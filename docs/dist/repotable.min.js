!function(t,e){"use strict";var i=e.module("repotable",["ng","ngSanitize","ngMessages"]);t.console?null:t.console={log:function(){}},i.constant("colTypes",{ID:1,IDS:2,TITLE:3,DATE:4,CUSTOMER:5,RESOURCE:6,STATUS:7,STATUSSM:8,FAMILY:9,NUMBER:10,HOURS:11,COSTS:12,PERCENT:13,INCREMENT:14,ICON:15,BUTTONS:16,DISABLED:17,LINK:18,BOOL:19,DOUBLE:20,WEEKS:21}),i.constant("fieldTypes",{ID:1,IDS:2,TITLE:3,DATE:4,CUSTOMER:5,RESOURCE:6,STATUS:7,STATUSSM:8,FAMILY:9,NUMBER:10,HOURS:11,COSTS:12,PERCENT:13,INCREMENT:14,ICON:15,BUTTONS:16,DISABLED:17,LINK:18,BOOL:19,DOUBLE:20,WEEKS:21}),i.constant("fieldTotalTypes",{SUM:1,MIN:2,MAX:3,AVG:4}),i.directive("draggableItem",["$parse","$timeout","Utils","Style","ElementRect","Droppables",function(i,r,n,s,a,o){return{require:"ngModel",link:function(c,u,l,h){function f(t){return k(c)&&(E=n.getTouch(t),p()),!1}function g(t){return w=n.getTouch(t),T=E.difference(w),!N&&T.power()>25&&(N=!0,u.addClass("dragging")),N&&(I.transform="translateX("+T.x+"px) translateY("+T.y+"px)",I.set(S),M.set(C).offset(T),b=o.getIntersections(M),b.length&&e.element(b[0].native).addClass("dropping")),!1}function d(t){if(N){N=!1,u.removeClass("dragging"),I.transform="none",I.set(S);var n=i(l.droppableIndex)(c),s=i(l.ngModel)(c);if(b.length){var a=null;e.forEach(b,function(t,i){e.element(t.native).removeClass("dropping over"),t.data.droppable(c)&&!a&&(a={from:{index:n,model:s,target:S},to:{index:t.data.index,model:t.data.model,target:t.native}},r(function(){c.$emit("onDropItem",a)}))})}else{var a={from:{index:n,model:s,target:S},to:null};r(function(){c.$emit("onDropOut",a)})}}return m(),!1}function p(){e.element(t).on("touchmove mousemove",g),e.element(t).on("touchend mouseup",d)}function m(){e.element(t).off("touchmove mousemove",g),e.element(t).off("touchend mouseup",d)}function v(){u.on("touchstart mousedown",f)}function y(){u.off("touchstart mousedown",f)}var E,w,T,N,b,C=u[0],x=l.draggableItem||".item",k=void 0!==l.draggableIf?i(l.draggableIf):function(){return!0},S=C.querySelector(x),I=new s,M=new a;c.$on("$destroy",function(){y()}),v()}}}]),i.directive("droppableItem",["$parse","Utils","Style","Droppables",function(t,e,i,r){return{require:"ngModel",link:function(e,i,n,s){function a(){var i=t(n.droppableIndex)(e),r=t(n.ngModel)(e),s=void 0!==n.droppableIf?t(n.droppableIf):function(){return!0};return{index:i,model:r,droppable:s}}var o=i[0];n.droppableItem||".item";r.add(o,a),e.$on("$destroy",function(){r.remove(o)})}}}]),i.directive("toggler",["$document","$parse","$timeout","Utils",function(t,i,r,n){return{restrict:"A",link:function(s,a,o,c){function u(){return i(o.toggler+"=="+o.value)(s)}function l(){d(),r(function(){i(o.toggler+"="+o.value)(s)})}function h(){p(),r(function(){i(o.toggler+"=null")(s)})}function f(t){setTimeout(function(){u()?h():l()},100)}function g(t){u()&&null===n.getClosestElement(t.target,a[0])&&null===n.getClosest(t.target,o.target)&&h()}function d(){e.element(t).on("click",g)}function p(){e.element(t).off("click",g)}function m(){a.on("click",f)}function v(){a.off("click",f)}if(void 0===o.value)throw new Error("[toggler] attribute value required");if(void 0===o.target)throw new Error("[toggler] attribute target required");s.$on("$destroy",function(){v(),p()}),m()}}}]),i.filter("shortName",["$filter",function(t){function e(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}return function(t){if(!t)return"";t.indexOf(" .")===t.length-2&&(t=t.split(" .").join(""));var i=t.split(" "),r=i.shift();if(i.length){var n=i.join(" ");return r.substr(0,1).toUpperCase()+"."+e(n)}return r}}]),i.filter("customCurrency",["$filter",function(t){var e=t("currency");return function(t,i){return e(t*i.ratio,i.formatting)}}]),i.filter("customNumber",["$filter",function(t){var e=t("number");return function(t,i,r){return r=r||"",t?e(t,i)+r:"-"}}]),i.filter("customHours",[function(){return function(t){if(t){var e=Math.floor(t),i=Math.floor(60*(t-e)),r=e?e+" H":"";return r+=i?" "+i+" m":""}return"-"}}]),i.filter("customDate",["$filter",function(t){var e=t("date");return function(t,i,r){return t?e(t,i,r):"-"}}]),i.filter("customTime",["$filter",function(t){return function(t,e){return t?Utils.parseTime(t):e?e:"-"}}]),i.filter("customDigital",["$filter",function(t){return function(t,e){return t?Utils.parseHour(t):e?e:"-"}}]),i.filter("customString",["$filter",function(t){return function(t,e){return t?t:e?e:"-"}}]),i.filter("customEnum",function(){return function(t){return t+=1,t<10?"0"+t:t}}),i.factory("State",["$timeout",function(t){function e(){this.isReady=!1,this.idle()}return e.prototype={idle:function(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.button=null,this.errors=[]},enabled:function(){return!this.isBusy&&!this.isErroring&&!this.isSuccessing},busy:function(){return!this.isBusy&&(this.isBusy=!0,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.errors=[],!0)},success:function(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!0,this.isSuccessing=!0,this.errors=[],t(function(){this.isSuccessing=!1,this.button=null}.bind(this),1e3)},error:function(e){this.isBusy=!1,this.isError=!0,this.isErroring=!0,this.isSuccess=!1,this.isSuccessing=!1,this.errors.push(e),t(function(){this.isErroring=!1,this.button=null}.bind(this),1e3)},ready:function(){this.isReady=!0,this.success()},errorMessage:function(){return this.isError?this.errors[this.errors.length-1]:null},submitClass:function(){return{busy:this.isBusy,ready:this.isReady,successing:this.isSuccessing,success:this.isSuccess,errorring:this.isErroring,error:this.isError}},submitMessage:function(t,e,i,r){return t=t||"Submit",this.isBusy?e||t:this.isSuccess?i||t:this.isError?r||t:t}},e}]),i.factory("Animate",[function(){function e(t,e){this.callback=t,this.isPlaying=!1,this.key=null,this.ticks=0,this.useTimeout=e===!0}return e.prototype={play:function(){function e(r){i.ticks++,i.callback(r,i.ticks),this.useTimeout?i.key=t.setTimeout(e,1e3/60):i.key=t.requestAnimationFrame(e)}var i=this;this.key||(this.isPlaying=!0,e())},pause:function(){this.key&&(this.useTimeout?t.clearTimeout(this.key):t.cancelAnimationFrame(this.key),this.key=null,this.isPlaying=!1)},playpause:function(){this.key?this.pause():this.play()}},e}]),i.factory("Md5",[function(){function t(t,e){var a=t[0],o=t[1],c=t[2],u=t[3];a=i(a,o,c,u,e[0],7,-680876936),u=i(u,a,o,c,e[1],12,-389564586),c=i(c,u,a,o,e[2],17,606105819),o=i(o,c,u,a,e[3],22,-1044525330),a=i(a,o,c,u,e[4],7,-176418897),u=i(u,a,o,c,e[5],12,1200080426),c=i(c,u,a,o,e[6],17,-1473231341),o=i(o,c,u,a,e[7],22,-45705983),a=i(a,o,c,u,e[8],7,1770035416),u=i(u,a,o,c,e[9],12,-1958414417),c=i(c,u,a,o,e[10],17,-42063),o=i(o,c,u,a,e[11],22,-1990404162),a=i(a,o,c,u,e[12],7,1804603682),u=i(u,a,o,c,e[13],12,-40341101),c=i(c,u,a,o,e[14],17,-1502002290),o=i(o,c,u,a,e[15],22,1236535329),a=r(a,o,c,u,e[1],5,-165796510),u=r(u,a,o,c,e[6],9,-1069501632),c=r(c,u,a,o,e[11],14,643717713),o=r(o,c,u,a,e[0],20,-373897302),a=r(a,o,c,u,e[5],5,-701558691),u=r(u,a,o,c,e[10],9,38016083),c=r(c,u,a,o,e[15],14,-660478335),o=r(o,c,u,a,e[4],20,-405537848),a=r(a,o,c,u,e[9],5,568446438),u=r(u,a,o,c,e[14],9,-1019803690),c=r(c,u,a,o,e[3],14,-187363961),o=r(o,c,u,a,e[8],20,1163531501),a=r(a,o,c,u,e[13],5,-1444681467),u=r(u,a,o,c,e[2],9,-51403784),c=r(c,u,a,o,e[7],14,1735328473),o=r(o,c,u,a,e[12],20,-1926607734),a=n(a,o,c,u,e[5],4,-378558),u=n(u,a,o,c,e[8],11,-2022574463),c=n(c,u,a,o,e[11],16,1839030562),o=n(o,c,u,a,e[14],23,-35309556),a=n(a,o,c,u,e[1],4,-1530992060),u=n(u,a,o,c,e[4],11,1272893353),c=n(c,u,a,o,e[7],16,-155497632),o=n(o,c,u,a,e[10],23,-1094730640),a=n(a,o,c,u,e[13],4,681279174),u=n(u,a,o,c,e[0],11,-358537222),c=n(c,u,a,o,e[3],16,-722521979),o=n(o,c,u,a,e[6],23,76029189),a=n(a,o,c,u,e[9],4,-640364487),u=n(u,a,o,c,e[12],11,-421815835),c=n(c,u,a,o,e[15],16,530742520),o=n(o,c,u,a,e[2],23,-995338651),a=s(a,o,c,u,e[0],6,-198630844),u=s(u,a,o,c,e[7],10,1126891415),c=s(c,u,a,o,e[14],15,-1416354905),o=s(o,c,u,a,e[5],21,-57434055),a=s(a,o,c,u,e[12],6,1700485571),u=s(u,a,o,c,e[3],10,-1894986606),c=s(c,u,a,o,e[10],15,-1051523),o=s(o,c,u,a,e[1],21,-2054922799),a=s(a,o,c,u,e[8],6,1873313359),u=s(u,a,o,c,e[15],10,-30611744),c=s(c,u,a,o,e[6],15,-1560198380),o=s(o,c,u,a,e[13],21,1309151649),a=s(a,o,c,u,e[4],6,-145523070),u=s(u,a,o,c,e[11],10,-1120210379),c=s(c,u,a,o,e[2],15,718787259),o=s(o,c,u,a,e[9],21,-343485551),t[0]=l(a,t[0]),t[1]=l(o,t[1]),t[2]=l(c,t[2]),t[3]=l(u,t[3])}function e(t,e,i,r,n,s){return e=l(l(e,t),l(r,s)),l(e<<n|e>>>32-n,i)}function i(t,i,r,n,s,a,o){return e(i&r|~i&n,t,i,s,a,o)}function r(t,i,r,n,s,a,o){return e(i&n|r&~n,t,i,s,a,o)}function n(t,i,r,n,s,a,o){return e(i^r^n,t,i,s,a,o)}function s(t,i,r,n,s,a,o){return e(r^(i|~n),t,i,s,a,o)}function a(e){var i,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(i=64;i<=e.length;i+=64)t(n,o(e.substring(i-64,i)));e=e.substring(i-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<e.length;i++)s[i>>2]|=e.charCodeAt(i)<<(i%4<<3);if(s[i>>2]|=128<<(i%4<<3),i>55)for(t(n,s),i=0;i<16;i++)s[i]=0;return s[14]=8*r,t(n,s),n}function o(t){var e,i=[];for(e=0;e<64;e+=4)i[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return i}function c(t){for(var e="",i=0;i<4;i++)e+=f[t>>8*i+4&15]+f[t>>8*i&15];return e}function u(t){for(var e=0;e<t.length;e++)t[e]=c(t[e]);return t.join("")}function l(t,e){return t+e&4294967295}function h(){}var f="0123456789abcdef".split("");return h.encode=function(t){return u(a(t))},"5d41402abc4b2a76b9719d911017c592"!==h.encode("hello")&&(l=function(t,e){var i=(65535&t)+(65535&e),r=(t>>16)+(e>>16)+(i>>16);return r<<16|65535&i}),h}]),i.factory("Utils",["$compile","$controller","Vector","Md5",function(i,r,n,s){function a(t,e){var i=new n;if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var r=null,s=t.originalEvent?t.originalEvent:t,a=s.touches.length?s.touches:s.changedTouches;a&&a.length&&(r=a[0]),r&&(i.x=r.pageX,i.y=r.pageY)}else"click"!=t.type&&"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(i.x=t.pageX,i.y=t.pageY);return e&&(i.s=n.difference(e,i)),i.type=t.type,i}function o(t,e){var i=t[0].getBoundingClientRect(),r=new n(i.left,i.top);return n.difference(r,e)}function c(t,e){var i,r;if(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(t){return"function"==typeof document.body[t]&&(i=t,!0)}),t[i](e))return t;for(;null!==t;){if(r=t.parentElement,null!==r&&r[i](e))return r;t=r}return null}function u(t,e){var i;if(t===e)return t;for(;null!==t;){if(i=t.parentElement,null!==i&&i===e)return i;t=i}return null}function l(t,e,i){var r,n,s,a=null,o=0;i||(i={});var c=function(){o=i.leading===!1?0:E(),a=null,s=t.apply(r,n),a||(r=n=null)};return function(){var u=E();o||i.leading!==!1||(o=u);var l=e-(u-o);return r=this,n=arguments,l<=0||l>e?(a&&(clearTimeout(a),a=null),o=u,s=t.apply(r,n),a||(r=n=null)):a||i.trailing===!1||(a=setTimeout(c,l)),s}}function h(t,i){var r=null;return t&&e.forEach(t,function(t){var n=!0;e.forEach(i,function(e,i){n=n&&t[i]===e}),n&&(r=t)}),r}function f(t,n,s,a){n.html(s);var o=i(n.contents());if(a.controller){var c=t.$new();e.extend(c,a);var u=r(a.controller,{$scope:c});a.controllerAs&&(t[a.controllerAs]=u),n.data("$ngControllerController",u),n.children().data("$ngControllerController",u),t=c}o(t)}function g(){}function d(t){return function(e,i){return e[t]<i[t]?1:e[t]>i[t]?-1:0}}function p(t,i,r){t=t||"",i=i||"";var n=t.split(",");if(n.length>1){var s=n.shift();return e.forEach(n,function(t,e){s=r?s.split("{"+e+"}").join("' + "+i+t+" + '"):s.split("{"+e+"}").join(i+t)}),r?"'"+s+"'":s}return i+t}function m(t,e){return t[e]}function v(t,e,i){return"string"==typeof e?v(t,e.split("."),i):1==e.length&&void 0!==i?t[e[0]]=i:0==e.length?t:v(t[e[0]],e.slice(1),i)}function y(t,e,i){return"string"==typeof e?y(t,e.split("."),i):1==e.length&&void 0!==i?t[e[0]]+=i:0==e.length?t:y(t[e[0]],e.slice(1),i)}!function(){for(var e=0,i=["ms","moz","webkit","o"],r=0;r<i.length&&!t.requestAnimationFrame;++r)t.requestAnimationFrame=t[i[r]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i[r]+"CancelAnimationFrame"]||t[i[r]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(i,r){var n=(new Date).getTime(),s=Math.max(0,16-(n-e)),a=t.setTimeout(function(){i(n+s)},s);return e=n+s,a}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}(),function(){Array.prototype.reduce||Object.defineProperty(Array.prototype,"reduce",{value:function(t){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof t)throw new TypeError(t+" is not a function");var e,i=Object(this),r=i.length>>>0,n=0;if(2==arguments.length)e=arguments[1];else{for(;n<r&&!(n in i);)n++;if(n>=r)throw new TypeError("Reduce of empty array with no initial value");e=i[n++]}for(;n<r;)n in i&&(e=t(e,i[n],n,i)),n++;return e}})}();var E=Date.now||function(){return(new Date).getTime()},w=t.navigator.userAgent.toLowerCase(),T=w.indexOf("safari")!==-1&&w.indexOf("chrome")===-1,N=w.indexOf("trident")!==-1||w.indexOf("edge")!==-1||w.indexOf("msie")!==-1,b=!T&&!N&&w.indexOf("chrome")!==-1,C=w.indexOf("mobile")!==-1;return g.reverseSortOn=d,g.getTouch=a,g.getRelativeTouch=o,g.getClosest=c,g.getClosestElement=u,g.throttle=l,g.where=h,g.format=p,g.compileController=f,g.reducer=m,g.reducerSetter=v,g.reducerAdder=y,g.toMd5=function(t){return s.encode(t)},g.ua={safari:T,msie:N,chrome:b,mobile:C},e.forEach(g.ua,function(t,i){t&&e.element(document.getElementsByTagName("body")).addClass(i)}),g}]),i.factory("Vector",function(){function t(t,e){this.x=t||0,this.y=e||0}return t.make=function(e,i){return new t(i.x-e.x,i.y-e.y)},t.size=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t.normalize=function(e){var i=t.size(e);return e.x/=i,e.y/=i,e},t.incidence=function(t,e){var i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return i},t.distance=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},t.cross=function(t,e){return t.x*e.y-t.y*e.x},t.difference=function(e,i){return new t(i.x-e.x,i.y-e.y)},t.power=function(t,e){var i=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);return(i+r)/2},t.prototype={size:function(){return t.size(this)},normalize:function(){return t.normalize(this)},incidence:function(e){return t.incidence(this,e)},cross:function(e){return t.cross(this,e)},distance:function(e){return t.distance(this,e)},difference:function(e){return t.difference(this,e)},power:function(){return(Math.abs(this.x)+Math.abs(this.y))/2},towards:function(t,e){return e=e||.125,this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},friction:function(t){return this.x*=t,this.y*=t,this},copy:function(e){return new t(this.x,this.y)},toString:function(){return"{"+this.x+","+this.y+"}"}},t}),i.factory("ElementRect",["Vector",function(t){function e(){this.x=0,this.y=0,this.width=0,this.height=0,this.center=new t}return e.fromNative=function(t){return(new e).set(t)},e.prototype={set:function(t){var e=t.getBoundingClientRect();return this.x=e.left,this.y=e.top,this.width=t.offsetWidth,this.height=t.offsetHeight,this.center.x=this.x+this.width/2,this.center.y=this.y+this.height/2,this.native=t,this},offset:function(t){return this.x+=t.x,this.y+=t.y,this.center.x=this.x+this.width/2,this.center.y=this.y+this.height/2,this},intersect:function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)},toString:function(){return"{"+this.x+","+this.y+","+this.width+","+this.height+"}"}},e}]),i.factory("Style",function(){function t(){this.props={scale:1,hoverScale:1,currentScale:1}}var i=function(){var t="transform",e="webkitTransform",r=document.createElement("DIV");return"undefined"!=typeof r.style[t]?["webkit","moz","o","ms"].every(function(t){var e="-"+t+"-transform";return"undefined"==typeof r.style[e]||(i=e,!1)}):i="undefined"!=typeof r.style[e]?"-webkit-transform":void 0,i}();return t.prototype={set:function(t){var i=[];e.forEach(this,function(t,e){"props"!==e&&i.push(e+":"+t)}),t.style.cssText=i.join(";")+";"},transform:function(t){this[i]=t},transformOrigin:function(t,e){this[i+"-origin-x"]=Math.round(1e3*t)/1e3+"%",this[i+"-origin-y"]=Math.round(1e3*e)/1e3+"%"}},t.prefix=i,t}),i.factory("Filters",[function(){function t(){this.keys={},this.flags={},this.values=[],this.search=[]}return t.prototype={has:function(t){return t&&this.keys[t]===!0||!1},active:function(t){return this.has(t)&&this.flags[t]===!0||!1},removeAll:function(){this.keys={},this.values.length=0},reset:function(){this.removeAll(),this.flags={},this.search=[]},toggle:function(t){if(this.active(t.id)){t.active=this.flags[t.id]=!1;var e=this.search.indexOf(t.id);this.search.splice(e,1)}else t.active=this.flags[t.id]=!0,this.search.push(t.id)},add:function(t){t.id&&!this.has(t.id)&&(this.keys[t.id]=!0,this.values.push(t))},remove:function(t){if(this.has(t.id)){var e;this.flags[t.id]===!0&&(t.active=this.flags[t.id]=!1,e=this.search.indexOf(t.id),this.search.splice(e,1)),e=this.values.indexOf(t),this.values.splice(e,1),this.keys[t.id]=!1}},sort:function(){this.values.sort(function(t,e){var i,r;return i=t.name?String(t.name).toLowerCase():"",r=e.name?String(e.name).toLowerCase():"",i<r?-1:i>r?1:0})},filter:function(t){return!this.search.length||this.search.indexOf(t.key)!==-1}},t}]),i.factory("Order",[function(){function t(){this.set(0)}return t.prototype={set:function(t){switch(t){case 1:this.name="Asc",this.sort=1,this.asc=!0,this.desc=!1;break;case-1:this.name="Desc",this.sort=-1,this.asc=!1,this.desc=!0;break;default:this.name="Ordina",this.sort=0,this.asc=!1,this.desc=!1}},toggle:function(){var t=this.sort-1;t===-2?t=1:null,this.set(t)}},t}]),i.factory("Field",["$parse","$filter","Utils","Filters","Order","fieldTypes","fieldTotalTypes",function(t,i,r,n,s,a,o){function c(i){this.filters=new n,this.order=new s,this.typeTotal=this.typeTotal||o.SUM,i?e.extend(this,i):null,e.isFunction(this.value)&&(this.value=this.value.bind(this)),this.name=this.name||this.value,this.raw=this.raw||this.value,this.key=this.key||this.value,this.source=this.source||this.value,this.getters={};var r=["key","value","raw","source","post"];e.forEach(r,function(i){this[i]&&(this.getters[i]=e.isFunction(this[i])?this[i]:t(this[i]))},this),this.setters={},e.forEach(this.getters,function(t,i){e.isFunction(this[i])||(this.setters[i]=t.assign)},this),this.keys={},this.total=0}return c.prototype={reset:function(){this.keys={},this.total=0,this.isActive()||this.filters.reset()},addValue:function(t){var e=this.getKey(t);if(!this.filters.has(e)){var i=this.getRaw(t),r=this.filters.flags[e];this.filters.add({id:e,name:i||"-",active:r})}},filter:function(t){return!this.isActive()||!this.filters.search.length||this.filters.search.indexOf(t.cells[this.$id].key)!==-1},getKey:function(t){return this.getters.key(t)},getValue:function(t){return this.getters.value(t)},getRaw:function(t){return this.getters.raw(t)},getSource:function(t){return this.getters.source(t)},hasKey:function(t){var e=!0,i=this.getKey(t);return i&&1!=this.keys[i]&&(this.keys[i]=!0,e=!1),e},initValue:function(t){return this.setters.raw(t,this.getters.value(t)||0),this},aggregation:function(t,e){var i=this.getters.raw(t)||0,r=this.getters.value(e)||0,n=this;switch(n.typeTotal){case o.MIN:n.setters.raw(t,Math.min(i,r));break;case o.MAX:n.setters.raw(t,Math.max(i,r));break;case o.AVG:var s=0;n.setters.raw(t,(r+i*s)/(s+1));break;default:n.setters.raw(t,i+r)}return n},addCount:function(t,e){if(!this.hasKey(e)&&this.setters.raw){var i=null;i=t!=e?(this.getters.raw(t)||0)+1:1,this.setters.raw(t,i)}return this},getFormatted:function(t){return this.dynamic?this.formatValue(this.getRaw(t)):t.cells[this.$id].name},getFormat:function(){var t="";switch(this.type){case a.ID:case a.NUMBER:t="#";break;case a.DOUBLE:t="#";break;case a.DATE:t="yyyy-mm-dd";break;case a.WEEKS:t="#,###0 [$W]";break;case a.HOURS:t="#,###0 [$H]";break;case a.COSTS:t="#,###.00 €";break;case a.PERCENT:t="0.00%";break;case a.INCREMENT:t="[Color 10]+0.00%;[Red]-0.00%;-"}return t},getLink:function(t){return e.isFunction(this.link)?this.link(t):null},getHeaderClass:function(){var t=[];switch(e.forEach(this,function(e,i){e===!0&&t.push(i)}),this.type){case a.NUMBER:case a.DOUBLE:case a.WEEKS:case a.HOURS:case a.COSTS:case a.PERCENT:case a.INCREMENT:t.push("text-xs-right")}return t.join(" ")},getCellClass:function(t){var i=[];switch(e.forEach(this,function(t,e){t===!0&&i.push(e)}),this.type){case a.LINK:i.push("text-underline");break;case a.NUMBER:case a.DOUBLE:case a.WEEKS:case a.HOURS:case a.COSTS:i.push("text-xs-right");break;case a.PERCENT:i.push("text-xs-right");break;case a.INCREMENT:i.push("text-xs-right")}return i.join(" ")},getColumnClass:function(){return this.color?"shade-light-blue-"+this.color:""},getItemClass:function(t){var e=[];e.push(t.cells[this.$id].cellClass);var i=this.getColumnClass();return""!=i&&e.push(i),e.join(" ")},getTextClass:function(t){var i=[];switch(this.type){case a.INCREMENT:var r=this.getRaw(t);e.isNumber(r)&&r<0?i.push("text-danger"):i.push("text-success")}return i.join(" ")},isActive:function(){return e.isFunction(this.active)&&this.active?this.active():this.active},toggle:function(){e.isFunction(this.active)?null:this.active=!this.active},activate:function(){e.isFunction(this.active)?null:this.active=!0},deactivate:function(){e.isFunction(this.active)?null:this.active=!1},formatValue:function(t){switch(this.type){case a.RESOURCE:case a.DISABLED:t=i("shortName")(t);break;case a.ID:case a.NUMBER:t=i("customNumber")(t,0);break;case a.DOUBLE:t=i("customNumber")(t,2);break;case a.WEEKS:t=i("customNumber")(t,2," W");break;case a.DATE:t=i("date")(t,"yyyy-MM-dd");break;case a.HOURS:t=i("customNumber")(t,0," H");break;case a.COSTS:t=i("customNumber")(t,0," €");break;case a.PERCENT:t=i("customNumber")(t,2," %");break;case a.INCREMENT:t=e.isNumber(t)?(t>0?"+":"")+i("customNumber")(t,2," %"):t||"-"}return t},getTotal:function(t){var e=this.getValueTotal(t);return this.formatValue(e)},getValueTotal:function(t){var i=0,r=this;if(r.compare&&r.type===a.INCREMENT){var n=0,s=0;e.forEach(t,function(t){n+=r.$field.getters.raw(t)||0,s+=r.getters.raw(t)||0}.bind(this)),s&&(i=(n-s)/s*100)}else{switch(r.typeTotal){case o.SUM:i=0;break;case o.MIN:i=Number.POSITIVE_INFINITY;break;case o.MAX:i=Number.NEGATIVE_INFINITY;break;case o.AVG:}e.forEach(t,function(t,e){var n=i,s=r.getters.raw(t)||0;switch(r.typeTotal){case o.SUM:i=n+s;break;case o.MIN:i=n<s?n:s;break;case o.MAX:i=n>s?n:s;break;case o.AVG:i=(s+n*e)/(e+1)}}),i===Number.POSITIVE_INFINITY||i===Number.NEGATIVE_INFINITY?i=0:null}return r.total=i,i},getTotalClass:function(t){var e=[];switch(this.type){case a.NUMBER:case a.DOUBLE:case a.WEEKS:case a.HOURS:case a.COSTS:case a.PERCENT:case a.INCREMENT:e.push("text-xs-right")}return e.join(" ")},getCellTotal:function(t,i){var r,n=0,s=this;if(s.compare&&s.type===a.INCREMENT){var c=0,u=0;e.forEach(t,function(t){r=t.cols[i],c+=s.$field.getters.raw(item)||0,u+=r.getValue()||0}),u&&(n=(c-u)/u*100)}else{switch(s.typeTotal){case o.SUM:n=0;break;case o.MIN:n=Number.POSITIVE_INFINITY;break;case o.MAX:n=Number.NEGATIVE_INFINITY;break;case o.AVG:}e.forEach(t,function(t,e){r=t.cols[i];var a=n,c=r.getValue()||0;switch(s.typeTotal){case o.SUM:n=a+c;break;case o.MIN:n=a<c?a:c;break;case o.MAX:n=a>c?a:c;break;case o.AVG:n=(c+a*e)/(e+1)}}),n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY?n=0:null}return s.total=n,n},toStatic:function(t){this.post&&this.setters.raw(t,this.getters.post(t)||0);var e=this,i=t.cells[e.$id]={cellClass:e.getCellClass(t),textClass:e.getTextClass(t),link:e.link?e.link(t):null,pop:e.pop?e.pop(t):null,key:e.getKey(t),getValue:function(){return e.dynamic?e.getters.value(t):i.value?i.value:e.getters.raw(t)},getName:function(){return e.dynamic?e.formatValue(i.getValue()):i.name?i.name:e.formatValue(i.getValue())},getTotalValue:function(t,i){return e.getCellTotal(t,i)},getTotalName:function(t,r){var n=i.getTotalValue(t,r);return e.formatValue(n)},formatValue:function(t){return e.formatValue(t)}};return i.value=i.getValue(),i.name=i.getName(),i}},c.types=a,c.totalTypes=o,c}]),i.factory("Fields",["$parse","Utils","Field","fieldTypes",function(t,i,r,n){function s(t){var i=[];return t&&e.forEach(t,function(t,e){t.$id=e+1,i.push(new r(t))}),e.extend(i,s.prototype),i}return s.prototype={expand:function(t){var i={dynamic:!0,compare:!1};t?e.extend(i,t):null;var a=[];return a.radios={},e.forEach(this,function(t,e){t.$id=a.length+1,a.push(t),t.aggregate&&t.value===t.raw&&(i.dynamic&&a.push(new r({$id:a.length+1,name:"%",value:function(e){return t.getters.raw(e)/t.total*100},key:t.key,type:n.PERCENT,dynamic:!0,active:function(){return a.show.dynamic&&t.active},$field:t})),i.compare&&(a.push(new r({$id:a.length+1,name:"anno precedente",value:function(t){return this.getters.raw(t)},raw:t.value+"Last",source:t.value,key:t.key,type:t.type,count:t.count,compare:!0,dynamic:!0,active:function(){return a.show.compare&&t.active},$field:t})),a.push(new r({$id:a.length+1,name:"%",value:function(e){var i=t.getters.raw(e)||0,r=this.getters.raw(e)||0;return r?(i-r)/r*100:null},raw:t.value+"Gain",source:t.value,key:t.key,type:n.INCREMENT,count:t.count,compare:!0,dynamic:!0,active:function(){return a.show.compare&&t.active},$field:t})))),t.radio&&t.active&&(a.radios[t.radio]=t.value)}),e.extend(a,s.prototype),a},reset:function(){return this.groups={},e.forEach(this,function(t){t.reset()}),this},unique:function(t,e){var i=this.getGroupKey(t),r=this.groups[i];return r||(r=this.groups[i]=t,r.cells=[],e.push(r)),r},iterate:function(t,i){t=e.copy(t);var r=this.unique(t,i);this.aggregation(r,t)},compare:function(t,i){t=e.copy(t),e.forEach(this,function(e){if(e.compare){var i=e.getters.source(t);e.setters.raw(t,i),e.setters.source(t,0)}});var r=this.unique(t,i);this.aggregation(r,t,!0)},aggregation:function(t,i,r){return e.forEach(this,function(e){(e.isActive()||e.always)&&(r?e.compare:!e.compare)&&(e.count?e.addCount(t,i):(r||e.aggregate)&&(e.hasKey(i)||(t===i?e.initValue(t):e.aggregation(t,i))))}),this},getCount:function(){var t=0;return e.forEach(this,function(e){t+=e.isActive()?1:0}.bind(this)),t},getFirstField:function(){var t=null;return e.forEach(this,function(e){null===t&&e.isActive()&&e.groupBy&&"month"!==e.value&&"monthShort"!==e.value&&(t=e)}),t},getGroupKey:function(t){var i=[];return e.forEach(this,function(e){e.isActive()&&e.groupBy&&i.push(e.getKey(t))}),i.join("-")},getGroups:function(){var t=[];return e.forEach(this,function(e,i){e.groupBy&&t.push(e)}),e.extend(t,s.prototype),t},getAggregates:function(){var t=[];return e.forEach(this,function(e,i){e.aggregate&&!e.count&&t.push(e)}),e.extend(t,s.prototype),t},getPercentages:function(){var t=[];return e.forEach(this,function(e,i){e.type===n.PERCENT&&t.push(e)}),e.extend(t,s.prototype),t},getDynamics:function(){var t=[];return e.forEach(this,function(e,i){e.dynamic&&t.push(e)}),e.extend(t,s.prototype),t},getCompares:function(){var t=[];return e.forEach(this,function(e,i){e.compare&&t.push(e)}),e.extend(t,s.prototype),t},getCounters:function(){var t=[];return e.forEach(this,function(e,i){e.count&&t.push(e)}),e.extend(t,s.prototype),t},activeInRange:function(t){for(var e=!1,i=0;!e&&i<this.length;){var r=this[i];r.active&&(e=t.indexOf(r.value)!==-1),i++}return e},toggleFields:function(t){t.radio?(e.forEach(this,function(e){t.radio===e.radio&&t!==e&&e.deactivate()}),t.activate(),this.radios[t.radio]=t.value):t.toggle()},show:{table:!0},toStatic:function(t){var i,r=this,n=[],s=[];return e.forEach(r,function(t){t.filters.removeAll(),t.col={active:t.isActive(),headerClass:t.getHeaderClass(),columnClass:t.getColumnClass(),totalClass:t.getTotalClass(),format:t.getFormat(),$id:t.$id,colName:t.name,type:t.type,groupBy:t.groupBy,aggregate:t.aggregate,compare:t.compare,filters:t.filters,order:t.order},t.col.active&&(t.col.index=n.length,n.push(t.col))}),e.forEach(r,function(r){(r.col.active||r.dynamic||r.always)&&(e.forEach(t,function(t,n){i=r.toStatic(t),r.hasSearch&&r.groupBy&&r.addValue(t);var a=s[n]=s[n]||{cols:[]};i=e.extend(e.copy(i),r.col),a.cols[r.col.index]=i}),r.hasSearch&&r.groupBy&&r.filters.sort())}),e.forEach(n,function(t,e){var i=s[s.length-1].cols[e];t.$last=i,t.getTotalValue=function(t){return i.getTotalValue(t,e)},t.getTotalName=function(t){return i.getTotalName(t,e)}}),{cols:n,rows:s}}},s.fromDatas=function(t){return s.parseDatas(t)},s.parseDatas=function(t){function i(t,s){if(e.isArray(t))e.forEach(t,function(t,e){i(t,(s||"")+"["+e+"]")});else if(e.isObject(t))e.forEach(t,function(t,e){i(t,(s?s+".":"")+e)});else{var a={value:s,type:n.TEXT,active:r.length<6};e.isDate(t)||e.isNumber(t)&&(s.toLowerCase().indexOf("date")!==-1||s.toLowerCase().indexOf("time")!==-1)?(a.type=n.DATE,a.groupBy=!0,a.hasSearch=!0):e.isNumber(t)?(a.type=n.NUMBER,a.aggregate=!0,a.color=1):(a.groupBy=!0,a.hasSearch=!0),r.push(a)}}var r=null;return t&&t.length&&(r=[],i(t[0])),r},s.types=n,s}]),i.factory("Table",["$parse","Fields","fieldTypes","orderByFilter",function(t,i,r,n){function s(t,e){this.fields=new i(t).expand(e),this.defaults=t.map(function(t){return{$id:t.$id,active:t.active}}),this.colGroups=[{name:"GroupBy",items:this.fields.getGroups()}],this.valGroups=[{name:"Aggregate",items:this.fields.getAggregates()}],this.excludes=[],this.includes=[],this.setOptions(e),this.datas=[],this.items=[],this.rows=[],this.cols=[]}var a=4;return s.prototype={setDatas:function(t,i){t&&e.forEach(t,function(t,e){t.$id=e+1}),this.datas=t,i&&e.forEach(i,function(t,e){t.$id=e+1}),this.compares=i,this.update()},setOptions:function(t){var e=this;this.options=[{name:"Columns",template:"partials/report/filters/columns",icon:"icon-columns",groups:this.colGroups,toggle:function(t){return e.toggleField(t)},active:!0},{name:"Values",template:"partials/report/filters/values",icon:"icon-values",groups:this.valGroups,toggle:function(t){return e.toggleField(t)}},{name:"Options",template:"partials/report/filters/flags",icon:"icon-options",rows:[{name:"Exclude",items:this.exclude,toggle:function(t){return e.exclude(t)}},{name:"Include",items:this.includes,toggle:function(t){return e.include(t)}},{name:"Flags",items:[{name:"Percentuali di incidenza",key:"dynamic"}],toggle:function(t){return e.toggle(t.key)}}]}]},update:function(){this.items=[],this.rows=[],this.cols=[];var t=this.datas,i=this.items,r=this.fields,n=this.excludes,s=this.includes,a=this.compares;r.reset(),e.forEach(t,function(t){var a=!0;e.forEach(n,function(e){e.active&&(a=a&&e.filter(t))}),e.forEach(s,function(e){e.active&&(a=a&&e.filter(t))}),a&&r.iterate(t,i)}),a&&e.forEach(a,function(t){var a=!0;e.forEach(n,function(e){e.active&&(a=a&&e.filter(t))}),e.forEach(s,function(e){e.active&&(a=a&&e.filter(t))}),a&&r.compare(t,i)}),this.toStatic(),this.after&&e.isFunction(this.after)&&this.after(i)},setOrderBy:function(){var t,i=[],r=[],n=[],s=[];e.forEach(this.fields,function(e,a){e.col.active&&(0!==e.order.sort&&(t=e.order.sort===-1?"-":"",s.push(t+"cols["+i.length+"].getValue()"),r.push(t+e.raw)),n.push("cols["+i.length+"].getValue()"),i.push(e.raw))}),i.length=Math.min(a,i.length),n.length=Math.min(3,n.length),this.orderBy=r.length?r:i,this.filteredOrderBy=s.length?s:n},exclude:function(t){t.active=!t.active,this.update()},include:function(t){t.active=!t.active,this.update()},has:function(t){return this.fields?this.fields.show[t]:null},resetFilters:function(){var t=this;e.forEach(t.fields,function(i,r){e.forEach(t.defaults,function(t){i.$id===t.$id&&(e.isFunction(i.active)?null:i.active=t.active)}),i.filters.reset()}),t.fields=t.fields.sort(function(t,e){return t.$id-e.$id}),t.update()},doFilterStatic:function(t){var i,r=this;r.fields;return function(t){var n=!0;if(e.forEach(r.cols,function(e,r){
i=t.cols[r],i.matches=null,n=n&&e.filters.filter(i)}),n&&r.search&&r.search.length){var s=!1;e.forEach(t.cols,function(t){t.matches=new RegExp(r.search,"gim").exec(t.name),s=s||null!==t.matches}),n=n&&s}return n}},toggle:function(t){var e=null;if(this.fields){var i=this.fields.show;switch(i[t]=!i[t],t){case"dynamic":i.compare=!1;break;case"compare":i.dynamic=!1}e=i[t]}return this.toStatic(),e},toggleField:function(t){this.fields.toggleFields(t),this.update()},toggleOrder:function(t){e.forEach(this.fields,function(e){e.$id!==t.$id&&e.order.set(0)}),t.order.toggle(),this.setOrderBy()},swap:function(t,i){e.forEach(this.fields,function(e){e.$id===t.$id&&(t=e),e.$id===i.$id&&(i=e)});var r=this.fields.indexOf(t),n=this.fields[r];this.fields.splice(r,1);var s=this.fields.indexOf(i);this.fields.splice(s,0,n),this.update()},toStatic:function(){var t=this.fields.toStatic(this.items);this.rows=t.rows,this.cols=t.cols,this.setOrderBy()},toJson:function(t){var i={name:"Repotable",description:"a view of selected datas"};if(t?e.extend(i,t):null,i.columns=[],i.rows=[],this.rows.length){var n=this.cols,s=this.rows;e.forEach(n,function(t,e){i.columns.push({index:e,name:t.colName,format:t.format})}),e.forEach(s,function(t,s){var a=[];e.forEach(n,function(e,i){var n=t.cols[i];switch(a[i]=n.getValue(),e.type){case r.PERCENT:case r.INCREMENT:a[i]/=100}}),i.rows.push(a)});var a=[];e.forEach(n,function(t,e){if(t.aggregate)switch(a[e]=t.getTotalValue(),t.type){case r.PERCENT:case r.INCREMENT:a[e]/=100}else a[e]=null}),i.rows.push(a)}return i}},s.fromDatas=function(t){(!e.isArray(t)||!t.length>1||!e.isObject(t[0]))&&e.forEach(t,function(i){e.isArray(i)&&i.length&&e.isObject(i[0])&&(t=i)}),e.isArray(t)||(t=[t]);var r=i.fromDatas(t),n=new s(r);return n.setDatas(t),n},s}]),i.factory("Column__",["$parse","$filter","Utils","Filters","Order","colTypes",function(t,i,r,n,s,a){function o(i){this.filters=new n,this.order=new s,this.typeTotal=this.typeTotal||c.SUM,i?e.extend(this,i):null,e.isFunction(this.value)&&(this.value=this.value.bind(this)),this.name=this.name||this.value,this.raw=this.raw||this.value,this.key=this.key||this.value,this.source=this.source||this.value,this.getters={};var r=["key","value","raw","source","post"];e.forEach(r,function(i){this[i]&&(this.getters[i]=e.isFunction(this[i])?this[i]:t(this[i]))},this),this.setters={},e.forEach(this.getters,function(t,i){e.isFunction(this[i])||(this.setters[i]=t.assign)},this),this.keys={},this.total=0}var c={SUM:1,MIN:2,MAX:3,AVG:4};return o.prototype={reset:function(){this.keys={},this.total=0,this.isActive()||this.filters.reset()},addValue:function(t){var e=this.getKey(t);if(!this.filters.has(e)){var i=this.getRaw(t),r=this.filters.flags[e];this.filters.add({id:e,name:i||"-",active:r})}},filter:function(t){return!this.isActive()||!this.filters.search.length||this.filters.search.indexOf(t.static[this.id].key)!==-1},getKey:function(t){return this.getters.key(t)},getValue:function(t){return this.getters.value(t)},getRaw:function(t){return this.getters.raw(t)},getSource:function(t){return this.getters.source(t)},hasKey:function(t){var e=!0,i=this.getKey(t);return i&&1!=this.keys[i]&&(this.keys[i]=!0,e=!1),e},initValue:function(t){return this.setters.raw(t,this.getters.value(t)||0),this},aggregation:function(t,e){var i=this.getters.raw(t)||0,r=this.getters.value(e)||0,n=this;switch(n.typeTotal){case c.MIN:n.setters.raw(t,Math.min(i,r));break;case c.MAX:n.setters.raw(t,Math.max(i,r));break;case c.AVG:var s=0;n.setters.raw(t,(r+i*s)/(s+1));break;default:n.setters.raw(t,i+r)}return n},addCount:function(t,e){if(!this.hasKey(e)&&this.setters.raw){var i=null;i=t!=e?(this.getters.raw(t)||0)+1:1,this.setters.raw(t,i)}return this},getFormatted:function(t){return this.dynamic?this.formatValue(this.getRaw(t)):t.static[this.id].name},getFormat:function(){var t="";switch(this.type){case a.ID:case a.NUMBER:t="#";break;case a.DOUBLE:t="#";break;case a.DATE:t="yyyy-mm-dd";break;case a.WEEKS:t="#,###0 [$W]";break;case a.HOURS:t="#,###0 [$H]";break;case a.COSTS:t="#,###.00 €";break;case a.PERCENT:t="0.00%";break;case a.INCREMENT:t="[Color 10]+0.00%;[Red]-0.00%;-"}return t},getLink:function(t){return e.isFunction(this.link)?this.link(t):null},getHeaderClass:function(){var t=[];switch(e.forEach(this,function(e,i){e===!0&&t.push(i)}),this.type){case a.NUMBER:case a.DOUBLE:case a.WEEKS:case a.HOURS:case a.COSTS:case a.PERCENT:case a.INCREMENT:t.push("text-xs-right")}return t.join(" ")},getCellClass:function(t){var i=[];switch(e.forEach(this,function(t,e){t===!0&&i.push(e)}),this.type){case a.LINK:i.push("text-underline");break;case a.NUMBER:case a.DOUBLE:case a.WEEKS:case a.HOURS:case a.COSTS:i.push("text-xs-right");break;case a.PERCENT:i.push("text-xs-right");break;case a.INCREMENT:i.push("text-xs-right")}return i.join(" ")},getColumnClass:function(){return this.color?"shade-light-blue-"+this.color:""},getItemClass:function(t){var e=[];e.push(t.static[this.id].cellClass);var i=this.getColumnClass();return""!=i&&e.push(i),e.join(" ")},getTextClass:function(t){var i=[];switch(this.type){case a.INCREMENT:var r=this.getRaw(t);e.isNumber(r)&&r<0?i.push("text-danger"):i.push("text-success")}return i.join(" ")},isActive:function(){return e.isFunction(this.active)&&this.active?this.active():this.active},toggle:function(){e.isFunction(this.active)?null:this.active=!this.active},activate:function(){e.isFunction(this.active)?null:this.active=!0},deactivate:function(){e.isFunction(this.active)?null:this.active=!1},formatValue:function(t){switch(this.type){case a.RESOURCE:case a.DISABLED:t=i("shortName")(t);break;case a.ID:case a.NUMBER:t=i("customNumber")(t,0);break;case a.DOUBLE:t=i("customNumber")(t,2);break;case a.WEEKS:t=i("customNumber")(t,2," W");break;case a.DATE:t=i("date")(t,"yyyy-MM-dd");break;case a.HOURS:t=i("customNumber")(t,0," H");break;case a.COSTS:t=i("customNumber")(t,0," €");break;case a.PERCENT:t=i("customNumber")(t,2," %");break;case a.INCREMENT:t=e.isNumber(t)?(t>0?"+":"")+i("customNumber")(t,2," %"):t||"-"}return t},getTotal:function(t){var e=this.getValueTotal(t);return this.formatValue(e)},getValueTotal:function(t){var i=0,r=this;if(r.compare&&r.type===a.INCREMENT){var n=0,s=0;e.forEach(t,function(t){n+=r.$col.getters.raw(t)||0,s+=r.getters.raw(t)||0}.bind(this)),s&&(i=(n-s)/s*100)}else{switch(r.typeTotal){case c.SUM:i=0;break;case c.MIN:i=Number.POSITIVE_INFINITY;break;case c.MAX:i=Number.NEGATIVE_INFINITY;break;case c.AVG:}e.forEach(t,function(t,e){var n=i,s=r.getters.raw(t)||0;switch(r.typeTotal){case c.SUM:i=n+s;break;case c.MIN:i=n<s?n:s;break;case c.MAX:i=n>s?n:s;break;case c.AVG:i=(s+n*e)/(e+1)}}),i===Number.POSITIVE_INFINITY||i===Number.NEGATIVE_INFINITY?i=0:null}return r.total=i,i},getTotalClass:function(t){var e=[];switch(this.type){case a.NUMBER:case a.DOUBLE:case a.WEEKS:case a.HOURS:case a.COSTS:case a.PERCENT:case a.INCREMENT:e.push("text-xs-right")}return e.join(" ")},getCellTotal:function(t,i){var r,n=0,s=this;if(s.compare&&s.type===a.INCREMENT){var o=0,u=0;e.forEach(t,function(t){r=t.cols[i],o+=s.$col.getters.raw(item)||0,u+=r.getValue()||0}),u&&(n=(o-u)/u*100)}else{switch(s.typeTotal){case c.SUM:n=0;break;case c.MIN:n=Number.POSITIVE_INFINITY;break;case c.MAX:n=Number.NEGATIVE_INFINITY;break;case c.AVG:}e.forEach(t,function(t,e){r=t.cols[i];var a=n,o=r.getValue()||0;switch(s.typeTotal){case c.SUM:n=a+o;break;case c.MIN:n=a<o?a:o;break;case c.MAX:n=a>o?a:o;break;case c.AVG:n=(o+a*e)/(e+1)}}),n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY?n=0:null}return s.total=n,n},toStatic:function(t){this.post&&this.setters.raw(t,this.getters.post(t)||0);var e=this,i=t.static[e.id]={cellClass:e.getCellClass(t),textClass:e.getTextClass(t),link:e.link?e.link(t):null,pop:e.pop?e.pop(t):null,key:e.getKey(t),getValue:function(){return e.dynamic?e.getters.value(t):i.value?i.value:e.getters.raw(t)},getName:function(){return e.dynamic?e.formatValue(i.getValue()):i.name?i.name:e.formatValue(i.getValue())},getTotalValue:function(t,i){return e.getCellTotal(t,i)},getTotalName:function(t,r){var n=i.getTotalValue(t,r);return e.formatValue(n)},formatValue:function(t){return e.formatValue(t)}};return i.value=i.getValue(),i.name=i.getName(),i}},o.types=a,o}]),i.factory("Columns__",["$parse","Utils","Column","colTypes",function(t,i,r,n){function s(t){var i=[];return t&&e.forEach(t,function(t,e){t.id=e+1,i.push(new r(t))}),e.extend(i,s.prototype),i}return s.prototype={expand:function(t){var i={dynamic:!0,compare:!1};t?e.extend(i,t):null;var a=[];return a.radios={},e.forEach(this,function(t,e){t.id=a.length+1,a.push(t),t.aggregate&&t.value===t.raw&&(i.dynamic&&a.push(new r({id:a.length+1,name:"%",value:function(e){return t.getters.raw(e)/t.total*100},key:t.key,type:n.PERCENT,dynamic:!0,active:function(){return a.show.dynamic&&t.active},$col:t})),i.compare&&(a.push(new r({id:a.length+1,name:"anno precedente",value:function(t){return this.getters.raw(t)},raw:t.value+"Last",source:t.value,key:t.key,type:t.type,count:t.count,compare:!0,dynamic:!0,active:function(){return a.show.compare&&t.active},$col:t})),a.push(new r({id:a.length+1,name:"%",value:function(e){var i=t.getters.raw(e)||0,r=this.getters.raw(e)||0;return r?(i-r)/r*100:null},raw:t.value+"Gain",source:t.value,key:t.key,type:n.INCREMENT,count:t.count,compare:!0,dynamic:!0,active:function(){return a.show.compare&&t.active},$col:t})))),t.radio&&t.active&&(a.radios[t.radio]=t.value)}),e.extend(a,s.prototype),a},reset:function(){return this.groups={},e.forEach(this,function(t){t.reset()}),this},unique:function(t,e){var i=this.getGroupKey(t),r=this.groups[i];return r||(r=this.groups[i]=t,r.static=[],e.push(r)),r},iterate:function(t,i){t=e.copy(t);var r=this.unique(t,i);this.aggregation(r,t)},compare:function(t,i){t=e.copy(t),e.forEach(this,function(e){if(e.compare){var i=e.getters.source(t);e.setters.raw(t,i),e.setters.source(t,0)}});var r=this.unique(t,i);this.aggregation(r,t,!0)},aggregation:function(t,i,r){return e.forEach(this,function(e){(e.isActive()||e.always)&&(r?e.compare:!e.compare)&&(e.count?e.addCount(t,i):(r||e.aggregate)&&(e.hasKey(i)||(t===i?e.initValue(t):e.aggregation(t,i))))}),this},getCount:function(){var t=0;return e.forEach(this,function(e){t+=e.isActive()?1:0}.bind(this)),t},getFirstCol:function(){var t=null;return e.forEach(this,function(e){null===t&&e.isActive()&&e.groupBy&&"month"!==e.value&&"monthShort"!==e.value&&(t=e)}),t},getGroupKey:function(t){var i=[];return e.forEach(this,function(e){e.isActive()&&e.groupBy&&i.push(e.getKey(t))}),i.join("-")},getGroups:function(){var t=[];return e.forEach(this,function(e,i){e.groupBy&&t.push(e)}),e.extend(t,s.prototype),t},getAggregates:function(){var t=[];return e.forEach(this,function(e,i){e.aggregate&&!e.count&&t.push(e)}),e.extend(t,s.prototype),t},getPercentages:function(){var t=[];return e.forEach(this,function(e,i){e.type===n.PERCENT&&t.push(e)}),e.extend(t,s.prototype),t},getDynamics:function(){var t=[];return e.forEach(this,function(e,i){e.dynamic&&t.push(e)}),e.extend(t,s.prototype),t},getCompares:function(){var t=[];return e.forEach(this,function(e,i){e.compare&&t.push(e)}),e.extend(t,s.prototype),t},getCounters:function(){var t=[];return e.forEach(this,function(e,i){e.count&&t.push(e)}),e.extend(t,s.prototype),t},activeInRange:function(t){for(var e=!1,i=0;!e&&i<this.length;){var r=this[i];r.static.active&&(e=t.indexOf(r.value)!==-1),i++}return e},toggleColumns:function(t){t.radio?(e.forEach(this,function(e){t.radio===e.radio&&t!==e&&e.deactivate()}),t.activate(),this.radios[t.radio]=t.value):t.toggle()},show:{table:!0},toStatic:function(t){var i=[],r=[];return e.forEach(this,function(t){t.filters.removeAll(),t.static={active:t.isActive(),headerClass:t.getHeaderClass(),columnClass:t.getColumnClass(),totalClass:t.getTotalClass(),format:t.getFormat(),id:t.id,colName:t.name,type:t.type,groupBy:t.groupBy,aggregate:t.aggregate,compare:t.compare,filters:t.filters,order:t.order},t.static.active&&(t.static.index=i.length,i.push(t.static))}),e.forEach(this,function(i){(i.static.active||i.dynamic||i.always)&&(e.forEach(t,function(t,n){var s=i.toStatic(t);i.hasSearch&&i.groupBy&&i.addValue(t);var a=r[n]=r[n]||{cols:[]};s=e.extend(e.copy(s),i.static),a.cols[i.static.index]=s}),i.hasSearch&&i.groupBy&&i.filters.sort())}),e.forEach(i,function(t,e){var i=r[r.length-1].cols[e];t.$last=i,t.getTotalValue=function(t){return i.getTotalValue(t,e)},t.getTotalName=function(t){return i.getTotalName(t,e)}}),{cols:i,rows:r}}},s.fromDatas=function(t){return s.parseCols(t)},s.parseCols=function(t){function i(t,s){if(e.isArray(t))e.forEach(t,function(t,e){i(t,(s||"")+"["+e+"]")});else if(e.isObject(t))e.forEach(t,function(t,e){i(t,(s?s+".":"")+e)});else{var a={value:s,type:n.TEXT,active:r.length<6};e.isDate(t)||e.isNumber(t)&&(s.toLowerCase().indexOf("date")!==-1||s.toLowerCase().indexOf("time")!==-1)?(a.type=n.DATE,a.groupBy=!0,a.hasSearch=!0):e.isNumber(t)?(a.type=n.NUMBER,a.aggregate=!0,a.color=1):(a.groupBy=!0,a.hasSearch=!0),r.push(a)}}var r=null;return t&&t.length&&(r=[],i(t[0])),r},s.types=n,s}]),i.factory("Table__",["$parse","Columns","colTypes","orderByFilter",function(t,i,r,n){function s(t,e){this.cols=new i(t).expand(e),this.defaults=t.map(function(t){return{id:t.id,active:t.active}}),this.colGroups=[{name:"GroupBy",items:this.cols.getGroups()}],this.valGroups=[{name:"Aggregate",items:this.cols.getAggregates()}],this.excludes=[],this.includes=[],this.setOptions(e)}var a=4;return s.prototype={setDatas:function(t,i){t&&e.forEach(t,function(t,e){t.$id=e+1}),this.datas=t,i&&e.forEach(i,function(t,e){t.$id=e+1}),this.compares=i,this.update()},setOptions:function(t){var e=this;this.options=[{name:"Columns",template:"partials/report/filters/columns",icon:"icon-columns",groups:this.colGroups,toggle:function(t){return e.toggleCol(t)},active:!0},{name:"Values",template:"partials/report/filters/values",icon:"icon-values",groups:this.valGroups,toggle:function(t){return e.toggleCol(t)}},{name:"Options",template:"partials/report/filters/flags",icon:"icon-options",rows:[{name:"Exclude",items:this.exclude,toggle:function(t){return e.exclude(t)}},{name:"Include",items:this.includes,toggle:function(t){return e.include(t)}},{name:"Flags",items:[{name:"Percentuali di incidenza",key:"dynamic"}],toggle:function(t){return e.toggle(t.key)}}]}]},update:function(){this.rows=[];var t=this.datas,i=this.rows,r=this.cols,n=this.excludes,s=this.includes,a=this.compares;r.reset(),e.forEach(t,function(t){var a=!0;e.forEach(n,function(e){e.active&&(a=a&&e.filter(t))}),e.forEach(s,function(e){e.active&&(a=a&&e.filter(t))}),a&&r.iterate(t,i)}),a&&e.forEach(a,function(t){var a=!0;e.forEach(n,function(e){e.active&&(a=a&&e.filter(t))}),e.forEach(s,function(e){e.active&&(a=a&&e.filter(t))}),a&&r.compare(t,i)}),this.toStatic(),this.after&&e.isFunction(this.after)&&this.after(i)},setOrderBy:function(){var t,i=[],r=[],n=[],s=[];e.forEach(this.cols,function(e,a){e.static.active&&(0!==e.order.sort&&(t=e.order.sort===-1?"-":"",s.push(t+"cols["+i.length+"].getValue()"),r.push(t+e.raw)),n.push("cols["+i.length+"].getValue()"),i.push(e.raw))}),i.length=Math.min(a,i.length),n.length=Math.min(3,n.length),this.orderBy=r.length?r:i,this.filteredOrderBy=s.length?s:n},exclude:function(t){t.active=!t.active,this.update()},include:function(t){t.active=!t.active,this.update()},has:function(t){return this.cols?this.cols.show[t]:null},resetFilters:function(){var t=this;e.forEach(t.cols,function(i,r){e.forEach(t.defaults,function(t){i.id===t.id&&(e.isFunction(i.active)?null:i.active=t.active)}),i.filters.reset()}),t.cols=t.cols.sort(function(t,e){return t.id-e.id}),t.update()},doFilterStatic:function(t){var i,r=this;r.cols;return function(t){var n=!0;if(e.forEach(r.filtered.cols,function(e,r){i=t.cols[r],i.matches=null,n=n&&e.filters.filter(i)}),n&&r.search&&r.search.length){var s=!1;e.forEach(t.cols,function(t){t.matches=new RegExp(r.search,"gim").exec(t.name),s=s||null!==t.matches}),n=n&&s}return n}},toggle:function(t){var e=null;if(this.cols){var i=this.cols.show;switch(i[t]=!i[t],t){case"dynamic":i.compare=!1;break;case"compare":i.dynamic=!1}e=i[t]}return this.toStatic(),e},toggleCol:function(t){this.cols.toggleColumns(t),this.update()},toggleOrder:function(t){e.forEach(this.cols,function(e){e.id!==t.id&&e.order.set(0)}),t.order.toggle(),this.setOrderBy()},swap:function(t,e){t=this.cols[this.filtered.cols.indexOf(t)],e=this.cols[this.filtered.cols.indexOf(e)];var i=this.cols.indexOf(t),r=this.cols[i];this.cols.splice(i,1),i=this.cols.indexOf(e),this.cols.splice(i,0,r),this.update()},toStatic:function(){this.filtered=this.cols.toStatic(this.rows),this.setOrderBy()},toJson:function(t){var i={name:"Repotable",description:"a view of selected datas"};if(t?e.extend(i,t):null,i.columns=[],i.rows=[],this.filtered&&this.filtered.rows.length){var n=this.filtered.cols,s=this.filtered.rows;e.forEach(n,function(t,e){i.columns.push({index:e,name:t.colName,format:t.format})}),e.forEach(s,function(t,s){var a=[];e.forEach(n,function(e,i){var n=t.cols[i];switch(a[i]=n.getValue(),e.type){case r.PERCENT:case r.INCREMENT:a[i]/=100}}),i.rows.push(a)});var a=[];e.forEach(n,function(t,e){if(t.aggregate)switch(a[e]=t.getTotalValue(),t.type){case r.PERCENT:case r.INCREMENT:a[e]/=100}else a[e]=null}),i.rows.push(a)}return i}},s.fromDatas=function(t){(!e.isArray(t)||!t.length>1||!e.isObject(t[0]))&&e.forEach(t,function(i){e.isArray(i)&&i.length&&e.isObject(i[0])&&(t=i)}),e.isArray(t)||(t=[t]);var r=i.fromDatas(t),n=new s(r);return n.setDatas(t),n},s}]),i.service("Droppables",["ElementRect",function(t){this.natives=[],this.callbacks=[],this.rects=[],this.add=function(e,i){this.natives.push(e),this.callbacks.push(i||function(){}),this.rects.push(t.fromNative(e))},this.remove=function(t){var e=this.natives.indexOf(t);e!==-1&&(this.natives.splice(e,1),this.callbacks.splice(e,1),this.rects.splice(e,1))},this.getIntersections=function(t){var i,r=[];return e.forEach(this.rects,function(n,s){n.set(n.native),i=e.element(n.native),i.removeClass("dropping"),n.intersect(t)?(n.distance=n.center.distance(t.center),n.data=this.callbacks[s](),r.push(n),i.addClass("over")):i.removeClass("over")}.bind(this)),r.sort(function(t,e){return t.distance<e.distance?-1:t.distance>e.distance?1:0}),r}}])}(window,window.angular);
//# sourceMappingURL=repotable.min.js.map
