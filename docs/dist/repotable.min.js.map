{"version":3,"sources":["docs/dist/repotable.js"],"names":["window","angular","module","console","log","constant","ID","IDS","TITLE","DATE","CUSTOMER","RESOURCE","STATUS","STATUSSM","FAMILY","NUMBER","HOURS","COSTS","PERCENT","GAIN","ICON","BUTTONS","DISABLED","LINK","BOOL","DOUBLE","WEEKS","SUM","MIN","MAX","AVG","directive","$parse","$timeout","Utils","Style","ElementRect","Droppables","require","link","scope","element","attributes","model","onStart","e","condition","down","getTouch","addDragListeners","onMove","move","diff","difference","dragging","power","addClass","style","transform","x","y","set","target","elementRect","nativeElement","offset","rects","getIntersections","length","native","onEnd","removeClass","fromIndex","droppableIndex","fromModel","ngModel","event","forEach","rect","index","data","droppable","from","to","$emit","removeDragListeners","on","off","addListeners","removeListeners","selector","draggableItem","undefined","draggableIf","querySelector","$on","onGetData","droppableIf","droppableItem","add","remove","$document","restrict","isActive","toggler","value","activate","addOutListeners","deactivate","removeOutListeners","onClick","setTimeout","onClickOut","getClosestElement","getClosest","Error","filter","$filter","toTitleCase","str","replace","txt","charAt","toUpperCase","substr","toLowerCase","indexOf","split","join","splitted","firstName","shift","lastName","legacyFilter","cost","currency","ratio","formatting","precision","unit","hours","Math","floor","minutes","label","format","timezone","placeholder","parseTime","parseHour","val","factory","State","this","isReady","idle","prototype","isBusy","isError","isErroring","isSuccess","isSuccessing","button","errors","enabled","busy","success","bind","error","push","ready","errorMessage","submitClass","successing","errorring","submitMessage","idleMessage","busyMessage","successMessage","Animate","callback","useTimeout","isPlaying","key","ticks","play","loop","time","_this","requestAnimationFrame","pause","clearTimeout","cancelAnimationFrame","playpause","cycle","k","a","b","c","d","ff","gg","hh","ii","add32","cmn","q","s","t","md51","i","n","state","md5blk","substring","tail","charCodeAt","md5blks","rhex","j","hex_chr","hex","Md5","encode","string","lsw","msw","$compile","$controller","Vector","previous","type","touch","originalEvent","touches","changedTouches","pageX","pageY","getRelativeTouch","point","getBoundingClientRect","left","top","el","matchesFn","parent","some","fn","document","body","parentElement","throttle","func","wait","options","context","args","result","timeout","later","leading","getNow","apply","now","remaining","arguments","trailing","where","array","query","found","item","has","compileController","html","contents","controller","$scope","$new","extend","controllerAs","children","reverseSortOn","prepend","expression","formatted","reducer","o","reducerSetter","slice","reducerAdder","lastTime","vendors","currTime","Date","getTime","timeToCall","max","id","Array","reduce","Object","defineProperty","TypeError","len","ua","navigator","userAgent","safari","msie","chrome","mobile","toMd5","getElementsByTagName","make","size","sqrt","normalize","l","incidence","angle","atan2","distance","cross","abs","towards","friction","copy","toString","width","height","center","fromNative","offsetWidth","offsetHeight","vector","intersect","props","scale","hoverScale","currentScale","prefix","webkit","div","createElement","every","prop","prefixed","styles","cssText","transformOrigin","round","Filters","keys","flags","values","search","active","removeAll","reset","toggle","splice","sort","va","vb","name","String","cell","Order","asc","desc","fieldTypes","fieldTotalTypes","Field","filters","order","typeTotal","isFunction","raw","source","getters","fields","field","setters","getter","assign","total","hasKey","initValue","aggregation","row","min","addCount","v","addValue","getFormat","getLink","formatValue","isNumber","getTotal","filtered","getValueTotal","compare","current","$field","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","getTotalClass","cc","getCellTotal","rows","previousCell","cols","col","getValue","getHeaderClass","getCellClass","getColumnClass","color","getTextClass","toStatic","post","cellClass","textClass","pop","dynamic","getName","getTotalValue","getTotalName","types","totalTypes","Fields","$id","expand","radios","aggregate","show","fieldPrevious","count","radio","groups","unique","items","getGroupKey","cells","iterate","comparing","mode","always","getCount","getFirstField","first","groupBy","getGroups","getAggregates","getPercentages","getDynamics","getCompares","getCounters","activeInRange","range","flag","toggleFields","table","headerClass","columnClass","totalClass","colName","originaIndex","hasSearch","last","$last","fromDatas","datas","parseDatas","parse","isArray","isObject","TEXT","isDate","orderByFilter","Table","defaults","map","colGroups","valGroups","excludes","includes","setOptions","MAX_FIELDS_ORDERED","setDatas","compares","update","template","icon","toggleField","exclude","include","setOrderBy","sign","defaultsFiltered","ordersFiltered","filteredOrderBy","resetFilters","doFilterStatic","matches","match","RegExp","exec","toggleOrder","f","swap","fi","ti","after","toJson","json","description","columns","colTypes","Column","static","getKey","getRaw","getSource","getFormatted","getItemClass","$col","Columns","getFirstCol","toggleColumns","parseCols","MAX_COLS_ORDERED","toggleCol","orders","orderBy","service","natives","callbacks","intersections"],"mappings":"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","file":"repotable.min.js","sourcesContent":["\r\n(function(window, angular) {'use strict';\r\n\n/* global angular */\r\n\r\nvar module = angular.module('repotable', ['ng', 'ngSanitize', 'ngMessages']);\r\n\n/* global angular, module */\r\n\r\nwindow.console ? null : window.console = { log: function () { } };\r\n\r\n/*\r\nwindow.domain = '//' + location.hostname + (location.port ? ':' + location.port : ''); // location.protocol + \r\nmodule.constant('domain', domain);\r\n*/\r\n\r\nmodule.constant('colTypes', {\r\n    ID: 1,\r\n    IDS: 2,\r\n    TITLE: 3,\r\n    DATE: 4,\r\n    CUSTOMER: 5,\r\n    RESOURCE: 6,\r\n    STATUS: 7,\r\n    STATUSSM: 8,\r\n    FAMILY: 9,\r\n    NUMBER: 10,\r\n    HOURS: 11,\r\n    COSTS: 12,\r\n    PERCENT: 13,\r\n    GAIN: 14,\r\n    ICON: 15,\r\n    BUTTONS: 16,\r\n    DISABLED: 17,\r\n    LINK: 18,\r\n    BOOL: 19,\r\n    DOUBLE: 20,\r\n    WEEKS: 21,\r\n});\r\n\r\nmodule.constant('fieldTypes', {\r\n    ID: 1,\r\n    IDS: 2,\r\n    TITLE: 3,\r\n    DATE: 4,\r\n    CUSTOMER: 5,\r\n    RESOURCE: 6,\r\n    STATUS: 7,\r\n    STATUSSM: 8,\r\n    FAMILY: 9,\r\n    NUMBER: 10,\r\n    HOURS: 11,\r\n    COSTS: 12,\r\n    PERCENT: 13,\r\n    GAIN: 14,\r\n    ICON: 15,\r\n    BUTTONS: 16,\r\n    DISABLED: 17,\r\n    LINK: 18,\r\n    BOOL: 19,\r\n    DOUBLE: 20,\r\n    WEEKS: 21,\r\n});\r\n\r\nmodule.constant('fieldTotalTypes', {\r\n    SUM: 1,\r\n    MIN: 2,\r\n    MAX: 3,\r\n    AVG: 4,\r\n});\r\n\n/* global angular, module */\r\n\n/* global angular, module */\r\n\r\nmodule.directive('draggableItem', ['$parse', '$timeout', 'Utils', 'Style', 'ElementRect', 'Droppables', function ($parse, $timeout, Utils, Style, ElementRect, Droppables) {\r\n\r\n    return {\r\n        require: 'ngModel',\r\n        link: function (scope, element, attributes, model) {\r\n            var nativeElement = element[0];\r\n            var selector = attributes.draggableItem || '.item';\r\n            var condition = attributes.draggableIf !== undefined ? $parse(attributes.draggableIf) : function () { return true; };\r\n            var target = nativeElement.querySelector(selector);\r\n            var style = new Style();\r\n            var elementRect = new ElementRect();\r\n            var down, move, diff, dragging, rects;\r\n            function onStart(e) {\r\n                if (condition(scope)) {\r\n                    down = Utils.getTouch(e);\r\n                    addDragListeners();\r\n                }\r\n                return false;\r\n            }\r\n            function onMove(e) {\r\n                move = Utils.getTouch(e);\r\n                diff = down.difference(move);\r\n                if (!dragging && diff.power() > 25) {\r\n                    dragging = true;\r\n                    element.addClass('dragging');\r\n                }\r\n                if (dragging) {\r\n                    style.transform = 'translateX(' + diff.x + 'px) translateY(' + diff.y + 'px)';\r\n                    style.set(target);\r\n                    elementRect.set(nativeElement).offset(diff);\r\n                    rects = Droppables.getIntersections(elementRect);\r\n                    if (rects.length) {\r\n                        angular.element(rects[0].native).addClass('dropping');\r\n                    }\r\n                }\r\n                // console.log(diff);\r\n                return false;\r\n            }\r\n            function onEnd(e) {\r\n                if (dragging) {\r\n                    dragging = false;\r\n                    element.removeClass('dragging');\r\n                    style.transform = 'none';\r\n                    style.set(target);\r\n                    var fromIndex = $parse(attributes.droppableIndex)(scope);\r\n                    var fromModel = $parse(attributes.ngModel)(scope);\r\n                    if (rects.length) {\r\n                        var event = null;\r\n                        angular.forEach(rects, function (rect, index) {\r\n                            angular.element(rect.native).removeClass('dropping over');\r\n                            if (rect.data.droppable(scope) && !event) {\r\n                                event = {\r\n                                    from: {\r\n                                        index: fromIndex,\r\n                                        model: fromModel,\r\n                                        target: target,\r\n                                    },\r\n                                    to: {\r\n                                        index: rect.data.index,\r\n                                        model: rect.data.model,\r\n                                        target: rect.native\r\n                                    },\r\n                                };\r\n                                $timeout(function () {\r\n                                    scope.$emit('onDropItem', event);\r\n                                });\r\n                            }\r\n                        });\r\n                    } else {\r\n                        var event = {\r\n                            from: {\r\n                                index: fromIndex,\r\n                                model: fromModel,\r\n                                target: target,\r\n                            },\r\n                            to: null,\r\n                        };\r\n                        $timeout(function () {\r\n                            scope.$emit('onDropOut', event);\r\n                        });\r\n                    }\r\n                }\r\n                removeDragListeners();\r\n                return false;\r\n            }\r\n            function addDragListeners() {\r\n                angular.element(window).on('touchmove mousemove', onMove);\r\n                angular.element(window).on('touchend mouseup', onEnd);\r\n            };\r\n            function removeDragListeners() {\r\n                angular.element(window).off('touchmove mousemove', onMove);\r\n                angular.element(window).off('touchend mouseup', onEnd);\r\n            };\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onStart);\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onStart);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\r\n\r\nmodule.directive('droppableItem', ['$parse', 'Utils', 'Style', 'Droppables', function ($parse, Utils, Style, Droppables) {\r\n    var droppables = {};\r\n    return {\r\n        require: 'ngModel',\r\n        link: function (scope, element, attributes, model) {\r\n            var nativeElement = element[0];\r\n            var selector = attributes.droppableItem || '.item';\r\n            function onGetData() {\r\n                var index = $parse(attributes.droppableIndex)(scope);\r\n                var model = $parse(attributes.ngModel)(scope);\r\n                var droppable = attributes.droppableIf !== undefined ? $parse(attributes.droppableIf) : function () { return true };\r\n                return {\r\n                    index: index,\r\n                    model: model,\r\n                    droppable: droppable,\r\n                };\r\n            }\r\n            Droppables.add(nativeElement, onGetData);\r\n            scope.$on('$destroy', function () {\r\n                Droppables.remove(nativeElement);\r\n            });\r\n        }\r\n    }\r\n}]);\r\n\r\nmodule.directive('toggler', ['$document', '$parse', '$timeout', 'Utils', function ($document, $parse, $timeout, Utils) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            if (attributes.value === undefined) {\r\n                throw new Error('[toggler] attribute value required');\r\n            }\r\n            if (attributes.target === undefined) {\r\n                throw new Error('[toggler] attribute target required');\r\n            }\r\n            function isActive() {\r\n                return $parse(attributes.toggler + '==' + attributes.value)(scope);\r\n            }\r\n            function activate() {\r\n                addOutListeners();\r\n                $timeout(function () {\r\n                    $parse(attributes.toggler + '=' + attributes.value)(scope);\r\n                });\r\n            }\r\n            function deactivate() {\r\n                removeOutListeners();\r\n                $timeout(function () {\r\n                    $parse(attributes.toggler + '=null')(scope);\r\n                });\r\n            }\r\n            function onClick(e) {\r\n                setTimeout(function () {\r\n                    if (isActive()) {\r\n                        deactivate();\r\n                    } else {\r\n                        activate();\r\n                    }\r\n                }, 100);\r\n            }\r\n            function onClickOut(e) {\r\n                if (isActive()\r\n                    && Utils.getClosestElement(e.target, element[0]) === null\r\n                    && Utils.getClosest(e.target, attributes.target) === null) {\r\n                    deactivate();\r\n                }\r\n            }\r\n            function addOutListeners() {\r\n                angular.element($document).on('click', onClickOut);\r\n            };\r\n            function removeOutListeners() {\r\n                angular.element($document).off('click', onClickOut);\r\n            };\r\n            function addListeners() {\r\n                element.on('click', onClick);\r\n            };\r\n            function removeListeners() {\r\n                element.off('click', onClick);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n                removeOutListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\r\n\n/* global angular, module */\r\n\r\nmodule.filter('shortName', ['$filter', function ($filter) {\r\n    function toTitleCase(str) {\r\n        return str.replace(/\\w\\S*/g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });\r\n    }\r\n    return function (value) {\r\n        if (!value) {\r\n            return '';\r\n        }\r\n        if (value.indexOf(' .') === value.length - 2) {\r\n            value = value.split(' .').join('');\r\n        }\r\n        /*\r\n        var splitted;\r\n        if (value.indexOf('.') !== -1) {\r\n            splitted = value.split('.');\r\n        } else {\r\n            splitted = value.split(' ');\r\n        }\r\n        */\r\n        var splitted = value.split(' ');\r\n        var firstName = splitted.shift();\r\n        if (splitted.length) {\r\n            var lastName = splitted.join(' ');\r\n            return firstName.substr(0, 1).toUpperCase() + '.' + toTitleCase(lastName);\r\n        } else {\r\n            return firstName;\r\n        }\r\n    }\r\n}]);\r\n\r\nmodule.filter('customCurrency', ['$filter', function ($filter) {\r\n    var legacyFilter = $filter('currency');\r\n    return function (cost, currency) {\r\n        return legacyFilter(cost * currency.ratio, currency.formatting);\r\n    }\r\n}]);\r\n\r\nmodule.filter('customNumber', ['$filter', function ($filter) {\r\n    var filter = $filter('number');\r\n    return function (value, precision, unit) {\r\n        unit = unit || '';\r\n        return (value ? filter(value, precision) + unit : '-');\r\n    }\r\n}]);\r\n\r\nmodule.filter('customHours', [function () {\r\n    return function (value) {\r\n        if (value) {\r\n            var hours = Math.floor(value);\r\n            var minutes = Math.floor((value - hours) * 60);\r\n            var label = hours ? hours + ' H' : '';\r\n            label += minutes ? ' ' + minutes + ' m' : '';\r\n            return label;\r\n        } else {\r\n            return '-';\r\n        }\r\n    }\r\n}]);\r\n\r\nmodule.filter('customDate', ['$filter', function ($filter) {\r\n    var filter = $filter('date');\r\n    return function (value, format, timezone) {\r\n        return value ? filter(value, format, timezone) : '-';\r\n    }\r\n}]);\r\n\r\nmodule.filter('customTime', ['$filter', function ($filter) {\r\n    return function (value, placeholder) {\r\n        if (value) {\r\n            return Utils.parseTime(value);\r\n        } else {\r\n            return (placeholder ? placeholder : '-');\r\n        }\r\n    }\r\n}]);\r\n\r\nmodule.filter('customDigital', ['$filter', function ($filter) {\r\n    return function (value, placeholder) {\r\n        if (value) {\r\n            return Utils.parseHour(value);\r\n        } else {\r\n            return (placeholder ? placeholder : '-');\r\n        }\r\n    }\r\n}]);\r\n\r\nmodule.filter('customString', ['$filter', function ($filter) {\r\n    return function (value, placeholder) {\r\n        return value ? value : (placeholder ? placeholder : '-');\r\n    }\r\n}]);\r\n\r\nmodule.filter('customEnum', function () {\r\n    return function (val) {\r\n        val = val + 1;\r\n        return val < 10 ? '0' + val : val;\r\n    };\r\n});\r\n\n/* global angular, module */\r\n\r\nmodule.factory('State', ['$timeout', function ($timeout) {\r\n    function State() {\r\n        this.isReady = false;\r\n        this.idle();\r\n    }\r\n    State.prototype = {\r\n        idle: function () {\r\n            this.isBusy = false;\r\n            this.isError = false;\r\n            this.isErroring = false;\r\n            this.isSuccess = false;\r\n            this.isSuccessing = false;\r\n            this.button = null;\r\n            this.errors = [];\r\n        },\r\n        enabled: function () {\r\n            return !this.isBusy && !this.isErroring && !this.isSuccessing;\r\n        },\r\n        busy: function () {\r\n            if (!this.isBusy) {\r\n                this.isBusy = true;\r\n                this.isError = false;\r\n                this.isErroring = false;\r\n                this.isSuccess = false;\r\n                this.isSuccessing = false;\r\n                this.errors = [];\r\n                // console.log('State.busy', this);\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n        success: function () {\r\n            this.isBusy = false;\r\n            this.isError = false;\r\n            this.isErroring = false;\r\n            this.isSuccess = true;\r\n            this.isSuccessing = true;\r\n            this.errors = [];\r\n            $timeout(function () {\r\n                this.isSuccessing = false;\r\n                this.button = null;\r\n            }.bind(this), 1000);\r\n        },\r\n        error: function (error) {\r\n            this.isBusy = false;\r\n            this.isError = true;\r\n            this.isErroring = true;\r\n            this.isSuccess = false;\r\n            this.isSuccessing = false;\r\n            this.errors.push(error);\r\n            $timeout(function () {\r\n                this.isErroring = false;\r\n                this.button = null;\r\n            }.bind(this), 1000);\r\n        },\r\n        ready: function () {\r\n            this.isReady = true;\r\n            this.success();\r\n        },\r\n        errorMessage: function () {\r\n            return this.isError ? this.errors[this.errors.length - 1] : null;\r\n        },\r\n        submitClass: function () {\r\n            return {\r\n                busy: this.isBusy,\r\n                ready: this.isReady,\r\n                successing: this.isSuccessing,\r\n                success: this.isSuccess,\r\n                errorring: this.isErroring,\r\n                error: this.isError,\r\n            };\r\n        },\r\n        submitMessage: function (idleMessage, busyMessage, successMessage, errorMessage) {\r\n            idleMessage = idleMessage || 'Submit';\r\n            if (this.isBusy) {\r\n                return busyMessage || idleMessage;\r\n            } else if (this.isSuccess) {\r\n                return successMessage || idleMessage;\r\n            } else if (this.isError) {\r\n                return errorMessage || idleMessage;\r\n            } else {\r\n                return idleMessage;\r\n            }\r\n        },\r\n    };\r\n    return State;\r\n}]);\r\n\r\nmodule.factory('Animate', [function () {\r\n    function Animate(callback, useTimeout) {\r\n        this.callback = callback;\r\n        this.isPlaying = false;\r\n        this.key = null;\r\n        this.ticks = 0;\r\n        this.useTimeout = useTimeout === true ? true : false;\r\n    }\r\n    Animate.prototype = {\r\n        play: function () {\r\n            var _this = this;\r\n            function loop(time) {\r\n                _this.ticks++;\r\n                _this.callback(time, _this.ticks);\r\n                if (this.useTimeout) {\r\n                    _this.key = window.setTimeout(loop, 1000 / 60);\r\n                } else {\r\n                    _this.key = window.requestAnimationFrame(loop);\r\n                }\r\n            }\r\n            if (!this.key) {\r\n                this.isPlaying = true;\r\n                loop();\r\n            }\r\n        },\r\n        pause: function () {\r\n            if (this.key) {\r\n                if (this.useTimeout) {\r\n                    window.clearTimeout(this.key);\r\n                } else {\r\n                    window.cancelAnimationFrame(this.key);\r\n                }\r\n                this.key = null;\r\n                this.isPlaying = false;\r\n            }\r\n        },\r\n        playpause: function () {\r\n            if (this.key) {\r\n                this.pause();\r\n            } else {\r\n                this.play();\r\n            }\r\n        }\r\n    }\r\n    return Animate;\r\n}]);\r\n\r\nmodule.factory('Md5', [function () {\r\n\r\n    var hex_chr = '0123456789abcdef'.split('');\r\n\r\n    function cycle(x, k) {\r\n        var a = x[0], b = x[1], c = x[2], d = x[3];\r\n\r\n        a = ff(a, b, c, d, k[0], 7, -680876936);\r\n        d = ff(d, a, b, c, k[1], 12, -389564586);\r\n        c = ff(c, d, a, b, k[2], 17, 606105819);\r\n        b = ff(b, c, d, a, k[3], 22, -1044525330);\r\n        a = ff(a, b, c, d, k[4], 7, -176418897);\r\n        d = ff(d, a, b, c, k[5], 12, 1200080426);\r\n        c = ff(c, d, a, b, k[6], 17, -1473231341);\r\n        b = ff(b, c, d, a, k[7], 22, -45705983);\r\n        a = ff(a, b, c, d, k[8], 7, 1770035416);\r\n        d = ff(d, a, b, c, k[9], 12, -1958414417);\r\n        c = ff(c, d, a, b, k[10], 17, -42063);\r\n        b = ff(b, c, d, a, k[11], 22, -1990404162);\r\n        a = ff(a, b, c, d, k[12], 7, 1804603682);\r\n        d = ff(d, a, b, c, k[13], 12, -40341101);\r\n        c = ff(c, d, a, b, k[14], 17, -1502002290);\r\n        b = ff(b, c, d, a, k[15], 22, 1236535329);\r\n\r\n        a = gg(a, b, c, d, k[1], 5, -165796510);\r\n        d = gg(d, a, b, c, k[6], 9, -1069501632);\r\n        c = gg(c, d, a, b, k[11], 14, 643717713);\r\n        b = gg(b, c, d, a, k[0], 20, -373897302);\r\n        a = gg(a, b, c, d, k[5], 5, -701558691);\r\n        d = gg(d, a, b, c, k[10], 9, 38016083);\r\n        c = gg(c, d, a, b, k[15], 14, -660478335);\r\n        b = gg(b, c, d, a, k[4], 20, -405537848);\r\n        a = gg(a, b, c, d, k[9], 5, 568446438);\r\n        d = gg(d, a, b, c, k[14], 9, -1019803690);\r\n        c = gg(c, d, a, b, k[3], 14, -187363961);\r\n        b = gg(b, c, d, a, k[8], 20, 1163531501);\r\n        a = gg(a, b, c, d, k[13], 5, -1444681467);\r\n        d = gg(d, a, b, c, k[2], 9, -51403784);\r\n        c = gg(c, d, a, b, k[7], 14, 1735328473);\r\n        b = gg(b, c, d, a, k[12], 20, -1926607734);\r\n\r\n        a = hh(a, b, c, d, k[5], 4, -378558);\r\n        d = hh(d, a, b, c, k[8], 11, -2022574463);\r\n        c = hh(c, d, a, b, k[11], 16, 1839030562);\r\n        b = hh(b, c, d, a, k[14], 23, -35309556);\r\n        a = hh(a, b, c, d, k[1], 4, -1530992060);\r\n        d = hh(d, a, b, c, k[4], 11, 1272893353);\r\n        c = hh(c, d, a, b, k[7], 16, -155497632);\r\n        b = hh(b, c, d, a, k[10], 23, -1094730640);\r\n        a = hh(a, b, c, d, k[13], 4, 681279174);\r\n        d = hh(d, a, b, c, k[0], 11, -358537222);\r\n        c = hh(c, d, a, b, k[3], 16, -722521979);\r\n        b = hh(b, c, d, a, k[6], 23, 76029189);\r\n        a = hh(a, b, c, d, k[9], 4, -640364487);\r\n        d = hh(d, a, b, c, k[12], 11, -421815835);\r\n        c = hh(c, d, a, b, k[15], 16, 530742520);\r\n        b = hh(b, c, d, a, k[2], 23, -995338651);\r\n\r\n        a = ii(a, b, c, d, k[0], 6, -198630844);\r\n        d = ii(d, a, b, c, k[7], 10, 1126891415);\r\n        c = ii(c, d, a, b, k[14], 15, -1416354905);\r\n        b = ii(b, c, d, a, k[5], 21, -57434055);\r\n        a = ii(a, b, c, d, k[12], 6, 1700485571);\r\n        d = ii(d, a, b, c, k[3], 10, -1894986606);\r\n        c = ii(c, d, a, b, k[10], 15, -1051523);\r\n        b = ii(b, c, d, a, k[1], 21, -2054922799);\r\n        a = ii(a, b, c, d, k[8], 6, 1873313359);\r\n        d = ii(d, a, b, c, k[15], 10, -30611744);\r\n        c = ii(c, d, a, b, k[6], 15, -1560198380);\r\n        b = ii(b, c, d, a, k[13], 21, 1309151649);\r\n        a = ii(a, b, c, d, k[4], 6, -145523070);\r\n        d = ii(d, a, b, c, k[11], 10, -1120210379);\r\n        c = ii(c, d, a, b, k[2], 15, 718787259);\r\n        b = ii(b, c, d, a, k[9], 21, -343485551);\r\n\r\n        x[0] = add32(a, x[0]);\r\n        x[1] = add32(b, x[1]);\r\n        x[2] = add32(c, x[2]);\r\n        x[3] = add32(d, x[3]);\r\n\r\n    }\r\n\r\n    function cmn(q, a, b, x, s, t) {\r\n        a = add32(add32(a, q), add32(x, t));\r\n        return add32((a << s) | (a >>> (32 - s)), b);\r\n    }\r\n\r\n    function ff(a, b, c, d, x, s, t) {\r\n        return cmn((b & c) | ((~b) & d), a, b, x, s, t);\r\n    }\r\n\r\n    function gg(a, b, c, d, x, s, t) {\r\n        return cmn((b & d) | (c & (~d)), a, b, x, s, t);\r\n    }\r\n\r\n    function hh(a, b, c, d, x, s, t) {\r\n        return cmn(b ^ c ^ d, a, b, x, s, t);\r\n    }\r\n\r\n    function ii(a, b, c, d, x, s, t) {\r\n        return cmn(c ^ (b | (~d)), a, b, x, s, t);\r\n    }\r\n\r\n    function md51(s) {\r\n        var txt = '';\r\n        var n = s.length,\r\n        state = [1732584193, -271733879, -1732584194, 271733878], i;\r\n        for (i = 64; i <= s.length; i += 64) {\r\n            cycle(state, md5blk(s.substring(i - 64, i)));\r\n        }\r\n        s = s.substring(i - 64);\r\n        var tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n        for (i = 0; i < s.length; i++)\r\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\r\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\r\n        if (i > 55) {\r\n            cycle(state, tail);\r\n            for (i = 0; i < 16; i++) tail[i] = 0;\r\n        }\r\n        tail[14] = n * 8;\r\n        cycle(state, tail);\r\n        return state;\r\n    }\r\n\r\n    /* there needs to be support for Unicode here,\r\n        * unless we pretend that we can redefine the MD-5\r\n        * algorithm for multi-byte characters (perhaps\r\n        * by adding every four 16-bit characters and\r\n        * shortening the sum to 32 bits). Otherwise\r\n        * I suggest performing MD-5 as if every character\r\n        * was two bytes--e.g., 0040 0025 = @%--but then\r\n        * how will an ordinary MD-5 sum be matched?\r\n        * There is no way to standardize text to something\r\n        * like UTF-8 before transformation; speed cost is\r\n        * utterly prohibitive. The JavaScript standard\r\n        * itself needs to look at this: it should start\r\n        * providing access to strings as preformed UTF-8\r\n        * 8-bit unsigned value arrays.\r\n        */\r\n    function md5blk(s) { /* I figured global was faster.   */\r\n        var md5blks = [], i; /* Andy King said do it this way. */\r\n        for (i = 0; i < 64; i += 4) {\r\n            md5blks[i >> 2] = s.charCodeAt(i)\r\n            + (s.charCodeAt(i + 1) << 8)\r\n            + (s.charCodeAt(i + 2) << 16)\r\n            + (s.charCodeAt(i + 3) << 24);\r\n        }\r\n        return md5blks;\r\n    }\r\n\r\n    function rhex(n) {\r\n        var s = '', j = 0;\r\n        for (; j < 4; j++)\r\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F]\r\n            + hex_chr[(n >> (j * 8)) & 0x0F];\r\n        return s;\r\n    }\r\n\r\n    function hex(x) {\r\n        for (var i = 0; i < x.length; i++)\r\n            x[i] = rhex(x[i]);\r\n        return x.join('');\r\n    }\r\n\r\n    /* this function is much faster,\r\n    so if possible we use it. Some IEs\r\n    are the only ones I know of that\r\n    need the idiotic second function,\r\n    generated by an if clause.  */\r\n    function add32(a, b) {\r\n        return (a + b) & 0xFFFFFFFF;\r\n    }\r\n\r\n    function Md5() { }\r\n    Md5.encode = function (string) {\r\n        return hex(md51(string));\r\n    }\r\n    if (Md5.encode('hello') !== '5d41402abc4b2a76b9719d911017c592') {\r\n        add32 = function (x, y) {\r\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\r\n            msw = (x >> 16) + (y >> 16) + (lsw >> 16);\r\n            return (msw << 16) | (lsw & 0xFFFF);\r\n        }\r\n    }\r\n    return Md5;\r\n}]);\r\n\r\nmodule.factory('Utils', ['$compile', '$controller', 'Vector', 'Md5', function ($compile, $controller, Vector, Md5) {\r\n    (function () {\r\n        // POLYFILL window.requestAnimationFrame\r\n        var lastTime = 0;\r\n        var vendors = ['ms', 'moz', 'webkit', 'o'];\r\n        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\r\n            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame']\r\n                                       || window[vendors[x] + 'CancelRequestAnimationFrame'];\r\n        }\r\n        if (!window.requestAnimationFrame) {\r\n            window.requestAnimationFrame = function (callback, element) {\r\n                var currTime = new Date().getTime();\r\n                var timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n                var id = window.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\r\n                lastTime = currTime + timeToCall;\r\n                return id;\r\n            };\r\n        }\r\n        if (!window.cancelAnimationFrame) {\r\n            window.cancelAnimationFrame = function (id) {\r\n                clearTimeout(id);\r\n            };\r\n        }\r\n    }());\r\n    (function () {\r\n        // POLYFILL Array.prototype.reduce\r\n        // Production steps of ECMA-262, Edition 5, 15.4.4.21\r\n        // Reference: http://es5.github.io/#x15.4.4.21\r\n        // https://tc39.github.io/ecma262/#sec-array.prototype.reduce\r\n        if (!Array.prototype.reduce) {\r\n            Object.defineProperty(Array.prototype, 'reduce', {\r\n                value: function (callback) {// , initialvalue\r\n                    if (this === null) {\r\n                        throw new TypeError('Array.prototype.reduce called on null or undefined');\r\n                    }\r\n                    if (typeof callback !== 'function') {\r\n                        throw new TypeError(callback + ' is not a function');\r\n                    }\r\n                    var o = Object(this);\r\n                    var len = o.length >>> 0;\r\n                    var k = 0;\r\n                    var value;\r\n                    if (arguments.length == 2) {\r\n                        value = arguments[1];\r\n                    } else {\r\n                        while (k < len && !(k in o)) {\r\n                            k++;\r\n                        }\r\n                        if (k >= len) {\r\n                            throw new TypeError('Reduce of empty array with no initial value');\r\n                        }\r\n                        value = o[k++];\r\n                    }\r\n                    while (k < len) {\r\n                        if (k in o) {\r\n                            value = callback(value, o[k], k, o);\r\n                        }\r\n                        k++;\r\n                    }\r\n                    return value;\r\n                }\r\n            });\r\n        }\r\n    }());\r\n    var _isTouch;\r\n    function isTouch() {\r\n        if (!_isTouch) {\r\n            _isTouch = {\r\n                value: ('ontouchstart' in window || 'onmsgesturechange' in window)\r\n            }\r\n        }\r\n        // console.log(_isTouch);\r\n        return _isTouch.value;\r\n    }\r\n    function getTouch(e, previous) {\r\n        var t = new Vector();\r\n        if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {\r\n            var touch = null;\r\n            var event = e.originalEvent ? e.originalEvent : e;\r\n            var touches = event.touches.length ? event.touches : event.changedTouches;\r\n            if (touches && touches.length) {\r\n                touch = touches[0];\r\n            }\r\n            if (touch) {\r\n                t.x = touch.pageX;\r\n                t.y = touch.pageY;\r\n            }\r\n        } else if (e.type == 'click' || e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {\r\n            t.x = e.pageX;\r\n            t.y = e.pageY;\r\n        }\r\n        if (previous) {\r\n            t.s = Vector.difference(previous, t);\r\n        }\r\n        t.type = e.type;\r\n        return t;\r\n    }\r\n    function getRelativeTouch(element, point) {\r\n        var rect = element[0].getBoundingClientRect();\r\n        var e = new Vector(rect.left, rect.top);\r\n        return Vector.difference(e, point);\r\n    }\r\n    function getClosest(el, selector) {\r\n        var matchesFn, parent;\r\n        ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function (fn) {\r\n            if (typeof document.body[fn] == 'function') {\r\n                matchesFn = fn;\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        if (el[matchesFn](selector)) {\r\n            return el;\r\n        }\r\n        while (el !== null) {\r\n            parent = el.parentElement;\r\n            if (parent !== null && parent[matchesFn](selector)) {\r\n                return parent;\r\n            }\r\n            el = parent;\r\n        }\r\n        return null;\r\n    }\r\n    function getClosestElement(el, target) {\r\n        var matchesFn, parent;\r\n        if (el === target) {\r\n            return el;\r\n        }\r\n        while (el !== null) {\r\n            parent = el.parentElement;\r\n            if (parent !== null && parent === target) {\r\n                return parent;\r\n            }\r\n            el = parent;\r\n        }\r\n        return null;\r\n    }\r\n    var getNow = Date.now || function () {\r\n        return new Date().getTime();\r\n    };\r\n    function throttle(func, wait, options) {\r\n        // Returns a function, that, when invoked, will only be triggered at most once\r\n        // during a given window of time. Normally, the throttled function will run\r\n        // as much as it can, without ever going more than once per `wait` duration;\r\n        // but if you'd like to disable the execution on the leading edge, pass\r\n        // `{leading: false}`. To disable execution on the trailing edge, ditto.\r\n        var context, args, result;\r\n        var timeout = null;\r\n        var previous = 0;\r\n        if (!options) options = {};\r\n        var later = function () {\r\n            previous = options.leading === false ? 0 : getNow();\r\n            timeout = null;\r\n            result = func.apply(context, args);\r\n            if (!timeout) context = args = null;\r\n        };\r\n        return function () {\r\n            var now = getNow();\r\n            if (!previous && options.leading === false) previous = now;\r\n            var remaining = wait - (now - previous);\r\n            context = this;\r\n            args = arguments;\r\n            if (remaining <= 0 || remaining > wait) {\r\n                if (timeout) {\r\n                    clearTimeout(timeout);\r\n                    timeout = null;\r\n                }\r\n                previous = now;\r\n                result = func.apply(context, args);\r\n                if (!timeout) context = args = null;\r\n            } else if (!timeout && options.trailing !== false) {\r\n                timeout = setTimeout(later, remaining);\r\n            }\r\n            return result;\r\n        };\r\n    }\r\n    function where(array, query) {\r\n        var found = null;\r\n        if (array) {\r\n            angular.forEach(array, function (item) {\r\n                var has = true;\r\n                angular.forEach(query, function (value, key) {\r\n                    has = has && item[key] === value;\r\n                });\r\n                if (has) {\r\n                    found = item;\r\n                }\r\n            });\r\n        }\r\n        return found;\r\n    }\r\n    function compileController(scope, element, html, data) {\r\n        // console.log('Utils.compileController', element);\r\n        element.html(html);\r\n        var link = $compile(element.contents());\r\n        if (data.controller) {\r\n            var $scope = scope.$new();\r\n            angular.extend($scope, data);\r\n            var controller = $controller(data.controller, { $scope: $scope });\r\n            if (data.controllerAs) {\r\n                scope[data.controllerAs] = controller;\r\n            }\r\n            element.data('$ngControllerController', controller);\r\n            element.children().data('$ngControllerController', controller);\r\n            scope = $scope;\r\n        }\r\n        link(scope);\r\n    }\r\n    var ua = window.navigator.userAgent.toLowerCase();\r\n    var safari = ua.indexOf('safari') !== -1 && ua.indexOf('chrome') === -1;\r\n    var msie = ua.indexOf('trident') !== -1 || ua.indexOf('edge') !== -1 || ua.indexOf('msie') !== -1;\r\n    var chrome = !safari && !msie && ua.indexOf('chrome') !== -1;\r\n    var mobile = ua.indexOf('mobile') !== -1;\r\n    function Utils() {\r\n    }\r\n    function reverseSortOn(key) {\r\n        return function (a, b) {\r\n            if (a[key] < b[key]) {\r\n                return 1;\r\n            }\r\n            if (a[key] > b[key]) {\r\n                return -1;\r\n            }\r\n            // a must be equal to b\r\n            return 0;\r\n        }\r\n    }\r\n    function format(string, prepend, expression) {\r\n        string = string || '';\r\n        prepend = prepend || '';\r\n        var splitted = string.split(',');\r\n        if (splitted.length > 1) {\r\n            var formatted = splitted.shift();\r\n            angular.forEach(splitted, function (value, index) {\r\n                if (expression) {\r\n                    formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\r\n                } else {\r\n                    formatted = formatted.split('{' + index + '}').join(prepend + value);\r\n                }\r\n            });\r\n            if (expression) {\r\n                return '\\'' + formatted + '\\'';\r\n            } else {\r\n                return formatted;\r\n            }\r\n        } else {\r\n            return prepend + string;\r\n        }\r\n    }\r\n    function reducer(o, key) {\r\n        return o[key];\r\n    }\r\n    function reducerSetter(o, key, value) {\r\n        if (typeof key == 'string') {\r\n            return reducerSetter(o, key.split('.'), value);\r\n        } else if (key.length == 1 && value !== undefined) {\r\n            return o[key[0]] = value;\r\n        } else if (key.length == 0) {\r\n            return o;\r\n        } else {\r\n            return reducerSetter(o[key[0]], key.slice(1), value);\r\n        }\r\n    }\r\n    function reducerAdder(o, key, value) {\r\n        if (typeof key == 'string') {\r\n            return reducerAdder(o, key.split('.'), value);\r\n        } else if (key.length == 1 && value !== undefined) {\r\n            return (o[key[0]] += value);\r\n        } else if (key.length == 0) {\r\n            return o;\r\n        } else {\r\n            return reducerAdder(o[key[0]], key.slice(1), value);\r\n        }\r\n    }\r\n    Utils.reverseSortOn = reverseSortOn;\r\n    Utils.getTouch = getTouch;\r\n    Utils.getRelativeTouch = getRelativeTouch;\r\n    Utils.getClosest = getClosest;\r\n    Utils.getClosestElement = getClosestElement;\r\n    Utils.throttle = throttle;\r\n    Utils.where = where;\r\n    Utils.format = format;\r\n    Utils.compileController = compileController;\r\n    Utils.reducer = reducer;\r\n    Utils.reducerSetter = reducerSetter;\r\n    Utils.reducerAdder = reducerAdder;\r\n    Utils.toMd5 = function (string) {\r\n        return Md5.encode(string);\r\n    };\r\n    Utils.ua = {\r\n        safari: safari,\r\n        msie: msie,\r\n        chrome: chrome,\r\n        mobile: mobile,\r\n    };\r\n    angular.forEach(Utils.ua, function (value, key) {\r\n        if (value) {\r\n            angular.element(document.getElementsByTagName('body')).addClass(key);\r\n        }\r\n    });\r\n    return Utils;\r\n}]);\r\n\r\nmodule.factory('Vector', function () {\r\n    function Vector(x, y) {\r\n        this.x = x || 0;\r\n        this.y = y || 0;\r\n    }\r\n    Vector.make = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.size = function (a) {\r\n        return Math.sqrt(a.x * a.x + a.y * a.y);\r\n    };\r\n    Vector.normalize = function (a) {\r\n        var l = Vector.size(a);\r\n        a.x /= l;\r\n        a.y /= l;\r\n        return a;\r\n    };\r\n    Vector.incidence = function (a, b) {\r\n        var angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\r\n        // if (angle < 0) angle += 2 * Math.PI;\r\n        // angle = Math.min(angle, (Math.PI * 2 - angle));\r\n        return angle;\r\n    };\r\n    Vector.distance = function (a, b) {\r\n        return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\r\n    };\r\n    Vector.cross = function (a, b) {\r\n        return (a.x * b.y) - (a.y * b.x);\r\n    };\r\n    Vector.difference = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.power = function (a, b) {\r\n        var x = Math.abs(b.x - a.x);\r\n        var y = Math.abs(b.y - a.y);\r\n        return (x + y) / 2;\r\n    };\r\n    Vector.prototype = {\r\n        size: function () {\r\n            return Vector.size(this);\r\n        },\r\n        normalize: function () {\r\n            return Vector.normalize(this);\r\n        },\r\n        incidence: function (b) {\r\n            return Vector.incidence(this, b);\r\n        },\r\n        cross: function (b) {\r\n            return Vector.cross(this, b);\r\n        },\r\n        distance: function (b) {\r\n            return Vector.distance(this, b);\r\n        },\r\n        difference: function (b) {\r\n            return Vector.difference(this, b);\r\n        },\r\n        power: function () {\r\n            return (Math.abs(this.x) + Math.abs(this.y)) / 2;\r\n        },\r\n        towards: function (b, friction) {\r\n            friction = friction || 0.125;\r\n            this.x += (b.x - this.x) * friction;\r\n            this.y += (b.y - this.y) * friction;\r\n            return this;\r\n        },\r\n        add: function (b) {\r\n            this.x += b.x;\r\n            this.y += b.y;\r\n            return this;\r\n        },\r\n        friction: function (b) {\r\n            this.x *= b;\r\n            this.y *= b;\r\n            return this;\r\n        },\r\n        copy: function (b) {\r\n            return new Vector(this.x, this.y);\r\n        },\r\n        toString: function () {\r\n            return '{' + this.x + ',' + this.y + '}';\r\n        },\r\n    };\r\n    return Vector;\r\n});\r\n\r\nmodule.factory('ElementRect', ['Vector', function (Vector) {\r\n    function ElementRect() {\r\n        this.x = 0;\r\n        this.y = 0;\r\n        this.width = 0;\r\n        this.height = 0;\r\n        this.center = new Vector();\r\n    }\r\n    ElementRect.fromNative = function (nativeElement) {\r\n        return new ElementRect().set(nativeElement);\r\n    }\r\n    ElementRect.prototype = {\r\n        set: function (nativeElement) {\r\n            var rect = nativeElement.getBoundingClientRect();\r\n            this.x = rect.left;\r\n            this.y = rect.top;\r\n            this.width = nativeElement.offsetWidth;\r\n            this.height = nativeElement.offsetHeight;\r\n            this.center.x = this.x + this.width / 2;\r\n            this.center.y = this.y + this.height / 2;\r\n            this.native = nativeElement;\r\n            return this;\r\n        },\r\n        offset: function (vector) {\r\n            this.x += vector.x;\r\n            this.y += vector.y;\r\n            this.center.x = this.x + this.width / 2;\r\n            this.center.y = this.y + this.height / 2;\r\n            return this;\r\n        },\r\n        intersect: function (element) {\r\n            // console.log('intersect.this', this, 'element', element);\r\n            return !(element.x > this.x + this.width ||\r\n                        element.x + element.width < this.x ||\r\n                        element.y > this.y + this.height ||\r\n                        element.y + element.height < this.y);\r\n        },\r\n        toString: function () {\r\n            return '{' + this.x + ',' + this.y + ',' + this.width + ',' + this.height + '}';\r\n        },\r\n    };\r\n    return ElementRect;\r\n}]);\r\n\r\nmodule.factory('Style', function () {\r\n    var prefix = function detectTransformProperty() {\r\n        var transform = 'transform',\r\n            webkit = 'webkitTransform';\r\n        var div = document.createElement(\"DIV\");\r\n        if (typeof div.style[transform] !== 'undefined') {\r\n            ['webkit', 'moz', 'o', 'ms'].every(function (prop) {\r\n                var prefixed = '-' + prop + '-transform';\r\n                if (typeof div.style[prefixed] !== 'undefined') {\r\n                    prefix = prefixed;\r\n                    return false;\r\n                }\r\n                return true;\r\n            });\r\n        } else if (typeof div.style[webkit] !== 'undefined') {\r\n            prefix = '-webkit-transform';\r\n        } else {\r\n            prefix = undefined;\r\n        }\r\n        return prefix;\r\n    }();\r\n    function Style() {\r\n        this.props = {\r\n            scale: 1,\r\n            hoverScale: 1,\r\n            currentScale: 1,\r\n        }\r\n    }\r\n    Style.prototype = {\r\n        set: function (element) {\r\n            var styles = [];\r\n            angular.forEach(this, function (value, key) {\r\n                if (key !== 'props')\r\n                    styles.push(key + ':' + value);\r\n            });\r\n            element.style.cssText = styles.join(';') + ';';\r\n        },\r\n        transform: function (transform) {\r\n            this[prefix] = transform;\r\n        },\r\n        transformOrigin: function (x, y) {\r\n            this[prefix + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\r\n            this[prefix + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\r\n        },\r\n    };\r\n    Style.prefix = prefix;\r\n    return Style;\r\n});\r\n\n/* global angular, module */\r\n\r\nmodule.factory('Filters', [function () {\r\n    function Filters() {\r\n        this.keys = {};\r\n        this.flags = {};\r\n        this.values = [];\r\n        this.search = [];\r\n    }\r\n    Filters.prototype = {\r\n        has: function (id) {\r\n            return (id && this.keys[id] === true) || false;\r\n        },\r\n        active: function (id) {\r\n            return (this.has(id) && this.flags[id] === true) || false;\r\n        },\r\n        removeAll: function () {\r\n            this.keys = {};\r\n            this.values.length = 0;\r\n        },\r\n        reset: function () {\r\n            this.removeAll();\r\n            this.flags = {};\r\n            this.search = [];\r\n        },\r\n        toggle: function (item) {\r\n            if (this.active(item.id)) {\r\n                item.active = this.flags[item.id] = false;\r\n                var index = this.search.indexOf(item.id);\r\n                this.search.splice(index, 1);\r\n            } else {\r\n                item.active = this.flags[item.id] = true;\r\n                this.search.push(item.id);\r\n            }\r\n        },\r\n        add: function (item) {\r\n            if (item.id && !this.has(item.id)) {\r\n                this.keys[item.id] = true;\r\n                this.values.push(item);\r\n            }\r\n        },\r\n        remove: function (item) {\r\n            if (this.has(item.id)) {\r\n                var index;\r\n                if (this.flags[item.id] === true) {\r\n                    item.active = this.flags[item.id] = false;\r\n                    index = this.search.indexOf(item.id);\r\n                    this.search.splice(index, 1);\r\n                }\r\n                index = this.values.indexOf(item);\r\n                this.values.splice(index, 1);\r\n                this.keys[item.id] = false;\r\n            }\r\n        },\r\n        sort: function () {\r\n            this.values.sort(function (va, vb) {\r\n                var a, b;\r\n                a = va.name ? String(va.name).toLowerCase() : ''; // ignore upper and lowercase\r\n                b = vb.name ? String(vb.name).toLowerCase() : ''; // ignore upper and lowercase\r\n                if (a < b) {\r\n                    return -1;\r\n                }\r\n                if (a > b) {\r\n                    return 1;\r\n                }\r\n                return 0;\r\n            });\r\n        },\r\n        filter: function (cell) {\r\n            if (this.search.length) {\r\n                return (this.search.indexOf(cell.key) !== -1);\r\n            } else {\r\n                return true;\r\n            }\r\n        },\r\n    };\r\n    return Filters;\r\n}]);\r\n\r\nmodule.factory('Order', [function () {\r\n    function Order() {\r\n        this.set(0);\r\n    }\r\n    Order.prototype = {\r\n        set: function (sort) {\r\n            switch (sort) {\r\n                case 1:\r\n                    this.name = 'Asc';\r\n                    this.sort = 1;\r\n                    this.asc = true;\r\n                    this.desc = false;\r\n                    break;\r\n                case -1:\r\n                    this.name = 'Desc';\r\n                    this.sort = -1;\r\n                    this.asc = false;\r\n                    this.desc = true;\r\n                    break;\r\n                default:\r\n                    this.name = 'Ordina';\r\n                    this.sort = 0;\r\n                    this.asc = false;\r\n                    this.desc = false;\r\n            }\r\n        },\r\n        toggle: function () {\r\n            var sort = this.sort - 1;\r\n            sort === -2 ? sort = 1 : null;\r\n            this.set(sort);\r\n        },\r\n    };\r\n    return Order;\r\n}]);\r\n\r\nmodule.factory('Field', ['$parse', '$filter', 'Utils', 'Filters', 'Order', 'fieldTypes', 'fieldTotalTypes', function ($parse, $filter, Utils, Filters, Order, fieldTypes, fieldTotalTypes) {\r\n    function Field(data) {\r\n        this.filters = new Filters();\r\n        this.order = new Order();\r\n        this.typeTotal = this.typeTotal || fieldTotalTypes.SUM;\r\n        data ? angular.extend(this, data) : null;\r\n        // console.log('typeTotal', this.typeTotal);\r\n        // PREPARE GETTER SETTERS\r\n        if (angular.isFunction(this.value)) {\r\n            this.value = this.value.bind(this);\r\n        }\r\n        this.name = this.name || this.value;\r\n        this.raw = this.raw || this.value;\r\n        this.key = this.key || this.value;\r\n        this.source = this.source || this.value;\r\n        this.getters = {};\r\n        var fields = ['key', 'value', 'raw', 'source', 'post'];\r\n        angular.forEach(fields, function (field) {\r\n            if (this[field]) {\r\n                this.getters[field] = angular.isFunction(this[field]) ? this[field] : $parse(this[field]);\r\n            }\r\n        }, this);\r\n        this.setters = {};\r\n        angular.forEach(this.getters, function (getter, key) {\r\n            if (!angular.isFunction(this[key])) {\r\n                this.setters[key] = getter.assign;\r\n            }\r\n        }, this);\r\n        // PREPARE GETTER SETTERS\r\n        this.keys = {};\r\n        this.total = 0;\r\n    }\r\n    Field.prototype = {\r\n        reset: function () {\r\n            this.keys = {};\r\n            this.total = 0;\r\n            if (!this.isActive()) {\r\n                this.filters.reset();\r\n            }\r\n        },\r\n        hasKey: function (item) {\r\n            var has = true;\r\n            var key = this.getters.key(item);\r\n            if (key && this.keys[key] != true) {\r\n                this.keys[key] = true;\r\n                has = false;\r\n            }\r\n            return has;\r\n        },\r\n        initValue: function (item) {\r\n            this.setters.raw(item, (this.getters.value(item) || 0));\r\n            return this;\r\n        },\r\n        aggregation: function (item, row) {\r\n            var a = (this.getters.raw(item) || 0);\r\n            var b = (this.getters.value(row) || 0);\r\n            var field = this;\r\n            switch (field.typeTotal) {\r\n                case fieldTotalTypes.MIN:\r\n                    field.setters.raw(item, Math.min(a, b));\r\n                    break;\r\n                case fieldTotalTypes.MAX:\r\n                    field.setters.raw(item, Math.max(a, b));\r\n                    break;\r\n                case fieldTotalTypes.AVG:\r\n                    var n = 0;\r\n                    field.setters.raw(item, (b + (a * n)) / (n + 1)); // (newVal + (avg * n)) / (n+1)\r\n                    break;\r\n                default:\r\n                    field.setters.raw(item, a + b);\r\n            }\r\n            return field;\r\n        },\r\n        addCount: function (item, row) {\r\n            if (!this.hasKey(row) && this.setters.raw) {\r\n                var v = null;\r\n                if (item != row) {\r\n                    v = (this.getters.raw(item) || 0) + 1;\r\n                } else {\r\n                    v = 1;\r\n                }\r\n                this.setters.raw(item, v);\r\n            }\r\n            return this;\r\n        },\r\n        addValue: function (item) {\r\n            var key = this.getters.key(item);\r\n            if (!this.filters.has(key)) {\r\n                var value = this.getters.raw(item);\r\n                var active = this.filters.flags[key];\r\n                this.filters.add({\r\n                    id: key,\r\n                    name: value || '-',\r\n                    active: active,\r\n                });\r\n            }\r\n        },\r\n        getFormat: function () {\r\n            var format = '';\r\n            switch (this.type) {\r\n                case fieldTypes.ID:\r\n                case fieldTypes.NUMBER:\r\n                    format = '#';\r\n                    break;\r\n                case fieldTypes.DOUBLE:\r\n                    format = '#';\r\n                    break;\r\n                case fieldTypes.DATE:\r\n                    format = 'yyyy-mm-dd';\r\n                    break;\r\n                case fieldTypes.WEEKS:\r\n                    format = '#,###0 [$W]';\r\n                    break;\r\n                case fieldTypes.HOURS:\r\n                    format = '#,###0 [$H]';\r\n                    break;\r\n                case fieldTypes.COSTS:\r\n                    format = '#,###.00 ';\r\n                    break;\r\n                case fieldTypes.PERCENT:\r\n                    format = '0.00%';\r\n                    break;\r\n                case fieldTypes.GAIN:\r\n                    format = '[Color 10]+0.00%;[Red]-0.00%;-';\r\n                    break;\r\n            }\r\n            return format;\r\n        },\r\n        getLink: function (item) {\r\n            return angular.isFunction(this.link) ? this.link(item) : null;\r\n        },\r\n        isActive: function () {\r\n            if (angular.isFunction(this.active) && this.active) {\r\n                return this.active();\r\n            } else {\r\n                return this.active;\r\n            }\r\n        },\r\n        toggle: function () {\r\n            angular.isFunction(this.active) ? null : this.active = !this.active;\r\n        },\r\n        activate: function () {\r\n            angular.isFunction(this.active) ? null : this.active = true;\r\n        },\r\n        deactivate: function () {\r\n            angular.isFunction(this.active) ? null : this.active = false;\r\n        },\r\n        formatValue: function (value) {\r\n            switch (this.type) {\r\n                case fieldTypes.RESOURCE:\r\n                case fieldTypes.DISABLED:\r\n                    value = $filter('shortName')(value);\r\n                    break;\r\n                case fieldTypes.ID:\r\n                case fieldTypes.NUMBER:\r\n                    value = $filter('customNumber')(value, 0);\r\n                    break;\r\n                case fieldTypes.DOUBLE:\r\n                    value = $filter('customNumber')(value, 2);\r\n                    break;\r\n                case fieldTypes.WEEKS:\r\n                    value = $filter('customNumber')(value, 2, ' W');\r\n                    break;\r\n                case fieldTypes.DATE:\r\n                    value = $filter('date')(value, 'yyyy-MM-dd');\r\n                    break;\r\n                case fieldTypes.HOURS:\r\n                    value = $filter('customNumber')(value, 0, ' H');\r\n                    break;\r\n                case fieldTypes.COSTS:\r\n                    value = $filter('customNumber')(value, 0, ' ');\r\n                    break;\r\n                case fieldTypes.PERCENT:\r\n                    value = $filter('customNumber')(value, 2, ' %');\r\n                    break;\r\n                case fieldTypes.GAIN:\r\n                    value = angular.isNumber(value) ? (value > 0 ? '+' : '') + $filter('customNumber')(value, 2, ' %') : (value || '-');\r\n                    break;\r\n            }\r\n            return value;\r\n        },\r\n        getTotal: function (filtered) {\r\n            var value = this.getValueTotal(filtered);\r\n            return this.formatValue(value);\r\n        },\r\n        getValueTotal: function (filtered) {\r\n            var value = 0, field = this;\r\n            if (field.compare && field.type === fieldTypes.GAIN) {\r\n                var current = 0; // (field.getters.raw(item) || 0);\r\n                var previous = 0; // (this.getters.raw(item) || 0);                \r\n                angular.forEach(filtered, function (item) {\r\n                    current += (field.$field.getters.raw(item) || 0);\r\n                    previous += (field.getters.raw(item) || 0);\r\n                }.bind(this));\r\n                if (previous) {\r\n                    value = (current - previous) / previous * 100;\r\n                }\r\n            } else {\r\n                switch (field.typeTotal) {\r\n                    case fieldTotalTypes.SUM:\r\n                        value = 0;\r\n                        break;\r\n                    case fieldTotalTypes.MIN:\r\n                        value = Number.POSITIVE_INFINITY;\r\n                        break;\r\n                    case fieldTotalTypes.MAX:\r\n                        value = Number.NEGATIVE_INFINITY;\r\n                        break;\r\n                    case fieldTotalTypes.AVG:\r\n                        break;\r\n                }\r\n                angular.forEach(filtered, function (item, i) {\r\n                    var a = value;\r\n                    var b = (field.getters.raw(item) || 0);\r\n                    switch (field.typeTotal) {\r\n                        case fieldTotalTypes.SUM:\r\n                            value = a + b;\r\n                            break;\r\n                        case fieldTotalTypes.MIN:\r\n                            value = a < b ? a : b;\r\n                            break;\r\n                        case fieldTotalTypes.MAX:\r\n                            value = a > b ? a : b;\r\n                            break;\r\n                        case fieldTotalTypes.AVG:\r\n                            value = (b + (a * i)) / (i + 1);\r\n                            break;\r\n                    }\r\n                });\r\n                (value === Number.POSITIVE_INFINITY || value === Number.NEGATIVE_INFINITY) ? value = 0 : null;\r\n            }\r\n            field.total = value;\r\n            return value;\r\n        },\r\n        getTotalClass: function (filtered) {\r\n            var cc = [];\r\n            switch (this.type) {\r\n                case fieldTypes.NUMBER:\r\n                case fieldTypes.DOUBLE:\r\n                case fieldTypes.WEEKS:\r\n                case fieldTypes.HOURS:\r\n                case fieldTypes.COSTS:\r\n                case fieldTypes.PERCENT:\r\n                case fieldTypes.GAIN:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getCellTotal: function (rows, index) {\r\n            var value = 0, field = this, cell, previousCell;\r\n            if (field.compare && field.type === fieldTypes.GAIN) {\r\n                var current = 0;\r\n                var previous = 0;         \r\n                angular.forEach(rows, function (row) {\r\n                    /*\r\n                    cell = row.cols[index];\r\n                    current += (field.$field.getters.raw(item) || 0);\r\n                    previous += (cell.getValue() || 0);\r\n                    */\r\n                    cell = row.cols[field.$field.col.index];\r\n                    previousCell = row.cols[index];\r\n                    current += (cell.getValue() || 0);\r\n                    previous += (previousCell.getValue() || 0);\r\n                });\r\n                if (previous) {\r\n                    value = (current - previous) / previous * 100;\r\n                }\r\n            } else {\r\n                switch (field.typeTotal) {\r\n                    case fieldTotalTypes.SUM:\r\n                        value = 0;\r\n                        break;\r\n                    case fieldTotalTypes.MIN:\r\n                        value = Number.POSITIVE_INFINITY;\r\n                        break;\r\n                    case fieldTotalTypes.MAX:\r\n                        value = Number.NEGATIVE_INFINITY;\r\n                        break;\r\n                    case fieldTotalTypes.AVG:\r\n                        break;\r\n                }\r\n                angular.forEach(rows, function (row, i) {\r\n                    cell = row.cols[index];\r\n                    var a = value;\r\n                    var b = (cell.getValue() || 0);                    \r\n                    switch (field.typeTotal) {\r\n                        case fieldTotalTypes.SUM:\r\n                            value = a + b;\r\n                            break;\r\n                        case fieldTotalTypes.MIN:\r\n                            value = a < b ? a : b;\r\n                            break;\r\n                        case fieldTotalTypes.MAX:\r\n                            value = a > b ? a : b;\r\n                            break;\r\n                        case fieldTotalTypes.AVG:\r\n                            value = (b + (a * i)) / (i + 1);\r\n                            break;\r\n                    }\r\n                });\r\n                (value === Number.POSITIVE_INFINITY || value === Number.NEGATIVE_INFINITY) ? value = 0 : null;\r\n            }\r\n            field.total = value;\r\n            return value;\r\n        },\r\n        getHeaderClass: function () {\r\n            var cc = [];\r\n            angular.forEach(this, function (value, key) {\r\n                if (value === true) {\r\n                    cc.push(key);\r\n                }\r\n            });\r\n            switch (this.type) {\r\n                case fieldTypes.NUMBER:\r\n                case fieldTypes.DOUBLE:\r\n                case fieldTypes.WEEKS:\r\n                case fieldTypes.HOURS:\r\n                case fieldTypes.COSTS:\r\n                case fieldTypes.PERCENT:\r\n                case fieldTypes.GAIN:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n            }\r\n            /*\r\n            var columnClass = this.getColumnClass();\r\n            if (columnClass != '') {\r\n                cc.push(columnClass);\r\n            }\r\n            */\r\n            return cc.join(' ');\r\n        },\r\n        getCellClass: function (item) {\r\n            var cc = [];\r\n            angular.forEach(this, function (value, key) {\r\n                if (value === true) {\r\n                    cc.push(key);\r\n                }\r\n            });\r\n            switch (this.type) {\r\n                case fieldTypes.LINK:\r\n                    cc.push('text-underline');\r\n                    break;\r\n                case fieldTypes.NUMBER:\r\n                case fieldTypes.DOUBLE:\r\n                case fieldTypes.WEEKS:\r\n                case fieldTypes.HOURS:\r\n                case fieldTypes.COSTS:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n                case fieldTypes.PERCENT:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n                case fieldTypes.GAIN:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getColumnClass: function () {\r\n            return this.color ? 'shade-light-blue-' + this.color : '';\r\n        },\r\n        getTextClass: function (item) {\r\n            var cc = [];\r\n            switch (this.type) {\r\n                case fieldTypes.GAIN:\r\n                    var value = this.getters.raw(item);\r\n                    if (angular.isNumber(value) && value < 0) {\r\n                        cc.push('text-danger');\r\n                    } else {\r\n                        cc.push('text-success');\r\n                    }\r\n                    break;\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        /*\r\n        getItemClass: function (item) {\r\n            var cc = [];\r\n            cc.push(item.cells[this.$id].cellClass);\r\n            var columnClass = this.getColumnClass();\r\n            if (columnClass != '') {\r\n                cc.push(columnClass);\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getFormatted: function (item) {\r\n            if (this.dynamic) {\r\n                return this.formatValue(this.getters.raw(item));\r\n            } else {\r\n                return item.cells[this.$id].name;\r\n            }\r\n        },\r\n        filter: function (item) {\r\n            if (this.isActive() && this.filters.search.length) {\r\n                return (this.filters.search.indexOf(item.cells[this.$id].key) !== -1);\r\n            } else {\r\n                return true;\r\n            }\r\n        },\r\n        */\r\n        toStatic: function (item) {\r\n            if (this.post) {\r\n                this.setters.raw(item, (this.getters.post(item) || 0));\r\n            }\r\n            var field = this;\r\n            // var cell = item.cells[field.$id] = {\r\n            var cell = {\r\n                cellClass: field.getCellClass(item),\r\n                textClass: field.getTextClass(item),\r\n                link: (field.link ? field.link(item) : null),\r\n                pop: (field.pop ? field.pop(item) : null),\r\n                key: field.getters.key(item),\r\n                getValue: function () {\r\n                    if (field.dynamic && !field.post) {\r\n                        return field.getters.value(item);\r\n                    } else if (cell.value) {\r\n                        return cell.value;\r\n                    } else {\r\n                        return field.getters.raw(item);\r\n                    }\r\n                },\r\n                getName: function () {\r\n                    if (field.dynamic && !field.post) {\r\n                        return field.formatValue(cell.getValue());\r\n                    } else if (cell.name) {\r\n                        return cell.name;\r\n                    } else {\r\n                        return field.formatValue(cell.getValue());\r\n                    }\r\n                },\r\n                getTotalValue: function (rows, index) {\r\n                    return field.getCellTotal(rows, index);\r\n                },\r\n                getTotalName: function (rows, index) {\r\n                    var value = cell.getTotalValue(rows, index);\r\n                    return field.formatValue(value);\r\n                },\r\n                formatValue: function (value) {\r\n                    return field.formatValue(value);\r\n                },\r\n            };\r\n            cell.value = cell.getValue();\r\n            cell.name = cell.getName();\r\n            return cell;\r\n        },\r\n    };\r\n    Field.types = fieldTypes;\r\n    Field.totalTypes = fieldTotalTypes;\r\n    return Field;\r\n}]);\r\n\r\nmodule.factory('Fields', ['$parse', 'Utils', 'Field', 'fieldTypes', function ($parse, Utils, Field, fieldTypes) {\r\n    function Fields(fields) {\r\n        var array = [];\r\n        if (fields) {\r\n            angular.forEach(fields, function (field, index) {\r\n                field.$id = index + 1;\r\n                array.push(new Field(field));\r\n            });\r\n        }\r\n        angular.extend(array, Fields.prototype);\r\n        return array;\r\n    }\r\n    Fields.prototype = {\r\n        // EXPANSION\r\n        expand: function (data) {\r\n            var options = {\r\n                dynamic: true,\r\n                compare: false,\r\n            }\r\n            data ? angular.extend(options, data) : null;\r\n            // add percentuals and compares\r\n            var array = [], fields = this;\r\n            array.radios = {};\r\n            angular.forEach(this, function (field, index) {\r\n                field.$id = array.length + 1;\r\n                array.push(field);\r\n                if (field.aggregate && field.value === field.raw) {\r\n                    if (options.dynamic) {\r\n                        array.push(new Field({\r\n                            $id: array.length + 1,\r\n                            name: '%',\r\n                            value: function (item) {\r\n                                return field.getters.raw(item) / field.total * 100;\r\n                            },\r\n                            key: field.key,\r\n                            type: fieldTypes.PERCENT,\r\n                            dynamic: true,\r\n                            active: function () {\r\n                                return array.show.dynamic && field.active;\r\n                            },\r\n                            $field: field,\r\n                        }));\r\n                    }\r\n                    if (options.compare) {\r\n                        var fieldPrevious = new Field({\r\n                            $id: array.length + 1,\r\n                            name: 'anno precedente',\r\n                            value: function (item) {\r\n                                return this.getters.raw(item);\r\n                            },\r\n                            raw: field.value + 'Last',\r\n                            source: field.value,\r\n                            key: field.key,\r\n                            type: field.type, // \r\n                            count: field.count,\r\n                            compare: true,\r\n                            dynamic: true,\r\n                            active: function () {\r\n                                return (fields.show.compare && this.$field.active) || false;\r\n                            },\r\n                            $field: field,\r\n                        });\r\n                        array.push(fieldPrevious);\r\n                        array.push(new Field({\r\n                            $id: array.length + 1,\r\n                            name: '%',\r\n                            value: function (row) {\r\n                                return 0;\r\n                            },\r\n                            post: function (row) {\r\n                                var current = (field.getters.raw(row) || 0);\r\n                                var previous = (fieldPrevious.getters.raw(row) || 0);\r\n                                if (current && previous) {\r\n                                    return ((current - previous) / previous) * 100;\r\n                                } else if (current) {\r\n                                    return Number.POSITIVE_INFINITY; // '+ %';\r\n                                } else {\r\n                                    return null; // '+ %';\r\n                                }\r\n                            },\r\n                            raw: field.value + 'Gain',\r\n                            source: field.value,\r\n                            key: field.key,\r\n                            type: fieldTypes.GAIN, // field.type, // \r\n                            count: field.count,\r\n                            compare: true,\r\n                            dynamic: true,\r\n                            active: function () {\r\n                                 return (fields.show.compare && this.$field.active) || false;\r\n                            },\r\n                            $field: field,\r\n                        }));\r\n                    }\r\n                }\r\n                if (field.radio && field.active) {\r\n                    array.radios[field.radio] = field.value;\r\n                }\r\n            });\r\n            angular.extend(array, Fields.prototype);\r\n            return array;\r\n        },\r\n        // AGGREGATE, GROUPBY & COMPARE\r\n        reset: function () {\r\n            this.groups = {};\r\n            angular.forEach(this, function (field) {\r\n                field.reset();\r\n            });\r\n            return this;\r\n        },\r\n        unique: function (row, items) {\r\n            var key = this.getGroupKey(row);\r\n            var item = this.groups[key];\r\n            if (!item) {\r\n                item = this.groups[key] = row; // angular.copy(row);\r\n                item.cells = [];\r\n                items.push(item);\r\n            }\r\n            return item;\r\n        },\r\n        iterate: function (row, items) {\r\n            row = angular.copy(row);\r\n            var item = this.unique(row, items);\r\n            this.aggregation(item, row);\r\n        },\r\n        compare: function (row, items) {\r\n            row = angular.copy(row);\r\n            angular.forEach(this, function (field) {\r\n                if (field.compare) {\r\n                    var value = field.getters.source(row);\r\n                    field.setters.raw(row, value);      \r\n                }\r\n            });\r\n            /*\r\n            // !!! _1_\r\n            angular.forEach(this, function (field) {\r\n                if (field.compare) {\r\n                    field.setters.source(row, 0);\r\n                }\r\n            });\r\n            */\r\n            var item = this.unique(row, items);\r\n            this.aggregation(item, row, true);\r\n        },\r\n        aggregation: function (item, row, comparing) {\r\n            angular.forEach(this, function (field) {\r\n                var mode = (comparing ? field.compare : !field.compare);\r\n                if ((field.isActive() || field.always) && mode) {\r\n                    if (field.count) {\r\n                        field.addCount(item, row);\r\n                    } else if (comparing || field.aggregate) {\r\n                        if (!field.hasKey(row)) {\r\n                            if (item === row) {\r\n                                field.initValue(item);\r\n                            } else {\r\n                                field.aggregation(item, row);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            return this;\r\n        },\r\n        // AGGREGATE, GROUPBY & COMPARE\r\n        getCount: function () {\r\n            var i = 0;\r\n            angular.forEach(this, function (field) {\r\n                i += field.isActive() ? 1 : 0;\r\n            }.bind(this));\r\n            return i;\r\n        },\r\n        getFirstField: function () {\r\n            var first = null;\r\n            angular.forEach(this, function (field) {\r\n                if (first === null && field.isActive() && field.groupBy && field.value !== 'month' && field.value !== 'monthShort') {\r\n                    first = field;\r\n                }\r\n            });\r\n            return first;\r\n        },\r\n        getGroupKey: function (item) {\r\n            var keys = [];\r\n            angular.forEach(this, function (field) {\r\n                if (field.isActive() && field.groupBy) {\r\n                    keys.push(field.getters.key(item));\r\n                }\r\n            });\r\n            return keys.join('-');\r\n        },\r\n        getGroups: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (field, index) {\r\n                if (field.groupBy) {\r\n                    array.push(field);\r\n                }\r\n            });\r\n            angular.extend(array, Fields.prototype);\r\n            return array;\r\n        },\r\n        getAggregates: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (field, index) {\r\n                if (field.aggregate && !field.count) {\r\n                    array.push(field);\r\n                }\r\n            });\r\n            angular.extend(array, Fields.prototype);\r\n            return array;\r\n        },\r\n        getPercentages: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (field, index) {\r\n                if (field.type === fieldTypes.PERCENT) {\r\n                    array.push(field);\r\n                }\r\n            });\r\n            angular.extend(array, Fields.prototype);\r\n            return array;\r\n        },\r\n        getDynamics: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (field, index) {\r\n                if (field.dynamic) {\r\n                    array.push(field);\r\n                }\r\n            });\r\n            angular.extend(array, Fields.prototype);\r\n            return array;\r\n        },\r\n        getCompares: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (field, index) {\r\n                if (field.compare) {\r\n                    array.push(field);\r\n                }\r\n            });\r\n            angular.extend(array, Fields.prototype);\r\n            return array;\r\n        },\r\n        getCounters: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (field, index) {\r\n                if (field.count) {\r\n                    array.push(field);\r\n                }\r\n            });\r\n            angular.extend(array, Fields.prototype);\r\n            return array;\r\n        },        \r\n        activeInRange: function (range) {\r\n            var flag = false;\r\n            var i = 0;\r\n            while (!flag && i < this.length) {\r\n                var field = this[i];\r\n                if (field.active) {\r\n                    flag = (range.indexOf(field.value) !== -1);\r\n                }\r\n                i++;\r\n            }\r\n            return flag;\r\n        },        \r\n        toggleFields: function (field) {\r\n            if (field.radio) {\r\n                angular.forEach(this, function (item) {\r\n                    if (field.radio === item.radio && field !== item) {\r\n                        item.deactivate();\r\n                    }\r\n                });\r\n                field.activate();\r\n                this.radios[field.radio] = field.value;\r\n            } else {\r\n                field.toggle();\r\n            }\r\n        },\r\n        show: {\r\n            table: true, // defaults\r\n        },\r\n        // ELIMINARE\r\n        /*\r\n        isFilterDisabled: function (row, field, filtered) { // check if other values are disabled !! unused\r\n            var id = row.id,\r\n                t = this;\r\n            var has = false,\r\n                index = 0;\r\n            while (index < filtered.length) {\r\n                has = has || field.getters.key(filtered[index]) === id;\r\n                if (has) {\r\n                    index = filtered.length;\r\n                } else {\r\n                    index++;\r\n                }\r\n            }\r\n            return !has;\r\n        },\r\n        getSortKey: function (item) {\r\n            var values = [];\r\n            angular.forEach(this, function (field) {\r\n                if (field.isActive() && field.groupBy) {\r\n                    values.push(field.sort ? $parse(field.sort)(item) : field.formatValue(field.getters.raw(item)));\r\n                }\r\n            });\r\n            return values.join('');\r\n        },\r\n        */\r\n        toStatic: function (items) {\r\n            var fields = this,\r\n                cols = [],\r\n                rows = [],\r\n                cell;\r\n            // primo ciclo\r\n            angular.forEach(fields, function (field, index) {\r\n                field.filters.removeAll();\r\n                field.col = {\r\n                    active: field.isActive(),\r\n                    headerClass: field.getHeaderClass(),\r\n                    columnClass: field.getColumnClass(),\r\n                    totalClass: field.getTotalClass(),\r\n                    format: field.getFormat(),\r\n\r\n                    $id: field.$id,\r\n                    colName: field.name,\r\n                    type: field.type,\r\n                    groupBy: field.groupBy,\r\n                    aggregate: field.aggregate,\r\n                    compare: field.compare,\r\n                    filters: field.filters,\r\n                    order: field.order,\r\n                    originaIndex: index,\r\n                };\r\n                if (field.col.active) {\r\n                    field.col.index = cols.length;\r\n                    cols.push(field.col);\r\n                }\r\n            });\r\n            // lasciare serve un secondo ciclo!\r\n            angular.forEach(fields, function (field) {\r\n                if (field.col.active || (field.dynamic && !field.compare) || field.always) {\r\n                    angular.forEach(items, function (item, i) {\r\n                        cell = field.toStatic(item);\r\n                        if (field.hasSearch && field.groupBy) {\r\n                            field.addValue(item);\r\n                        }\r\n                        var row = rows[i] = (rows[i] || { cols: [] });\r\n                        cell = angular.extend(angular.copy(cell), field.col);\r\n                        row.cols[field.col.index] = cell;\r\n                    });\r\n                    if (field.hasSearch && field.groupBy) {\r\n                        field.filters.sort();\r\n                    }\r\n                }\r\n            });\r\n            // lasciare serve un terzo ciclo!\r\n            angular.forEach(cols, function (field, index) {\r\n                var last = rows[rows.length - 1].cols[index];\r\n                field.$last = last;\r\n                field.getTotalValue = function (rows) {\r\n                    return this.$last.getTotalValue(rows, index);\r\n                };\r\n                field.getTotalName = function (rows) {\r\n                    return this.$last.getTotalName(rows, index);\r\n                };\r\n                /*\r\n                field.totalValue = field.getTotalValue();\r\n                field.totalName = field.getTotalName();\r\n                */\r\n            });\r\n            //console.log('Fields.toStatic', 'cols', cols.length, 'rows', rows.length);\r\n            return { cols: cols, rows: rows };\r\n        },\r\n    };\r\n    Fields.fromDatas = function (datas) {\r\n        return Fields.parseDatas(datas);\r\n    }\r\n    Fields.parseDatas = function getFields(datas) {\r\n        var fields = null;\r\n        if (datas && datas.length) {\r\n            fields = [];\r\n            function parse(item, prop) {\r\n                if (angular.isArray(item)) {\r\n                    angular.forEach(item, function (value, key) {\r\n                        parse(value, (prop || '') + '[' + key + ']');\r\n                    });\r\n                } else if (angular.isObject(item)) {\r\n                    angular.forEach(item, function (value, key) {\r\n                        parse(value, (prop ? prop + '.' : '') + key);\r\n                    });\r\n                } else {\r\n                    var field = {\r\n                        value: prop,\r\n                        type: fieldTypes.TEXT,\r\n                        active: fields.length < 6,\r\n                    };\r\n                    if (angular.isDate(item) || (angular.isNumber(item) && \r\n                        (prop.toLowerCase().indexOf('date') !== -1 || prop.toLowerCase().indexOf('time') !== -1)\r\n                        )) {\r\n                        field.type = fieldTypes.DATE;\r\n                        field.groupBy = true;\r\n                        field.hasSearch = true;\r\n                    } else if (angular.isNumber(item)) {\r\n                        field.type = fieldTypes.NUMBER;\r\n                        field.aggregate = true;\r\n                        field.color = 1;\r\n                    } else {\r\n                        field.groupBy = true;\r\n                        field.hasSearch = true;\r\n                    }\r\n                    fields.push(field);\r\n                }\r\n            }\r\n            parse(datas[0]);\r\n        }\r\n        return fields;\r\n    };\r\n    Fields.types = fieldTypes;\r\n    return Fields;\r\n}]);\r\n\r\nmodule.factory('Table', ['$parse', 'Fields', 'fieldTypes', 'orderByFilter', function ($parse, Fields, fieldTypes, orderByFilter) {\r\n    var MAX_FIELDS_ORDERED = 4;\r\n    function Table(fields, options) {\r\n        this.fields = new Fields(fields).expand(options);\r\n        this.defaults = fields.map(function (field) {\r\n            return {\r\n                $id: field.$id,\r\n                active: field.active,\r\n            };\r\n        });\r\n        this.colGroups = [{\r\n            name: 'GroupBy',\r\n            items: this.fields.getGroups()\r\n        }, ];\r\n        this.valGroups = [{\r\n            name: 'Aggregate',\r\n            items: this.fields.getAggregates()\r\n        }, ];\r\n        this.excludes = [];\r\n        this.includes = [];\r\n        this.setOptions(options);\r\n        // DATAS\r\n        this.datas = [];\r\n        this.items = [];    \r\n        this.rows = [];\r\n        this.cols = [];    \r\n    }\r\n    Table.prototype = {\r\n        setDatas: function (datas, compares) {\r\n            if (datas) {\r\n                angular.forEach(datas, function (item, index) {\r\n                    item.$id = index + 1;\r\n                });\r\n            }\r\n            this.datas = datas;\r\n            if (compares) {\r\n                angular.forEach(compares, function (item, index) {\r\n                    item.$id = index + 1;\r\n                });\r\n            }\r\n            this.compares = compares;\r\n            this.update();\r\n        },\r\n        setOptions: function (options) {\r\n            var table = this;\r\n            this.options = [{\r\n                name: 'Columns',\r\n                template: 'partials/report/filters/columns',\r\n                icon: 'icon-columns',\r\n                groups: this.colGroups,\r\n                toggle: function(item) {\r\n                    return table.toggleField(item);\r\n                },\r\n                active: true,\r\n            }, {\r\n                name: 'Values',\r\n                template: 'partials/report/filters/values',\r\n                icon: 'icon-values',\r\n                groups: this.valGroups,\r\n                toggle: function(item) {\r\n                    return table.toggleField(item);\r\n                },\r\n            }, {\r\n                name: 'Options',\r\n                template: 'partials/report/filters/flags',\r\n                icon: 'icon-options',\r\n                rows: [{\r\n                    name: 'Exclude',\r\n                    items: this.exclude,\r\n                    toggle: function (item) {\r\n                        return table.exclude(item); \r\n                    },\r\n                }, {\r\n                    name: 'Include',\r\n                    items: this.includes,\r\n                    toggle: function (item) {\r\n                        return table.include(item); \r\n                    },\r\n                }, {\r\n                    name: 'Flags',\r\n                    items: [{\r\n                        name: 'Percentuali di incidenza',\r\n                        key: 'dynamic',\r\n                    }],\r\n                    toggle: function (item) {\r\n                        return table.toggle(item.key);\r\n                    }\r\n                }],\r\n            },];\r\n        },\r\n        update: function () {\r\n            this.items = [];\r\n            this.rows = [];\r\n            this.cols = [];\r\n            var datas = this.datas;\r\n            var items = this.items;\r\n            var fields = this.fields;\r\n            var excludes = this.excludes;\r\n            var includes = this.includes;\r\n            var compares = this.compares;\r\n            fields.reset();\r\n            // var compared = null;\r\n            angular.forEach(datas, function (row) {\r\n                var has = true;\r\n                angular.forEach(excludes, function (e) {\r\n                    if (e.active) {\r\n                        has = has && e.filter(row);\r\n                    }\r\n                });\r\n                angular.forEach(includes, function (i) {\r\n                    if (i.active) {\r\n                        has = has && i.filter(row);\r\n                    }\r\n                });\r\n                if (has) {\r\n                    fields.iterate(row, items);\r\n                }\r\n            });\r\n            if (compares) {\r\n                // compared = [];\r\n                angular.forEach(compares, function (row) {\r\n                    var has = true;\r\n                    angular.forEach(excludes, function (e) {\r\n                        if (e.active) {\r\n                            has = has && e.filter(row);\r\n                        }\r\n                    });\r\n                    angular.forEach(includes, function (i) {\r\n                        if (i.active) {\r\n                            has = has && i.filter(row);\r\n                        }\r\n                    });\r\n                    if (has) {\r\n                        // compared.push(row);\r\n                        fields.compare(row, items);\r\n                    }\r\n                });\r\n            }\r\n            this.toStatic();\r\n        },\r\n        setOrderBy: function () {\r\n            // var defaults = [];\r\n            // var orders = [];\r\n            var table = this;\r\n            var defaultsFiltered = [];\r\n            var ordersFiltered = [];\r\n            var sign;\r\n            angular.forEach(table.fields, function (field, index) {\r\n                if (field.col.active) {\r\n                    if (field.order.sort !== 0) {\r\n                        sign = (field.order.sort === -1 ? '-' : '');\r\n                        ordersFiltered.push(sign + 'cols[' + defaultsFiltered.length + '].getValue()');\r\n                        // orders.push(sign + field.raw);                        \r\n                    }\r\n                    defaultsFiltered.push('cols[' + defaultsFiltered.length + '].getValue()');\r\n                    // defaults.push(field.raw);\r\n                }\r\n            });\r\n            // defaults.length = Math.min(MAX_FIELDS_ORDERED, defaults.length);\r\n            defaultsFiltered.length = Math.min(MAX_FIELDS_ORDERED, defaultsFiltered.length);\r\n            // table.orderBy = orders.length ? orders : defaults; // null;\r\n            table.filteredOrderBy = ordersFiltered.length ? ordersFiltered : defaultsFiltered; // null;\r\n            // console.log('Table.sort', 'filteredOrderBy', table.filteredOrderBy);\r\n        },\r\n        exclude: function (item) {\r\n            item.active = !item.active;\r\n            this.update();\r\n        },\r\n        include: function (item) {\r\n            item.active = !item.active;\r\n            this.update();\r\n        },\r\n        has: function (mode) {\r\n            return (this.fields ? this.fields.show[mode] : null);\r\n        },\r\n        resetFilters: function () {\r\n            var table = this;\r\n            angular.forEach(table.fields, function (field, key) {\r\n                angular.forEach(table.defaults, function (item) {\r\n                    if (field.$id === item.$id) {\r\n                        angular.isFunction(field.active) ? null : field.active = item.active;\r\n                    }\r\n                });\r\n                field.filters.reset();\r\n            });\r\n            table.fields = table.fields.sort(function (a, b) {\r\n                return a.$id - b.$id;\r\n            });\r\n            // table.fields.radios.workloads = 'supplier.name'; //??? default radios ???\r\n            table.update();\r\n        },\r\n        doFilterStatic: function (cols) {\r\n            var table = this; \r\n            var fields = table.fields, cell;\r\n            return function (row) {\r\n                var has = true;\r\n                angular.forEach(table.cols, function (col, index) {\r\n                    cell = row.cols[index];\r\n                    cell.matches = null;\r\n                    has = has && col.filters.filter(cell);\r\n                });\r\n                // SPOSTARE RICERCA SEARCH OBJECT\r\n                if (has && table.search && table.search.length) {\r\n                    var match = false;\r\n                    angular.forEach(row.cols, function(cell) {\r\n                        cell.matches = new RegExp(table.search, 'gim').exec(cell.name);\r\n                        match = match || (cell.matches !== null);\r\n                    });\r\n                    has = has && match;\r\n                }\r\n                return has;\r\n            };\r\n        },\r\n        toggle: function (mode) {\r\n            var value = null;\r\n            if (this.fields) {\r\n                var show = this.fields.show;\r\n                show[mode] = !show[mode];\r\n                switch (mode) {\r\n                    case 'dynamic':\r\n                        show.compare = false;\r\n                        break;\r\n                    case 'compare':\r\n                        show.dynamic = false;\r\n                        break;\r\n                }\r\n                value = show[mode];\r\n            }\r\n            this.toStatic(); //!!! nuovo\r\n            return value;\r\n        },\r\n        toggleField: function (field) {\r\n            this.fields.toggleFields(field);\r\n            this.update();\r\n        },\r\n        toggleOrder: function (field) {\r\n            angular.forEach(this.fields, function (f) {\r\n                if (f.$id !== field.$id) {\r\n                    f.order.set(0);\r\n                }\r\n            });\r\n            field.order.toggle();\r\n            this.setOrderBy();\r\n        },\r\n        swap: function (from, to) {\r\n            // console.log('Table.swap', 'from', from, 'to', to);\r\n            angular.forEach(this.fields, function(field) {\r\n                if (field.$id === from.$id) {\r\n                    from = field;\r\n                }\r\n                if (field.$id === to.$id) {\r\n                    to = field;\r\n                }\r\n            });\r\n            // from = this.fields[this.fields.indexOf(from)];\r\n            // to = this.fields[this.fields.indexOf(to)];\r\n            var fi = this.fields.indexOf(from);\r\n            var field = this.fields[fi];\r\n            this.fields.splice(fi, 1);\r\n            var ti = this.fields.indexOf(to);\r\n            this.fields.splice(ti, 0, field);\r\n            // console.log('Table.swap', fi, ti, field);\r\n            this.update();\r\n        },\r\n        toStatic: function () {\r\n            var table = this;\r\n            var filtered = table.fields.toStatic(table.items);\r\n            table.rows = filtered.rows;\r\n            table.cols = filtered.cols;\r\n            table.setOrderBy();            \r\n            if (this.after && angular.isFunction(this.after)) {\r\n                this.after(items);\r\n            }\r\n        },\r\n        toJson: function (data) {\r\n            var table = this;\r\n            var json = {\r\n                name: 'Repotable',\r\n                description: 'a view of selected datas', // + $filter('date')(filters.dateFrom, 'dd MMM yyyy') + ' al ' + $filter('date')(filters.dateTo, 'dd MMM yyyy'),\r\n            };\r\n            data ? angular.extend(json, data) : null;\r\n            json.columns = [];\r\n            json.rows = [];\r\n            if (table.rows.length) {\r\n                var cols = table.cols;\r\n                var rows = table.rows;\r\n                angular.forEach(cols, function (col, index) {\r\n                    json.columns.push({\r\n                        index: index,\r\n                        name: col.colName,\r\n                        format: col.format,\r\n                    });\r\n                });\r\n                angular.forEach(rows, function (row, index) {\r\n                    var item = [];\r\n                    angular.forEach(cols, function (col, index) {\r\n                        var cell = row.cols[index];\r\n                        item[index] = cell.getValue();\r\n                        switch (col.type) {\r\n                            case fieldTypes.PERCENT:\r\n                            case fieldTypes.GAIN:\r\n                                item[index] /= 100;\r\n                                break;\r\n                        }\r\n                    });\r\n                    json.rows.push(item);\r\n                });\r\n                var item = [];\r\n                angular.forEach(cols, function (col, index) {\r\n                    if (col.aggregate) {\r\n                        item[index] = col.getTotalValue();\r\n                        switch (col.type) {\r\n                            case fieldTypes.PERCENT:\r\n                            case fieldTypes.GAIN:\r\n                                item[index] /= 100;\r\n                                break;\r\n                        }\r\n                    } else {\r\n                        item[index] = null;\r\n                    }\r\n                });\r\n                json.rows.push(item);\r\n            }\r\n            return json;\r\n        },\r\n    };\r\n    Table.fromDatas = function (datas) {\r\n        if (!angular.isArray(datas) || !datas.length > 1 || !angular.isObject(datas[0])) {\r\n            angular.forEach(datas, function (data) {\r\n                if (angular.isArray(data) && data.length && angular.isObject(data[0])) {\r\n                    datas = data;\r\n                }\r\n            });\r\n        }\r\n        if (!angular.isArray(datas)) {\r\n            datas = [datas];\r\n        }\r\n        var fields = Fields.fromDatas(datas);\r\n        var table = new Table(fields);\r\n        table.setDatas(datas);\r\n        return table;\r\n    };\r\n    return Table;\r\n}]);\r\n\r\n\r\n\r\n\r\n\r\nmodule.factory('Column__', ['$parse', '$filter', 'Utils', 'Filters', 'Order', 'colTypes', function ($parse, $filter, Utils, Filters, Order, colTypes) {\r\n    var totalTypes = {\r\n        SUM: 1,\r\n        MIN: 2,\r\n        MAX: 3,\r\n        AVG: 4,\r\n    }\r\n    function Column(data) {\r\n        this.filters = new Filters();\r\n        this.order = new Order();\r\n        this.typeTotal = this.typeTotal || totalTypes.SUM;\r\n        data ? angular.extend(this, data) : null;\r\n        // console.log('typeTotal', this.typeTotal);\r\n        // PREPARE GETTER SETTERS\r\n        if (angular.isFunction(this.value)) {\r\n            this.value = this.value.bind(this);\r\n        }\r\n        this.name = this.name || this.value;\r\n        this.raw = this.raw || this.value;\r\n        this.key = this.key || this.value;\r\n        this.source = this.source || this.value;\r\n        this.getters = {};\r\n        var fields = ['key', 'value', 'raw', 'source', 'post'];\r\n        angular.forEach(fields, function (field) {\r\n            if (this[field]) {\r\n                this.getters[field] = angular.isFunction(this[field]) ? this[field] : $parse(this[field]);\r\n            }\r\n        }, this);\r\n        this.setters = {};\r\n        angular.forEach(this.getters, function (getter, key) {\r\n            if (!angular.isFunction(this[key])) {\r\n                this.setters[key] = getter.assign;\r\n            }\r\n        }, this);\r\n        // PREPARE GETTER SETTERS\r\n        this.keys = {};\r\n        this.total = 0;\r\n    }\r\n    Column.prototype = {\r\n        reset: function () {\r\n            this.keys = {};\r\n            this.total = 0;\r\n            if (!this.isActive()) {\r\n                this.filters.reset();\r\n            }\r\n        },\r\n        addValue: function (item) {\r\n            var key = this.getters.key(item);\r\n            if (!this.filters.has(key)) {\r\n                var value = this.getters.raw(item);\r\n                var active = this.filters.flags[key];\r\n                this.filters.add({\r\n                    id: key,\r\n                    name: value || '-',\r\n                    active: active,\r\n                });\r\n            }\r\n        },\r\n        filter: function (item) {\r\n            if (this.isActive() && this.filters.search.length) {\r\n                return (this.filters.search.indexOf(item.static[this.id].key) !== -1);\r\n            } else {\r\n                return true;\r\n            }\r\n        },\r\n        getKey: function (item) {\r\n            return this.getters.key(item);\r\n        },\r\n        getValue: function (item) {\r\n            return this.getters.value(item);\r\n        },\r\n        getRaw: function (item) {\r\n            return this.getters.raw(item);\r\n        },\r\n        getSource: function (item) {\r\n            return this.getters.source(item);\r\n        },\r\n        hasKey: function (item) {\r\n            var has = true;\r\n            var key = this.getters.key(item);\r\n            if (key && this.keys[key] != true) {\r\n                this.keys[key] = true;\r\n                has = false;\r\n            }\r\n            return has;\r\n        },\r\n        initValue: function (item) {\r\n            this.setters.raw(item, (this.getters.value(item) || 0));\r\n            return this;\r\n        },\r\n        aggregation: function (item, row) {\r\n            var a = (this.getters.raw(item) || 0);\r\n            var b = (this.getters.value(row) || 0);\r\n            var col = this;\r\n            switch (col.typeTotal) {\r\n                case totalTypes.MIN:\r\n                    col.setters.raw(item, Math.min(a, b));\r\n                    break;\r\n                case totalTypes.MAX:\r\n                    col.setters.raw(item, Math.max(a, b));\r\n                    break;\r\n                case totalTypes.AVG:\r\n                    var n = 0;\r\n                    col.setters.raw(item, (b + (a * n)) / (n + 1)); // (newVal + (avg * n)) / (n+1)\r\n                    break;\r\n                default:\r\n                    col.setters.raw(item, a + b);\r\n            }\r\n            return col;\r\n        },\r\n        addCount: function (item, row) {\r\n            if (!this.hasKey(row) && this.setters.raw) {\r\n                var v = null;\r\n                if (item != row) {\r\n                    v = (this.getters.raw(item) || 0) + 1;\r\n                } else {\r\n                    v = 1;\r\n                }\r\n                this.setters.raw(item, v);\r\n            }\r\n            return this;\r\n        },\r\n        getFormatted: function (item) {\r\n            if (this.dynamic) {\r\n                return this.formatValue(this.getters.raw(item));\r\n            } else {\r\n                return item.static[this.id].name;\r\n            }\r\n        },\r\n        getFormat: function () {\r\n            var format = '';\r\n            switch (this.type) {\r\n                case colTypes.ID:\r\n                case colTypes.NUMBER:\r\n                    format = '#';\r\n                    break;\r\n                case colTypes.DOUBLE:\r\n                    format = '#';\r\n                    break;\r\n                case colTypes.DATE:\r\n                    format = 'yyyy-mm-dd';\r\n                    break;\r\n                case colTypes.WEEKS:\r\n                    format = '#,###0 [$W]';\r\n                    break;\r\n                case colTypes.HOURS:\r\n                    format = '#,###0 [$H]';\r\n                    break;\r\n                case colTypes.COSTS:\r\n                    format = '#,###.00 ';\r\n                    break;\r\n                case colTypes.PERCENT:\r\n                    format = '0.00%';\r\n                    break;\r\n                case colTypes.GAIN:\r\n                    format = '[Color 10]+0.00%;[Red]-0.00%;-';\r\n                    break;\r\n            }\r\n            return format;\r\n        },\r\n        getLink: function (item) {\r\n            return angular.isFunction(this.link) ? this.link(item) : null;\r\n        },\r\n        getHeaderClass: function () {\r\n            var cc = [];\r\n            angular.forEach(this, function (value, key) {\r\n                if (value === true) {\r\n                    cc.push(key);\r\n                }\r\n            });\r\n            switch (this.type) {\r\n                case colTypes.NUMBER:\r\n                case colTypes.DOUBLE:\r\n                case colTypes.WEEKS:\r\n                case colTypes.HOURS:\r\n                case colTypes.COSTS:\r\n                case colTypes.PERCENT:\r\n                case colTypes.GAIN:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n            }\r\n            /*\r\n            var columnClass = this.getColumnClass();\r\n            if (columnClass != '') {\r\n                cc.push(columnClass);\r\n            }\r\n            */\r\n            return cc.join(' ');\r\n        },\r\n        getCellClass: function (item) {\r\n            var cc = [];\r\n            angular.forEach(this, function (value, key) {\r\n                if (value === true) {\r\n                    cc.push(key);\r\n                }\r\n            });\r\n            switch (this.type) {\r\n                case colTypes.LINK:\r\n                    cc.push('text-underline');\r\n                    break;\r\n                case colTypes.NUMBER:\r\n                case colTypes.DOUBLE:\r\n                case colTypes.WEEKS:\r\n                case colTypes.HOURS:\r\n                case colTypes.COSTS:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n                case colTypes.PERCENT:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n                case colTypes.GAIN:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getColumnClass: function () {\r\n            return this.color ? 'shade-light-blue-' + this.color : '';\r\n        },\r\n        getItemClass: function (item) {\r\n            var cc = [];\r\n            cc.push(item.static[this.id].cellClass);\r\n            var columnClass = this.getColumnClass();\r\n            if (columnClass != '') {\r\n                cc.push(columnClass);\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getTextClass: function (item) {\r\n            var cc = [];\r\n            switch (this.type) {\r\n                case colTypes.GAIN:\r\n                    var value = this.getters.raw(item);\r\n                    if (angular.isNumber(value) && value < 0) {\r\n                        cc.push('text-danger');\r\n                    } else {\r\n                        cc.push('text-success');\r\n                    }\r\n                    break;\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        isActive: function () {\r\n            if (angular.isFunction(this.active) && this.active) {\r\n                return this.active();\r\n            } else {\r\n                return this.active;\r\n            }\r\n        },\r\n        toggle: function () {\r\n            angular.isFunction(this.active) ? null : this.active = !this.active;\r\n        },\r\n        activate: function () {\r\n            angular.isFunction(this.active) ? null : this.active = true;\r\n        },\r\n        deactivate: function () {\r\n            angular.isFunction(this.active) ? null : this.active = false;\r\n        },\r\n        formatValue: function (value) {\r\n            switch (this.type) {\r\n                case colTypes.RESOURCE:\r\n                case colTypes.DISABLED:\r\n                    value = $filter('shortName')(value);\r\n                    break;\r\n                case colTypes.ID:\r\n                case colTypes.NUMBER:\r\n                    value = $filter('customNumber')(value, 0);\r\n                    break;\r\n                case colTypes.DOUBLE:\r\n                    value = $filter('customNumber')(value, 2);\r\n                    break;\r\n                case colTypes.WEEKS:\r\n                    value = $filter('customNumber')(value, 2, ' W');\r\n                    break;\r\n                case colTypes.DATE:\r\n                    value = $filter('date')(value, 'yyyy-MM-dd');\r\n                    break;\r\n                case colTypes.HOURS:\r\n                    value = $filter('customNumber')(value, 0, ' H');\r\n                    break;\r\n                case colTypes.COSTS:\r\n                    value = $filter('customNumber')(value, 0, ' ');\r\n                    break;\r\n                case colTypes.PERCENT:\r\n                    value = $filter('customNumber')(value, 2, ' %');\r\n                    break;\r\n                case colTypes.GAIN:\r\n                    value = angular.isNumber(value) ? (value > 0 ? '+' : '') + $filter('customNumber')(value, 2, ' %') : (value || '-');\r\n                    break;\r\n            }\r\n            return value;\r\n        },\r\n        getTotal: function (filtered) {\r\n            var value = this.getValueTotal(filtered);\r\n            return this.formatValue(value);\r\n        },\r\n        getValueTotal: function (filtered) {\r\n            var value = 0, col = this;\r\n            if (col.compare && col.type === colTypes.GAIN) {\r\n                var current = 0; // (col.getters.raw(item) || 0);\r\n                var previous = 0; // (this.getters.raw(item) || 0);                \r\n                angular.forEach(filtered, function (item) {\r\n                    current += (col.$col.getters.raw(item) || 0);\r\n                    previous += (col.getters.raw(item) || 0);\r\n                }.bind(this));\r\n                if (previous) {\r\n                    value = (current - previous) / previous * 100;\r\n                }\r\n            } else {\r\n                switch (col.typeTotal) {\r\n                    case totalTypes.SUM:\r\n                        value = 0;\r\n                        break;\r\n                    case totalTypes.MIN:\r\n                        value = Number.POSITIVE_INFINITY;\r\n                        break;\r\n                    case totalTypes.MAX:\r\n                        value = Number.NEGATIVE_INFINITY;\r\n                        break;\r\n                    case totalTypes.AVG:\r\n                        break;\r\n                }\r\n                angular.forEach(filtered, function (item, i) {\r\n                    var a = value;\r\n                    var b = (col.getters.raw(item) || 0);\r\n                    switch (col.typeTotal) {\r\n                        case totalTypes.SUM:\r\n                            value = a + b;\r\n                            break;\r\n                        case totalTypes.MIN:\r\n                            value = a < b ? a : b;\r\n                            break;\r\n                        case totalTypes.MAX:\r\n                            value = a > b ? a : b;\r\n                            break;\r\n                        case totalTypes.AVG:\r\n                            value = (b + (a * i)) / (i + 1);\r\n                            break;\r\n                    }\r\n                });\r\n                (value === Number.POSITIVE_INFINITY || value === Number.NEGATIVE_INFINITY) ? value = 0 : null;\r\n            }\r\n            col.total = value;\r\n            return value;\r\n        },\r\n        getTotalClass: function (filtered) {\r\n            var cc = [];\r\n            switch (this.type) {\r\n                case colTypes.NUMBER:\r\n                case colTypes.DOUBLE:\r\n                case colTypes.WEEKS:\r\n                case colTypes.HOURS:\r\n                case colTypes.COSTS:\r\n                case colTypes.PERCENT:\r\n                case colTypes.GAIN:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getCellTotal: function (rows, index) {\r\n            var value = 0, col = this, cell;\r\n            if (col.compare && col.type === colTypes.GAIN) {\r\n                var current = 0;\r\n                var previous = 0;         \r\n                angular.forEach(rows, function (row) {\r\n                    cell = row.cols[index];\r\n                    current += (col.$col.getters.raw(item) || 0);\r\n                    previous += (cell.getValue() || 0);\r\n                });\r\n                if (previous) {\r\n                    value = (current - previous) / previous * 100;\r\n                }\r\n            } else {\r\n                switch (col.typeTotal) {\r\n                    case totalTypes.SUM:\r\n                        value = 0;\r\n                        break;\r\n                    case totalTypes.MIN:\r\n                        value = Number.POSITIVE_INFINITY;\r\n                        break;\r\n                    case totalTypes.MAX:\r\n                        value = Number.NEGATIVE_INFINITY;\r\n                        break;\r\n                    case totalTypes.AVG:\r\n                        break;\r\n                }\r\n                angular.forEach(rows, function (row, i) {\r\n                    cell = row.cols[index];\r\n                    var a = value;\r\n                    var b = (cell.getValue() || 0);                    \r\n                    switch (col.typeTotal) {\r\n                        case totalTypes.SUM:\r\n                            value = a + b;\r\n                            break;\r\n                        case totalTypes.MIN:\r\n                            value = a < b ? a : b;\r\n                            break;\r\n                        case totalTypes.MAX:\r\n                            value = a > b ? a : b;\r\n                            break;\r\n                        case totalTypes.AVG:\r\n                            value = (b + (a * i)) / (i + 1);\r\n                            break;\r\n                    }\r\n                });\r\n                (value === Number.POSITIVE_INFINITY || value === Number.NEGATIVE_INFINITY) ? value = 0 : null;\r\n            }\r\n            col.total = value;\r\n            return value;\r\n        },\r\n        toStatic: function (item) {\r\n            if (this.post) {\r\n                this.setters.raw(item, (this.getters.post(item) || 0));\r\n            }\r\n            var col = this;\r\n            var cell = item.static[col.id] = {\r\n                cellClass: col.getCellClass(item),\r\n                textClass: col.getTextClass(item),\r\n                link: col.link ? col.link(item) : null,\r\n                pop: col.pop ? col.pop(item) : null,\r\n                key: col.getters.key(item),\r\n                getValue: function () {\r\n                    if (col.dynamic) {\r\n                        return col.getters.value(item);\r\n                    } else if (cell.value) {\r\n                        return cell.value;\r\n                    } else {\r\n                        return col.getters.raw(item);\r\n                    }\r\n                },\r\n                getName: function () {\r\n                    if (col.dynamic) {\r\n                        return col.formatValue(cell.getValue());\r\n                    } else if (cell.name) {\r\n                        return cell.name;\r\n                    } else {\r\n                        return col.formatValue(cell.getValue());\r\n                    }\r\n                },\r\n                getTotalValue: function (rows, index) {\r\n                    return col.getCellTotal(rows, index);\r\n                },\r\n                getTotalName: function (rows, index) {\r\n                    var value = cell.getTotalValue(rows, index);\r\n                    return col.formatValue(value);\r\n                },\r\n                formatValue: function (value) {\r\n                    return col.formatValue(value);\r\n                },\r\n            };\r\n            cell.value = cell.getValue();\r\n            cell.name = cell.getName();\r\n            return cell;\r\n        },\r\n    };\r\n    Column.types = colTypes;\r\n    return Column;\r\n}]);\r\n\r\nmodule.factory('Columns__', ['$parse', 'Utils', 'Column', 'colTypes', function ($parse, Utils, Column, colTypes) {\r\n    function Columns(columns) {\r\n        var array = [];\r\n        if (columns) {\r\n            angular.forEach(columns, function (col, index) {\r\n                col.id = index + 1;\r\n                array.push(new Column(col));\r\n            });\r\n        }\r\n        angular.extend(array, Columns.prototype);\r\n        return array;\r\n    }\r\n    Columns.prototype = {\r\n        // EXPANSION\r\n        expand: function (data) {\r\n            var options = {\r\n                dynamic: true,\r\n                compare: false,\r\n            }\r\n            data ? angular.extend(options, data) : null;\r\n            // add percentuals and compares\r\n            var array = [],\r\n                cols = this;\r\n            array.radios = {};\r\n            angular.forEach(this, function (col, index) {\r\n                col.id = array.length + 1;\r\n                array.push(col);\r\n                if (col.aggregate && col.value === col.raw) {\r\n                    if (options.dynamic) {\r\n                        array.push(new Column({\r\n                            id: array.length + 1,\r\n                            name: '%',\r\n                            value: function (item) {\r\n                                return col.getters.raw(item) / col.total * 100;\r\n                            },\r\n                            key: col.key,\r\n                            type: colTypes.PERCENT,\r\n                            dynamic: true,\r\n                            active: function () {\r\n                                return array.show.dynamic && col.active;\r\n                            },\r\n                            $col: col,\r\n                        }));\r\n                    }\r\n                    if (options.compare) {\r\n                        array.push(new Column({\r\n                            id: array.length + 1,\r\n                            name: 'anno precedente',\r\n                            value: function (item) {\r\n                                return this.getters.raw(item);\r\n                            },\r\n                            raw: col.value + 'Last',\r\n                            source: col.value,\r\n                            key: col.key,\r\n                            type: col.type, // \r\n                            count: col.count,\r\n                            compare: true,\r\n                            dynamic: true,\r\n                            active: function () {\r\n                                return array.show.compare && col.active;\r\n                            },\r\n                            $col: col,\r\n                        }));\r\n                        array.push(new Column({\r\n                            id: array.length + 1,\r\n                            name: '%',\r\n                            value: function (item) {\r\n                                var current = (col.getters.raw(item) || 0);\r\n                                var previous = (this.getters.raw(item) || 0);\r\n                                if (previous) {\r\n                                    return (current - previous) / previous * 100;\r\n                                } else {\r\n                                    return null; // '+ %';\r\n                                }\r\n                            },\r\n                            raw: col.value + 'Gain',\r\n                            source: col.value,\r\n                            key: col.key,\r\n                            type: colTypes.GAIN, // col.type, // \r\n                            count: col.count,\r\n                            compare: true,\r\n                            dynamic: true,\r\n                            active: function () {\r\n                                return array.show.compare && col.active;\r\n                            },\r\n                            $col: col,\r\n                        }));\r\n                    }\r\n                }\r\n                if (col.radio && col.active) {\r\n                    array.radios[col.radio] = col.value;\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        // AGGREGATE, GROUPBY & COMPARE\r\n        reset: function () {\r\n            this.groups = {};\r\n            angular.forEach(this, function (col) {\r\n                col.reset();\r\n            });\r\n            return this;\r\n        },\r\n        unique: function (row, items) {\r\n            var key = this.getGroupKey(row);\r\n            var item = this.groups[key];\r\n            if (!item) {\r\n                item = this.groups[key] = row; // angular.copy(row);\r\n                item.static = [];\r\n                items.push(item);\r\n            }\r\n            return item;\r\n        },\r\n        iterate: function (row, items) {\r\n            row = angular.copy(row);\r\n            var item = this.unique(row, items);\r\n            this.aggregation(item, row);\r\n        },\r\n        compare: function (row, items) {\r\n            row = angular.copy(row);\r\n            angular.forEach(this, function (col) {\r\n                if (col.compare) {\r\n                    var value = col.getters.source(row);\r\n                    col.setters.raw(row, value);\r\n                    col.setters.source(row, 0); // !!! _1_\r\n                }\r\n            });\r\n            /*\r\n            // !!! _1_\r\n            angular.forEach(this, function (col) {\r\n                if (col.compare) {\r\n                    col.setters.source(row, 0);\r\n                }\r\n            });\r\n            */\r\n            var item = this.unique(row, items);\r\n            this.aggregation(item, row, true);\r\n        },\r\n        aggregation: function (item, row, comparing) {\r\n            angular.forEach(this, function (col) {\r\n                if ((col.isActive() || col.always) && (comparing ? col.compare : !col.compare)) {\r\n                    if (col.count) {\r\n                        col.addCount(item, row);\r\n                    } else if (comparing || col.aggregate) {\r\n                        if (!col.hasKey(row)) {\r\n                            if (item === row) {\r\n                                col.initValue(item);\r\n                            } else {\r\n                                col.aggregation(item, row);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            return this;\r\n        },\r\n        // AGGREGATE, GROUPBY & COMPARE\r\n        getCount: function () {\r\n            var i = 0;\r\n            angular.forEach(this, function (col) {\r\n                i += col.isActive() ? 1 : 0;\r\n            }.bind(this));\r\n            return i;\r\n        },\r\n        getFirstCol: function () {\r\n            var first = null;\r\n            angular.forEach(this, function (col) {\r\n                if (first === null && col.isActive() && col.groupBy && col.value !== 'month' && col.value !== 'monthShort') {\r\n                    first = col;\r\n                }\r\n            });\r\n            return first;\r\n        },\r\n        getGroupKey: function (item) {\r\n            var keys = [];\r\n            angular.forEach(this, function (col) {\r\n                if (col.isActive() && col.groupBy) {\r\n                    keys.push(col.getters.key(item));\r\n                }\r\n            });\r\n            return keys.join('-');\r\n        },\r\n        getGroups: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.groupBy) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getAggregates: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.aggregate && !col.count) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getPercentages: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.type === colTypes.PERCENT) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getDynamics: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.dynamic) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getCompares: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.compare) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getCounters: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.count) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },        \r\n        activeInRange: function (range) {\r\n            var flag = false;\r\n            var i = 0;\r\n            while (!flag && i < this.length) {\r\n                var col = this[i];\r\n                if (col.static.active) {\r\n                    flag = (range.indexOf(col.value) !== -1);\r\n                }\r\n                i++;\r\n            }\r\n            return flag;\r\n        },        \r\n        toggleColumns: function (c) {\r\n            if (c.radio) {\r\n                angular.forEach(this, function (col) {\r\n                    if (c.radio === col.radio && c !== col) {\r\n                        col.deactivate();\r\n                    }\r\n                });\r\n                c.activate();\r\n                this.radios[c.radio] = c.value;\r\n            } else {\r\n                c.toggle();\r\n            }\r\n        },\r\n        show: {\r\n            table: true, // defaults\r\n        },\r\n        // ELIMINARE\r\n        /*\r\n        isFilterDisabled: function (item, col, filtered) { // check if other values are disabled !! unused\r\n            var id = item.id,\r\n                t = this;\r\n            var has = false,\r\n                index = 0;\r\n            while (index < filtered.length) {\r\n                has = has || col.getters.key(filtered[index]) === id;\r\n                if (has) {\r\n                    index = filtered.length;\r\n                } else {\r\n                    index++;\r\n                }\r\n            }\r\n            return !has;\r\n        },\r\n        getSortKey: function (item) {\r\n            var values = [];\r\n            angular.forEach(this, function (col) {\r\n                if (col.isActive() && col.groupBy) {\r\n                    values.push(col.sort ? $parse(col.sort)(item) : col.formatValue(col.getters.raw(item)));\r\n                }\r\n            });\r\n            return values.join('');\r\n        },\r\n        */\r\n        toStatic: function (items) {\r\n            var cols = [],\r\n                rows = [],\r\n                cell;\r\n            //console.log('Columns.rows', 'rows', rows.length);\r\n            angular.forEach(this, function (col) {\r\n                col.filters.removeAll();\r\n                col.static = {\r\n                    active: col.isActive(),\r\n                    headerClass: col.getHeaderClass(),\r\n                    columnClass: col.getColumnClass(),\r\n                    totalClass: col.getTotalClass(),\r\n                    format: col.getFormat(),\r\n\r\n                    id: col.id,\r\n                    colName: col.name,\r\n                    type: col.type,\r\n                    groupBy: col.groupBy,\r\n                    aggregate: col.aggregate,\r\n                    compare: col.compare,\r\n                    filters: col.filters,\r\n                    order: col.order,\r\n                };\r\n                if (col.static.active) {\r\n                    col.static.index = cols.length;\r\n                    cols.push(col.static);\r\n                }\r\n            });\r\n            // lasciare serve un secondo ciclo!\r\n            angular.forEach(this, function (col) {\r\n                if (col.static.active || col.dynamic || col.always) {\r\n                    angular.forEach(items, function (item, i) {\r\n                        var cell = col.toStatic(item);\r\n                        if (col.hasSearch && col.groupBy) {\r\n                            col.addValue(item);\r\n                        }\r\n                        var row = rows[i] = (rows[i] || { cols: [] });\r\n                        cell = angular.extend(angular.copy(cell), col.static);\r\n                        row.cols[col.static.index] = cell;\r\n                    });\r\n                    if (col.hasSearch && col.groupBy) {\r\n                        col.filters.sort();\r\n                    }\r\n                }\r\n            });\r\n            // lasciare serve un terzo ciclo!\r\n            angular.forEach(cols, function (col, index) {\r\n                var last = rows[rows.length - 1].cols[index];\r\n                col.$last = last;\r\n                col.getTotalValue = function (rows) {\r\n                    return last.getTotalValue(rows, index);\r\n                };\r\n                col.getTotalName = function (rows) {\r\n                    return last.getTotalName(rows, index);\r\n                };\r\n            });\r\n            // console.log('Table.toStatic', rows.length);\r\n            return { cols: cols, rows: rows };\r\n        },\r\n    };\r\n    Columns.fromDatas = function (datas) {\r\n        return Columns.parseCols(datas);\r\n    }\r\n    Columns.parseCols = function getColumns(datas) {\r\n        var cols = null;\r\n        if (datas && datas.length) {\r\n            cols = [];\r\n            function parse(item, prop) {\r\n                if (angular.isArray(item)) {\r\n                    angular.forEach(item, function (value, key) {\r\n                        parse(value, (prop || '') + '[' + key + ']');\r\n                    });\r\n                } else if (angular.isObject(item)) {\r\n                    angular.forEach(item, function (value, key) {\r\n                        parse(value, (prop ? prop + '.' : '') + key);\r\n                    });\r\n                } else {\r\n                    var col = {\r\n                        value: prop,\r\n                        type: colTypes.TEXT,\r\n                        active: cols.length < 6,\r\n                    };\r\n                    if (angular.isDate(item) || (angular.isNumber(item) && \r\n                        (prop.toLowerCase().indexOf('date') !== -1 || prop.toLowerCase().indexOf('time') !== -1)\r\n                        )) {\r\n                        col.type = colTypes.DATE;\r\n                        col.groupBy = true;\r\n                        col.hasSearch = true;\r\n                    } else if (angular.isNumber(item)) {\r\n                        col.type = colTypes.NUMBER;\r\n                        col.aggregate = true;\r\n                        col.color = 1;\r\n                    } else {\r\n                        col.groupBy = true;\r\n                        col.hasSearch = true;\r\n                    }\r\n                    cols.push(col);\r\n                }\r\n            }\r\n            parse(datas[0]);\r\n        }\r\n        return cols;\r\n    };\r\n    Columns.types = colTypes;\r\n    return Columns;\r\n}]);\r\n\r\nmodule.factory('Table__', ['$parse', 'Columns', 'colTypes', 'orderByFilter', function ($parse, Columns, colTypes, orderByFilter) {\r\n    var MAX_COLS_ORDERED = 4;\r\n    function Table(cols, options) {\r\n        this.cols = new Columns(cols).expand(options);\r\n        this.defaults = cols.map(function (col) {\r\n            return {\r\n                id: col.id,\r\n                active: col.active,\r\n            };\r\n        });\r\n        this.colGroups = [{\r\n            name: 'GroupBy',\r\n            items: this.cols.getGroups()\r\n        }, ];\r\n        this.valGroups = [{\r\n            name: 'Aggregate',\r\n            items: this.cols.getAggregates()\r\n        }, ];\r\n        this.excludes = [];\r\n        this.includes = [];\r\n        this.setOptions(options);        \r\n    }\r\n    Table.prototype = {\r\n        setDatas: function (datas, compares) {\r\n            if (datas) {\r\n                angular.forEach(datas, function (item, index) {\r\n                    item.$id = index + 1;\r\n                });\r\n            }\r\n            this.datas = datas;\r\n            if (compares) {\r\n                angular.forEach(compares, function (item, index) {\r\n                    item.$id = index + 1;\r\n                });\r\n            }\r\n            this.compares = compares;\r\n            this.update();\r\n        },\r\n        setOptions: function (options) {\r\n            var table = this;\r\n            this.options = [{\r\n                name: 'Columns',\r\n                template: 'partials/report/filters/columns',\r\n                icon: 'icon-columns',\r\n                groups: this.colGroups,\r\n                toggle: function(item) {\r\n                    return table.toggleCol(item);\r\n                },\r\n                active: true,\r\n            }, {\r\n                name: 'Values',\r\n                template: 'partials/report/filters/values',\r\n                icon: 'icon-values',\r\n                groups: this.valGroups,\r\n                toggle: function(item) {\r\n                    return table.toggleCol(item);\r\n                },\r\n            }, {\r\n                name: 'Options',\r\n                template: 'partials/report/filters/flags',\r\n                icon: 'icon-options',\r\n                rows: [{\r\n                    name: 'Exclude',\r\n                    items: this.exclude,\r\n                    toggle: function (item) {\r\n                        return table.exclude(item); \r\n                    },\r\n                }, {\r\n                    name: 'Include',\r\n                    items: this.includes,\r\n                    toggle: function (item) {\r\n                        return table.include(item); \r\n                    },\r\n                }, {\r\n                    name: 'Flags',\r\n                    items: [{\r\n                        name: 'Percentuali di incidenza',\r\n                        key: 'dynamic',\r\n                    }],\r\n                    toggle: function (item) {\r\n                        return table.toggle(item.key);\r\n                    }\r\n                }],\r\n            },];\r\n        },\r\n        update: function () {\r\n            this.rows = [];\r\n            var datas = this.datas;\r\n            var rows = this.rows;\r\n            var cols = this.cols;\r\n            var excludes = this.excludes;\r\n            var includes = this.includes;\r\n            var compares = this.compares;\r\n            cols.reset();\r\n            // var compared = null;\r\n            angular.forEach(datas, function (row) {\r\n                var has = true;\r\n                angular.forEach(excludes, function (item) {\r\n                    if (item.active) {\r\n                        has = has && item.filter(row);\r\n                    }\r\n                });\r\n                angular.forEach(includes, function (item) {\r\n                    if (item.active) {\r\n                        has = has && item.filter(row);\r\n                    }\r\n                });\r\n                if (has) {\r\n                    cols.iterate(row, rows);\r\n                }\r\n            });\r\n            if (compares) {\r\n                // compared = [];\r\n                angular.forEach(compares, function (row) {\r\n                    var has = true;\r\n                    angular.forEach(excludes, function (item) {\r\n                        if (item.active) {\r\n                            has = has && item.filter(row);\r\n                        }\r\n                    });\r\n                    angular.forEach(includes, function (item) {\r\n                        if (item.active) {\r\n                            has = has && item.filter(row);\r\n                        }\r\n                    });\r\n                    if (has) {\r\n                        // compared.push(row);\r\n                        cols.compare(row, rows);\r\n                    }\r\n                });\r\n            }\r\n            this.toStatic();\r\n            if (this.after && angular.isFunction(this.after)) {\r\n                this.after(rows);\r\n            }\r\n        },\r\n        setOrderBy: function () {\r\n            var defaults = [];\r\n            var orders = [];\r\n            var defaultsFiltered = [];\r\n            var ordersFiltered = [];\r\n            var sign;\r\n            angular.forEach(this.cols, function (col, index) {\r\n                if (col.static.active) {\r\n                    if (col.order.sort !== 0) {\r\n                        sign = (col.order.sort === -1 ? '-' : '');\r\n                        ordersFiltered.push(sign + 'cols[' + defaults.length + '].getValue()');\r\n                        orders.push(sign + col.raw);                        \r\n                    }\r\n                    defaultsFiltered.push('cols[' + defaults.length + '].getValue()');\r\n                    defaults.push(col.raw);\r\n                }\r\n            });\r\n            defaults.length = Math.min(MAX_COLS_ORDERED, defaults.length);\r\n            defaultsFiltered.length = Math.min(3, defaultsFiltered.length);\r\n            this.orderBy = orders.length ? orders : defaults; // null;\r\n            this.filteredOrderBy = ordersFiltered.length ? ordersFiltered : defaultsFiltered; // null;\r\n            // this.filtered = orderByFilter(this.filtered, this.orderBy);\r\n            // console.log('Table.sort', 'filteredOrderBy', this.filteredOrderBy);\r\n        },\r\n        exclude: function (item) {\r\n            item.active = !item.active;\r\n            this.update();\r\n        },\r\n        include: function (item) {\r\n            item.active = !item.active;\r\n            this.update();\r\n        },\r\n        has: function (mode) {\r\n            return (this.cols ? this.cols.show[mode] : null);\r\n        },\r\n        resetFilters: function () {\r\n            var table = this;\r\n            angular.forEach(table.cols, function (col, key) {\r\n                angular.forEach(table.defaults, function (item) {\r\n                    if (col.id === item.id) {\r\n                        angular.isFunction(col.active) ? null : col.active = item.active;\r\n                    }\r\n                });\r\n                col.filters.reset();\r\n            });\r\n            table.cols = table.cols.sort(function (a, b) {\r\n                return a.id - b.id;\r\n            });\r\n            // table.cols.radios.workloads = 'supplier.name'; //??? default radios ???\r\n            table.update();\r\n        },\r\n        doFilterStatic: function (cols) {\r\n            var table = this; \r\n            var cols = table.cols, cell;\r\n            return function (row) {\r\n                var has = true;\r\n                angular.forEach(table.filtered.cols, function (col, index) {\r\n                    cell = row.cols[index];\r\n                    cell.matches = null;\r\n                    has = has && col.filters.filter(cell);\r\n                });\r\n                if (has && table.search && table.search.length) {\r\n                    var match = false;\r\n                    angular.forEach(row.cols, function(cell) {\r\n                        cell.matches = new RegExp(table.search, 'gim').exec(cell.name);\r\n                        match = match || (cell.matches !== null);\r\n                    });\r\n                    has = has && match;\r\n                }\r\n                return has;\r\n            };\r\n        },\r\n        toggle: function (mode) {\r\n            var value = null;\r\n            if (this.cols) {\r\n                var show = this.cols.show;\r\n                show[mode] = !show[mode];\r\n                switch (mode) {\r\n                    case 'dynamic':\r\n                        show.compare = false;\r\n                        break;\r\n                    case 'compare':\r\n                        show.dynamic = false;\r\n                        break;\r\n                }\r\n                value = show[mode];\r\n            }\r\n            this.toStatic(); //!!! nuovo\r\n            return value;\r\n        },\r\n        toggleCol: function (col) {\r\n            this.cols.toggleColumns(col);\r\n            this.update();\r\n        },\r\n        toggleOrder: function (col) {\r\n            angular.forEach(this.cols, function (item) {\r\n                if (item.id !== col.id) {\r\n                    item.order.set(0);\r\n                }\r\n            });\r\n            col.order.toggle();\r\n            this.setOrderBy();\r\n        },\r\n        swap: function (from, to) {\r\n            // console.log('Table.swap', 'from', from, 'to', to);\r\n            from = this.cols[this.filtered.cols.indexOf(from)];\r\n            to = this.cols[this.filtered.cols.indexOf(to)];\r\n            var index = this.cols.indexOf(from);\r\n            var item = this.cols[index];\r\n            this.cols.splice(index, 1);\r\n            index = this.cols.indexOf(to);\r\n            this.cols.splice(index, 0, item);\r\n            this.update();\r\n        },\r\n        // ELIMINARE\r\n        /*\r\n        doFilterColumns: function (cols) {\r\n            return function (col) {\r\n                return col.isActive(); // col.dynamic ? (cols.show.dynamic && col.active()) : col.active;\r\n            };\r\n        },\r\n        doFilterMultiple: function (cols) {\r\n            // table.update(); // doing regroup\r\n            return function (item) {\r\n                var has = true;\r\n                angular.forEach(cols, function (col) {\r\n                    has = has && col.filter(item);\r\n                });\r\n                return has;\r\n            };\r\n        },\r\n        doFilter: function (cols) {\r\n            // this.update(); // doing regroup\r\n            return function (item) {\r\n                var has = true;\r\n                angular.forEach(cols, function (col) {\r\n                    if (col.isActive() && col.filters && col.filters.id !== 0) {\r\n                        has = has && col.getters.key(item) === col.filters.id;\r\n                    }\r\n                }.bind(this));\r\n                return has;\r\n            };\r\n        },\r\n        getRowClass: function (item) {\r\n            return ''; // item.status ? 'status-' + Appearance.negotiationClass(item.status.id) : '';\r\n        },\r\n        onOpen: function (item) {\r\n            console.log('onOpen', item);\r\n        },\r\n        */\r\n        toStatic: function () {\r\n            this.filtered = this.cols.toStatic(this.rows);\r\n            // this.filtered = this.rows.slice();\r\n            this.setOrderBy();\r\n        },\r\n        toJson: function (data) {\r\n            var json = {\r\n                name: 'Repotable',\r\n                description: 'a view of selected datas', // + $filter('date')(filters.dateFrom, 'dd MMM yyyy') + ' al ' + $filter('date')(filters.dateTo, 'dd MMM yyyy'),\r\n            };\r\n            data ? angular.extend(json, data) : null;\r\n            json.columns = [];\r\n            json.rows = [];\r\n            if (this.filtered && this.filtered.rows.length) {\r\n                var cols = this.filtered.cols;\r\n                var rows = this.filtered.rows;\r\n                angular.forEach(cols, function (col, index) {\r\n                    json.columns.push({\r\n                        index: index,\r\n                        name: col.colName,\r\n                        format: col.format,\r\n                    });\r\n                });\r\n                angular.forEach(rows, function (row, index) {\r\n                    var item = [];\r\n                    angular.forEach(cols, function (col, index) {\r\n                        var cell = row.cols[index];\r\n                        item[index] = cell.getValue();\r\n                        switch (col.type) {\r\n                            case colTypes.PERCENT:\r\n                            case colTypes.GAIN:\r\n                                item[index] /= 100;\r\n                                break;\r\n                        }\r\n                    });\r\n                    json.rows.push(item);\r\n                });\r\n                var item = [];\r\n                angular.forEach(cols, function (col, index) {\r\n                    if (col.aggregate) {\r\n                        item[index] = col.getTotalValue();\r\n                        switch (col.type) {\r\n                            case colTypes.PERCENT:\r\n                            case colTypes.GAIN:\r\n                                item[index] /= 100;\r\n                                break;\r\n                        }\r\n                    } else {\r\n                        item[index] = null;\r\n                    }\r\n                });\r\n                json.rows.push(item);\r\n            }\r\n            return json;\r\n        },\r\n    };\r\n    Table.fromDatas = function (datas) {\r\n        if (!angular.isArray(datas) || !datas.length > 1 || !angular.isObject(datas[0])) {\r\n            angular.forEach(datas, function (data) {\r\n                if (angular.isArray(data) && data.length && angular.isObject(data[0])) {\r\n                    datas = data;\r\n                }\r\n            });\r\n        }\r\n        if (!angular.isArray(datas)) {\r\n            datas = [datas];\r\n        }\r\n        var cols = Columns.fromDatas(datas);\r\n        var table = new Table(cols);\r\n        table.setDatas(datas);\r\n        return table;\r\n    };\r\n    return Table;\r\n}]);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.service('Droppables', ['ElementRect', function(ElementRect) {\r\n    this.natives = [];\r\n    this.callbacks = [];\r\n    this.rects = [];\r\n    this.add = function(nativeElement, callback) {\r\n        this.natives.push(nativeElement);\r\n        this.callbacks.push(callback || function() {});\r\n        this.rects.push(ElementRect.fromNative(nativeElement));\r\n    };\r\n    this.remove = function(nativeElement) {\r\n        var index = this.natives.indexOf(nativeElement);\r\n        if (index !== -1) {\r\n            this.natives.splice(index, 1);\r\n            this.callbacks.splice(index, 1);\r\n            this.rects.splice(index, 1);\r\n        }\r\n    };\r\n    this.getIntersections = function(item) {\r\n        var intersections = [],\r\n            element;\r\n        angular.forEach(this.rects, function(rect, index) {\r\n            rect.set(rect.native);\r\n            element = angular.element(rect.native);\r\n            element.removeClass('dropping');\r\n            if (rect.intersect(item)) {\r\n                rect.distance = rect.center.distance(item.center);\r\n                rect.data = this.callbacks[index]();\r\n                intersections.push(rect);\r\n                element.addClass('over');\r\n            } else {\r\n                element.removeClass('over');\r\n            }\r\n        }.bind(this));\r\n        intersections.sort(function(a, b) {\r\n            if (a.distance < b.distance) {\r\n                return -1;\r\n            }\r\n            if (a.distance > b.distance) {\r\n                return 1;\r\n            }\r\n            return 0;\r\n        });\r\n        return intersections;\r\n    };\r\n}]);\n\r\n})(window, window.angular);\r\n"]}