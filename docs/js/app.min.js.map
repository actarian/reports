{"version":3,"sources":["docs/js/app.js"],"names":["app","angular","module","config","$httpProvider","window","console","log","domain","location","hostname","port","constant","CLI_PULL_NEW","CLI_PUSH_EXHISTING","COM_HANDLED","COM_SUPPORT","COM_UNAUTHORIZED","COM_EXTRA_BUDGET","COM_CLOSE","PLDSSPETC_AC_SHORT_YES","PLDSSPETC_AC_SHORT_NO","PLDSSPETC_SHORT_YES","PLDSSPETC_SHORT_NO","CAPOF_CLOSE","CAPOF_NO_BUDGET","CAPOF_CREATE","CAPOF_TASK","DIRCOM_ACCEPTED","DIRCOM_REFUSED","CAPOF_INFO","ASSIGNTO_CLOSE","CLI_PULL","COM_PULL_AC","COM_PULL","COM_PUSH","COM_LONG","COM_EXTRA","COM_EXTRA_CONFIRMED","PLDSSPETC_PUSH","PLDSSPETC_PULL","CAPOF_ASSIGNATION","DIRCOM_EXTRA","COMPLETE","COM_TASK","STATUS_WAITING","STATUS_TASK","STATUS_COM","STATUS_BUDGET","STATUS_COMPLETE","STATUS_OPENED","STATUS_HANDLED","STATUS_COMPLETED","STATUS_ESTIMATION","STATUS_PLANNED","STATUS_UNDONE","STATUS_DONE","STATUS_CLOSED","STATUS_RAI","STATUS_NEGOTIATION","STATUS_ACCEPTED","STATUS_REFUSED","NORMAL","DOWNWARD","DIRCOM","COM","SEG","CAPOF","PLDSSPE","TEC","NONE","ADMIN","PLDSSPETC","RR","DS","PL","SPE","GESTIONALE","REPORTTRATT","ID","IDS","TITLE","DATE","CUSTOMER","RESOURCE","STATUS","STATUSSM","FAMILY","NUMBER","HOURS","COSTS","PERCENT","INCREMENT","ICON","BUTTONS","DISABLED","LINK","BOOL","DOUBLE","WEEKS","controller","$scope","$location","$timeout","$http","$templateCache","$compile","$window","Appearance","appearance","stop","$event","stopImmediatePropagation","goBack","history","back","init","source","state","paging","$filter","$q","State","Utils","DataFilter","DataSource","Columns","Range","ChartData","colTypes","GroupColumns","rows","items","compares","cols","reset","compared","forEach","row","has","excludes","item","active","filter","includes","iterate","push","compare","makeStatic","CountryCols","name","value","key","type","TEXT","hasSearch","groupBy","radio","color","aggregate","tabs","id","template","icon","show","description","filters","ranges","currentQuarter","set","currentSemester","currentYear","expand","dynamic","showReport","defaults","map","col","colGroups","getGroups","valGroups","getAggregates","unpaged","uri","resolveItems","comparing","index","this","date","Date","created_at","setFullYear","getFullYear","dt","setDate","setHours","getTime","month","monthShort","resolve","deferred","response","data","group","showComparison","from","dateFrom","to","dateTo","params","Api","reports","negotiations","then","bind","search","datasource","sort","setRangeDiff","diff","range","is","setDiff","resetFilters","isFunction","a","b","update","exclude","include","toggleCol","toggleColumns","doFilter","isActive","getKey","doFilterMultiple","length","indexOf","doFilterColumns","doOrder","getSortKey","getRowClass","onOpen","path","excel","columns","json","format","getFormat","getValue","getValueTotal","exportExcel","headers","blob","Blob","windowUrl","URL","webkitURL","downloadUrl","createObjectURL","anchor","document","createElement","href","fileNamePattern","download","exec","body","appendChild","click","revokeObjectURL","remove","error","$on","scope","event","fromIndex","model","toIndex","splice","aid","directive","templateFunction","element","attributes","form","title","placeholder","replace","split","join","formKey","formFocus","message","decoration","disabled","label","change","onChange","inputCols","colInput","colLabel","required","readonly","options","validate","precision","controlRow","undefined","match","validation","mouseover","mouseout","nameHi","formKeyHi","modelHi","validationHi","requiredHi","messageHi","decorationHi","himodel","min","optionLabel","number","canCreate","flatten","queryable","onSelected","restrict","compile","templateElement","templateAttributes","html","contents","control","link","require","onFocus","focus","$modelValue","$setViewValue","doBlur","$invalid","validateType","onBlur","addListeners","on","removeListeners","off","$formatters","$parsers","unshift","valid","String","Number","toString","$setValidity","max","onTap","e","toggleClass","toggle","setAttribute","hasClass","addCloseListeners","onTapOut","getClosest","target","removeClass","removeCloseListeners","querySelector","$document","Style","togglers","collapsable","_height","offsetHeight","style","height","addClass","setTimeout","$broadcast","hide","$target","clearTimeout","onOver","onLeave","toElement","onClick","getClosestElement","toggleLeave","transclude","$parent","$eval","onValidate","button","stateClass","sclass","busy","isBusy","successing","isSuccessing","success","isSuccess","errorring","isErroring","isError","stateDisabled","onSort","getSort","enabled","setSort","$watchCollection","$parse","ElementRect","Droppables","onStart","condition","down","getTouch","addDragListeners","onMove","move","difference","dragging","power","transform","x","y","elementRect","nativeElement","offset","rects","getIntersections","native","onEnd","droppableIndex","fromModel","ngModel","rect","droppable","$emit","removeDragListeners","selector","draggableItem","draggableIf","onGetData","droppableIf","droppableItem","add","onLink","linkTo","attr","open","preventDefault","events","tap","$templateRequest","$controller","getPageScroll","supportPageOffset","pageXOffset","isCSS1Compat","compatMode","documentElement","scrollLeft","pageYOffset","scrollTop","pop","copy","onClose","promise","find","eq","append","compileController","$watch","newValue","oldValue","getBoundingClientRect","point","top","Math","onClickOut","showValues","toggler","activate","addOutListeners","deactivate","removeOutListeners","Error","toTitleCase","str","txt","charAt","toUpperCase","substr","toLowerCase","splitted","firstName","shift","lastName","legacyFilter","cost","currency","ratio","formatting","unit","hours","floor","minutes","timezone","parseTime","parseHour","val","filterWatcher","_groupBy","collection","getter","dict","property","isObject","isUndefined","isMemoized","arguments","memoize","provider","isNull","isScope","obj","$evalAsync","$get","$rootScope","getHashKey","fName","args","replacerFactory","cache","JSON","stringify","removeCache","targetScope","$id","$$listeners","$$cache","cleanStateless","$$timeout","$$phase","addListener","hashKey","$$isMemoized","filterName","$$memoize","result","factory","types","QUARTER","extend","prototype","setQuarter","setSemester","setYear","now","setMonth","getMonth","year","quarter","SEMESTER","semester","YEAR","getName","setDates","Base","$$super","$super","$ctor","apply","call","constructor","methods","Object","create","Point","radius","degree","w","h","pow","sin","cos","draw","ctx","fillStyle","fillRect","Vector","make","size","sqrt","normalize","l","incidence","angle","atan2","distance","cross","abs","towards","friction","width","center","fromNative","left","offsetWidth","vector","intersect","props","scale","hoverScale","currentScale","prefix","webkit","div","every","prop","prefixed","styles","cssText","transformOrigin","round","Matrix","translate","z","rotate","skew","matrix","decompose","decompositionType","decompositionTypeEnum","QRLike","is3dSupported","get","getComputedStyle","WebKitCSSMatrix","MozCSSMatrix","MsCSSMatrix","OCSSMatrix","CSSMatrix","properties","webkitTransform","OTransform","msTransform","MozTransform","insertBefore","p","getPropertyValue","removeChild","LULike","computedStyle","trim","matrix3dRegexp","matrix3dMatch","matrix2dRegexp","matrix2dMatch","isNaN","c","m41","m42","m43","m11","asin","m22","PI","acos","m13","parseFloat","d","f","delta","r","atan","s","compose","t","service","tableColumnClass","colType","columnClass","tableHeaderClass","Cookie","TIMEOUT","_set","days","setTime","expires","toGMTString","cookie","cookieName","ca","i","substring","parse","delete","checkCookie","elapsed","timeout","reject","interval","defer","LocalStorage","isLocalStorageSupported","supported","localStorage","setItem","removeItem","isSupported","storageEvent","originalEvent","SessionStorage","isSessionStorageSupported","sessionStorage","Animate","callback","useTimeout","isPlaying","ticks","play","loop","time","_this","requestAnimationFrame","pause","cancelAnimationFrame","playpause","cycle","k","ff","gg","hh","ii","add32","cmn","q","md51","n","md5blk","tail","charCodeAt","md5blks","rhex","j","hex_chr","hex","Md5","encode","string","lsw","msw","previous","touch","touches","changedTouches","pageX","pageY","getRelativeTouch","el","matchesFn","parent","some","fn","parentElement","throttle","func","wait","context","later","leading","getNow","remaining","trailing","where","array","query","found","$new","controllerAs","children","reverseSortOn","prepend","expression","formatted","reducer","o","reducerSetter","slice","reducerAdder","lastTime","vendors","currTime","timeToCall","Array","reduce","defineProperty","TypeError","len","ua","navigator","userAgent","safari","msie","chrome","mobile","toMd5","getElementsByTagName","isReady","idle","errors","ready","errorMessage","submitClass","submitMessage","idleMessage","busyMessage","successMessage","getObjectParams","getParams","post","btoa","page","getMonths","monthDiff","months","nameShort","storage","PAGES_FIRST","PAGES_SIZE","pages","PAGES_MAX","count","maxPages","allrows","steps","POSITIVE_INFINITY","next","$d","step","when","unallowed","$$lastRequestedPath","status","parseHeader","responseHeader","responseView","ceil","pagination","getPages","getUri","concat","opened","prevPage","nextPage","gotoPage","firstPage","lastPage","hasMany","hasMorePagesBehind","startingIndex","hasMorePagesNext","endingIndex","isPage","hasPages","openClose","hasSort","setSearch","getSearch","setDateFrom","getDateFrom","setDateTo","getDateTo","Column","raw","getters","fields","field","setters","assign","getRaw","getSource","values","keys","total","hasKey","initValue","addTotal","addCount","v","addValue","filtered","current","getValueFormatted","isNumber","getFormatted","static","getTotal","getLink","getHeaderClass","cc","getColumnClass","getCellClass","getItemClass","baseClass","getTextClass","getTotalClass","searchToggle","textClass","list","getCount","getFirstCol","first","getChartKey","getGroupKey","radios","showDynamics","getCounters","getPercentages","getDynamics","getCompares","groups","headerClass","va","vb","activeInRange","flag","unique","addTotals","searchDisabled","setMode","mode","labels","series","bezierCurve","elements","line","tension","scaleLabel","tooltipTemplate","scales","yAxes","gridLines","display","callbacks","tooltips","tooltipItems","tooltipItem","datasets","datasetIndex","datasetLabel","points","evt","datasetOverride","natives","intersections"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global angular */\r\n\r\n\"use strict\";\r\n\r\nvar app = angular.module('app', ['ngSanitize', 'ngMessages']); //, 'ngSilent', 'ui.bootstrap', 'relativeDate', 'ngFileUpload', 'textAngular', 'uiSwitch', 'rzModule', 'ngJsonExplorer', 'chart.js']);\r\n\r\napp.config(['$httpProvider', function ($httpProvider) {\r\n    \r\n    // $httpProvider.defaults.withCredentials = true;\r\n\r\n}]);\r\n\r\n/*\r\napp.run(['$rootScope', function ($rootScope) {\r\n\r\n}]);\r\n*/\n/* global angular, app */\r\n\r\nwindow.console ? null : window.console = { log: function () { } };\r\nwindow.domain = '//' + location.hostname + (location.port ? ':' + location.port : ''); // location.protocol + \r\n\r\napp.constant('domain', domain);\r\n\r\napp.constant('formActions', {\r\n    CLI_PULL_NEW: 1,\r\n    CLI_PUSH_EXHISTING: 2,\r\n    COM_HANDLED: 3,\r\n    COM_SUPPORT: 4,\r\n    COM_UNAUTHORIZED: 5,\r\n    COM_EXTRA_BUDGET: 6,\r\n    COM_CLOSE: 7,\r\n    PLDSSPETC_AC_SHORT_YES: 8,\r\n    PLDSSPETC_AC_SHORT_NO: 9,\r\n    PLDSSPETC_SHORT_YES: 10,\r\n    PLDSSPETC_SHORT_NO: 11,\r\n    CAPOF_CLOSE: 12,\r\n    CAPOF_NO_BUDGET: 13,\r\n    CAPOF_CREATE: 14,\r\n    CAPOF_TASK: 15,\r\n    DIRCOM_ACCEPTED: 16,\r\n    DIRCOM_REFUSED: 17,\r\n    CAPOF_INFO: 18,\r\n    ASSIGNTO_CLOSE: 19,\r\n});\r\n\r\napp.constant('formTypes', {\r\n    CLI_PULL: 1,\r\n    COM_PULL_AC: 2,\r\n    COM_PULL: 3,\r\n    COM_PUSH: 4,\r\n    COM_LONG: 5,\r\n    COM_EXTRA: 6,\r\n    COM_EXTRA_CONFIRMED: 7,\r\n    PLDSSPETC_PUSH: 8,\r\n    PLDSSPETC_PULL: 9,\r\n    CAPOF_ASSIGNATION: 10,\r\n    DIRCOM_EXTRA: 11,\r\n    COMPLETE: 12,\r\n    COM_TASK: 13,\r\n});\r\n\r\napp.constant('formStatus', {\r\n    STATUS_WAITING:         1,\r\n    STATUS_TASK:            2,\r\n    STATUS_COM:             3,\r\n    STATUS_BUDGET:          4,\r\n    STATUS_COMPLETE:        5,\r\n});\r\n\r\napp.constant('taskStatus', {\r\n    STATUS_OPENED: 1,\r\n    STATUS_HANDLED: 2,\r\n    STATUS_WAITING: 3,\r\n    STATUS_COMPLETED: 4,\r\n    STATUS_ESTIMATION: 5,\r\n    STATUS_PLANNED: 6,\r\n});\r\n\r\napp.constant('teamStatus', {\r\n    STATUS_UNDONE: 0,\r\n    STATUS_DONE: 1,\r\n});\r\n\r\napp.constant('negotiationStatus', {\r\n    STATUS_OPENED: 1,\r\n    STATUS_CLOSED: 2,\r\n});\r\n\r\napp.constant('estimationStatus', {\r\n    STATUS_RAI: 255,\r\n    STATUS_COM: 270,\r\n    STATUS_NEGOTIATION: 254,\r\n    STATUS_ACCEPTED: 252,\r\n    STATUS_REFUSED: 253,\r\n    STATUS_COMPLETED: 271,\r\n});\r\n\r\napp.constant('projectTypes', {\r\n    NORMAL:                 1,\r\n    DOWNWARD:               2,\r\n});\r\n\r\napp.constant('projectStatus', {\r\n    STATUS_OPENED: 1,\r\n    STATUS_CLOSED: 2,\r\n});\r\n\r\napp.constant('userAreas', {\r\n    DIRCOM: 250,\r\n    COM: 210,\r\n    SEG: 200,\r\n    CAPOF: 80,\r\n    PLDSSPE: 170,\r\n    TEC: 140,\r\n    NONE: 0,\r\n});\r\n\r\napp.constant('userGroups', {\r\n    ADMIN: [10000],\r\n    DIRCOM: [10000, 250, 1],\r\n    COM: [10000, 210, 200],\r\n    SEG: [10000, 200],\r\n    PLDSSPETC: [10000, 220, 170, 160, 150, 140],\r\n    PLDSSPE: [10000, 220, 170, 160, 150],\r\n    RR: [10000, 220],\r\n    DS: [10000, 170],\r\n    PL: [10000, 160],\r\n    SPE: [10000, 150],\r\n    TEC: [10000, 140],\r\n    CAPOF: [10000, 80],\r\n    GESTIONALE: [10000, 1],\r\n    REPORTTRATT: [10000, 1, 190, 80, 250],\r\n});\r\n\r\napp.constant('colTypes', {\r\n    ID: 1,\r\n    IDS: 2,\r\n    TITLE: 3,\r\n    DATE: 4,\r\n    CUSTOMER: 5,\r\n    RESOURCE: 6,\r\n    STATUS: 7,\r\n    STATUSSM: 8,\r\n    FAMILY: 9,\r\n    NUMBER: 10,\r\n    HOURS: 11,\r\n    COSTS: 12,\r\n    PERCENT: 13,\r\n    INCREMENT: 14,\r\n    ICON: 15,\r\n    BUTTONS: 16,\r\n    DISABLED: 17,\r\n    LINK: 18,\r\n    BOOL: 19,\r\n    DOUBLE: 20,\r\n    WEEKS: 21,\r\n});\r\n\r\n/*\r\napp.value('relativeDateTranslations', {\r\n    just_now:               'adesso', // 'just now',\r\n    seconds_ago:            '{{time}} secondi fa', // '{{time}} seconds ago',\r\n    a_minute_ago:\t        'un minuto fa', // 'a minute ago',\r\n    minutes_ago:\t        '{{time}} minuti fa', // '{{time}} minutes ago',\r\n    an_hour_ago:            'un\\'ora fa', // 'an hour ago',\r\n    hours_ago:              '{{time}} ore fa', // '{{time}} hours ago',\r\n    a_day_ago:              'ieri', // 'yesterday',\r\n    days_ago:               '{{time}} giorni fa', // '{{time}} days ago',\r\n    a_week_ago:             'una settimana fa', // 'a week ago',\r\n    weeks_ago:              '{{time}} settimane fa', // '{{time}} weeks ago',\r\n    a_month_ago:            'un mese fa', // 'a month ago',\r\n    months_ago:             '{{time}} mesi fa', // '{{time}} months ago',\r\n    a_year_ago:             'un anno fa', // 'a year ago',\r\n    years_ago:              '{{time}} anni fa', // '{{time}} years ago',\r\n    over_a_year_ago:        'più di un anno fa', // 'over a year ago',\r\n    seconds_from_now:       'fra {{time}} secondi', // '{{time}} seconds from now',\r\n    a_minute_from_now:      'fra un minuto', // 'a minute from now',\r\n    minutes_from_now:       'tra {{time}} minuti', // '{{time}} minutes from now',\r\n    an_hour_from_now:       'tra un\\'ora', // 'an hour from now',\r\n    hours_from_now:         'tra {{time}} ore', // '{{time}} hours from now',\r\n    a_day_from_now:         'domani', // 'tomorrow',\r\n    days_from_now:          'fra {{time}} giorni', // '{{time}} days from now',\r\n    a_week_from_now:        'tra una settimana', // 'a week from now',\r\n    weeks_from_now:         'fra {{time}} settimane', // '{{time}} weeks from now',\r\n    a_month_from_now:       'tra un mese', // 'a month from now',\r\n    months_from_now:        'fra {{time}} mesi', // '{{time}} months from now',\r\n    a_year_from_now:        'tra un anno', // 'a year from now',\r\n    years_from_now:         'tra {{time}} anni', // '{{time}} years from now',\r\n    over_a_year_from_now:   'fra più di un anno', // 'over a year from now',\r\n});\r\n\r\napp.config(['ChartJsProvider', function (ChartJsProvider) {\r\n    console.log(Chart.defaults.global);\r\n    var colors = ['#1684FB', '#F21500', '#ffe200', '#FF6435', '#FF9700', '#4BAF4F', '#8BC24A', '#7A70E4', '#53E2DD', '#03A9F4'];\r\n    ChartJsProvider.setOptions({\r\n        chartColors: colors,\r\n        responsive: true,\r\n        maintainAspectRatio: true,\r\n    });\r\n    ChartJsProvider.setOptions('line', {\r\n        showLines: true,\r\n    });\r\n    ChartJsProvider.setOptions('tooltips', {\r\n        callbacks: {\r\n            title: function (tooltipItems, data) {\r\n                return ''; // title;\r\n            },\r\n            label: function (tooltipItem, data) {\r\n                var label = data.datasets[tooltipItem.datasetIndex].label; // data.labels[tooltipItem.index];\r\n                var datasetLabel = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];\r\n                return label + ': ' + datasetLabel;\r\n            }\r\n        }\r\n    });\r\n    ChartJsProvider.setOptions('legend', {\r\n        display: true,\r\n    });    \r\n}]);\r\n*/\n/* global angular, app */\r\n\r\napp.controller('RootCtrl', ['$scope', '$location', '$timeout', '$http', '$templateCache', '$compile', '$window', 'Appearance', function ($scope, $location, $timeout, $http, $templateCache, $compile, $window, Appearance) {\r\n\r\n    $scope.appearance = Appearance;\r\n\r\n    $scope.stop = function ($event) {\r\n        $event.stopImmediatePropagation();\r\n        return true;\r\n    };\r\n    $scope.goBack = function () {\r\n        $window.history.back();\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('TableCtrl', ['$scope', function ($scope) {\r\n\r\n    $scope.init = function (source) {\r\n        $scope.source = source;\r\n        $scope.state = $scope.source.state;\r\n        $scope.source.paging();\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('ReportCtrl', ['$scope', '$filter', '$location', '$http', '$q', 'State', 'Utils', 'Appearance', 'DataFilter', 'DataSource', 'Columns', 'Range', 'ChartData', 'colTypes', function ($scope, $filter, $location, $http, $q, State, Utils, Appearance, DataFilter, DataSource, Columns, Range, ChartData, colTypes) {\r\n    var state = $scope.state = new State();\r\n\r\n    var tabs = $scope.tabs = [{\r\n        id: 2,\r\n        name: 'Colonne',\r\n        template: 'partials/report/filters/columns',\r\n        icon: 'icon-time',\r\n    }, {\r\n        id: 3,\r\n        name: 'Valori',\r\n        template: 'partials/report/filters/values',\r\n        icon: 'icon-time',\r\n    }, {\r\n        id: 4,\r\n        name: 'Opzioni',\r\n        template: 'partials/report/filters/flags',\r\n        icon: 'icon-time',\r\n    },];\r\n    tabs.show = true;\r\n    tabs.description = 'partials/report/description';\r\n    tabs.id = 2;\r\n\r\n    function GroupColumns(rows, items, compares) {\r\n        // console.log(rows, items, compares);\r\n        cols.reset();\r\n        var compared = null;\r\n        angular.forEach(rows, function (row) {\r\n            var has = true;\r\n            angular.forEach(excludes, function (item) {\r\n                if (item.active) {\r\n                    has = has && item.filter(row);\r\n                }\r\n            });\r\n            angular.forEach(includes, function (item) {\r\n                if (item.active) {\r\n                    has = has && item.filter(row);\r\n                }\r\n            });\r\n            if (has) {\r\n                cols.iterate(row, items);\r\n            }\r\n        });\r\n        if (compares) {\r\n            compared = [];\r\n            angular.forEach(compares, function (row) {\r\n                var has = true;\r\n                angular.forEach(excludes, function (item) {\r\n                    if (item.active) {\r\n                        has = has && item.filter(row);\r\n                    }\r\n                });\r\n                angular.forEach(includes, function (item) {\r\n                    if (item.active) {\r\n                        has = has && item.filter(row);\r\n                    }\r\n                });\r\n                if (has) {\r\n                    compared.push(row);\r\n                    cols.compare(row, items);\r\n                }\r\n            });\r\n        }\r\n        cols.makeStatic(items);\r\n        // $scope.groupChart();\r\n    }\r\n    \r\n    var filters = $scope.filters = new DataFilter();\r\n    var ranges = $scope.ranges = [\r\n        new Range().currentQuarter().set(filters),\r\n        new Range().currentSemester(),\r\n        new Range().currentYear(),\r\n    ];\r\n\r\n    function CountryCols(){\r\n        return [{\r\n            name: 'region', value: 'region', key: 'region', type: colTypes.TEXT, active: true, hasSearch: true, groupBy: true,\r\n        }, {\r\n            name: 'name', value: 'name', key: 'name', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'country',\r\n        }, {\r\n            name: 'capital', value: 'capital', key: 'name', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'country',\r\n        }, {\r\n            name: 'language', value: 'languages[0].name', key: 'languages[0].name', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'country',\r\n        }, {\r\n            name: 'currency', value: 'currencies[0].name', key: 'currencies[0].name', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'country',\r\n        }, {\r\n            name: 'alpha2Code', value: 'alpha2Code', key: 'name', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'country',\r\n        }, {\r\n            name: 'lat', value: 'latlng[0]', key: 'name', type: colTypes.NUMBER, active: false, groupBy: true, color: 1,\r\n        }, {\r\n            name: 'lng', value: 'latlng[1]', key: 'name', type: colTypes.NUMBER, active: false, groupBy: true, color: 1,\r\n        }, {\r\n            name: 'area', value: 'area', key: 'name', type: colTypes.NUMBER, active: true, aggregate: true, color: 2,\r\n        }, {\r\n            name: 'population', value: 'population', key: 'name', type: colTypes.NUMBER, active: true, aggregate: true, color: 3,\r\n        }, ];\r\n        /*\r\n        alpha2Code: \"AF\"\r\n        alpha3Code: \"AFG\"\r\n        altSpellings: Array[2]\r\n        area: 652230\r\n        borders: Array[6]\r\n        callingCodes: Array[1]\r\n        capital: \"Kabul\"\r\n        currencies: Array[1]\r\n        demonym: \"Afghan\"\r\n        gini: 27.8\r\n        languages: Array[3]\r\n        latlng: Array[2]\r\n        name: \"Afghanistan\"\r\n        nativeName: \"افغانستان\"\r\n        numericCode: \"004\"\r\n        population: 27657145\r\n        region: \"Asia\"\r\n        timezones: Array[1]\r\n        topLevelDomain: Array[1]\r\n        translations: Object\r\n        */\r\n    }\r\n    function GitCols(){\r\n        return [{\r\n            name: 'owner', value: 'owner.login', key: 'owner.id', type: colTypes.TEXT, active: true, hasSearch: true, groupBy: true, radio: 'git',\r\n        }, {\r\n            name: 'name', value: 'name', key: 'id', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'git',\r\n        }, {\r\n            name: 'description', value: 'description', key: 'id', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'git',\r\n        }, {\r\n            name: 'count', value: 'count', key: 'id', type: colTypes.NUMBER, active: false, count: true, aggregate: true,\r\n        }, {\r\n            name: 'size', value: 'size', key: 'orderRecord.id', type: colTypes.NUMBER, active: true, aggregate: true, color: 1,\r\n        }, {\r\n            name: 'stargazers_count', value: 'stargazers_count', key: 'id', type: colTypes.NUMBER, active: true, aggregate: true, color: 2,\r\n        }, {\r\n            name: 'watchers_count', value: 'watchers_count', key: 'id', type: colTypes.NUMBER, active: true, aggregate: true, color: 3,\r\n        }, {\r\n            name: 'score', value: 'score', key: 'id', type: colTypes.NUMBER, active: true, aggregate: true, color: 4,\r\n        }, {\r\n            name: 'A = score * 2', value: 'score * 2', raw: 'A', key: 'id', type: colTypes.NUMBER, active: true, aggregate: true\r\n        }, {\r\n            name: 'B = A * 3', value: 'A * 3', raw: 'B', key: 'id', type: colTypes.NUMBER, active: true, aggregate: true\r\n        }, {\r\n            name: 'C = B / A', value: 'B / A', raw: 'C', key: 'id', type: colTypes.NUMBER, active: true, aggregate: true\r\n        }]\r\n    }\r\n\r\n    var cols = $scope.cols = new Columns(CountryCols());\r\n    cols = $scope.cols = cols.expand({ dynamic: true, compare: false });\r\n    cols.showReport = true;\r\n    var defaults = cols.map(function (col) { \r\n        return { \r\n            id: col.id, \r\n            active: col.active,\r\n        };\r\n    });\r\n    var colGroups = $scope.colGroups = [{\r\n        name: 'GroupBy',\r\n        cols: cols.getGroups()\r\n    }, ];\r\n    var valGroups = $scope.valGroups = [{\r\n        name: 'Aggregate',\r\n        cols: cols.getAggregates()\r\n    }];\r\n    var excludes = $scope.excludes = [/*{\r\n        name: 'Monte ore / tutti i reparti', filter: function (row) {\r\n            return !(row.supplier.id === 15143);\r\n        }, active: true,\r\n    }, */];\r\n    var includes = $scope.includes = [];\r\n\r\n    var compares;\r\n    var source = $scope.source = new DataSource({\r\n        unpaged: true,\r\n        uri: function () {\r\n            return 'api/restcountries.all.js';\r\n            return 'https://restcountries.eu/rest/v2/all';\r\n            return 'https://api.github.com/search/repositories?q=tetris+language:javascript&sort=stars&order=desc&per_page=100';\r\n        },\r\n        filters: filters,\r\n        resolveItems: function (items, rows, comparing) {\r\n            console.log(items);\r\n            // items = items.items;\r\n            angular.forEach(items, function (item, index) {\r\n                item.id = this.id;\r\n                var date = new Date(item.created_at);\r\n                if (comparing) {\r\n                    date = new Date(date.setFullYear(date.getFullYear() + 1));\r\n                }\r\n                item.dt = date;\r\n                item.dt.setDate(1);\r\n                item.dt.setHours(0, 0, 0, 0);\r\n                item.dt = item.dt.getTime();\r\n                item.month = $filter('date')(date, '(yyyy MM) MMMM');\r\n                item.monthShort = $filter('date')(date, 'MMM yy');\r\n                rows.push(item);\r\n                this.id++;\r\n            }, this);\r\n            return rows;\r\n        },\r\n        resolve: function (deferred) {\r\n            compares = null;\r\n            this.id = 1;\r\n            this.resolveItems(this.response.data, this.rows);\r\n            deferred.resolve();\r\n        },\r\n        group: function (deferred) {\r\n            if (cols.showComparison) {\r\n                if (compares) {\r\n                    GroupColumns(this.rows, this.items, compares);\r\n                    deferred.resolve();\r\n                } else {\r\n                    // loadAndParseCompares\r\n                    var from = new Date(filters.dateFrom.getTime());\r\n                    var to = new Date(filters.dateTo.getTime());\r\n                    var params = {\r\n                        dateFrom: new Date(from.setFullYear(from.getFullYear() - 1)),\r\n                        dateTo: new Date(to.setFullYear(to.getFullYear() - 1)),\r\n                    };\r\n                    Api.reports.negotiations(params).then(function success(response) {\r\n                        compares = this.resolveItems(response, [], true);\r\n                        GroupColumns(this.rows, this.items, compares);\r\n                        deferred.resolve();\r\n                    }.bind(this));\r\n                }\r\n            } else {\r\n                GroupColumns(this.rows, this.items);\r\n                deferred.resolve();\r\n            }\r\n        },\r\n        search: function (datasource) {\r\n            // console.log('search', datasource.items, datasource.filters);\r\n        },\r\n        sort: function (datasource) {\r\n            // console.log('sort', datasource.items, datasource.filters);\r\n        },\r\n    });\r\n\r\n    $scope.setRangeDiff = function (diff) {\r\n        angular.forEach(ranges, function (range) {\r\n            if (range.is(filters)) {\r\n                range.setDiff(diff);\r\n                range.set(filters, source);\r\n            }\r\n        });\r\n    };\r\n    $scope.resetFilters = function () {\r\n        angular.forEach(cols, function (col, key) {\r\n            angular.forEach(defaults, function (item) {\r\n                if (col.id === item.id) {\r\n                    angular.isFunction(col.active) ? null : col.active = item.active;\r\n                }\r\n            });\r\n            col.search = null;\r\n        });\r\n        cols = $scope.cols = cols.sort(function (a, b) {\r\n            return a.id - b.id;\r\n        });\r\n        // cols.radios.workloads = 'supplier.name';\r\n        source.update();\r\n    };\r\n    $scope.exclude = function (item) {\r\n        item.active = !item.active;\r\n        source.update();\r\n    };\r\n    $scope.include = function (item) {\r\n        item.active = !item.active;\r\n        source.update();\r\n    };\r\n    $scope.toggleCol = function (col) {\r\n        cols.toggleColumns(col);\r\n        source.update();\r\n    };\r\n    $scope.doFilter = function (cols) {\r\n        // source.update(); // doing regroup\r\n        return function (item) {\r\n            var has = true;\r\n            angular.forEach(cols, function (col) {\r\n                if (col.isActive() && col.search && col.search.id !== 0) {\r\n                    has = has && col.getKey(item) === col.search.id;\r\n                }\r\n            }.bind(this));\r\n            return has;\r\n        };\r\n    };\r\n    $scope.doFilterMultiple = function (cols) {\r\n        // source.update(); // doing regroup\r\n        return function (item) {\r\n            var has = true;\r\n            angular.forEach(cols, function (col) {\r\n                if (col.isActive() && col.search.length) {\r\n                    has = has && col.search.indexOf(col.getKey(item)) != -1;\r\n                }\r\n            }.bind(this));\r\n            return has;\r\n        };\r\n    };\r\n    $scope.doFilterColumns = function (cols) {\r\n        return function (col) {\r\n            return col.isActive(); // col.dynamic ? (cols.showDynamics && col.active()) : col.active;\r\n        };\r\n    };\r\n    $scope.doOrder = function (cols) {\r\n        return function (item) {\r\n            return cols.getSortKey(item);\r\n        };\r\n    };\r\n    $scope.getRowClass = function (item) {\r\n        return ''; // item.status ? 'status-' + Appearance.negotiationClass(item.status.id) : '';\r\n    };\r\n    $scope.onOpen = function (item) {\r\n        $location.path('/trattative/' + item.id);\r\n    };\r\n    $scope.excel = function (columns, rows) {\r\n        console.log('excel', columns, rows);\r\n        var json = {\r\n            name: 'Report carichi di lavoro',\r\n            description: 'Report carichi di lavoro', // + $filter('date')(filters.dateFrom, 'dd MMM yyyy') + ' al ' + $filter('date')(filters.dateTo, 'dd MMM yyyy'),\r\n            columns: [],\r\n            rows: [],\r\n        };\r\n        angular.forEach(columns, function (col, index) {\r\n            json.columns.push({\r\n                index: index,\r\n                name: col.name,\r\n                format: col.getFormat(),\r\n            });\r\n        });\r\n        angular.forEach(rows, function (row, index) {\r\n            var item = [];\r\n            angular.forEach(columns, function (col, index) {\r\n                item[index] = col.getValue(row);\r\n                switch (col.type) {\r\n                    case colTypes.PERCENT:\r\n                    case colTypes.INCREMENT:\r\n                        item[index] /= 100;\r\n                        break;\r\n                }\r\n            });\r\n            json.rows.push(item);\r\n        });\r\n        var item = [];\r\n        angular.forEach(columns, function (col, index) {\r\n            if (col.aggregate) {\r\n                item[index] = col.getValueTotal(rows);\r\n                switch (col.type) {\r\n                    case colTypes.PERCENT:\r\n                    case colTypes.INCREMENT:\r\n                        item[index] /= 100;\r\n                        break;\r\n                }\r\n            } else {\r\n                item[index] = null;\r\n            }\r\n        });\r\n        json.rows.push(item);\r\n        Api.app.exportExcel(json).then(function success(response) {\r\n            var headers = response.headers();\r\n            // console.log(response);\r\n            var blob = new Blob([response.data], { type: headers['content-type'] });\r\n            var windowUrl = (window.URL || window.webkitURL);\r\n            var downloadUrl = windowUrl.createObjectURL(blob);\r\n            var anchor = document.createElement(\"a\");\r\n            anchor.href = downloadUrl;\r\n            var fileNamePattern = /filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/;\r\n            anchor.download = fileNamePattern.exec(headers['content-disposition'])[1];\r\n            document.body.appendChild(anchor);\r\n            anchor.click();\r\n            windowUrl.revokeObjectURL(blob);\r\n            anchor.remove();\r\n            /*\r\n            //Dispatching click event.\r\n            if (document.createEvent) {\r\n                var e = document.createEvent('MouseEvents');\r\n                e.initEvent('click', true, true);\r\n                link.dispatchEvent(e);\r\n                return true;\r\n            }\r\n             */\r\n            return;\r\n\r\n        }, function error(response) {\r\n            state.error(response);\r\n        });\r\n    };\r\n    $scope.$on('onDropItem', function (scope, event) {\r\n        // console.log('NegotiationReportCtrl.onDropItem', 'from', event.from, 'to', event.to);\r\n        var fromIndex = cols.indexOf(event.from.model);\r\n        var toIndex = cols.indexOf(event.to.model);\r\n        var item = cols[fromIndex];\r\n        cols.splice(fromIndex, 1);\r\n        cols.splice(toIndex, 0, item);\r\n    });\r\n    $scope.$on('onDropOut', function (scope, event) {\r\n        // console.log('NegotiationReportCtrl.onDropOut', event.model, event.from, event.to, event.target);\r\n    });\r\n\r\n    function Init() {\r\n        state.ready();\r\n    }    \r\n\r\n    /*\r\n    $scope.output = \"A\";\r\n    $http.get('https://api.github.com/search/repositories?q=tetris+language:javascript&sort=stars&order=desc&per_page=100').then(function success(response) {\r\n        $scope.output = response;\r\n    });\r\n    */\r\n\r\n}]);\r\n\n/* global angular, app */\r\n\r\nvar aid = 0; // application unique id counter using for dev\r\n\r\napp.directive('controlRow', ['$http', '$templateCache', '$compile', 'Utils', function ($http, $templateCache, $compile, Utils) {\r\n    function templateFunction (element, attributes) {\r\n        var form = attributes.form || 'Form';\r\n        var title = attributes.title || 'Untitled';\r\n        var placeholder = attributes.placeholder || title;\r\n        var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++aid);\r\n        var formKey = form + '.' + name;\r\n        var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n        var message = '', decoration = '', disabled = '';\r\n        var label = (attributes.label ? attributes.label : 'name');\r\n        var key = (attributes.key ? attributes.key : 'id');\r\n        var model = attributes.model;\r\n        var change = (attributes.onChange ? ' ng-change=\"' + attributes.onChange + '\"' : '');\r\n        var inputCols = attributes.cols ? 6 : 9;\r\n        var colInput = 'col-lg-' + inputCols;\r\n        var colLabel = 'col-lg-' + (12 - inputCols);\r\n        var required = (attributes.required ? ' required=\"true\"' : '');\r\n        var readonly = (attributes.readonly ? ' readonly' : '');\r\n        var options = (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '');\r\n        var validate = (attributes.validate ? ' validate-type=\"' + attributes.validate + '\" ' : '');\r\n        var format = (attributes.format ? ' format=\"' + attributes.format + '\" ' : '');\r\n        var precision = (attributes.precision ? ' precision=\"' + attributes.precision + '\" ' : '');\r\n        if (attributes.disabled) {\r\n            disabled = ' disabled';\r\n        }\r\n        if (attributes.required) {\r\n            decoration = attributes.readonly || attributes.disabled ? '' : '<sup>✽</sup>';            \r\n        }\r\n        message = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$touched) && ') + formKey + '.$error\" role=\"alert\">';\r\n        message = message + '<span ng-message=\"required\" class=\"label-error animated flash\">obbligatorio ⤴</span>';\r\n        switch (attributes.controlRow) {\r\n            case 'password':\r\n                message = message + '<span ng-message=\"minlength\" class=\"label-error animated flash\">almeno 3 caratteri ⤴</span>';\r\n                break;\r\n            case 'email':\r\n                message = message + '<span ng-message=\"email\" class=\"label-error animated flash\">valore non corretto ⤴</span>';\r\n                break;\r\n            case 'number':\r\n            case 'range':\r\n                message = message + '<span ng-message=\"positive\" class=\"label-error animated flash\">solo valori positivi ⤴</span>';\r\n                message = message + '<span ng-message=\"number\" class=\"label-error animated flash\">solo valori numerici ⤴</span>';\r\n                break;\r\n        }\r\n        if (attributes.match !== undefined) {\r\n            message = message + '<span ng-message=\"match\" class=\"label-error animated flash\">non corrispondente ⤴</span>';\r\n        }\r\n        message = message + '</span>';\r\n        var validation = ' ng-class=\"{ \\'control-focus\\': ' + formKey + '.hasFocus, \\'control-success\\': ' + formKey + '.$valid, \\'control-error\\': ' + formKey + '.$invalid && (' + form + '.$submitted || ' + formKey + '.$touched), \\'control-empty\\': !' + formKey + '.$viewValue }\"';\r\n        var template = '<div class=\"row\" ' + validation + '><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + decoration + '</label><div class=\"' + colInput + ' col-' + attributes.controlRow + '\">';\r\n        switch (attributes.controlRow) {\r\n            case 'static':\r\n                var click = (attributes.click ? ' ng-click=\"' + attributes.click + '\"' : '');\r\n                var mouseover = (attributes.mouseover ? ' ng-mouseover=\"' + attributes.mouseover + '\"' : '');\r\n                var mouseout = (attributes.mouseout ? ' ng-mouseover=\"' + attributes.mouseout + '\"' : '');\r\n                var icon = (attributes.icon ? '<i class=\"pull-xs-right ' + attributes.icon + '\"></i>' : '');\r\n                template += '<p class=\"form-control\" ' + click + mouseover + mouseout + '><span ng-bind-html=\"' + model + ' || \\'&nbsp;\\'\"></span>' + icon + '</p>';\r\n                break;\r\n            case 'checkbox':\r\n                template = '<div class=\"' + colInput + '\"' + validation + '><div class=\"col-xs-12\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + '\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">' + title + '</span>';\r\n                template += '</label>';\r\n                // template += '<input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + required + ' class=\"toggle toggle-round-flat\">';\r\n                /*\r\n                template = '<div class=\"checkbox\">';\r\n                template += '<span class=\"checkbox-label\">' + title + required +'</span>';\r\n                template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + required + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                template += '</div>';\r\n                */\r\n                break;\r\n            case 'yesno':\r\n                template = '<div class=\"row\" ' + validation + '><label class=\"col-lg-6 custom-control custom-checkbox\">' + title + decoration + '</label>';\r\n                template += '<div class=\"' + colLabel + '\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + '\" ng-change=\"' + model + 'No=!' + model + '\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">Sì</span>';\r\n                template += '</label></div>';\r\n                template += '<div class=\"' + colLabel + '\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + 'No\" ng-change=\"' + model + '=!' + model + 'No\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">No</span>';\r\n                template += '</label>';\r\n                // template += '<input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + required + ' class=\"toggle toggle-round-flat\">';\r\n                /*\r\n                template = '<div class=\"checkbox\">';\r\n                template += '<span class=\"checkbox-label\">' + title + required +'</span>';\r\n                template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + required + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                template += '</div>';\r\n                */\r\n                break;\r\n            case 'switch':\r\n                template = '<div class=\"row control-switch\" ' + validation + '><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + decoration + '</label>';\r\n                template += '<div class=\"' + colInput + '\">';\r\n                template += '<switch name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + options + ' on=\"Sì\" off=\"No\" ' + required + disabled + readonly + formFocus + '></switch>';\r\n                break;\r\n            case 'range':\r\n                validate = ' validate-type=\"number\"';\r\n                var nameHi = name + 'Hi';\r\n                var formKeyHi = form + '.' + nameHi;\r\n                var modelHi = attributes.modelHi;\r\n                var validationHi = ' ng-class=\"{ \\'control-focus\\': ' + formKeyHi + '.hasFocus, \\'control-success\\': ' + formKeyHi + '.$valid, \\'control-error\\': ' + formKeyHi + '.$invalid && (' + form + '.$submitted || ' + formKeyHi + '.$touched), \\'control-empty\\': !' + formKeyHi + '.$viewValue }\"';\r\n                var requiredHi = required;\r\n                if (attributes.requiredHi == 'true') {\r\n                    requiredHi = ' required=\"true\"';\r\n                } else if (attributes.requiredHi == 'false') {\r\n                    requiredHi = '';\r\n                }\r\n                var messageHi = ' ', decorationHi = ' ';\r\n                if (attributes.required && attributes.requiredHi !== 'false') {\r\n                    decorationHi = attributes.readonly || attributes.disabled ? '' : '<sup>✽</sup>';                    \r\n                }\r\n                messageHi = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKeyHi + '.$touched) && ') + formKeyHi + '.$error\" role=\"alert\">';\r\n                messageHi = messageHi + '<span ng-message=\"required\" class=\"label-error animated flash\">obbligatorio ⤴</span>';\r\n                switch (attributes.controlRow) {\r\n                    case 'password':\r\n                        messageHi = messageHi + '<span ng-message=\"minlength\" class=\"label-error animated flash\">almeno 3 caratteri ⤴</span>';\r\n                        break;\r\n                    case 'email':\r\n                        messageHi = messageHi + '<span ng-message=\"email\" class=\"label-error animated flash\">valore non corretto ⤴</span>';\r\n                        break;\r\n                    case 'number':\r\n                    case 'range':\r\n                        messageHi = messageHi + '<span ng-message=\"positive\" class=\"label-error animated flash\">solo valori positivi ⤴</span>';\r\n                        messageHi = messageHi + '<span ng-message=\"number\" class=\"label-error animated flash\">solo valori numerici ⤴</span>';\r\n                        break;\r\n                }\r\n                if (attributes.match !== undefined) {\r\n                    messageHi = messageHi + '<span ng-message=\"match\" class=\"label-error animated flash\">non corrispondente ⤴</span>';\r\n                }\r\n                messageHi = messageHi + '</span>';\r\n                template = '<div class=\"row\"><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + '</label><div class=\"' + colInput + ' col-' + attributes.controlRow + '\">';\r\n                template += '<div class=\"form-control-range form-control-range-min\" ' + validation + '>' + decoration + '<input class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>' + message + '</div>';\r\n                template += '<div class=\"form-control-range form-control-range-max\" ' + validationHi + '>' + decorationHi + '<input class=\"form-control\" name=\"' + nameHi + '\" ng-model=\"' + modelHi + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + requiredHi + disabled + readonly + formFocus + validate + format + precision + '>' + messageHi + '</div>';\r\n                return template + '</div></div>';\r\n                break;\r\n            case 'range-slider':\r\n                var himodel = (attributes.himodel ? ' rz-slider-high=\"' + attributes.himodel + '\" ' : '');\r\n                options = (attributes.options ? ' rz-slider-options=\"' + attributes.options + '\" ' : '');\r\n                template += '<rzslider rz-slider-model=\"' + model + '\" ' + himodel + options + '\"></rzslider>';\r\n                break;\r\n            case 'select':\r\n                var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\r\n                var optionLabel = Utils.format(label, 'item.', true);\r\n                var options = attributes.number\r\n                    ? 'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter\r\n                    : optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\r\n                template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + ' ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + required + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n                break;\r\n            case 'autocomplete':\r\n                var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n                var flatten = (attributes.flatten ? attributes.flatten : false);\r\n                var queryable = (attributes.queryable ? attributes.queryable : false);\r\n                var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n                template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" type=\"hidden\" ' + (attributes.required ? 'required' : '') + '>';\r\n                template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n                break;\r\n            case 'textarea':\r\n                var rows = (attributes.rows ? attributes.rows : '1');\r\n                template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" ' + required + disabled + ' rows=\"' + rows + '\"' + formFocus + '></textarea>';\r\n                break;\r\n            case 'htmltext':\r\n                template += '<div text-angular name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" ' + required + disabled + readonly + formFocus + (attributes.required ? ' ta-min-text=\"1\"' : '') + '></div>';\r\n                break;\r\n            case 'password':\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"password\" ng-minlength=\"2\" ' + required + disabled + formFocus + '>';\r\n                break;\r\n            case 'email':\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + required + disabled + formFocus + '>';\r\n                break;\r\n            case 'number':\r\n                validate = ' validate-type=\"number\"';\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n            case 'date':\r\n                validate = ' validate-type=\"date\"';\r\n                format = ' format=\"dd-MM-yyyy\"';\r\n                if (attributes.disabled || attributes.readonly) {\r\n                    template += '<div class=\"input-group\"><input type=\"text\" class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" placeholder=\"' + placeholder + '\" ' + required + disabled + readonly + formFocus + validate + format + '><span class=\"input-group-addon\"><i class=\"icon-calendar\"></i></span></div>';\r\n                } else {\r\n                    template += '<input type=\"date\" name=\"' + name + '\" class=\"form-control form-control-hidden\" is-open=\"flags.' + name + '\" ng-model=\"' + model + '\" placeholder=\"dd-MM-yyyy\" ' + required + disabled + readonly + formFocus + ' uib-datepicker-popup datepicker-options=\"sources.datepickerOptions\" datepicker-template-url=\"uib/template/datepicker/datepicker.html\" show-button-bar=\"false\" current-text=\"Oggi\" clear-text=\"Rimuovi\" close-text=\"Chiudi\">';\r\n                    template += '<div ng-click=\"(flags.' + name + ' = true)\" class=\"input-group disabled\"><input type=\"text\" class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" placeholder=\"' + placeholder + '\" ' + required + disabled + readonly + formFocus + validate + format + '><span class=\"input-group-addon\"><i class=\"icon-calendar\"></i></span></div>';\r\n                }\r\n                break;\r\n                /*\r\n            case 'date':\r\n                placeholder = placeholder || 'dd-MM-yyyy';\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"date\"' + required + disabled + readonly + formFocus + '>';\r\n                break;\r\n                */\r\n            case 'datetime-local':\r\n                placeholder = placeholder || 'dd-MM-yyyyTHH:mm:ss';\r\n                // placeholder == title ? placeholder = 'dd/MM/yyyyTHH:mm:ss' : null;\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + required + disabled + readonly + formFocus + '>';\r\n                break;\r\n            case 'text':\r\n            default:\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n        }\r\n        return template + message + '</div></div>';\r\n    }\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        compile: function (templateElement, templateAttributes) {            \r\n            return function (scope, element, attributes) {\r\n                element.html(templateFunction(templateElement, templateAttributes));\r\n                $compile(element.contents())(scope);\r\n            }\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('control', [function () {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        template: function (element, attributes) {\r\n            var form = attributes.form || 'Form';\r\n            var title = attributes.title || 'Untitled';\r\n            var placeholder = attributes.placeholder || title;\r\n            var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++aid);\r\n            var formKey = name; // form + '.' + name;\r\n            var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n            var message = '', decoration = '', disabled = '';\r\n            var label = (attributes.label ? attributes.label : 'name');\r\n            var key = (attributes.key ? attributes.key : 'id');\r\n            var model = attributes.model;\r\n            var change = (attributes.onChange ? ' ng-change=\"' + attributes.onChange + '\"' : '');\r\n            var required = (attributes.required ? ' required=\"true\"' : '');\r\n            var readonly = (attributes.readonly ? ' readonly' : '');\r\n            var options = (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '');\r\n            var validate = (attributes.validate ? ' validate-type=\"' + attributes.validate + '\" ' : '');\r\n            if (attributes.required) {\r\n                decoration = attributes.readonly || attributes.disabled ? '' : '<sup>✽</sup>';\r\n                message = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$dirty) && ') + formKey + '.$error\" role=\"alert\"><span ng-message=\"required\" class=\"label-error animated flash\"> ⤴ required</span>';\r\n                switch (attributes.control) {\r\n                    case 'password':\r\n                        message = message + '<span ng-message=\"minlength\" class=\"label-error animated flash\"> ⤴ at least 3 chars</span>';\r\n                        break;\r\n                    case 'email':\r\n                        message = message + '<span ng-message=\"email\" class=\"label-error animated flash\"> ⤴ incorrect</span>';\r\n                        break;\r\n                    case 'number':\r\n                        message = message + '<span ng-message=\"number\" class=\"label-error animated flash\"> ⤴ enter a valid number</span>';\r\n                        message = message + '<span ng-message=\"number\" class=\"label-error animated flash\"> ⤴ enter a positive number</span>';\r\n                        break;\r\n                }\r\n                if (attributes.match !== undefined) {\r\n                    message = message + '<span ng-message=\"match\" class=\"label-error animated flash\"> ⤴ not matching</span>';\r\n                }\r\n                message = message + '</span>';\r\n            } else {\r\n                message = ' ';\r\n            }\r\n            if (attributes.disabled) {\r\n                disabled = ' disabled';\r\n            }\r\n            // var template = '<ng-form name=\"' + name + '\" ng-class=\"{ \\'control-focus\\': ' + formKey + '.hasFocus, \\'control-success\\': ' + formKey + '.$valid, \\'control-error\\': ' + formKey + '.$invalid && (' + form + '.$submitted || ' + formKey + '.$dirty), \\'control-empty\\': !' + formKey + '.$viewValue }\"><label for=\"' + name + '\" class=\"control-label\">' + title + message + '</label>';\r\n            var template = '<ng-form name=\"' + name + '\" ng-class=\"{ \\'control-focus\\': ' + formKey + '.hasFocus }\"><label for=\"' + name + '\" class=\"control-label\"><span class=\"control-title\">' + title + '</span>' + decoration + ' ' + message + '</label>';\r\n            // console.log('control' + formKey);\r\n            switch (attributes.control) {\r\n                case 'checkbox':\r\n                    template = '<ng-form name=\"' + name + '\" class=\"checkbox\">';\r\n                    template += '<span class=\"checkbox-label\"><span class=\"control-title\">' + title + '</span>' + decoration + ' ' + message + '</span>';\r\n                    template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + required + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                    template += '</div>';\r\n                    break;\r\n                case 'select':\r\n                    var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\r\n                    var options = attributes.number\r\n                        ? 'item.' + key + ' as item.' + label + ' for item in ' + attributes.source + filter\r\n                        : 'item.' + label + ' for item in ' + attributes.source + filter + ' track by item.' + key;\r\n                    template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + ' ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + required + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n                    break;\r\n                case 'autocomplete':\r\n                    var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n                    var flatten = (attributes.flatten ? attributes.flatten : false);\r\n                    var queryable = (attributes.queryable ? attributes.queryable : false);\r\n                    var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n                    template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + ' type=\"hidden\" ' + required +  disabled +'>';\r\n                    template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n                    break;\r\n                case 'textarea':\r\n                    var rows = (attributes.rows ? attributes.rows : '1');\r\n                    template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" ' + required + disabled +' rows=\"' + rows + '\"' + formFocus + '></textarea>';\r\n                    break;\r\n                case 'datetime-local':\r\n                    placeholder == title ? placeholder = 'yyyy-MM-ddTHH:mm:ss' : null;\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + required + readonly + formFocus + '>';\r\n                    break;\r\n                case 'password':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"password\" ng-minlength=\"2\" ' + required + disabled + formFocus + '>';\r\n                    break;\r\n                case 'email':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + required + disabled + formFocus + '>';\r\n                    break;\r\n                case 'number':\r\n                    validate = ' validate-type=\"number\"';\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + ' validate-type=\"number\">'; // ' validator=\"{ number: isNumber }\">';\r\n                    break;\r\n                case 'text':\r\n                default:\r\n                    // var log = ' ng-change=\"log(\\'' + formKey + '\\', \\'$valid\\', ' + formKey + '.$valid, \\'$dirty\\', ' + formKey + '.$dirty, \\'$pristine\\', ' + formKey + '.$pristine, \\'$error\\', ' + formKey + '.$error)\"';\r\n                    var log = '';\r\n                    template += '<input name=\"' + name + '\" ' + log + ' class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + '>';\r\n                    break;\r\n            }\r\n            return template + '</ng-form>';\r\n        },\r\n        link: function (scope, element, attributes, model) {\r\n        },\r\n    };\r\n}]);\r\n\r\napp.directive('validateType', ['$filter', function ($filter) {\r\n    return {\r\n        require: 'ngModel',\r\n        link: function (scope, element, attributes, model) {\r\n            var validateType = attributes.validateType;\r\n            var format = attributes.format || '';\r\n            var precision = attributes.precision || 2;\r\n            var focus = false;\r\n            switch (validateType) {\r\n                case 'date':\r\n                case 'datetime':\r\n                case 'datetime-local':\r\n                    model.$formatters.push(function (value) {\r\n                        if (value) {\r\n                            return $filter('date')(value, format);\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    break;\r\n                case 'number':\r\n                    model.$parsers.unshift(function (value) {\r\n                        var valid = false, type = validateType;\r\n                        if (value !== undefined && value !== \"\") {\r\n                            valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \r\n                            value = Number(value);\r\n                            model.$setValidity('number', valid);\r\n                            if (valid) {\r\n                                model.$setValidity('positive', value >= 0.01);\r\n                                attributes.min !== undefined ? model.$setValidity('range', value >= Number(attributes.min)) : null;\r\n                                attributes.max !== undefined ? model.$setValidity('range', value <= Number(attributes.max)) : null;\r\n                            }\r\n                            /*                             \r\n                            if (valid) {\r\n                                if (value < 0.01) {\r\n                                    valid = false;\r\n                                    type = 'positive';\r\n                                }\r\n                                if (valid && attributes.min !== undefined) {\r\n                                    valid = valid && value >= Number(attributes.min);\r\n                                    if (!valid) {\r\n                                        type = 'range';\r\n                                    }\r\n                                }\r\n                                if (valid && attributes.max !== undefined) {\r\n                                    valid = valid && value <= Number(attributes.max);\r\n                                    if (!valid) {\r\n                                        type = 'range';\r\n                                    }\r\n                                }\r\n                            }\r\n                            */\r\n                            // console.log('validateType.number', type, valid, value);\r\n                        } else {\r\n                            valid = true;\r\n                            value = Number(value);\r\n                            model.$setValidity('number', true);\r\n                            model.$setValidity('positive', true);\r\n                            attributes.min !== undefined ? model.$setValidity('range', true) : null;\r\n                            attributes.max !== undefined ? model.$setValidity('range', true) : null;\r\n                        }\r\n                        return value;\r\n                    });\r\n                    model.$formatters.push(function (value) {\r\n                        if (value) {\r\n                            return $filter('number')(value, precision) + ' ' + format;\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    /*\r\n                    model.$render = function () {\r\n                        console.log('model.render', model.$modelValue);\r\n                        element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\r\n                    };\r\n                    */\r\n                    break;\r\n            }\r\n            function onFocus() {\r\n                focus = true;\r\n                if (format) {\r\n                    element[0].value = model.$modelValue || null;\r\n                    if (!model.$modelValue) {\r\n                        model.$setViewValue(null);\r\n                    }\r\n                }\r\n            }\r\n            function doBlur() {\r\n                if (format && !model.$invalid) {\r\n                    switch (validateType) {\r\n                        case 'date':\r\n                        case 'datetime':\r\n                        case 'datetime-local':\r\n                            element[0].value = model.$modelValue ? $filter('date')(model.$modelValue, format) : ' ';\r\n                            break;\r\n                        default:\r\n                            element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n            function onBlur() {\r\n                focus = false;\r\n                doBlur();\r\n            }\r\n            function addListeners() {\r\n                element.on('focus', onFocus);\r\n                element.on('blur', onBlur);\r\n            }\r\n            function removeListeners() {\r\n                element.off('focus', onFocus);\r\n                element.off('blur', onBlur);\r\n            }\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\r\n\r\napp.directive('dropdown', ['$window', 'Utils', function ($window, Utils) {\r\n    return {\r\n        restrict: 'C',\r\n        link: function (scope, element, attributes, model) {\r\n            var toggle = element[0].querySelector('.dropdown-toggle');\r\n            var opened = element.hasClass('open');\r\n            function onTap(e) {\r\n                element.toggleClass('open');\r\n                toggle.setAttribute('aria-expanded', element.hasClass('open').toString());\r\n                addCloseListeners();\r\n            };\r\n            function onTapOut(e) {\r\n                if (Utils.getClosest(e.target, '.dropdown')) {\r\n                    return true;\r\n                } else {\r\n                    element.removeClass('open');\r\n                    toggle.setAttribute('aria-expanded', element.hasClass('open').toString());\r\n                    removeCloseListeners();\r\n                }\r\n            };\r\n            function addCloseListeners() {\r\n                angular.element($window).on('touchend mouseup', onTapOut);\r\n            };\r\n            function removeCloseListeners() {\r\n                angular.element($window).off('touchend mouseup', onTapOut);\r\n            };\r\n            function addListeners() {\r\n                angular.element(toggle).on('touchstart mousedown', onTap);\r\n            };\r\n            function removeListeners() {\r\n                angular.element(toggle).off('touchstart mousedown', onTap);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n                removeCloseListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('dropup', ['$window', 'Utils', function ($window, Utils) {\r\n    return {\r\n        restrict: 'C',\r\n        link: function (scope, element, attributes, model) {\r\n            var toggle = element[0].querySelector('.dropdown-toggle');\r\n            var opened = element.hasClass('open');\r\n            function onTap(e) {\r\n                element.toggleClass('open');\r\n                toggle.setAttribute('aria-expanded', element.hasClass('open').toString());\r\n            };\r\n            function onTapOut(e) {\r\n                if (Utils.getClosest(e.target, '.dropdown')) {\r\n                    return true;\r\n                } else {\r\n                    element.removeClass('open');\r\n                    toggle.setAttribute('aria-expanded', element.hasClass('open').toString());\r\n                }\r\n            };\r\n            function addListeners() {\r\n                angular.element(toggle).on('touchstart mousedown', onTap);\r\n                angular.element($window).on('touchend mouseup', onTapOut);\r\n            };\r\n            function removeListeners() {\r\n                angular.element(toggle).off('touchstart mousedown', onTap);\r\n                angular.element($window).off('touchend mouseup', onTapOut);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('toggle', ['$window', '$document', '$timeout', 'Utils', 'Style', function ($window, $document, $timeout, Utils, Style) {\r\n    var togglers = [];\r\n    var reflow = function (element) {\r\n        new Function('bs', 'return bs')(element ? element.offsetHeight : 0);\r\n    };\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            if (!attributes.target) {\r\n                return;\r\n            }\r\n            var target;\r\n            var style = new Style();\r\n            function show() {\r\n                var collapsable = angular.element(target);\r\n                if (collapsable.hasClass('in')) {\r\n                    return;\r\n                }\r\n                collapsable.removeClass('collapse');\r\n                if (target) {\r\n                    var _height = target.offsetHeight;\r\n                    style.height = '0px';\r\n                    style.set(target);\r\n                    collapsable.removeClass('collapse').addClass('collapsing');\r\n                    target.setAttribute('aria-expanded', true);\r\n                    element.removeClass('collapsed');\r\n                    element[0].setAttribute('aria-expanded', true);\r\n                    setTimeout(function () {\r\n                        style.height = _height + 'px';\r\n                        style.set(target);\r\n                        setTimeout(function () {\r\n                            collapsable.removeClass('collapsing').addClass('collapse').addClass('in');\r\n                            target.style.height = 'auto';\r\n                        }, 500);\r\n                    }, 1);\r\n                    scope.$broadcast('onToggled', target);\r\n                }\r\n                addCloseListeners();\r\n            }\r\n            function hide() {\r\n                var collapsable = angular.element(target);\r\n                if (!collapsable.hasClass('in')) {\r\n                    return;\r\n                }\r\n                var _height = target ? target.offsetHeight : 0;\r\n                style.height = _height + 'px';\r\n                style.set(target);\r\n                collapsable.addClass('collapsing').removeClass('collapse').removeClass('in');\r\n                target.setAttribute('aria-expanded', false);\r\n                element.addClass('collapsed');\r\n                element[0].setAttribute('aria-expanded', false);                \r\n                setTimeout(function () {\r\n                    style.height = '0px';\r\n                    style.set(target);\r\n                    setTimeout(function () {\r\n                        collapsable.removeClass('collapsing').addClass('collapse');\r\n                        target.style.height = 'auto';\r\n                    }, 500);\r\n                }, 1);\r\n                removeCloseListeners();\r\n            }            \r\n            function onTap(e) {\r\n                // console.log('toggle.onTap');\r\n                /*\r\n                if (angular.element(target).hasClass('collapsing')) {\r\n                    return;\r\n                }\r\n                */\r\n                if (angular.element(target).hasClass('in')) {\r\n                    hide();\r\n                } else {\r\n                    show();\r\n                }\r\n            }\r\n            function onTapOut(e) {\r\n                // console.log('toggle.onTapOut', e);\r\n                if (Utils.getClosest(e.target, attributes.target)) {\r\n                    return true;\r\n                } else {\r\n                    hide();\r\n                }\r\n            };\r\n            function addCloseListeners() {\r\n                angular.element($window).on('touchend mouseup', onTapOut);\r\n            };\r\n            function removeCloseListeners() {\r\n                angular.element($window).off('touchend mouseup', onTapOut);\r\n            };\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onTap);\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onTap);\r\n            };\r\n            scope.$on('onToggled', function ($scope, $target) {\r\n                if (target !== $target) {\r\n                    // console.log('toggle.onToggled');\r\n                    hide();\r\n                }\r\n            });\r\n            scope.$on('$destroy', function () {\r\n                var index = togglers.indexOf(target);\r\n                if (index !== -1) {\r\n                    togglers.splice(index, 1);\r\n                }\r\n                removeListeners();\r\n                removeCloseListeners();\r\n            });\r\n            setTimeout(function () {\r\n                target = document.querySelector(attributes.target);\r\n                togglers.push(target);\r\n                // console.log('toggle', attributes.target, target);\r\n                addListeners();\r\n            });\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('toggleEnter', ['$window', '$document', '$timeout', 'Utils', 'Style', function ($window, $document, $timeout, Utils, Style) {\r\n    var togglers = [];\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            if (!attributes.target) {\r\n                return;\r\n            }\r\n            var target;\r\n            var style = new Style();\r\n            var to;\r\n            function show() {\r\n                var collapsable = angular.element(target);\r\n                if (collapsable.hasClass('in')) {\r\n                    return;\r\n                }\r\n                to ? clearTimeout(to) : null;\r\n                collapsable.removeClass('collapse');\r\n                if (target) {\r\n                    var _height = target.offsetHeight;\r\n                    style.height = '0px';\r\n                    style.set(target);\r\n                    collapsable.removeClass('collapse').addClass('collapsing');\r\n                    target.setAttribute('aria-expanded', true);\r\n                    element.removeClass('collapsed');\r\n                    element[0].setAttribute('aria-expanded', true);\r\n                    to = setTimeout(function () {\r\n                        style.height = _height + 'px';\r\n                        style.set(target);\r\n                        to = setTimeout(function () {\r\n                            collapsable.removeClass('collapsing').addClass('collapse').addClass('in');\r\n                            target.style.height = 'auto';\r\n                        }, 500);\r\n                    }, 1);\r\n                    scope.$broadcast('onToggleEntered', target);\r\n                }\r\n                addCloseListeners();\r\n            }\r\n            function hide() {\r\n                var collapsable = angular.element(target);\r\n                if (!collapsable.hasClass('in')) {\r\n                    return;\r\n                }\r\n                to ? clearTimeout(to) : null;\r\n                to = setTimeout(function () { \r\n                    var _height = target ? target.offsetHeight : 0;\r\n                    style.height = _height + 'px';\r\n                    style.set(target);\r\n                    collapsable.addClass('collapsing').removeClass('collapse').removeClass('in');\r\n                    target.setAttribute('aria-expanded', false);\r\n                    element.addClass('collapsed');\r\n                    element[0].setAttribute('aria-expanded', false);\r\n                    to = setTimeout(function () {\r\n                        style.height = '0px';\r\n                        style.set(target);\r\n                        to = setTimeout(function () {\r\n                            collapsable.removeClass('collapsing').addClass('collapse');\r\n                            target.style.height = 'auto';\r\n                        }, 125);\r\n                    }, 1);\r\n                    removeCloseListeners();\r\n                }, 500);\r\n            }\r\n            function onOver(e) {\r\n                if (angular.element(target).hasClass('collapsing')) {\r\n                    return;\r\n                }\r\n                show();\r\n            }\r\n            function onLeave(e) {\r\n                if (Utils.getClosest(e.toElement, attributes.target)) {\r\n                    return true;\r\n                } else {\r\n                    hide();\r\n                }\r\n            }\r\n            function onClick(e) {\r\n                if (Utils.getClosestElement(e.target, element[0])) {\r\n                    return true;\r\n                } else if (Utils.getClosest(e.target, attributes.target)) {\r\n                    return true;\r\n                } else {\r\n                    hide();\r\n                }\r\n            }\r\n            function addCloseListeners() {\r\n                if (attributes.toggleLeave) {\r\n                    element.on('mouseleave', onLeave);\r\n                    angular.element(target).on('mouseleave', onLeave);\r\n                } else {\r\n                    angular.element($window).on('click', onClick);\r\n                }\r\n            }\r\n            function removeCloseListeners() {\r\n                if (attributes.toggleLeave) {\r\n                    element.off('mouseleave', onLeave);\r\n                    angular.element(target).off('mouseleave', onLeave);\r\n                } else {\r\n                    angular.element($window).off('click', onClick);\r\n                }\r\n            }\r\n            function addListeners() {\r\n                element.on('mouseenter', onOver);\r\n            }\r\n            function removeListeners() {\r\n                element.off('mouseenter', onOver);\r\n            }\r\n            scope.$on('onToggleEntered', function ($scope, $target) {\r\n                if (target !== $target) {\r\n                    console.log('toggleEnter.onToggleEntered');\r\n                    hide();\r\n                }\r\n            });\r\n            scope.$on('$destroy', function () {\r\n                var index = togglers.indexOf(target);\r\n                if (index !== -1) {\r\n                    togglers.splice(index, 1);\r\n                }\r\n                removeListeners();\r\n                removeCloseListeners();\r\n            });\r\n            setTimeout(function () {\r\n                target = document.querySelector(attributes.target);\r\n                togglers.push(target);\r\n                addListeners();\r\n            });\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('state', ['$timeout', function ($timeout) {\r\n    return {\r\n        restrict: 'EA',\r\n        template: '<button type=\"button\" class=\"btn btn-sm btn-primary btn-block-md-down\" ng-class=\"stateClass()\" ng-disabled=\"stateDisabled()\"><span ng-transclude></span></button>',\r\n        transclude: true,\r\n        replace: true,\r\n        scope: {\r\n            state: '=',\r\n        },\r\n        link: function (scope, element, attributes, model) {\r\n            scope.stateClass = function () {\r\n                if (scope.state.button === element) {\r\n                    var sclass = {\r\n                        busy: scope.state.isBusy,\r\n                        successing: scope.state.isSuccessing,\r\n                        success: scope.state.isSuccess,\r\n                        errorring: scope.state.isErroring,\r\n                        error: scope.state.isError,\r\n                    };\r\n                    // console.log('stateClass', sclass);\r\n                    return sclass;\r\n                } else {\r\n                    return null;\r\n                }\r\n            };\r\n            scope.stateDisabled = function () {\r\n                var disabled = (scope.state.button && scope.state.button !== element); // || scope.$parent.$eval(attributes.onValidate);\r\n                // console.log('stateDisabled', disabled);\r\n                return disabled;\r\n            };\r\n            function onClick() {\r\n                $timeout(function () {\r\n                    if (!scope.$parent.$eval(attributes.onValidate)) {\r\n                        console.log('state.onClick', attributes.onValidate, attributes.onClick);\r\n                        scope.state.button = element;\r\n                        return scope.$parent.$eval(attributes.onClick);\r\n                    } else {\r\n                        scope.$parent.$eval('form.$setSubmitted()');\r\n                    }\r\n                });\r\n            };\r\n            function addListeners() {\r\n                element.on('touchstart click', onClick);\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart click', onClick);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('sortable', ['$timeout', function ($timeout) {    \r\n    return {\r\n        restrict: 'A',\r\n        scope: {\r\n            source: '=sortable',\r\n            key: '@sortableKey',\r\n            sort: '=?',\r\n        },\r\n        template: '<th ng-class=\"{ \\'sorted-up\\': sort == 1, \\'sorted-down\\': sort == -1 }\" ng-transclude></th>',\r\n        transclude: true,\r\n        replace: true,\r\n        link: function (scope, element, attributes, model) {\r\n            scope.sort = scope.sort || 0;\r\n            function onSort() {\r\n                scope.sort = scope.source.getSort(scope.key);\r\n                // console.log('sortable.onSort', scope.key, scope.source.filters.sort);\r\n            }\r\n            scope.$watchCollection('source.filters.sort', onSort);\r\n            onSort();\r\n            function onTap() {\r\n                if (scope.source.state.enabled()) {\r\n                    var sort = scope.sort ? (scope.sort * -1) : 1;\r\n                    scope.source.setSort(scope.key, sort).then(function (response) {\r\n                        scope.sort = sort;\r\n                    });\r\n                }\r\n            }\r\n            function addListeners() {\r\n                element.on('touchstart click', onTap);\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart click', onTap);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('draggableItem', ['$parse', '$timeout', 'Utils', 'Style', 'ElementRect', 'Droppables', function ($parse, $timeout, Utils, Style, ElementRect, Droppables) {\r\n\r\n    return {\r\n        require: 'ngModel',\r\n        link: function (scope, element, attributes, model) {\r\n            var nativeElement = element[0];\r\n            var selector = attributes.draggableItem || '.item';\r\n            var condition = attributes.draggableIf !== undefined ? $parse(attributes.draggableIf) : function () { return true; };\r\n            var target = nativeElement.querySelector(selector);\r\n            var style = new Style();\r\n            var elementRect = new ElementRect();\r\n            var down, move, diff, dragging, rects;\r\n            function onStart(e) {\r\n                if (condition(scope)) {\r\n                    down = Utils.getTouch(e);\r\n                    addDragListeners();\r\n                }\r\n                return false;\r\n            }\r\n            function onMove(e) {\r\n                move = Utils.getTouch(e);\r\n                diff = down.difference(move);\r\n                if (!dragging && diff.power() > 25) {\r\n                    dragging = true;\r\n                    element.addClass('dragging');\r\n                }\r\n                if (dragging) {\r\n                    style.transform = 'translateX(' + diff.x + 'px) translateY(' + diff.y + 'px)';\r\n                    style.set(target);\r\n                    elementRect.set(nativeElement).offset(diff);\r\n                    rects = Droppables.getIntersections(elementRect);\r\n                    if (rects.length) {\r\n                        angular.element(rects[0].native).addClass('dropping');\r\n                    }\r\n                }\r\n                // console.log(diff);\r\n                return false;\r\n            }\r\n            function onEnd(e) {\r\n                if (dragging) {\r\n                    dragging = false;\r\n                    element.removeClass('dragging');\r\n                    style.transform = 'none';\r\n                    style.set(target);\r\n                    var fromIndex = $parse(attributes.droppableIndex)(scope);\r\n                    var fromModel = $parse(attributes.ngModel)(scope);\r\n                    if (rects.length) {\r\n                        var event = null;\r\n                        angular.forEach(rects, function (rect, index) {\r\n                            angular.element(rect.native).removeClass('dropping over');\r\n                            if (rect.data.droppable(scope) && !event) {\r\n                                event = {\r\n                                    from: {\r\n                                        index: fromIndex,\r\n                                        model: fromModel,\r\n                                        target: target,\r\n                                    },\r\n                                    to: {\r\n                                        index: rect.data.index,\r\n                                        model: rect.data.model,\r\n                                        target: rect.native\r\n                                    },\r\n                                };\r\n                                $timeout(function () {\r\n                                    scope.$emit('onDropItem', event);\r\n                                });\r\n                            }\r\n                        });\r\n                    } else {\r\n                        var event = {\r\n                            from: {\r\n                                index: fromIndex,\r\n                                model: fromModel,\r\n                                target: target,\r\n                            },\r\n                            to: null,\r\n                        };\r\n                        $timeout(function () {\r\n                            scope.$emit('onDropOut', event);\r\n                        });\r\n                    }\r\n                }\r\n                removeDragListeners();\r\n                return false;\r\n            }\r\n            function addDragListeners() {\r\n                angular.element(window).on('touchmove mousemove', onMove);\r\n                angular.element(window).on('touchend mouseup', onEnd);\r\n            };\r\n            function removeDragListeners() {\r\n                angular.element(window).off('touchmove mousemove', onMove);\r\n                angular.element(window).off('touchend mouseup', onEnd);\r\n            };\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onStart);\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onStart);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\r\n\r\napp.directive('droppableItem', ['$parse', 'Utils', 'Style', 'Droppables', function ($parse, Utils, Style, Droppables) {\r\n    var droppables = {};\r\n    return {\r\n        require: 'ngModel',\r\n        link: function (scope, element, attributes, model) {\r\n            var nativeElement = element[0];\r\n            var selector = attributes.droppableItem || '.item';\r\n            function onGetData() {\r\n                var index = $parse(attributes.droppableIndex)(scope);\r\n                var model = $parse(attributes.ngModel)(scope);\r\n                var droppable = attributes.droppableIf !== undefined ? $parse(attributes.droppableIf) : function () { return true };\r\n                return {\r\n                    index: index,\r\n                    model: model,\r\n                    droppable: droppable,\r\n                };\r\n            }\r\n            Droppables.add(nativeElement, onGetData);\r\n            scope.$on('$destroy', function () {\r\n                Droppables.remove(nativeElement);\r\n            });\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('linkTo', ['$parse', '$timeout', '$location', function ($parse, $timeout, $location) {\r\n    return {\r\n        link: function (scope, element, attributes, model) {\r\n            if (!attributes.linkTo) {\r\n                return;\r\n            }\r\n            function onLink() {\r\n                var link = $parse(attributes.linkTo)(scope);\r\n                if (!link) {\r\n                    return;\r\n                }\r\n                element.attr('href', link.href);\r\n                element.attr('target', link.target);\r\n            }\r\n            function onTap(event) {\r\n                var link = $parse(attributes.linkTo)(scope);\r\n                if (!link) {\r\n                    return;\r\n                }\r\n                element.attr('href', link.href);\r\n                element.attr('target', link.target);\r\n                if (link.target === '_blank') {\r\n                    window.open(link.href, '_blank');\r\n                } else {\r\n                    $timeout(function () {\r\n                        var href = link.href.split(window.domain).join('');\r\n                        $location.path(href);                        \r\n                    });\r\n                }\r\n                event.stopImmediatePropagation();\r\n                event.preventDefault();\r\n                return false;\r\n            }\r\n            var events = {\r\n                tap: 'click', // 'touchstart mousedown', // 'click',\r\n            };\r\n            function addListeners() {\r\n                element.on(events.tap, onTap);\r\n            };\r\n            function removeListeners() {\r\n                element.off(events.tap, onTap);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n            $timeout(onLink);\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('pop', ['$parse', '$templateRequest', '$compile', '$controller', '$window', '$document', '$timeout', 'Utils', 'Style', function ($parse, $templateRequest, $compile, $controller, $window, $document, $timeout, Utils, Style) {\r\n    /*\r\n    function compilePop(scope, element, html, data) {\r\n        element.html(html);\r\n        var link = $compile(element.contents());\r\n        console.log(data.controller, scope, element, html, data);\r\n        if (data.controller) {\r\n            var $scope = scope.$new(true);\r\n            $scope = angular.extend($scope, data);\r\n            var controller = $controller(data.controller, $scope); // , modal);\r\n            if (data.controllerAs) {\r\n                scope[data.controllerAs] = controller;\r\n            }\r\n            element.data('$ngControllerController', controller);\r\n            element.children().data('$ngControllerController', controller);\r\n        }\r\n        link(scope);\r\n    }\r\n    */\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            var native = element[0], promise;\r\n            var pop = {\r\n                target: null,\r\n                element: null,\r\n                native: null,\r\n            };\r\n            function onOver(e) {\r\n                promise = $timeout(function () {\r\n                    onTargetOver();\r\n                }, 1000);\r\n            }\r\n            function onOut(e) {\r\n                promise ? $timeout.cancel(promise) : null;\r\n            };\r\n            function getPageScroll() {\r\n                var supportPageOffset = window.pageXOffset !== undefined;\r\n                var isCSS1Compat = ((document.compatMode || \"\") === \"CSS1Compat\");\r\n                var x = supportPageOffset ? window.pageXOffset : isCSS1Compat ? document.documentElement.scrollLeft : document.body.scrollLeft;\r\n                var y = supportPageOffset ? window.pageYOffset : isCSS1Compat ? document.documentElement.scrollTop : document.body.scrollTop;\r\n                return { x: x, y: y };\r\n            }\r\n            function onTap() {\r\n                if (!pop.native) {\r\n                    var data = angular.copy($parse(attributes.pop)(scope));\r\n                    // console.log('pop.onTargetOver', attributes.pop, data);\r\n                    if (data && data != undefined) {\r\n                        data.onClose = function () {\r\n                            removeCloseListeners();\r\n                            pop.element.remove();\r\n                            pop.native = pop.element = promise = null;\r\n                        };\r\n                        pop.native = document.createElement('div');\r\n                        pop.element = angular.element(pop.native);\r\n                        pop.element.addClass('pop');\r\n                        /*\r\n                        var rect = native.getBoundingClientRect();\r\n                        var point = getPageScroll();\r\n                        pop.element.attr('style', 'top:' + (point.y) + 'px');\r\n                        */\r\n                        var body = $document.find('body').eq(0);\r\n                        body.append(pop.element);\r\n                        if (data.template) {\r\n                            $templateRequest(data.template).then(function (html) {\r\n                                Utils.compileController(scope, pop.element, html, data);\r\n                            });\r\n                        } else {\r\n                            Utils.compileController(scope, pop.element, '<div>pop</div>', data);\r\n                        }\r\n                        // console.log('element', pop.element);\r\n                        scope.$emit('onPopUp', pop.native);\r\n                        $timeout(function () {\r\n                            addCloseListeners();\r\n                        }, 1000);\r\n                    }\r\n                }\r\n                /*\r\n                if (angular.element(pop.native).hasClass('collapsing')) {\r\n                    return;\r\n                }\r\n                if (angular.element(pop.native).hasClass('in')) {\r\n                    hide();\r\n                } else {\r\n                    show();\r\n                }\r\n                */\r\n            }\r\n            function onTapOut(e) {\r\n                if (Utils.getClosest(e.target, '.pop')) {\r\n                    return true;\r\n                } else {\r\n                    if (pop.native) {\r\n                        removeCloseListeners();\r\n                        pop.element.remove();\r\n                        pop.native = pop.element = promise = null;\r\n                    }\r\n                }\r\n            };\r\n            scope.$watch(function () {\r\n                return pop.element ? pop.element[0].offsetHeight : 0;\r\n            }, function (newValue, oldValue) {\r\n                if (newValue !== oldValue && pop.element) {\r\n                    var rect = native.getBoundingClientRect();\r\n                    var point = getPageScroll();\r\n                    var top = Math.max(80, (rect.top + point.y - newValue));\r\n                    pop.element.attr('style', 'top:' + top + 'px');\r\n                }\r\n            });\r\n            function addCloseListeners() {\r\n                /*\r\n                element.on('mouseout', onTargetOut);\r\n                pop.element.on('mouseout', onTargetOut);\r\n                */\r\n                angular.element($window).on('click', onTapOut);\r\n            };\r\n            function removeCloseListeners() {\r\n                /*\r\n                element.off('mouseout', onTargetOut);\r\n                pop.element.off('mouseout', onTargetOut);\r\n                */\r\n                angular.element($window).off('click', onTapOut);\r\n            };\r\n            function addListeners() {\r\n                /*\r\n                element.on('mouseover', onOver);\r\n                element.on('mouseout', onOut);\r\n                */\r\n                element.on('click', onTap);\r\n            };\r\n            function removeListeners() {\r\n                /*\r\n                element.off('mouseover', onOver);\r\n                element.off('mouseout', onOut);\r\n                */\r\n                element.off('click', onTap);\r\n            };\r\n            scope.$on('onPopUp', function ($scope, $target) {\r\n                if (pop.native !== $target) {\r\n                    onTapOut();\r\n                }\r\n            });\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('onClickOut', ['$document', '$parse', '$timeout', 'Utils', function ($document, $parse, $timeout, Utils) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            function onClick(e) {\r\n                if (Utils.getClosestElement(e.target, element[0]) === null) {\r\n                    $timeout(function () {                    \r\n                        console.log('onClickOut', attributes.onClickOut, scope.cols.showValues);\r\n                        var onClickOut = $parse(attributes.onClickOut);\r\n                        onClickOut(scope);\r\n                    });\r\n                }\r\n            }\r\n            function addListeners() {\r\n                angular.element($document).on('click', onClick);\r\n            };\r\n            function removeListeners() {\r\n                angular.element($document).off('click', onClick);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\r\n\r\napp.directive('toggler', ['$document', '$parse', '$timeout', 'Utils', function ($document, $parse, $timeout, Utils) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            if (attributes.value === undefined) {\r\n                throw new Error('[toggler] attribute value required');\r\n            }\r\n            if (attributes.target === undefined) {\r\n                throw new Error('[toggler] attribute target required');\r\n            }\r\n            function isActive() {\r\n                return $parse(attributes.toggler + '==' + attributes.value)(scope);\r\n            }\r\n            function activate() {\r\n                addOutListeners();\r\n                $timeout(function () {\r\n                    $parse(attributes.toggler + '=' + attributes.value)(scope);\r\n                });\r\n            }\r\n            function deactivate() {\r\n                removeOutListeners();\r\n                $timeout(function () {\r\n                    $parse(attributes.toggler + '=null')(scope);\r\n                });\r\n            }\r\n            function onClick(e) {\r\n                setTimeout(function () {\r\n                    if (isActive()) {\r\n                        deactivate();\r\n                    } else {\r\n                        activate();\r\n                    }\r\n                }, 100);\r\n            }\r\n            function onClickOut(e) {\r\n                if (isActive()\r\n                    && Utils.getClosestElement(e.target, element[0]) === null\r\n                    && Utils.getClosest(e.target, attributes.target) === null) {\r\n                    deactivate();\r\n                }\r\n            }\r\n            function addOutListeners() {\r\n                angular.element($document).on('click', onClickOut);\r\n            };\r\n            function removeOutListeners() {\r\n                angular.element($document).off('click', onClickOut);\r\n            };\r\n            function addListeners() {\r\n                element.on('click', onClick);\r\n            };\r\n            function removeListeners() {\r\n                element.off('click', onClick);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n                removeOutListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\r\n\n/* global angular, app, Autolinker */\r\n\r\napp.filter('shortName', ['$filter', function ($filter) {\r\n    function toTitleCase(str) {\r\n        return str.replace(/\\w\\S*/g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });\r\n    }\r\n    return function (value) {\r\n        if (!value) {\r\n            return '';\r\n        }\r\n        if (value.indexOf(' .') === value.length - 2) {\r\n            value = value.split(' .').join('');\r\n        }\r\n        /*\r\n        var splitted;\r\n        if (value.indexOf('.') !== -1) {\r\n            splitted = value.split('.');\r\n        } else {\r\n            splitted = value.split(' ');\r\n        }\r\n        */\r\n        var splitted = value.split(' ');\r\n        var firstName = splitted.shift();\r\n        if (splitted.length) {\r\n            var lastName = splitted.join(' ');\r\n            return firstName.substr(0, 1).toUpperCase() + '.' + toTitleCase(lastName);\r\n        } else {\r\n            return firstName;\r\n        }\r\n    }\r\n}]);\r\n\r\napp.filter('customCurrency', ['$filter', function ($filter) {\r\n    var legacyFilter = $filter('currency');\r\n    return function (cost, currency) {\r\n        return legacyFilter(cost * currency.ratio, currency.formatting);\r\n    }\r\n}]);\r\n\r\napp.filter('customNumber', ['$filter', function ($filter) {\r\n    var filter = $filter('number');\r\n    return function (value, precision, unit) {\r\n        unit = unit || '';\r\n        return (value ? filter(value, precision) + unit : '-');\r\n    }\r\n}]);\r\n\r\napp.filter('customHours', [function () {\r\n    return function (value) {\r\n        if (value) {\r\n            var hours = Math.floor(value);\r\n            var minutes = Math.floor((value - hours) * 60);\r\n            var label = hours ? hours + ' H' : '';\r\n            label += minutes ? ' ' + minutes + ' m' : '';\r\n            return label;\r\n        } else {\r\n            return '-';\r\n        }\r\n    }\r\n}]);\r\n\r\napp.filter('customDate', ['$filter', function ($filter) {\r\n    var filter = $filter('date');\r\n    return function (value, format, timezone) {\r\n        return value ? filter(value, format, timezone) : '-';\r\n    }\r\n}]);\r\n\r\napp.filter('customTime', ['$filter', function ($filter) {\r\n    return function (value, placeholder) {\r\n        if (value) {\r\n            return Utils.parseTime(value);\r\n        } else {\r\n            return (placeholder ? placeholder : '-');\r\n        }\r\n    }\r\n}]);\r\n\r\napp.filter('customDigital', ['$filter', function ($filter) {\r\n    return function (value, placeholder) {\r\n        if (value) {\r\n            return Utils.parseHour(value);\r\n        } else {\r\n            return (placeholder ? placeholder : '-');\r\n        }\r\n    }\r\n}]);\r\n\r\napp.filter('customString', ['$filter', function ($filter) {\r\n    return function (value, placeholder) {\r\n        return value ? value : (placeholder ? placeholder : '-');\r\n    }\r\n}]);\r\n\r\napp.filter('customEnum', function () {\r\n    return function (val) {\r\n        val = val + 1;\r\n        return val < 10 ? '0' + val : val;\r\n    };\r\n});\r\n\r\napp.filter('groupBy', ['$parse', 'filterWatcher', function ($parse, filterWatcher) {\r\n    function _groupBy(collection, getter) {\r\n        var dict = {};\r\n        var key;\r\n        angular.forEach(collection, function (item) {\r\n            key = getter(item);\r\n            if (!dict[key]) {\r\n                dict[key] = [];\r\n            }\r\n            dict[key].push(item);\r\n        });\r\n        return dict;\r\n    }\r\n    return function (collection, property) {\r\n        if (!angular.isObject(collection) || angular.isUndefined(property)) {\r\n            return collection;\r\n        }\r\n        return filterWatcher.isMemoized('groupBy', arguments) || filterWatcher.memoize('groupBy', arguments, this, _groupBy(collection, $parse(property)));        \r\n    }\r\n}]);\r\n\r\napp.provider('filterWatcher', function () {\r\n    function isNull(value) {\r\n        return value === null;\r\n    }\r\n    function isScope(obj) {\r\n        return obj && obj.$evalAsync && obj.$watch;\r\n    }\r\n    this.$get = ['$window', '$rootScope', function ($window, $rootScope) {\r\n        var $$cache = {};\r\n        var $$listeners = {};\r\n        var $$timeout = $window.setTimeout;\r\n        function getHashKey(fName, args) {\r\n            function replacerFactory() {\r\n                var cache = [];\r\n                return function (key, val) {\r\n                    if (angular.isObject(val) && !isNull(val)) {\r\n                        if (~cache.indexOf(val)) {\r\n                            return '[Circular]';\r\n                        }\r\n                        cache.push(val);\r\n                    }\r\n                    if ($window == val) return '$WINDOW';\r\n                    if ($window.document == val) return '$DOCUMENT';\r\n                    if (isScope(val)) return '$SCOPE';\r\n                    return val;\r\n                }\r\n            }\r\n            return [fName, JSON.stringify(args, replacerFactory())]\r\n              .join('#')\r\n              .replace(/\"/g, '');\r\n        }\r\n        function removeCache(event) {\r\n            var id = event.targetScope.$id;\r\n            angular.forEach($$listeners[id], function (key) {\r\n                delete $$cache[key];\r\n            });\r\n            delete $$listeners[id];\r\n        }\r\n        function cleanStateless() {\r\n            $$timeout(function () {\r\n                if (!$rootScope.$$phase) {\r\n                    $$cache = {};\r\n                }\r\n            }, 2000);\r\n        }\r\n        function addListener(scope, hashKey) {\r\n            var id = scope.$id;\r\n            if (angular.isUndefined($$listeners[id])) {\r\n                scope.$on('$destroy', removeCache);\r\n                $$listeners[id] = [];\r\n            }\r\n            return $$listeners[id].push(hashKey);\r\n        }\r\n        function $$isMemoized(filterName, args) {\r\n            var hashKey = getHashKey(filterName, args);\r\n            return $$cache[hashKey];\r\n        }\r\n        function $$memoize(filterName, args, scope, result) {\r\n            var hashKey = getHashKey(filterName, args);\r\n            //store result in `$$cache` container\r\n            $$cache[hashKey] = result;\r\n            // for angular versions that less than 1.3\r\n            // add to `$destroy` listener, a cleaner callback\r\n            if (isScope(scope)) {\r\n                addListener(scope, hashKey);\r\n            } else {\r\n                cleanStateless();\r\n            }\r\n            return result;\r\n        }\r\n        return {\r\n            isMemoized: $$isMemoized,\r\n            memoize: $$memoize\r\n        }\r\n    }];\r\n});\r\n\n/* global angular, app */\r\n\r\napp.factory('Range', ['$filter', function ($filter) {\r\n    function Range(data) {\r\n        this.type = Range.types.QUARTER;\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    Range.prototype = {\r\n        currentQuarter: function () {\r\n            this.diff = 0;\r\n            return this.setQuarter();\r\n        },\r\n        currentSemester: function () {\r\n            this.diff = 0;\r\n            return this.setSemester();\r\n        },\r\n        currentYear: function () {\r\n            this.diff = 0;\r\n            return this.setYear();\r\n        },\r\n        setQuarter: function () {\r\n            this.type = Range.types.QUARTER;\r\n            var now = new Date();\r\n            now.setMonth(now.getMonth() + 3 * this.diff);\r\n            var year = now.getFullYear();\r\n            var quarter = Math.floor(now.getMonth() / 3);\r\n            this.from = new Date(year, quarter * 3, 1);\r\n            this.to = new Date(year, quarter * 3 + 3, 0);\r\n            return this;\r\n        },\r\n        setSemester: function () {\r\n            this.type = Range.types.SEMESTER;\r\n            var now = new Date();\r\n            now.setMonth(now.getMonth() + 6 * this.diff);\r\n            var year = now.getFullYear();\r\n            var semester = Math.floor(now.getMonth() / 6);\r\n            this.from = new Date(year, semester * 6, 1);\r\n            this.to = new Date(year, semester * 6 + 6, 0);\r\n            return this;\r\n        },\r\n        setYear: function () {\r\n            this.type = Range.types.YEAR;\r\n            var now = new Date();\r\n            now.setMonth(now.getMonth() + 12 * this.diff);\r\n            var year = now.getFullYear();\r\n            this.from = new Date(year, 0, 1);\r\n            this.to = new Date(year, 12, 0);\r\n            return this;\r\n        },\r\n        getName: function () {\r\n            switch (this.type) {\r\n                case Range.types.QUARTER:\r\n                    return 'Trimestre ' + $filter('date')(this.from, 'MMM') + '-' + $filter('date')(this.to, 'MMM') + ' ' + $filter('date')(this.from, 'yyyy');\r\n                    break;\r\n                case Range.types.SEMESTER:\r\n                    return 'Semestre ' + $filter('date')(this.from, 'MMM') + '-' + $filter('date')(this.to, 'MMM') + ' ' + $filter('date')(this.from, 'yyyy');\r\n                    break;\r\n                case Range.types.YEAR:\r\n                    return 'Anno ' + $filter('date')(this.from, 'yyyy');\r\n                    break;\r\n            }\r\n        },\r\n        setDiff: function(diff) {\r\n            this.diff += diff;\r\n            switch (this.type) {\r\n                case Range.types.QUARTER:\r\n                    return this.setQuarter();\r\n                    break;\r\n                case Range.types.SEMESTER:\r\n                    return this.setSemester();\r\n                    break;\r\n                case Range.types.YEAR:\r\n                    return this.setYear();\r\n                    break;\r\n            }\r\n        },\r\n        set: function (filters, source) {\r\n            filters.dateFrom = this.from;\r\n            filters.dateTo = this.to;\r\n            source ? source.setDates(filters.dateFrom, filters.dateTo) : null;\r\n            return this;\r\n        },\r\n        is: function (filters) {\r\n            return  filters.dateFrom.getTime() == this.from.getTime() &&\r\n                    filters.dateTo.getTime() == this.to.getTime();\r\n        },\r\n    };\r\n    Range.types = {\r\n        QUARTER: 1,\r\n        SEMESTER: 2,\r\n        YEAR: 3,\r\n    }\r\n    return Range;\r\n}]);\r\n\r\napp.factory('Base', [function () {\r\n    function Base() {\r\n    }\r\n    Base.prototype = {\r\n        $$super: null,\r\n        $super: {},\r\n        $ctor: function () {\r\n            this.$$super.apply(this, [].splice.call(arguments, 0));\r\n        },\r\n    };\r\n    Base.extend = function (data) {\r\n        if (!data || !data.constructor) {\r\n            throw ('Base.extend.error: please pass an object with constructor eg. { constructor: function myFunc() {...} }');\r\n        }\r\n        var constructor = data.constructor;\r\n        var methods = data.methods || {};\r\n        // statics\r\n        angular.extend(constructor, this);\r\n        // prototypes\r\n        constructor.prototype = angular.extend(Object.create(this.prototype), methods);\r\n        constructor.prototype.constructor = constructor;\r\n        constructor.prototype.$$super = this;\r\n        constructor.prototype.$super = {};\r\n        angular.forEach(this.prototype, function (value, key) {\r\n            constructor.prototype.$super[key] = function (scope) {\r\n                value.apply(scope, [].splice.call(arguments, 1));\r\n            };\r\n        });\r\n        return constructor;\r\n    };\r\n    Base.prototype.constructor = Base;\r\n    return Base;\r\n}]);\r\n\r\napp.factory('Point', ['Base', function (Base) {\r\n    var Point = Base.extend({\r\n        constructor: function Point(x, y, radius) {\r\n            this.x = x || 0;\r\n            this.y = y || 0;\r\n            this.radius = radius || 100;\r\n        },\r\n        methods: {\r\n            move: function (degree, w, h, pow) {\r\n                var radius = this.radius * (1 + pow);\r\n                this.x = w / 2 + radius * Math.sin(degree);\r\n                this.y = h / 2 + radius * Math.cos(degree);\r\n            },\r\n            draw: function (ctx) {\r\n                ctx.fillStyle = \"white\";\r\n                ctx.fillRect(this.x, this.y, 4, 4);\r\n            },\r\n        }\r\n    });\r\n    return Point;\r\n}]);\r\n\r\napp.factory('Vector', function () {\r\n    function Vector(x, y) {\r\n        this.x = x || 0;\r\n        this.y = y || 0;\r\n    }\r\n    Vector.make = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.size = function (a) {\r\n        return Math.sqrt(a.x * a.x + a.y * a.y);\r\n    };\r\n    Vector.normalize = function (a) {\r\n        var l = Vector.size(a);\r\n        a.x /= l;\r\n        a.y /= l;\r\n        return a;\r\n    };\r\n    Vector.incidence = function (a, b) {\r\n        var angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\r\n        // if (angle < 0) angle += 2 * Math.PI;\r\n        // angle = Math.min(angle, (Math.PI * 2 - angle));\r\n        return angle;\r\n    };\r\n    Vector.distance = function (a, b) {\r\n        return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\r\n    };\r\n    Vector.cross = function (a, b) {\r\n        return (a.x * b.y) - (a.y * b.x);\r\n    };\r\n    Vector.difference = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.power = function (a, b) {\r\n        var x = Math.abs(b.x - a.x);\r\n        var y = Math.abs(b.y - a.y);\r\n        return (x + y) / 2;\r\n    };\r\n    Vector.prototype = {\r\n        size: function () {\r\n            return Vector.size(this);\r\n        },\r\n        normalize: function () {\r\n            return Vector.normalize(this);\r\n        },\r\n        incidence: function (b) {\r\n            return Vector.incidence(this, b);\r\n        },\r\n        cross: function (b) {\r\n            return Vector.cross(this, b);\r\n        },\r\n        distance: function (b) {\r\n            return Vector.distance(this, b);\r\n        },\r\n        difference: function (b) {\r\n            return Vector.difference(this, b);\r\n        },\r\n        power: function () {\r\n            return (Math.abs(this.x) + Math.abs(this.y)) / 2;\r\n        },\r\n        towards: function (b, friction) {\r\n            friction = friction || 0.125;\r\n            this.x += (b.x - this.x) * friction;\r\n            this.y += (b.y - this.y) * friction;\r\n            return this;\r\n        },\r\n        add: function (b) {\r\n            this.x += b.x;\r\n            this.y += b.y;\r\n            return this;\r\n        },\r\n        friction: function (b) {\r\n            this.x *= b;\r\n            this.y *= b;\r\n            return this;\r\n        },\r\n        copy: function (b) {\r\n            return new Vector(this.x, this.y);\r\n        },\r\n        toString: function () {\r\n            return '{' + this.x + ',' + this.y + '}';\r\n        },\r\n    };\r\n    return Vector;\r\n});\r\n\r\napp.factory('ElementRect', ['Vector', function (Vector) {\r\n    function ElementRect() {\r\n        this.x = 0;\r\n        this.y = 0;\r\n        this.width = 0;\r\n        this.height = 0;\r\n        this.center = new Vector();\r\n    }\r\n    ElementRect.fromNative = function (nativeElement) {\r\n        return new ElementRect().set(nativeElement);\r\n    }\r\n    ElementRect.prototype = {\r\n        set: function (nativeElement) {\r\n            var rect = nativeElement.getBoundingClientRect();\r\n            this.x = rect.left;\r\n            this.y = rect.top;\r\n            this.width = nativeElement.offsetWidth;\r\n            this.height = nativeElement.offsetHeight;\r\n            this.center.x = this.x + this.width / 2;\r\n            this.center.y = this.y + this.height / 2;\r\n            this.native = nativeElement;\r\n            return this;\r\n        },\r\n        offset: function (vector) {\r\n            this.x += vector.x;\r\n            this.y += vector.y;\r\n            this.center.x = this.x + this.width / 2;\r\n            this.center.y = this.y + this.height / 2;\r\n            return this;\r\n        },\r\n        intersect: function (element) {\r\n            // console.log('intersect.this', this, 'element', element);\r\n            return !(element.x > this.x + this.width ||\r\n                        element.x + element.width < this.x ||\r\n                        element.y > this.y + this.height ||\r\n                        element.y + element.height < this.y);\r\n        },\r\n        toString: function () {\r\n            return '{' + this.x + ',' + this.y + ',' + this.width + ',' + this.height + '}';\r\n        },\r\n    };\r\n    return ElementRect;\r\n}]);\r\n\r\napp.factory('Style', function () {\r\n    var prefix = function detectTransformProperty() {\r\n        var transform = 'transform',\r\n            webkit = 'webkitTransform';\r\n        var div = document.createElement(\"DIV\");\r\n        if (typeof div.style[transform] !== 'undefined') {\r\n            ['webkit', 'moz', 'o', 'ms'].every(function (prop) {\r\n                var prefixed = '-' + prop + '-transform';\r\n                if (typeof div.style[prefixed] !== 'undefined') {\r\n                    prefix = prefixed;\r\n                    return false;\r\n                }\r\n                return true;\r\n            });\r\n        } else if (typeof div.style[webkit] !== 'undefined') {\r\n            prefix = '-webkit-transform';\r\n        } else {\r\n            prefix = undefined;\r\n        }\r\n        return prefix;\r\n    }();\r\n    function Style() {\r\n        this.props = {\r\n            scale: 1,\r\n            hoverScale: 1,\r\n            currentScale: 1,\r\n        }\r\n    }\r\n    Style.prototype = {\r\n        set: function (element) {\r\n            var styles = [];\r\n            angular.forEach(this, function (value, key) {\r\n                if (key !== 'props')\r\n                    styles.push(key + ':' + value);\r\n            });\r\n            element.style.cssText = styles.join(';') + ';';\r\n        },\r\n        transform: function (transform) {\r\n            this[prefix] = transform;\r\n        },\r\n        transformOrigin: function (x, y) {\r\n            this[prefix + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\r\n            this[prefix + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\r\n        },\r\n    };\r\n    Style.prefix = prefix;\r\n    return Style;\r\n});\r\n\r\napp.factory('Matrix', [function () {\r\n    var transform = { name: 'transform', key: 'transform', matrix: null };\r\n    var is3dSupported = function isSupported3d() {\r\n        if (!window.getComputedStyle) {\r\n            return false;\r\n        }\r\n        transform.matrix = window.WebKitCSSMatrix || window.MozCSSMatrix || window.MsCSSMatrix || window.OCSSMatrix || window.CSSMatrix;\r\n        if (!transform.matrix) {\r\n            return false;\r\n        }\r\n        var element = document.createElement('div'),\r\n            has = false,\r\n            properties = {\r\n                webkitTransform: '-webkit-transform',\r\n                OTransform: '-o-transform',\r\n                msTransform: '-ms-transform',\r\n                MozTransform: '-moz-transform',\r\n                transform: 'transform'\r\n            };\r\n\r\n        document.body.insertBefore(element, null);\r\n        for (var p in properties) {\r\n            if (element.style[p] !== undefined) {\r\n                element.style[p] = \"translate3d(1px,1px,1px)\";\r\n                has = window.getComputedStyle(element).getPropertyValue(properties[p]);\r\n                transform.name = p;\r\n                transform.key = properties[p];\r\n                break;\r\n            }\r\n        }\r\n        document.body.removeChild(element);\r\n        return (has !== undefined && has.length > 0 && has !== \"none\");\r\n    }(transform);\r\n    var decompositionTypeEnum = {\r\n        QRLike: 1,\r\n        LULike: 2,\r\n    };\r\n\r\n    function Matrix(element) {\r\n        this.element = element || document.createElement('div');\r\n        this.translate = { x: 0, y: 0, z: 0 };\r\n        this.rotate = { x: 0, y: 0, z: 0 };\r\n        this.scale = { x: 1, y: 1, z: 1 };\r\n        this.skew = { x: 0, y: 0 };\r\n        this.matrix = this.decompose();\r\n        this.decompositionType = decompositionTypeEnum.QRLike;\r\n        console.log('Matrix', is3dSupported, transform);\r\n        this.get();\r\n    }\r\n    Matrix.prototype.decompose = function () {\r\n        var computedStyle = window.getComputedStyle(this.element);\r\n        var style = computedStyle[transform.name]; //.transform || computedStyle.WebkitTransform || computedStyle.MozTransform || computedStyle.msTransform || computedStyle.OTransform;\r\n        if (!style) {\r\n            this.matrix = new transform.matrix();\r\n        } else {\r\n            style = style.trim();\r\n            this.matrix = new transform.matrix(style);\r\n            if (style === 'none') {\r\n                this.translate.x = this.translate.y = this.translate.z = 0;\r\n                this.rotate.x = this.rotate.y = this.rotate.z = 0;\r\n                this.scale.x = this.scale.y = this.scale.z = 1;\r\n                this.skew.x = this.skew.y = 0;\r\n\r\n            } else {\r\n                var matrix3dRegexp = /matrix3d\\((.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*)\\)/;\r\n                var matrix3dMatch = matrix3dRegexp.exec(style);\r\n\r\n                var matrix2dRegexp = /matrix\\((.*),(.*),(.*),(.*),(.*),(.*)\\)/;\r\n                var matrix2dMatch = matrix2dRegexp.exec(style);\r\n\r\n                if (matrix3dMatch !== null) {\r\n                    /*****************/\r\n                    /*** 3D MATRIX ***/\r\n                    /*****************/\r\n                    var matrix = new transform.matrix(style);\r\n                    if (!matrix || isNaN(matrix.a) || isNaN(matrix.b) || isNaN(matrix.c) || isNaN(matrix.m41) || isNaN(matrix.m42) || isNaN(matrix.m43) || isNaN(matrix.m11)) {\r\n                        throw \"Could not catch CSSMatrix constructor for current browser, OR the constructor has returned a non-standard matrix object (need .a, .b, .c and mXX numerical properties to work)\";\r\n                    }\r\n                    this.rotate.x = Math.asin(matrix.m22) * 180 / Math.PI; // deg;\r\n                    this.rotate.y = Math.acos(matrix.m11) * 180 / Math.PI * (matrix.m13 > 0 ? -1 : 1); // deg\r\n                    this.rotate.z = 0; // \"TODO: Sorry, math people. I really need help here! Please implement this case for me. This will help you: http://9elements.com/html5demos/matrix3d/\";\r\n                    this.translate.x = matrix.m41; // px;\r\n                    this.translate.y = matrix.m42; // px;\r\n                    this.translate.z = matrix.m43; // px;\r\n                    this.scale.x = matrix.m11; // if (matrix.m11 === matrix.m22 && matrix.m22 === matrix.m33)\r\n                    this.scale.y = matrix.m11; // if (matrix.m11 === matrix.m22 && matrix.m22 === matrix.m33)\r\n                    this.scale.z = matrix.m11; // if (matrix.m11 === matrix.m22 && matrix.m22 === matrix.m33)\r\n                    this.skew.x = 0;\r\n                    this.skew.y = 0;\r\n\r\n                } else if (matrix2dMatch !== null) {\r\n                    /*****************/\r\n                    /*** 2D MATRIX ***/\r\n                    /*****************/\r\n                    var a = parseFloat(matrix2dMatch[1]);\r\n                    var b = parseFloat(matrix2dMatch[2]);\r\n                    var c = parseFloat(matrix2dMatch[3]);\r\n                    var d = parseFloat(matrix2dMatch[4]);\r\n                    var e = parseFloat(matrix2dMatch[5]);\r\n                    var f = parseFloat(matrix2dMatch[6]);\r\n\r\n                    var delta = a * d - b * c;\r\n\r\n                    this.rotate.x = 0; // deg;\r\n                    this.rotate.y = 0; // deg;\r\n                    this.rotate.z = 0; // deg;\r\n\r\n                    this.translate.x = e; // px;\r\n                    this.translate.y = f; // px;\r\n                    this.translate.z = 0; // px;\r\n\r\n                    this.scale.x = 1;\r\n                    this.scale.y = 1;\r\n                    this.scale.z = 1;\r\n\r\n                    this.skew.x = 0;\r\n                    this.skew.y = 0;\r\n\r\n                    if (this.decompositionType === decompositionTypeEnum.QRLike) {\r\n                        // Apply the QR-like decomposition.\r\n                        if (a != 0 || b != 0) {\r\n                            var r = Math.sqrt(a * a + b * b);\r\n                            this.rotate.z = (b > 0 ? Math.acos(a / r) : -Math.acos(a / r));\r\n                            this.scale.x = r;\r\n                            this.scale.y = delta / r;\r\n                            this.skew.x = Math.atan((a * c + b * d) / (r * r));\r\n                            this.skew.y = 0;\r\n                        } else if (c != 0 || d != 0) {\r\n                            var s = Math.sqrt(c * c + d * d);\r\n                            this.rotate.z = Math.PI / 2 - (d > 0 ? Math.acos(-c / s) : -Math.acos(c / s));\r\n                            this.scale.x = delta / s;\r\n                            this.scale.y = s;\r\n                            this.skew.x = 0;\r\n                            this.skew.y = Math.atan((a * c + b * d) / (s * s));\r\n                        } else { // a = b = c = d = 0\r\n                            this.rotate.z = 0;\r\n                            this.scale.x = 0;\r\n                            this.scale.y = 0;\r\n                            this.skew.x = 0;\r\n                            this.skew.y = 0;\r\n                        }\r\n                    } else {\r\n                        // Apply the LU-like decomposition.\r\n                        if (a != 0) {\r\n                            this.rotate.z = 0;\r\n                            this.scale.x = a;\r\n                            this.scale.y = delta / a;\r\n                            this.skew.x = Math.atan(c / a);\r\n                            this.skew.y = Math.atan(b / a);\r\n                        } else if (b != 0) {\r\n                            this.rotate.z = Math.PI / 2;\r\n                            this.scale.x = b;\r\n                            this.scale.y = delta / b;\r\n                            this.skew.x = Math.atan(d / b);\r\n                            this.skew.y = 0;\r\n                        } else { // a = b = 0\r\n                            this.rotate.z = 0;\r\n                            this.scale.x = c;\r\n                            this.scale.y = d;\r\n                            this.skew.x = Math.PI / 4;\r\n                            this.skew.y = 0;\r\n                            this.scale.x = 0;\r\n                            this.scale.y = 1;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return this.matrix;\r\n    };\r\n    Matrix.prototype.compose = function () {\r\n        var matrix = new transform.matrix();\r\n        if (is3dSupported) {\r\n            matrix = matrix.translate(this.translate.x, this.translate.y, this.translate.z);\r\n            matrix = matrix.scale(this.scale.x, this.scale.y, this.scale.z);\r\n            matrix = matrix.rotate(this.rotate.x, this.rotate.y, this.rotate.z);\r\n        } else {\r\n            matrix = matrix.translate(this.translate.x, this.translate.y);\r\n            matrix = matrix.scale(this.scale.x, this.scale.y);\r\n            matrix = matrix.rotate(this.rotate.z);\r\n        }\r\n        return matrix;\r\n    };\r\n    Matrix.prototype.get = function () {\r\n        this.decompose();\r\n        console.log(this.toString());\r\n    };\r\n    Matrix.prototype.set = function () {\r\n        var matrix = this.compose().toString();\r\n        this.element.style[transform.name] = matrix;\r\n        // console.log('Matrix.set', matrix);\r\n        // console.log(this.toString());\r\n    };\r\n    Matrix.prototype.toString = function () {\r\n        var t = this.translate;\r\n        var r = this.rotate;\r\n        var s = this.scale;\r\n        return 'Matrix translate(' + t.x + ',' + t.y + ',' + t.z + ') rotate(' + r.x + ',' + r.y + ',' + r.z + ') scale(' + s.x + ',' + s.y + ',' + s.z + ')';\r\n    };\r\n    return Matrix;\r\n\r\n}]);\r\n\n/* global angular, app */\r\n\r\napp.service('Appearance', ['colTypes', function (colTypes) {\r\n\r\n    this.tableColumnClass = function (colType) {\r\n        var columnClass = '';\r\n        switch (colType) {\r\n            case colTypes.ID:\r\n                columnClass = 'tag tag-link';\r\n                break;\r\n            case colTypes.TEXT:\r\n            case colTypes.CUSTOMER:\r\n            case colTypes.FAMILY:\r\n                columnClass = 'text-uppercase';\r\n                break;\r\n            case colTypes.TITLE:\r\n                columnClass = 'col-text text-uppercase';\r\n                break;\r\n            case colTypes.DATE:\r\n                columnClass = 'tag tag-date';\r\n                break;\r\n            case colTypes.RESOURCE:\r\n            case colTypes.STATUS:\r\n            case colTypes.STATUSSM:\r\n                columnClass = 'tag tag-pill';\r\n                break;\r\n            case colTypes.DISABLED:\r\n                columnClass = 'tag tag-pill disabled';\r\n                break;\r\n            case colTypes.IDS:\r\n            case colTypes.NUMBER:\r\n            case colTypes.DOUBLE:\r\n            case colTypes.WEEKS:\r\n            case colTypes.HOURS:\r\n            case colTypes.COSTS:\r\n            case colTypes.ICON:\r\n            case colTypes.BUTTONS:\r\n                break;\r\n        }\r\n        return columnClass;\r\n    };\r\n\r\n    this.tableHeaderClass = function (colType) {\r\n        var columnClass = '';\r\n        switch (colType) {\r\n            case colTypes.ID:\r\n                columnClass = 'th-id';\r\n                break;\r\n            case colTypes.IDS:\r\n                columnClass = 'th-ids';\r\n                break;\r\n            case colTypes.TEXT:\r\n                columnClass = 'th-text';\r\n                break;\r\n            case colTypes.TITLE:\r\n                columnClass = 'th-title';\r\n                break;\r\n            case colTypes.DATE:\r\n                columnClass = 'th-date';\r\n                break;\r\n            case colTypes.CUSTOMER:\r\n                columnClass = 'th-customer';\r\n                break;\r\n            case colTypes.RESOURCE:\r\n            case colTypes.DISABLED:\r\n                columnClass = 'th-resource';\r\n                break;\r\n            case colTypes.STATUS:\r\n                columnClass = 'th-status';\r\n                break;\r\n            case colTypes.STATUSSM:\r\n                columnClass = 'th-status-sm';\r\n                break;\r\n            case colTypes.FAMILY:\r\n                columnClass = 'th-family';\r\n                break;\r\n            case colTypes.NUMBER:\r\n            case colTypes.DOUBLE:\r\n            case colTypes.WEEKS:\r\n                columnClass = 'th-number';\r\n                break;\r\n            case colTypes.HOURS:\r\n                columnClass = 'th-hours';\r\n                break;\r\n            case colTypes.COSTS:\r\n                columnClass = 'th-costs';\r\n                break;\r\n            case colTypes.ICON:\r\n                columnClass = 'th-icon';\r\n                break;\r\n            case colTypes.BUTTONS:\r\n                columnClass = 'th-buttons';\r\n                break;\r\n        }\r\n        return columnClass;\r\n    }\r\n    \r\n}]);\r\n\r\napp.factory('Cookie', ['$q', '$window', function ($q, $window) {\r\n    function Cookie() {\r\n    }\r\n    Cookie.TIMEOUT = 5 * 60 * 1000; // five minutes\r\n    Cookie._set = function (name, value, days) {\r\n        if (days) {\r\n            var date = new Date();\r\n            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\r\n            var expires = \"; expires=\" + date.toGMTString();\r\n        } else {\r\n            var expires = \"\";\r\n        }\r\n        $window.document.cookie = name + \"=\" + value + expires + \"; path=/\";\r\n    }\r\n    Cookie.set = function (name, value, days) {\r\n        try {\r\n            var cache = [];\r\n            var json = JSON.stringify(value, function (key, value) {\r\n                if (key === 'pool') {\r\n                    return;\r\n                }\r\n                if (typeof value === 'object' && value !== null) {\r\n                    if (cache.indexOf(value) !== -1) {\r\n                        // Circular reference found, discard key\r\n                        return;\r\n                    }\r\n                    cache.push(value);\r\n                }\r\n                return value;\r\n            });\r\n            cache = null;\r\n            Cookie._set(name, json, days);\r\n        } catch (e) {\r\n            console.log('Cookie.set.error serializing', name, value, e);\r\n        }\r\n    };\r\n    Cookie.get = function (name) {\r\n        var cookieName = name + \"=\";\r\n        var ca = $window.document.cookie.split(';');\r\n        for (var i = 0; i < ca.length; i++) {\r\n            var c = ca[i];\r\n            while (c.charAt(0) == ' ') {\r\n                c = c.substring(1, c.length);\r\n            }\r\n            if (c.indexOf(cookieName) == 0) {\r\n                var value = c.substring(cookieName.length, c.length);\r\n                var model = null;\r\n                try {\r\n                    model = JSON.parse(value);\r\n                } catch (e) {\r\n                    console.log('Cookie.get.error parsing', key, e);\r\n                };\r\n                return model;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    Cookie.delete = function (name) {\r\n        Cookie._set(name, \"\", -1);\r\n    };\r\n    Cookie.on = function (name) {\r\n        var deferred = $q.defer();\r\n        var i, interval = 1000, elapsed = 0, timeout = Cookie.TIMEOUT;\r\n        function checkCookie() {\r\n            if (elapsed > timeout) {\r\n                deferred.reject('timeout');\r\n            } else {\r\n                var c = Cookie.get(name);\r\n                if (c) {\r\n                    deferred.resolve(c);\r\n                } else {\r\n                    elapsed += interval;\r\n                    i = setTimeout(checkCookie, interval);\r\n                }\r\n            }\r\n        }\r\n        checkCookie();\r\n        return deferred.promise;\r\n    };\r\n    return Cookie;\r\n}]);\r\n\r\napp.factory('LocalStorage', ['$q', '$window', 'Cookie', function ($q, $window, Cookie) {\r\n    function LocalStorage() {\r\n    }\r\n    function isLocalStorageSupported() {\r\n        var supported = false;\r\n        try {\r\n            supported = 'localStorage' in $window && $window['localStorage'] !== null;\r\n            if (supported) {\r\n                $window.localStorage.setItem('test', '1');\r\n                $window.localStorage.removeItem('test');\r\n            } else {\r\n                supported = false;\r\n            }\r\n        } catch (e) {\r\n            supported = false;\r\n        }\r\n        return supported;\r\n    }\r\n    LocalStorage.isSupported = isLocalStorageSupported();\r\n    if (LocalStorage.isSupported) {\r\n        LocalStorage.set = function (name, value) {\r\n            try {\r\n                var cache = [];\r\n                var json = JSON.stringify(value, function (key, value) {\r\n                    if (key === 'pool') {\r\n                        return;\r\n                    }\r\n                    if (typeof value === 'object' && value !== null) {\r\n                        if (cache.indexOf(value) !== -1) {\r\n                            // Circular reference found, discard key\r\n                            return;\r\n                        }\r\n                        cache.push(value);\r\n                    }\r\n                    return value;\r\n                });\r\n                cache = null;\r\n                $window.localStorage.setItem(name, json);\r\n            } catch (e) {\r\n                console.log('LocalStorage.set.error serializing', name, value, e);\r\n            }\r\n        };\r\n        LocalStorage.get = function (name) {\r\n            var value = null;\r\n            if ($window.localStorage[name] !== undefined) {\r\n                try {\r\n                    value = JSON.parse($window.localStorage[name]);\r\n                } catch (e) {\r\n                    console.log('LocalStorage.get.error parsing', name, e);\r\n                }\r\n            }\r\n            return value;\r\n        };\r\n        LocalStorage.delete = function (name) {\r\n            $window.localStorage.removeItem(name);\r\n        };\r\n        LocalStorage.on = function (name) {\r\n            var deferred = $q.defer();\r\n            var i, timeout = Cookie.TIMEOUT;\r\n            function storageEvent(e) {\r\n                // console.log('LocalStorage.on', name, e);\r\n                clearTimeout(i);\r\n                if (e.originalEvent.key == name) {\r\n                    try {\r\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\r\n                        deferred.resolve(value);\r\n                    } catch (e) {\r\n                        console.log('LocalStorage.on.error parsing', name, e);\r\n                        deferred.reject('error parsing ' + name);\r\n                    }\r\n                }\r\n            }\r\n            angular.element($window).on('storage', storageEvent);\r\n            i = setTimeout(function () {\r\n                deferred.reject('timeout');\r\n            }, timeout);\r\n            return deferred.promise;\r\n        };\r\n    } else {\r\n        console.log('LocalStorage.unsupported switching to cookies');\r\n        LocalStorage.set = Cookie.set;\r\n        LocalStorage.get = Cookie.get;\r\n        LocalStorage.delete = Cookie.delete;\r\n        LocalStorage.on = Cookie.on;\r\n    }\r\n    return LocalStorage;\r\n}]);\r\n\r\napp.factory('SessionStorage', ['$q', '$window', 'Cookie', function ($q, $window, Cookie) {\r\n    function SessionStorage() {\r\n    }\r\n    function isSessionStorageSupported() {\r\n        var supported = false;\r\n        try {\r\n            supported = 'sessionStorage' in $window && $window.sessionStorage !== undefined;\r\n            if (supported) {\r\n                $window.sessionStorage.setItem('test', '1');\r\n                $window.sessionStorage.removeItem('test');\r\n            } else {\r\n                supported = false;\r\n            }\r\n        } catch (e) {\r\n            supported = false;\r\n        }\r\n        return supported;\r\n    }\r\n    SessionStorage.isSupported = isSessionStorageSupported();\r\n    if (SessionStorage.isSupported) {\r\n        SessionStorage.set = function (name, value) {\r\n            try {\r\n                var cache = [];\r\n                var json = JSON.stringify(value, function (key, value) {\r\n                    if (key === 'pool') {\r\n                        return;\r\n                    }\r\n                    if (typeof value === 'object' && value !== null) {\r\n                        if (cache.indexOf(value) !== -1) {\r\n                            // Circular reference found, discard key\r\n                            return;\r\n                        }\r\n                        cache.push(value);\r\n                    }\r\n                    return value;\r\n                });\r\n                cache = null;\r\n                $window.sessionStorage.setItem(name, json);\r\n            } catch (e) {\r\n                console.log('SessionStorage.set.error serializing', name, value, e);\r\n            }\r\n        };\r\n        SessionStorage.get = function (name) {\r\n            var value = null;\r\n            if ($window.sessionStorage[name] !== undefined) {\r\n                try {\r\n                    value = JSON.parse($window.sessionStorage[name]);\r\n                } catch (e) {\r\n                    console.log('SessionStorage.get.error parsing', name, e);\r\n                }\r\n            }\r\n            return value;\r\n        };\r\n        SessionStorage.delete = function (name) {\r\n            $window.sessionStorage.removeItem(name);\r\n        };\r\n        SessionStorage.on = function (name) {\r\n            var deferred = $q.defer();\r\n            var i, timeout = Cookie.TIMEOUT;\r\n            function storageEvent(e) {\r\n                // console.log('SessionStorage.on', name, e);\r\n                clearTimeout(i);\r\n                if (e.originalEvent.key === name) {\r\n                    try {\r\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\r\n                        deferred.resolve(value);\r\n                    } catch (e) {\r\n                        console.log('SessionStorage.on.error parsing', name, e);\r\n                        deferred.reject('error parsing ' + name);\r\n                    }\r\n                }\r\n            }\r\n            angular.element($window).on('storage', storageEvent);\r\n            i = setTimeout(function () {\r\n                deferred.reject('timeout');\r\n            }, timeout);\r\n            return deferred.promise;\r\n        };\r\n    } else {\r\n        console.log('SessionStorage.unsupported switching to cookies');\r\n        SessionStorage.set = Cookie.set;\r\n        SessionStorage.get = Cookie.get;\r\n        SessionStorage.delete = Cookie.delete;\r\n        SessionStorage.on = Cookie.on;\r\n    }\r\n    return SessionStorage;\r\n}]);\r\n\r\napp.factory('Animate', [function () {\r\n    function Animate(callback, useTimeout) {\r\n        this.callback = callback;\r\n        this.isPlaying = false;\r\n        this.key = null;\r\n        this.ticks = 0;\r\n        this.useTimeout = useTimeout === true ? true : false;\r\n    }\r\n    Animate.prototype = {\r\n        play: function () {\r\n            var _this = this;\r\n            function loop(time) {\r\n                _this.ticks++;\r\n                _this.callback(time, _this.ticks);\r\n                if (this.useTimeout) {\r\n                    _this.key = window.setTimeout(loop, 1000 / 60);\r\n                } else {\r\n                    _this.key = window.requestAnimationFrame(loop);\r\n                }\r\n            }\r\n            if (!this.key) {\r\n                this.isPlaying = true;\r\n                loop();\r\n            }\r\n        },\r\n        pause: function () {\r\n            if (this.key) {\r\n                if (this.useTimeout) {\r\n                    window.clearTimeout(this.key);\r\n                } else {\r\n                    window.cancelAnimationFrame(this.key);\r\n                }\r\n                this.key = null;\r\n                this.isPlaying = false;\r\n            }\r\n        },\r\n        playpause: function () {\r\n            if (this.key) {\r\n                this.pause();\r\n            } else {\r\n                this.play();\r\n            }\r\n        }\r\n    }\r\n    return Animate;\r\n}]);\r\n\r\napp.factory('Md5', [function () {\r\n\r\n    var hex_chr = '0123456789abcdef'.split('');\r\n\r\n    function cycle(x, k) {\r\n        var a = x[0], b = x[1], c = x[2], d = x[3];\r\n\r\n        a = ff(a, b, c, d, k[0], 7, -680876936);\r\n        d = ff(d, a, b, c, k[1], 12, -389564586);\r\n        c = ff(c, d, a, b, k[2], 17, 606105819);\r\n        b = ff(b, c, d, a, k[3], 22, -1044525330);\r\n        a = ff(a, b, c, d, k[4], 7, -176418897);\r\n        d = ff(d, a, b, c, k[5], 12, 1200080426);\r\n        c = ff(c, d, a, b, k[6], 17, -1473231341);\r\n        b = ff(b, c, d, a, k[7], 22, -45705983);\r\n        a = ff(a, b, c, d, k[8], 7, 1770035416);\r\n        d = ff(d, a, b, c, k[9], 12, -1958414417);\r\n        c = ff(c, d, a, b, k[10], 17, -42063);\r\n        b = ff(b, c, d, a, k[11], 22, -1990404162);\r\n        a = ff(a, b, c, d, k[12], 7, 1804603682);\r\n        d = ff(d, a, b, c, k[13], 12, -40341101);\r\n        c = ff(c, d, a, b, k[14], 17, -1502002290);\r\n        b = ff(b, c, d, a, k[15], 22, 1236535329);\r\n\r\n        a = gg(a, b, c, d, k[1], 5, -165796510);\r\n        d = gg(d, a, b, c, k[6], 9, -1069501632);\r\n        c = gg(c, d, a, b, k[11], 14, 643717713);\r\n        b = gg(b, c, d, a, k[0], 20, -373897302);\r\n        a = gg(a, b, c, d, k[5], 5, -701558691);\r\n        d = gg(d, a, b, c, k[10], 9, 38016083);\r\n        c = gg(c, d, a, b, k[15], 14, -660478335);\r\n        b = gg(b, c, d, a, k[4], 20, -405537848);\r\n        a = gg(a, b, c, d, k[9], 5, 568446438);\r\n        d = gg(d, a, b, c, k[14], 9, -1019803690);\r\n        c = gg(c, d, a, b, k[3], 14, -187363961);\r\n        b = gg(b, c, d, a, k[8], 20, 1163531501);\r\n        a = gg(a, b, c, d, k[13], 5, -1444681467);\r\n        d = gg(d, a, b, c, k[2], 9, -51403784);\r\n        c = gg(c, d, a, b, k[7], 14, 1735328473);\r\n        b = gg(b, c, d, a, k[12], 20, -1926607734);\r\n\r\n        a = hh(a, b, c, d, k[5], 4, -378558);\r\n        d = hh(d, a, b, c, k[8], 11, -2022574463);\r\n        c = hh(c, d, a, b, k[11], 16, 1839030562);\r\n        b = hh(b, c, d, a, k[14], 23, -35309556);\r\n        a = hh(a, b, c, d, k[1], 4, -1530992060);\r\n        d = hh(d, a, b, c, k[4], 11, 1272893353);\r\n        c = hh(c, d, a, b, k[7], 16, -155497632);\r\n        b = hh(b, c, d, a, k[10], 23, -1094730640);\r\n        a = hh(a, b, c, d, k[13], 4, 681279174);\r\n        d = hh(d, a, b, c, k[0], 11, -358537222);\r\n        c = hh(c, d, a, b, k[3], 16, -722521979);\r\n        b = hh(b, c, d, a, k[6], 23, 76029189);\r\n        a = hh(a, b, c, d, k[9], 4, -640364487);\r\n        d = hh(d, a, b, c, k[12], 11, -421815835);\r\n        c = hh(c, d, a, b, k[15], 16, 530742520);\r\n        b = hh(b, c, d, a, k[2], 23, -995338651);\r\n\r\n        a = ii(a, b, c, d, k[0], 6, -198630844);\r\n        d = ii(d, a, b, c, k[7], 10, 1126891415);\r\n        c = ii(c, d, a, b, k[14], 15, -1416354905);\r\n        b = ii(b, c, d, a, k[5], 21, -57434055);\r\n        a = ii(a, b, c, d, k[12], 6, 1700485571);\r\n        d = ii(d, a, b, c, k[3], 10, -1894986606);\r\n        c = ii(c, d, a, b, k[10], 15, -1051523);\r\n        b = ii(b, c, d, a, k[1], 21, -2054922799);\r\n        a = ii(a, b, c, d, k[8], 6, 1873313359);\r\n        d = ii(d, a, b, c, k[15], 10, -30611744);\r\n        c = ii(c, d, a, b, k[6], 15, -1560198380);\r\n        b = ii(b, c, d, a, k[13], 21, 1309151649);\r\n        a = ii(a, b, c, d, k[4], 6, -145523070);\r\n        d = ii(d, a, b, c, k[11], 10, -1120210379);\r\n        c = ii(c, d, a, b, k[2], 15, 718787259);\r\n        b = ii(b, c, d, a, k[9], 21, -343485551);\r\n\r\n        x[0] = add32(a, x[0]);\r\n        x[1] = add32(b, x[1]);\r\n        x[2] = add32(c, x[2]);\r\n        x[3] = add32(d, x[3]);\r\n\r\n    }\r\n\r\n    function cmn(q, a, b, x, s, t) {\r\n        a = add32(add32(a, q), add32(x, t));\r\n        return add32((a << s) | (a >>> (32 - s)), b);\r\n    }\r\n\r\n    function ff(a, b, c, d, x, s, t) {\r\n        return cmn((b & c) | ((~b) & d), a, b, x, s, t);\r\n    }\r\n\r\n    function gg(a, b, c, d, x, s, t) {\r\n        return cmn((b & d) | (c & (~d)), a, b, x, s, t);\r\n    }\r\n\r\n    function hh(a, b, c, d, x, s, t) {\r\n        return cmn(b ^ c ^ d, a, b, x, s, t);\r\n    }\r\n\r\n    function ii(a, b, c, d, x, s, t) {\r\n        return cmn(c ^ (b | (~d)), a, b, x, s, t);\r\n    }\r\n\r\n    function md51(s) {\r\n        var txt = '';\r\n        var n = s.length,\r\n        state = [1732584193, -271733879, -1732584194, 271733878], i;\r\n        for (i = 64; i <= s.length; i += 64) {\r\n            cycle(state, md5blk(s.substring(i - 64, i)));\r\n        }\r\n        s = s.substring(i - 64);\r\n        var tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n        for (i = 0; i < s.length; i++)\r\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\r\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\r\n        if (i > 55) {\r\n            cycle(state, tail);\r\n            for (i = 0; i < 16; i++) tail[i] = 0;\r\n        }\r\n        tail[14] = n * 8;\r\n        cycle(state, tail);\r\n        return state;\r\n    }\r\n\r\n    /* there needs to be support for Unicode here,\r\n        * unless we pretend that we can redefine the MD-5\r\n        * algorithm for multi-byte characters (perhaps\r\n        * by adding every four 16-bit characters and\r\n        * shortening the sum to 32 bits). Otherwise\r\n        * I suggest performing MD-5 as if every character\r\n        * was two bytes--e.g., 0040 0025 = @%--but then\r\n        * how will an ordinary MD-5 sum be matched?\r\n        * There is no way to standardize text to something\r\n        * like UTF-8 before transformation; speed cost is\r\n        * utterly prohibitive. The JavaScript standard\r\n        * itself needs to look at this: it should start\r\n        * providing access to strings as preformed UTF-8\r\n        * 8-bit unsigned value arrays.\r\n        */\r\n    function md5blk(s) { /* I figured global was faster.   */\r\n        var md5blks = [], i; /* Andy King said do it this way. */\r\n        for (i = 0; i < 64; i += 4) {\r\n            md5blks[i >> 2] = s.charCodeAt(i)\r\n            + (s.charCodeAt(i + 1) << 8)\r\n            + (s.charCodeAt(i + 2) << 16)\r\n            + (s.charCodeAt(i + 3) << 24);\r\n        }\r\n        return md5blks;\r\n    }\r\n\r\n    function rhex(n) {\r\n        var s = '', j = 0;\r\n        for (; j < 4; j++)\r\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F]\r\n            + hex_chr[(n >> (j * 8)) & 0x0F];\r\n        return s;\r\n    }\r\n\r\n    function hex(x) {\r\n        for (var i = 0; i < x.length; i++)\r\n            x[i] = rhex(x[i]);\r\n        return x.join('');\r\n    }\r\n\r\n    /* this function is much faster,\r\n    so if possible we use it. Some IEs\r\n    are the only ones I know of that\r\n    need the idiotic second function,\r\n    generated by an if clause.  */\r\n    function add32(a, b) {\r\n        return (a + b) & 0xFFFFFFFF;\r\n    }\r\n\r\n    function Md5() { }\r\n    Md5.encode = function (string) {\r\n        return hex(md51(string));\r\n    }\r\n    if (Md5.encode('hello') !== '5d41402abc4b2a76b9719d911017c592') {\r\n        add32 = function (x, y) {\r\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\r\n            msw = (x >> 16) + (y >> 16) + (lsw >> 16);\r\n            return (msw << 16) | (lsw & 0xFFFF);\r\n        }\r\n    }\r\n    return Md5;\r\n}]);\r\n\r\napp.factory('Utils', ['$compile', '$controller', 'Vector', 'Md5', function ($compile, $controller, Vector, Md5) {\r\n    (function () {\r\n        // POLYFILL window.requestAnimationFrame\r\n        var lastTime = 0;\r\n        var vendors = ['ms', 'moz', 'webkit', 'o'];\r\n        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\r\n            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame']\r\n                                       || window[vendors[x] + 'CancelRequestAnimationFrame'];\r\n        }\r\n        if (!window.requestAnimationFrame) {\r\n            window.requestAnimationFrame = function (callback, element) {\r\n                var currTime = new Date().getTime();\r\n                var timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n                var id = window.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\r\n                lastTime = currTime + timeToCall;\r\n                return id;\r\n            };\r\n        }\r\n        if (!window.cancelAnimationFrame) {\r\n            window.cancelAnimationFrame = function (id) {\r\n                clearTimeout(id);\r\n            };\r\n        }\r\n    }());\r\n    (function () {\r\n        // POLYFILL Array.prototype.reduce\r\n        // Production steps of ECMA-262, Edition 5, 15.4.4.21\r\n        // Reference: http://es5.github.io/#x15.4.4.21\r\n        // https://tc39.github.io/ecma262/#sec-array.prototype.reduce\r\n        if (!Array.prototype.reduce) {\r\n            Object.defineProperty(Array.prototype, 'reduce', {\r\n                value: function (callback) {// , initialvalue\r\n                    if (this === null) {\r\n                        throw new TypeError('Array.prototype.reduce called on null or undefined');\r\n                    }\r\n                    if (typeof callback !== 'function') {\r\n                        throw new TypeError(callback + ' is not a function');\r\n                    }\r\n                    var o = Object(this);\r\n                    var len = o.length >>> 0;\r\n                    var k = 0;\r\n                    var value;\r\n                    if (arguments.length == 2) {\r\n                        value = arguments[1];\r\n                    } else {\r\n                        while (k < len && !(k in o)) {\r\n                            k++;\r\n                        }\r\n                        if (k >= len) {\r\n                            throw new TypeError('Reduce of empty array with no initial value');\r\n                        }\r\n                        value = o[k++];\r\n                    }\r\n                    while (k < len) {\r\n                        if (k in o) {\r\n                            value = callback(value, o[k], k, o);\r\n                        }\r\n                        k++;\r\n                    }\r\n                    return value;\r\n                }\r\n            });\r\n        }\r\n    }());\r\n    var _isTouch;\r\n    function isTouch() {\r\n        if (!_isTouch) {\r\n            _isTouch = {\r\n                value: ('ontouchstart' in window || 'onmsgesturechange' in window)\r\n            }\r\n        }\r\n        // console.log(_isTouch);\r\n        return _isTouch.value;\r\n    }\r\n    function getTouch(e, previous) {\r\n        var t = new Vector();\r\n        if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {\r\n            var touch = null;\r\n            var event = e.originalEvent ? e.originalEvent : e;\r\n            var touches = event.touches.length ? event.touches : event.changedTouches;\r\n            if (touches && touches.length) {\r\n                touch = touches[0];\r\n            }\r\n            if (touch) {\r\n                t.x = touch.pageX;\r\n                t.y = touch.pageY;\r\n            }\r\n        } else if (e.type == 'click' || e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {\r\n            t.x = e.pageX;\r\n            t.y = e.pageY;\r\n        }\r\n        if (previous) {\r\n            t.s = Vector.difference(previous, t);\r\n        }\r\n        t.type = e.type;\r\n        return t;\r\n    }\r\n    function getRelativeTouch(element, point) {\r\n        var rect = element[0].getBoundingClientRect();\r\n        var e = new Vector(rect.left, rect.top);\r\n        return Vector.difference(e, point);\r\n    }\r\n    function getClosest(el, selector) {\r\n        var matchesFn, parent;\r\n        ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function (fn) {\r\n            if (typeof document.body[fn] == 'function') {\r\n                matchesFn = fn;\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        if (el[matchesFn](selector)) {\r\n            return el;\r\n        }\r\n        while (el !== null) {\r\n            parent = el.parentElement;\r\n            if (parent !== null && parent[matchesFn](selector)) {\r\n                return parent;\r\n            }\r\n            el = parent;\r\n        }\r\n        return null;\r\n    }\r\n    function getClosestElement(el, target) {\r\n        var matchesFn, parent;\r\n        if (el === target) {\r\n            return el;\r\n        }\r\n        while (el !== null) {\r\n            parent = el.parentElement;\r\n            if (parent !== null && parent === target) {\r\n                return parent;\r\n            }\r\n            el = parent;\r\n        }\r\n        return null;\r\n    }\r\n    var getNow = Date.now || function () {\r\n        return new Date().getTime();\r\n    };\r\n    function throttle(func, wait, options) {\r\n        // Returns a function, that, when invoked, will only be triggered at most once\r\n        // during a given window of time. Normally, the throttled function will run\r\n        // as much as it can, without ever going more than once per `wait` duration;\r\n        // but if you'd like to disable the execution on the leading edge, pass\r\n        // `{leading: false}`. To disable execution on the trailing edge, ditto.\r\n        var context, args, result;\r\n        var timeout = null;\r\n        var previous = 0;\r\n        if (!options) options = {};\r\n        var later = function () {\r\n            previous = options.leading === false ? 0 : getNow();\r\n            timeout = null;\r\n            result = func.apply(context, args);\r\n            if (!timeout) context = args = null;\r\n        };\r\n        return function () {\r\n            var now = getNow();\r\n            if (!previous && options.leading === false) previous = now;\r\n            var remaining = wait - (now - previous);\r\n            context = this;\r\n            args = arguments;\r\n            if (remaining <= 0 || remaining > wait) {\r\n                if (timeout) {\r\n                    clearTimeout(timeout);\r\n                    timeout = null;\r\n                }\r\n                previous = now;\r\n                result = func.apply(context, args);\r\n                if (!timeout) context = args = null;\r\n            } else if (!timeout && options.trailing !== false) {\r\n                timeout = setTimeout(later, remaining);\r\n            }\r\n            return result;\r\n        };\r\n    }\r\n    function where(array, query) {\r\n        var found = null;\r\n        if (array) {\r\n            angular.forEach(array, function (item) {\r\n                var has = true;\r\n                angular.forEach(query, function (value, key) {\r\n                    has = has && item[key] === value;\r\n                });\r\n                if (has) {\r\n                    found = item;\r\n                }\r\n            });\r\n        }\r\n        return found;\r\n    }\r\n    function compileController(scope, element, html, data) {\r\n        // console.log('Utils.compileController', element);\r\n        element.html(html);\r\n        var link = $compile(element.contents());\r\n        if (data.controller) {\r\n            var $scope = scope.$new();\r\n            angular.extend($scope, data);\r\n            var controller = $controller(data.controller, { $scope: $scope });\r\n            if (data.controllerAs) {\r\n                scope[data.controllerAs] = controller;\r\n            }\r\n            element.data('$ngControllerController', controller);\r\n            element.children().data('$ngControllerController', controller);\r\n            scope = $scope;\r\n        }\r\n        link(scope);\r\n    }\r\n    var ua = window.navigator.userAgent.toLowerCase();\r\n    var safari = ua.indexOf('safari') !== -1 && ua.indexOf('chrome') === -1;\r\n    var msie = ua.indexOf('trident') !== -1 || ua.indexOf('edge') !== -1 || ua.indexOf('msie') !== -1;\r\n    var chrome = !safari && !msie && ua.indexOf('chrome') !== -1;\r\n    var mobile = ua.indexOf('mobile') !== -1;\r\n    function Utils() {\r\n    }\r\n    function reverseSortOn(key) {\r\n        return function (a, b) {\r\n            if (a[key] < b[key]) {\r\n                return 1;\r\n            }\r\n            if (a[key] > b[key]) {\r\n                return -1;\r\n            }\r\n            // a must be equal to b\r\n            return 0;\r\n        }\r\n    }\r\n    function format(string, prepend, expression) {\r\n        string = string || '';\r\n        prepend = prepend || '';\r\n        var splitted = string.split(',');\r\n        if (splitted.length > 1) {\r\n            var formatted = splitted.shift();\r\n            angular.forEach(splitted, function (value, index) {\r\n                if (expression) {\r\n                    formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\r\n                } else {\r\n                    formatted = formatted.split('{' + index + '}').join(prepend + value);\r\n                }\r\n            });\r\n            if (expression) {\r\n                return '\\'' + formatted + '\\'';\r\n            } else {\r\n                return formatted;\r\n            }\r\n        } else {\r\n            return prepend + string;\r\n        }\r\n    }\r\n    function reducer(o, key) {\r\n        return o[key];\r\n    }\r\n    function reducerSetter(o, key, value) {\r\n        if (typeof key == 'string') {\r\n            return reducerSetter(o, key.split('.'), value);\r\n        } else if (key.length == 1 && value !== undefined) {\r\n            return o[key[0]] = value;\r\n        } else if (key.length == 0) {\r\n            return o;\r\n        } else {\r\n            return reducerSetter(o[key[0]], key.slice(1), value);\r\n        }\r\n    }\r\n    function reducerAdder(o, key, value) {\r\n        if (typeof key == 'string') {\r\n            return reducerAdder(o, key.split('.'), value);\r\n        } else if (key.length == 1 && value !== undefined) {\r\n            return (o[key[0]] += value);\r\n        } else if (key.length == 0) {\r\n            return o;\r\n        } else {\r\n            return reducerAdder(o[key[0]], key.slice(1), value);\r\n        }\r\n    }\r\n    Utils.reverseSortOn = reverseSortOn;\r\n    Utils.getTouch = getTouch;\r\n    Utils.getRelativeTouch = getRelativeTouch;\r\n    Utils.getClosest = getClosest;\r\n    Utils.getClosestElement = getClosestElement;\r\n    Utils.throttle = throttle;\r\n    Utils.where = where;\r\n    Utils.format = format;\r\n    Utils.compileController = compileController;\r\n    Utils.reducer = reducer;\r\n    Utils.reducerSetter = reducerSetter;\r\n    Utils.reducerAdder = reducerAdder;\r\n    Utils.toMd5 = function (string) {\r\n        return Md5.encode(string);\r\n    };\r\n    Utils.ua = {\r\n        safari: safari,\r\n        msie: msie,\r\n        chrome: chrome,\r\n        mobile: mobile,\r\n    };\r\n    angular.forEach(Utils.ua, function (value, key) {\r\n        if (value) {\r\n            angular.element(document.getElementsByTagName('body')).addClass(key);\r\n        }\r\n    });\r\n    return Utils;\r\n}]);\r\n\r\napp.factory('State', ['$timeout', function ($timeout) {\r\n    function State() {\r\n        this.isReady = false;\r\n        this.idle();\r\n    }\r\n    State.prototype = {\r\n        idle: function () {\r\n            this.isBusy = false;\r\n            this.isError = false;\r\n            this.isErroring = false;\r\n            this.isSuccess = false;\r\n            this.isSuccessing = false;\r\n            this.button = null;\r\n            this.errors = [];\r\n        },\r\n        enabled: function () {\r\n            return !this.isBusy && !this.isErroring && !this.isSuccessing;\r\n        },\r\n        busy: function () {\r\n            if (!this.isBusy) {\r\n                this.isBusy = true;\r\n                this.isError = false;\r\n                this.isErroring = false;\r\n                this.isSuccess = false;\r\n                this.isSuccessing = false;\r\n                this.errors = [];\r\n                // console.log('State.busy', this);\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n        success: function () {\r\n            this.isBusy = false;\r\n            this.isError = false;\r\n            this.isErroring = false;\r\n            this.isSuccess = true;\r\n            this.isSuccessing = true;\r\n            this.errors = [];\r\n            $timeout(function () {\r\n                this.isSuccessing = false;\r\n                this.button = null;\r\n            }.bind(this), 1000);\r\n        },\r\n        error: function (error) {\r\n            this.isBusy = false;\r\n            this.isError = true;\r\n            this.isErroring = true;\r\n            this.isSuccess = false;\r\n            this.isSuccessing = false;\r\n            this.errors.push(error);\r\n            $timeout(function () {\r\n                this.isErroring = false;\r\n                this.button = null;\r\n            }.bind(this), 1000);\r\n        },\r\n        ready: function () {\r\n            this.isReady = true;\r\n            this.success();\r\n        },\r\n        errorMessage: function () {\r\n            return this.isError ? this.errors[this.errors.length - 1] : null;\r\n        },\r\n        submitClass: function () {\r\n            return {\r\n                busy: this.isBusy,\r\n                ready: this.isReady,\r\n                successing: this.isSuccessing,\r\n                success: this.isSuccess,\r\n                errorring: this.isErroring,\r\n                error: this.isError,\r\n            };\r\n        },\r\n        submitMessage: function (idleMessage, busyMessage, successMessage, errorMessage) {\r\n            idleMessage = idleMessage || 'Submit';\r\n            if (this.isBusy) {\r\n                return busyMessage || idleMessage;\r\n            } else if (this.isSuccess) {\r\n                return successMessage || idleMessage;\r\n            } else if (this.isError) {\r\n                return errorMessage || idleMessage;\r\n            } else {\r\n                return idleMessage;\r\n            }\r\n        },\r\n    };\r\n    return State;\r\n}]);\r\n\r\napp.factory('DataFilter', ['$filter', function ($filter) {\r\n    function DataFilter(data) {\r\n        /*\r\n        this.dateFrom = null;\r\n        this.dateTo = null;\r\n        this.search = null;\r\n        this.status = null;\r\n        this.sort = null;\r\n        */\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    DataFilter.prototype = {\r\n        getObjectParams: function (obj) {\r\n            var a = [];\r\n            if (obj) {\r\n                for (var p in obj) {\r\n                    a.push({ name: p, value: obj[p] });\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        getParams: function (source) {\r\n            var post = {}, value;\r\n            for (var p in this) {\r\n                switch (p) {\r\n                    case 'dateFrom':\r\n                    case 'dateTo':\r\n                    case 'status':\r\n                        value = this[p];\r\n                        if (value !== undefined) {\r\n                            post[p] = value;\r\n                        }\r\n                        break;\r\n                    case 'search':\r\n                    case 'sort':\r\n                        var json = JSON.stringify(this.getObjectParams(this[p]), null, '');\r\n                        post[p] = window.btoa(json);\r\n                        break;\r\n                }\r\n            }\r\n            if (!source.unpaged) {\r\n                post.page = source.page;\r\n                post.size = source.size;\r\n            }\r\n            // console.log('DataFilter.getParams', post);\r\n            return post;\r\n        },\r\n        getMonths: function () {\r\n            var months = [];\r\n            if (this.dateFrom && this.dateTo) {\r\n                var range = [this.dateFrom, this.dateTo];\r\n                range = range.sort(function (a, b) {\r\n                    return a.getTime() - b.getTime();\r\n                });\r\n                function monthDiff(a, b) {\r\n                    var months;\r\n                    months = (b.getFullYear() - a.getFullYear()) * 12;\r\n                    months -= a.getMonth() + 1;\r\n                    months += b.getMonth() + 1; // we should add + 1 to get correct month number\r\n                    months ++;\r\n                    // console.log(months);\r\n                    return months <= 0 ? 0 : months;\r\n                }\r\n                var diff = Math.max(1, monthDiff(range[0], range[1]));\r\n                // console.log('getMonths', range[0], range[1], diff);\r\n                var i = 0;\r\n                while (i < diff) {\r\n                    var date = new Date(range[0].getFullYear(), range[0].getMonth() + i, 1);\r\n                    months.push({\r\n                        id: date.getTime(),\r\n                        name: $filter('date')(date, '(yyyy MM) MMMM'),\r\n                        nameShort: $filter('date')(date, 'MMM yy'),\r\n                    });\r\n                    i++;\r\n                };\r\n            }\r\n            return months;\r\n        },\r\n    };\r\n    return DataFilter;\r\n}]);\r\n\r\napp.factory('DataSource', ['$q', '$http', '$rootScope', '$location', 'LocalStorage', 'State', 'DataFilter', function ($q, $http, $rootScope, $location, storage, State, DataFilter) {\r\n    var PAGES_FIRST = 1;\r\n    var PAGES_SIZE = 7;\r\n    var PAGES_MAX = Number.POSITIVE_INFINITY;\r\n    function DataSource(data) {\r\n        this.state = new State();\r\n        this.page = PAGES_FIRST;\r\n        this.size = PAGES_SIZE;\r\n        this.pages = PAGES_MAX;\r\n        this.count = 0;\r\n        this.maxPages = 10;\r\n        this.items = [];\r\n        this.rows = [];\r\n        this.allrows = [];\r\n        this.steps = [];\r\n        this.filters = new DataFilter({});\r\n        this.uri = '/api/items/paging';\r\n        this.unpaged = false; // if true skip pagination\r\n        data ? angular.extend(this, data) : null;        \r\n    }\r\n    DataSource.prototype = {\r\n        resolve: function (deferred) {\r\n            angular.forEach(this.response.data, function (item) {\r\n                this.push(item);\r\n            }, this.rows);\r\n            deferred.resolve();\r\n        },\r\n        group: function (deferred) {\r\n            deferred.resolve();\r\n        },\r\n        next: function ($d) {\r\n            if (this.steps.length) {\r\n                var deferred = $q.defer();\r\n                deferred.promise.then(function (response) {\r\n                    this.next($d);\r\n                }.bind(this), function (response) {\r\n                    this.error(response);\r\n                }.bind(this));\r\n                var step = this.steps.shift();\r\n                step.call(this, deferred);\r\n            } else {\r\n                $d.resolve();\r\n            }\r\n        },\r\n        when: function () {\r\n            var deferred = $q.defer();\r\n            angular.forEach(Array.prototype.slice.call(arguments), function(step) {\r\n                this.push(step);\r\n            }, this.steps);\r\n            this.next(deferred);\r\n            return deferred.promise;\r\n        },\r\n        unallowed: function (error) {\r\n            this.deferred.reject(error);\r\n            this.deferred = null;\r\n            this.state.error(error);\r\n            $location.$$lastRequestedPath = $location.path(); // $route.current.$$route.originalPath;\r\n            $location.path('/signin');\r\n        },\r\n        error: function (response) {\r\n            // typeof (err) === \"string\" ? err = { status: status } : (err == null ? err = { status: status } : err.status = status);\r\n            var error = response ? { message: response.data ? response.data.message : \"error\", status: response.status } : null;\r\n            if (error.message === 'ERROR_NOT_ALLOWED') {\r\n                var q = storage.get('q');\r\n                console.log('onError', error, 'q', q);\r\n                this.unallowed(error);\r\n            } else {\r\n                this.deferred.reject(error);\r\n                this.deferred = null;\r\n                this.state.error(error);\r\n            }\r\n        },\r\n        parseHeader: function () {\r\n            var responseHeader = this.response.headers('X-Pagination');\r\n            var responseView = responseHeader ? JSON.parse(responseHeader) : null;\r\n            if (responseView) {\r\n                this.page = responseView.page;\r\n                this.size = responseView.size;\r\n                this.count = responseView.count;\r\n                this.pages = responseView.pages;\r\n            } else {\r\n                this.page = PAGES_FIRST;\r\n                this.size = this.size || PAGES_SIZE;\r\n                this.count = this.response.data.length;\r\n                this.pages = Math.ceil(this.count / this.size);\r\n            }\r\n            this.pagination = this.getPages();\r\n        },\r\n        getUri: function () {\r\n            return angular.isFunction(this.uri) ? this.uri() : this.uri;\r\n        },\r\n        getParams: function () {\r\n            return { params: this.filters.getParams(this) };\r\n        },\r\n        get: function () {\r\n            $http.get(this.getUri(), this.getParams()).then(function (response) {\r\n                this.rows.length = 0;\r\n                this.items.length = 0;\r\n                this.response = response;\r\n                this.parseHeader();\r\n                this.when(this.resolve, this.group).then(function () {\r\n                    this.allrows = this.allrows.concat(this.rows);\r\n                    $rootScope.$broadcast('onDataSourceUpdate', this);\r\n                    this.state.success();\r\n                    this.deferred.resolve(this.rows);\r\n                    this.deferred = null;\r\n                }.bind(this));\r\n            }.bind(this), function (response) {\r\n                this.error(response);\r\n            }.bind(this));\r\n        },\r\n        update: function ($d) {\r\n            this.items = [];\r\n            if (this.state.busy()) {\r\n                this.when(this.group).then(function () {\r\n                    this.state.success();\r\n                }.bind(this));\r\n            }\r\n        },\r\n        paging: function ($d) {\r\n            var deferred = this.deferred = ($d || $q.defer());\r\n            if ((this.page <= this.pages || $d !== undefined) && this.state.busy()) {\r\n                this.opened = null;\r\n                this.get();\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        filter: function () {\r\n            var deferred = $q.defer();\r\n            this.allrows = [];\r\n            this.paging(deferred);\r\n            return deferred.promise;\r\n        },\r\n        add: function (item) {\r\n            this.rows.push(item);\r\n            this.allrows.push(item);\r\n            this.update();\r\n            this.count++;\r\n            this.pages = Math.ceil(this.count / this.size);\r\n        },\r\n        remove: function (item) {\r\n            var i = this.rows.indexOf(item);\r\n            if (i !== -1) {\r\n                this.rows.splice(i, 1);\r\n            }\r\n            i = this.allrows.indexOf(item);\r\n            if (i !== -1) {\r\n                this.allrows.splice(i, 1);\r\n            }\r\n            this.update();\r\n            this.count--;\r\n            this.pages = Math.ceil(this.count / this.size);\r\n        },\r\n        prevPage: function () {\r\n            var page = this.page - 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        nextPage: function () {\r\n            var page = this.page + 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        gotoPage: function (page) {\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        firstPage: function () {\r\n            if (this.page !== 1) {\r\n                this.page = 1;\r\n                this.paging();\r\n            }\r\n        },\r\n        lastPage: function () {\r\n            if (this.page !== this.pages) {\r\n                this.page = this.pages;\r\n                this.paging();\r\n            }\r\n        },\r\n        hasMany: function () {\r\n            return this.pages > this.maxPages;\r\n        },\r\n        hasMorePagesBehind: function () {\r\n            var startingIndex = Math.max(0, this.page - this.maxPages);\r\n            return startingIndex > 0;\r\n        },\r\n        hasMorePagesNext: function () {\r\n            var endingIndex = Math.max(0, this.page - this.maxPages) + this.maxPages;\r\n            return endingIndex < this.pages;\r\n        },\r\n        isPage: function (number) {\r\n            return this.page === number;\r\n        },\r\n        hasPages: function () {\r\n            return this.pages > 0 && this.pages < PAGES_MAX;\r\n        },\r\n        getPages: function () {\r\n            var a = [], i;\r\n            if (this.hasPages()) {\r\n                var startingIndex = Math.max(0, this.page - this.maxPages);\r\n                var endingIndex = Math.min(this.pages, startingIndex + this.maxPages);\r\n                i = startingIndex;\r\n                while (i < endingIndex) {\r\n                    a.push({ number: (i + 1) });\r\n                    i++;\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        openClose: function (index) {\r\n            if (this.opened === index) {\r\n                this.opened = null;\r\n            } else {\r\n                this.opened = index;\r\n            }\r\n        },\r\n        setSort: function (key, sort) {\r\n            var deferred = $q.defer();\r\n            if (!this.state.isBusy) {\r\n                this.filters.sort = {};\r\n                this.filters.sort[key] = sort;\r\n                if (angular.isFunction(this.sort)) {\r\n                    this.sort(this);\r\n                    deferred.resolve(this.rows);\r\n                } else {\r\n                    this.allrows = [];\r\n                    this.paging(deferred);\r\n                }\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        getSort: function (key) {\r\n            if (this.filters.sort) {\r\n                return this.filters.sort[key] || 0;\r\n            } else {\r\n                return 0;\r\n            }\r\n        },\r\n        hasSort: function () {\r\n            if (this.filters.sort) {\r\n                var has = false;\r\n                angular.forEach(this.filters.sort, function (value) {\r\n                    has = has || value;\r\n                });\r\n                return has;\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n        setSearch: function (key, search) {\r\n            var deferred = $q.defer();\r\n            if (!this.state.isBusy) {\r\n                this.filters.search = {};\r\n                if (search && search !== '') {\r\n                    this.filters.search[key] = search;\r\n                }\r\n                if (angular.isFunction(this.search)) {\r\n                    this.search(this);\r\n                    deferred.resolve(this.rows);\r\n                } else {\r\n                    this.allrows = [];\r\n                    this.paging(deferred);\r\n                }\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        getSearch: function (key) {\r\n            if (this.filters.search) {\r\n                return this.filters.search[key] || 0;\r\n            } else {\r\n                return 0;\r\n            }\r\n        },\r\n        hasSearch: function () {\r\n            if (this.filters.search) {\r\n                var has = false;\r\n                angular.forEach(this.filters.search, function (value) {\r\n                    has = has || (value && value !== '');\r\n                });\r\n                return has;\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n        setDateFrom: function (date) {\r\n            var deferred = $q.defer();\r\n            if (!this.state.isBusy) {\r\n                this.filters.dateFrom = date || '';\r\n                if (angular.isFunction(this.dateFrom)) {\r\n                    this.dateFrom(this);\r\n                    deferred.resolve(this.rows);\r\n                } else {\r\n                    this.allrows = [];\r\n                    this.paging(deferred);\r\n                }\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        getDateFrom: function () {\r\n            return this.filters.dateFrom || null;\r\n        },\r\n        setDateTo: function (date) {\r\n            var deferred = $q.defer();\r\n            if (!this.state.isBusy) {\r\n                this.filters.dateTo = date || '';\r\n                if (angular.isFunction(this.dateTo)) {\r\n                    this.dateTo(this);\r\n                    deferred.resolve(this.rows);\r\n                } else {\r\n                    this.allrows = [];\r\n                    this.paging(deferred);\r\n                }\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        getDateTo: function () {\r\n            return this.filters.dateTo || null;\r\n        },\r\n        setDates: function (from, to) {\r\n            var deferred = $q.defer();\r\n            if (!this.state.isBusy) {\r\n                this.filters.dateFrom = from || '';\r\n                this.filters.dateTo = to || '';\r\n                this.allrows = [];\r\n                this.paging(deferred);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n    };\r\n    return DataSource;\r\n}]);\r\n\r\napp.factory('Column', ['$parse', '$filter', 'Utils', 'colTypes', function ($parse, $filter, Utils, colTypes) {        \r\n    function Column(data) {\r\n        data ? angular.extend(this, data) : null;\r\n        // PREPARE GETTER SETTERS\r\n        if (angular.isFunction(this.value)) {\r\n            this.value = this.value.bind(this);\r\n        }\r\n        this.raw = this.raw || this.value;\r\n        this.source = this.source || this.value;\r\n        this.getters = {};\r\n        var fields = ['key', 'value', 'raw', 'source', 'post'];\r\n        angular.forEach(fields, function (field) {\r\n            if (this[field]) {\r\n                this.getters[field] = angular.isFunction(this[field]) ? this[field] : $parse(this[field]);\r\n            }\r\n        }, this);\r\n        this.setters = {};\r\n        angular.forEach(this.getters, function (getter, key) {\r\n            if (!angular.isFunction(this[key])) {\r\n                this.setters[key] = getter.assign;\r\n            }\r\n        }, this);\r\n        // PREPARE GETTER SETTERS\r\n        this.reset();\r\n    }\r\n    Column.prototype = {\r\n        getKey: function (item) {\r\n            return this.getters.key(item);\r\n        },\r\n        getValue: function (item) {\r\n            return this.getters.value(item);\r\n        },\r\n        getRaw: function (item) {\r\n            return this.getters.raw(item);\r\n        },\r\n        getSource: function (item) {\r\n            return this.getters.source(item);\r\n        },\r\n        reset: function () {\r\n            this.values = [];\r\n            this.keys = {};\r\n            this.search = [];\r\n            this.total = 0;\r\n        },\r\n        hasKey: function (item) {\r\n            var has = true;\r\n            var key = this.getKey(item);\r\n            if (key && this.keys[key] != true) {\r\n                this.keys[key] = true;\r\n                has = false;\r\n            }\r\n            return has;\r\n        },\r\n        initValue: function (item) {\r\n            this.setters.raw(item, (this.getters.value(item) || 0));\r\n            return this;\r\n        },\r\n        addTotal: function (item, row) {\r\n            this.setters.raw(item, (this.getters.raw(item) || 0) + (this.getters.value(row) || 0));\r\n            return this;\r\n        },\r\n        addCount: function (item, row) {\r\n            if (!this.hasKey(row) && this.setters.raw) {\r\n                var v = null;\r\n                if (item != row) {\r\n                    v = (this.getters.raw(item) || 0) + 1;\r\n                } else {\r\n                    v = 1;                    \r\n                }\r\n                this.setters.raw(item, v);\r\n            }\r\n            return this;\r\n        },\r\n        addValue: function (item) {\r\n            this.values = this.values || [];\r\n            var key = this.getKey(item);\r\n            var has = false;\r\n            angular.forEach(this.values, function (v) {\r\n                if (v.id == key) {\r\n                    has = true;\r\n                }\r\n            })\r\n            if (!has) {\r\n                var value = this.getRaw(item);\r\n                this.values.push({\r\n                    id: key,\r\n                    name: value || '-',\r\n                });\r\n            }\r\n        },\r\n        getValueTotal: function (filtered) {\r\n            var value = 0;\r\n            if (this.compare && this.type === colTypes.INCREMENT) {\r\n                var current = 0; // (col.getters.raw(item) || 0);\r\n                var previous = 0; // (this.getters.raw(item) || 0);                \r\n                angular.forEach(filtered, function (item) {\r\n                    current += (this.col.getters.raw(item) || 0);\r\n                    previous += (this.getters.raw(item) || 0);\r\n                }.bind(this));\r\n                if (previous) {\r\n                    value = (current - previous) / previous * 100;\r\n                }\r\n            } else {\r\n                angular.forEach(filtered, function (item) {\r\n                    value += this.getRaw(item) || 0;\r\n                }.bind(this));\r\n            }\r\n            this.total = value;\r\n            return value;\r\n        },\r\n        getValueFormatted: function (item) {\r\n            var value = this.getRaw(item);\r\n            switch (this.type) {\r\n                case colTypes.RESOURCE:\r\n                case colTypes.DISABLED:\r\n                    value = $filter('shortName')(value);\r\n                    break;\r\n                case colTypes.ID:\r\n                case colTypes.NUMBER:\r\n                    value = $filter('customNumber')(value, 0);\r\n                    break;\r\n                case colTypes.DOUBLE:\r\n                    value = $filter('customNumber')(value, 2);\r\n                    break;\r\n                case colTypes.WEEKS:\r\n                    value = $filter('customNumber')(value, 2, ' W');\r\n                    break;\r\n                case colTypes.DATE:\r\n                    value = $filter('date')(value, 'yyyy-MM-dd');\r\n                    break;\r\n                case colTypes.HOURS:\r\n                    value = $filter('customNumber')(value, 0, ' H');\r\n                    break;\r\n                case colTypes.COSTS:\r\n                    value = $filter('customNumber')(value, 0, ' €');\r\n                    break;\r\n                case colTypes.PERCENT:\r\n                    value = $filter('customNumber')(value, 2, ' %');\r\n                    break;\r\n                case colTypes.INCREMENT:\r\n                    value = angular.isNumber(value) ? (value > 0 ? '+' : '') + $filter('customNumber')(value, 2, ' %') : (value || '-');\r\n                    break;\r\n            }\r\n            return value;\r\n        },\r\n        getFormatted: function (item) {\r\n            if (this.dynamic) {\r\n                return this.getValueFormatted(item);\r\n            } else {\r\n                return item.static[this.id].value;\r\n            }\r\n        },\r\n        getTotal: function (filtered) {\r\n            var value = this.getValueTotal(filtered);\r\n            switch (this.type) {\r\n                case colTypes.NUMBER:\r\n                    value = $filter('customNumber')(value, 0);\r\n                    break;\r\n                case colTypes.DOUBLE:\r\n                    value = $filter('customNumber')(value, 2);\r\n                    break;\r\n                case colTypes.WEEKS:\r\n                    value = $filter('customNumber')(value, 2, ' W');\r\n                    break;\r\n                case colTypes.HOURS:\r\n                    value = $filter('customNumber')(value, 0, ' H');\r\n                    break;\r\n                case colTypes.COSTS:\r\n                    value = $filter('customNumber')(value, 0, ' €');\r\n                    break;\r\n                case colTypes.PERCENT:\r\n                    value = $filter('customNumber')(value, 2, ' %');\r\n                    break;\r\n                case colTypes.INCREMENT:\r\n                    value = angular.isNumber(value) ? (value > 0 ? '+' : '') + $filter('customNumber')(value, 2, ' %') : (value || '-');\r\n                    break;\r\n            }\r\n            return value;\r\n        },\r\n        getFormat: function () {\r\n            var format = '';\r\n            switch (this.type) {\r\n                case colTypes.ID:\r\n                case colTypes.NUMBER:\r\n                    format = '#';\r\n                    break;\r\n                case colTypes.DOUBLE:\r\n                    format = '#';\r\n                    break;\r\n                case colTypes.DATE:\r\n                    format = 'yyyy-mm-dd';\r\n                    break;\r\n                case colTypes.WEEKS:\r\n                    format = '#,###0 [$W]';\r\n                    break;\r\n                case colTypes.HOURS:\r\n                    format = '#,###0 [$H]';\r\n                    break;\r\n                case colTypes.COSTS:\r\n                    format = '#,###.00 €';\r\n                    break;\r\n                case colTypes.PERCENT:                \r\n                    format = '0.00%';\r\n                    break;\r\n                case colTypes.INCREMENT:\r\n                    format = '[Color 10]+0.00%;[Red]-0.00%;-';\r\n                    break;\r\n            }\r\n            return format;\r\n        },\r\n        getLink: function (item) {\r\n            return angular.isFunction(this.link) ? this.link(item) : null;\r\n        },\r\n        getHeaderClass: function () {\r\n            var cc = [];\r\n            angular.forEach(this, function (value, key) {\r\n                if (value === true) {\r\n                    cc.push(key);\r\n                }\r\n            });\r\n            switch (this.type) {\r\n                case colTypes.NUMBER:\r\n                case colTypes.DOUBLE:\r\n                case colTypes.WEEKS:\r\n                case colTypes.HOURS:\r\n                case colTypes.COSTS:\r\n                case colTypes.PERCENT:\r\n                case colTypes.INCREMENT:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n            }\r\n            var columnClass = this.getColumnClass();\r\n            if (columnClass != '') {\r\n                cc.push(columnClass);\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getCellClass: function (item) {\r\n            var cc = [];            \r\n            angular.forEach(this, function (value, key) {\r\n                if (value === true) {\r\n                    cc.push(key);\r\n                }\r\n            });\r\n            switch (this.type) {\r\n                case colTypes.LINK:\r\n                    cc.push('text-underline');\r\n                    break;\r\n                case colTypes.NUMBER:\r\n                case colTypes.DOUBLE:\r\n                case colTypes.WEEKS:\r\n                case colTypes.HOURS:\r\n                case colTypes.COSTS:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n                case colTypes.PERCENT:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n                case colTypes.INCREMENT:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getColumnClass: function () {\r\n            return this.color ? 'shade-light-blue-' + this.color : '';\r\n        },\r\n        getItemClass: function (item) {\r\n            var cc = [];\r\n            cc.push(item.static[this.id].baseClass);\r\n            var columnClass = this.getColumnClass();\r\n            if (columnClass != '') {\r\n                cc.push(columnClass);\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getTextClass: function (item) {\r\n            var cc = [];\r\n            switch (this.type) {\r\n                case colTypes.INCREMENT:\r\n                    var value = this.getRaw(item);\r\n                    if (angular.isNumber(value) && value < 0) {\r\n                        cc.push('text-danger');\r\n                    } else {\r\n                        cc.push('text-success');\r\n                    }\r\n                    break;\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getTotalClass: function (filtered) {\r\n            var cc = [];\r\n            switch (this.type) {\r\n                case colTypes.NUMBER:\r\n                case colTypes.DOUBLE:\r\n                case colTypes.WEEKS:\r\n                case colTypes.HOURS:\r\n                case colTypes.COSTS:\r\n                case colTypes.PERCENT:\r\n                case colTypes.INCREMENT:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        searchToggle: function (item) {\r\n            var index = this.search.indexOf(item.id);\r\n            if (index === -1) {\r\n                item.active = true;\r\n                this.search.push(item.id);\r\n            } else {\r\n                item.active = false;\r\n                this.search.splice(index, 1);\r\n            }\r\n        },\r\n        isActive: function () {\r\n            if (angular.isFunction(this.active) && this.active) {\r\n                return this.active();\r\n            } else {\r\n                return this.active;\r\n            }\r\n        },\r\n        toggle: function () {\r\n            angular.isFunction(this.active) ? null : this.active = !this.active;\r\n        },\r\n        activate: function () {\r\n            angular.isFunction(this.active) ? null : this.active = true;\r\n        },\r\n        deactivate: function () {\r\n            angular.isFunction(this.active) ? null : this.active = false;\r\n        },\r\n        makeStatic: function (item) {\r\n            if (this.post) {\r\n                this.setters.raw(item, (this.getters.post(item) || 0));\r\n            }\r\n            var col = this;\r\n            item.static[col.id] = {\r\n                baseClass: col.getCellClass(item),\r\n                textClass: col.getTextClass(item),\r\n                value: col.getValueFormatted(item),\r\n                link: col.link ? col.link(item) : null,\r\n                pop: col.pop ? col.pop(item) : null,\r\n            };\r\n        },\r\n    };\r\n    Column.types = colTypes;\r\n    return Column;\r\n}]);\r\n\r\napp.factory('Columns', ['$parse', 'Utils', 'Column', 'colTypes', function ($parse, Utils, Column, colTypes) {\r\n    function Columns(columns) {\r\n        var list = [];\r\n        if (columns) {\r\n            angular.forEach(columns, function (col, index) {\r\n                col.id = index + 1;\r\n                list.push(new Column(col));\r\n            });\r\n        }        \r\n        angular.extend(list, Columns.prototype);\r\n        return list;\r\n    }\r\n    Columns.prototype = {\r\n        getCount: function () {\r\n            var i = 0;\r\n            angular.forEach(this, function (col) {\r\n                i += col.isActive() ? 1 : 0;\r\n            }.bind(this));\r\n            return i;\r\n        },\r\n        getFirstCol: function () {\r\n            var first = null;\r\n            angular.forEach(this, function (col) {\r\n                if (first === null && col.isActive() && col.groupBy && col.value !== 'month' && col.value !== 'monthShort') {\r\n                    first = col;\r\n                }\r\n            });\r\n            return first;\r\n        },\r\n        getChartKey: function (item, time) {\r\n            var keys = [];\r\n            angular.forEach(this, function (col) {\r\n                if (col.isActive() && col.groupBy && col.value !== 'month' && col.value !== 'monthShort' && keys.length === 0) {\r\n                    keys.push(col.getKey(item));\r\n                }\r\n            });\r\n            keys.push(time);\r\n            return keys.join('-');\r\n        },\r\n        getGroupKey: function (item) {\r\n            var keys = [];\r\n            angular.forEach(this, function (col) {\r\n                if (col.isActive() && col.groupBy) {\r\n                    keys.push(col.getKey(item));\r\n                }\r\n            });\r\n            return keys.join('-');\r\n        },\r\n        getSortKey: function (item) {\r\n            var values = [];\r\n            angular.forEach(this, function (col) {\r\n                if (col.isActive() && col.groupBy) {\r\n                    values.push(col.sort ? $parse(col.sort)(item) : col.getValueFormatted(item));\r\n                }\r\n            });\r\n            return values.join('');\r\n        },\r\n        expand: function (data) {\r\n            var options = {\r\n                dynamic: true,\r\n                compare: true,\r\n            }\r\n            data ? angular.extend(options, data) : null;\r\n            // add percentuals and compares\r\n            var array = [], cols = this;\r\n            array.radios = {};\r\n            angular.forEach(this, function (col, index) {\r\n                col.id = array.length + 1;\r\n                array.push(col);\r\n                if (col.aggregate) {\r\n                    if (options.dynamic) {\r\n                        array.push(new Column({\r\n                            id: array.length + 1,\r\n                            name: '%',\r\n                            value: function (item) {\r\n                                return col.getters.raw(item) / col.total * 100;\r\n                            },\r\n                            key: col.key,\r\n                            type: colTypes.PERCENT,\r\n                            dynamic: true,\r\n                            active: function () {\r\n                                return array.showDynamics && col.active;\r\n                            },\r\n                            col: col,\r\n                        }));\r\n                    }\r\n                    if (options.compare) {\r\n                        array.push(new Column({\r\n                            id: array.length + 1,\r\n                            name: 'anno precedente',\r\n                            value: function (item) {\r\n                                return this.getters.raw(item);\r\n                            },\r\n                            raw: col.value + 'Last',\r\n                            source: col.value,\r\n                            key: col.key,\r\n                            type: col.type, // \r\n                            count: col.count,\r\n                            compare: true,\r\n                            dynamic: true,\r\n                            active: function () {\r\n                                return array.showComparison && col.active;\r\n                            },\r\n                            col: col,\r\n                        }));\r\n                        array.push(new Column({\r\n                            id: array.length + 1,\r\n                            name: '%',\r\n                            value: function (item) {\r\n                                var current = (col.getters.raw(item) || 0);\r\n                                var previous = (this.getters.raw(item) || 0);\r\n                                if (previous) {\r\n                                    return (current - previous) / previous * 100;\r\n                                } else {\r\n                                    return null; // '+∞ %';\r\n                                }\r\n                            },\r\n                            raw: col.value + 'Gain',\r\n                            source: col.value,\r\n                            key: col.key,\r\n                            type: colTypes.INCREMENT, // col.type, // \r\n                            count: col.count,\r\n                            compare: true,\r\n                            dynamic: true,\r\n                            active: function () {\r\n                                return array.showComparison && col.active;\r\n                            },\r\n                            col: col,\r\n                        }));\r\n                    }\r\n                }\r\n                if (col.radio && col.active) {\r\n                    array.radios[col.radio] = col.value;\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getGroups: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.groupBy) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getCounters: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.count) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getAggregates: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.aggregate && !col.count) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getPercentages: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.type === colTypes.PERCENT) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getDynamics: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.dynamic) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getCompares: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.compare) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        reset: function () {\r\n            this.groups = {};\r\n            angular.forEach(this, function (col) {\r\n                col.reset();\r\n            });\r\n            return this;\r\n        },\r\n        makeStatic: function (items) {\r\n            //console.log('Columns.makeStatic', 'items', items.length);\r\n            angular.forEach(this, function (col, index) {\r\n                col.values = [];\r\n                col.static = {\r\n                    active: col.isActive(),\r\n                    headerClass: col.getHeaderClass(),\r\n                };\r\n            });\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.static.active || col.dynamic) {\r\n                    angular.forEach(items, function (item) {\r\n                        col.makeStatic(item);\r\n                        col.groupBy ? col.addValue(item) : null;\r\n                    });\r\n                    if (col.groupBy) {\r\n                        col.values = col.values.sort(function (va, vb) {\r\n                            var a, b;\r\n                            a = va.name ? String(va.name).toLowerCase() : ''; // ignore upper and lowercase\r\n                            b = vb.name ? String(vb.name).toLowerCase() : ''; // ignore upper and lowercase\r\n                            if (a < b) {\r\n                                return -1;\r\n                            }\r\n                            if (a > b) {\r\n                                return 1;\r\n                            }\r\n                            return 0;\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        activeInRange: function (range) {\r\n            var flag = false;\r\n            var i = 0;\r\n            while (!flag && i < this.length) {\r\n                var col = this[i];\r\n                if (col.static.active) {\r\n                    flag = (range.indexOf(col.value) !== -1);\r\n                }\r\n                i++;\r\n            }\r\n            return flag;\r\n        },\r\n        unique: function (row, items) {\r\n            var key = this.getGroupKey(row);\r\n            var item = this.groups[key];\r\n            if (!item) {\r\n                item = this.groups[key] = row; // angular.copy(row);\r\n                item.static = [];\r\n                items.push(item);\r\n            }\r\n            return item;\r\n        },\r\n        iterate: function (row, items) {\r\n            row = angular.copy(row);\r\n            var item = this.unique(row, items);\r\n            this.addTotals(item, row);\r\n        },        \r\n        compare: function (row, items) {\r\n            row = angular.copy(row);\r\n            angular.forEach(this, function (col) {\r\n                if (col.compare) {\r\n                    var value = col.getters.source(row);\r\n                    col.setters.raw(row, value);\r\n                }\r\n            });\r\n            angular.forEach(this, function (col) {\r\n                if (col.compare) {\r\n                    col.setters.source(row, 0);\r\n                }\r\n            });\r\n            var item = this.unique(row, items);\r\n            this.addTotals(item, row, true);\r\n        },\r\n        addTotals: function (item, row, comparing) {\r\n            angular.forEach(this, function (col) {\r\n                if (col.isActive() && (comparing ? col.compare : !col.compare)) {\r\n                    if (col.count) {\r\n                        col.addCount(item, row);\r\n                    } else if (comparing || col.aggregate) {\r\n                        if (!col.hasKey(row)) {\r\n                            if (item === row) {\r\n                                col.initValue(item);\r\n                            } else {\r\n                                col.addTotal(item, row);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            return this;\r\n        },\r\n        toggleColumns: function (c) {\r\n            if (c.radio) {\r\n                angular.forEach(this, function (col) {\r\n                    if (c.radio === col.radio && c !== col) {\r\n                        col.deactivate();\r\n                    }\r\n                });\r\n                c.activate();\r\n                this.radios[c.radio] = c.value;\r\n            } else {\r\n                c.toggle();\r\n            }\r\n        },\r\n        searchDisabled: function (item, col, filtered) {\r\n            var id = item.id, t = this;\r\n            var has = false, index = 0;\r\n            while(index < filtered.length) {\r\n                has = has || col.getKey(filtered[index]) === id;\r\n                if (has) {\r\n                    index = filtered.length;\r\n                } else {\r\n                    index ++;\r\n                }\r\n            }\r\n            return !has;    \r\n        },\r\n        setMode: function (mode) {\r\n            this[mode] = !this[mode];\r\n            switch (mode) {\r\n                case 'showDynamics':\r\n                    this.showComparison = false;\r\n                    break;\r\n                case 'showComparison':\r\n                    this.showDynamics = false;\r\n                    break;\r\n            }\r\n            return this[mode];\r\n        },\r\n    };\r\n    Columns.types = colTypes;\r\n    return Columns;\r\n}]);\r\n\r\napp.factory('ChartData', ['$filter', function ($filter) {\r\n    function ChartData(data) {\r\n        var defaults = {\r\n            type: 'chart-line',\r\n            labels: [],\r\n            series: [],\r\n            data: [],\r\n            options: {\r\n                bezierCurve: false,\r\n                elements: {\r\n                    line: {\r\n                        tension: 0,\r\n                    }\r\n                },\r\n                scaleLabel: function (label) {\r\n                    return $filter('currency')(label.value);\r\n                },\r\n                tooltipTemplate: function (data) {\r\n                    return $filter('currency')(data.value);\r\n                },\r\n                scales: {\r\n                    yAxes: [{\r\n                        gridLines: {\r\n                            display: false\r\n                        },\r\n                        ticks: {\r\n                            min: 0,\r\n                            // max: 3,\r\n                            // stepSize: 1,\r\n                            callback: function (value, index, values) {\r\n                                return $filter('customNumber')(value, 2, ' W');\r\n                            }\r\n                        }\r\n                    }],\r\n                    callbacks: {\r\n                        label: function (label) {\r\n                            console.log('b');\r\n                            return $filter('customNumber')(label.value, 2, ' W');\r\n                        }\r\n                    }\r\n                },\r\n                tooltips: {\r\n                    callbacks: {\r\n                        title: function (tooltipItems, data) {\r\n                            return '';\r\n                        },\r\n                        label: function (tooltipItem, data) {\r\n                            var label = data.datasets[tooltipItem.datasetIndex].label;\r\n                            var datasetLabel = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];\r\n                            return label + ': ' + $filter('customNumber')(datasetLabel, 2, ' W');\r\n                        },\r\n                    }\r\n                },\r\n            },\r\n            onClick: function (points, evt) {\r\n                console.log('chart', points, evt);\r\n            },\r\n            datasetOverride: [],\r\n        };\r\n        angular.extend(this, defaults);\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    ChartData.prototype = {\r\n        getObjectParams: function (obj) {\r\n            var a = [];\r\n            if (obj) {\r\n                for (var p in obj) {\r\n                    a.push({ name: p, value: obj[p] });\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        getParams: function (source) {\r\n            var post = {}, value;\r\n            for (var p in this) {\r\n                switch (p) {\r\n                    case 'dateFrom':\r\n                    case 'dateTo':\r\n                    case 'status':\r\n                        value = this[p];\r\n                        if (value !== undefined) {\r\n                            post[p] = value;\r\n                        }\r\n                        break;\r\n                    case 'search':\r\n                    case 'sort':\r\n                        var json = JSON.stringify(this.getObjectParams(this[p]), null, '');\r\n                        post[p] = window.btoa(json);\r\n                        break;\r\n                }\r\n            }\r\n            if (!source.unpaged) {\r\n                post.page = source.page;\r\n                post.size = source.size;\r\n            }\r\n            // console.log('ChartData.getParams', post);\r\n            return post;\r\n        },\r\n        getMonths: function () {\r\n            var months = [];\r\n            if (this.dateFrom && this.dateTo) {\r\n                var range = [this.dateFrom, this.dateTo];\r\n                range = range.sort(function (a, b) {\r\n                    return a.getTime() - b.getTime();\r\n                });\r\n                function monthDiff(a, b) {\r\n                    var months;\r\n                    months = (b.getFullYear() - a.getFullYear()) * 12;\r\n                    months -= a.getMonth() + 1;\r\n                    months += b.getMonth() + 1; // we should add + 1 to get correct month number\r\n                    months++;\r\n                    // console.log(months);\r\n                    return months <= 0 ? 0 : months;\r\n                }\r\n                var diff = Math.max(1, monthDiff(range[0], range[1]));\r\n                // console.log('getMonths', range[0], range[1], diff);\r\n                var i = 0;\r\n                while (i < diff) {\r\n                    var date = new Date(range[0].getFullYear(), range[0].getMonth() + i, 1);\r\n                    months.push({\r\n                        id: date.getTime(),\r\n                        name: $filter('date')(date, '(yyyy MM) MMMM'),\r\n                        nameShort: $filter('date')(date, 'MMM yy'),\r\n                    });\r\n                    i++;\r\n                };\r\n            }\r\n            return months;\r\n        },\r\n    };\r\n    return ChartData;\r\n}]);\r\n\r\napp.service('Droppables', ['ElementRect', function (ElementRect) {\r\n    this.natives = [];\r\n    this.callbacks = [];\r\n    this.rects = [];\r\n    this.add = function (nativeElement, callback) {\r\n        this.natives.push(nativeElement);\r\n        this.callbacks.push(callback || function () { });\r\n        this.rects.push(ElementRect.fromNative(nativeElement));\r\n    };\r\n    this.remove = function (nativeElement) {\r\n        var index = this.natives.indexOf(nativeElement);\r\n        if (index !== -1) {\r\n            this.natives.splice(index, 1);\r\n            this.callbacks.splice(index, 1);\r\n            this.rects.splice(index, 1);\r\n        }\r\n    };\r\n    this.getIntersections = function (item) {\r\n        var intersections = [], element;\r\n        angular.forEach(this.rects, function (rect, index) {\r\n            rect.set(rect.native);\r\n            element = angular.element(rect.native);\r\n            element.removeClass('dropping');\r\n            if (rect.intersect(item)) {\r\n                rect.distance = rect.center.distance(item.center);\r\n                rect.data = this.callbacks[index]();\r\n                intersections.push(rect);\r\n                element.addClass('over');\r\n            } else {\r\n                element.removeClass('over');\r\n            }\r\n        }.bind(this));\r\n        intersections.sort(function (a, b) {\r\n            if (a.distance < b.distance) {\r\n                return -1;\r\n            }\r\n            if (a.distance > b.distance) {\r\n                return 1;\r\n            }\r\n            return 0;\r\n        });\r\n        return intersections;\r\n    };\r\n}]);\r\n"]}