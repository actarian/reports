{"version":3,"sources":["docs/js/app.js"],"names":["app","angular","module","config","$routeProvider","$locationProvider","when","title","templateUrl","controller","otherwise","html5Mode","$httpProvider","run","$rootScope","$route","$routeParams","$window","$q","$timeout","$on","current","forEach","value","key","replace","RegExp","document","window","console","log","domain","location","hostname","port","constant","CLI_PULL_NEW","CLI_PUSH_EXHISTING","COM_HANDLED","COM_SUPPORT","COM_UNAUTHORIZED","COM_EXTRA_BUDGET","COM_CLOSE","PLDSSPETC_AC_SHORT_YES","PLDSSPETC_AC_SHORT_NO","PLDSSPETC_SHORT_YES","PLDSSPETC_SHORT_NO","CAPOF_CLOSE","CAPOF_NO_BUDGET","CAPOF_CREATE","CAPOF_TASK","DIRCOM_ACCEPTED","DIRCOM_REFUSED","CAPOF_INFO","ASSIGNTO_CLOSE","CLI_PULL","COM_PULL_AC","COM_PULL","COM_PUSH","COM_LONG","COM_EXTRA","COM_EXTRA_CONFIRMED","PLDSSPETC_PUSH","PLDSSPETC_PULL","CAPOF_ASSIGNATION","DIRCOM_EXTRA","COMPLETE","COM_TASK","STATUS_WAITING","STATUS_TASK","STATUS_COM","STATUS_BUDGET","STATUS_COMPLETE","STATUS_OPENED","STATUS_HANDLED","STATUS_COMPLETED","STATUS_ESTIMATION","STATUS_PLANNED","STATUS_UNDONE","STATUS_DONE","STATUS_CLOSED","STATUS_RAI","STATUS_NEGOTIATION","STATUS_ACCEPTED","STATUS_REFUSED","NORMAL","DOWNWARD","DIRCOM","COM","SEG","CAPOF","PLDSSPE","TEC","NONE","ADMIN","PLDSSPETC","RR","DS","PL","SPE","GESTIONALE","REPORTTRATT","ID","IDS","TITLE","DATE","CUSTOMER","RESOURCE","STATUS","STATUSSM","FAMILY","NUMBER","HOURS","COSTS","PERCENT","INCREMENT","ICON","BUTTONS","DISABLED","LINK","BOOL","DOUBLE","WEEKS","$scope","$location","$http","$templateCache","$compile","Appearance","appearance","stop","$event","stopImmediatePropagation","goBack","history","back","init","source","state","paging","$filter","State","Utils","DataFilter","DataSource","Columns","Range","ChartData","colTypes","GroupColumns","rows","items","compares","cols","reset","compared","row","has","excludes","item","active","filter","includes","iterate","push","compare","makeStatic","CountryCols","name","type","TEXT","hasSearch","groupBy","radio","color","aggregate","tabs","id","template","icon","show","description","filters","ranges","currentQuarter","set","currentSemester","currentYear","expand","dynamic","showReport","defaults","map","col","colGroups","getGroups","valGroups","getAggregates","unpaged","uri","resolveItems","comparing","index","this","date","Date","created_at","setFullYear","getFullYear","dt","setDate","setHours","getTime","month","monthShort","resolve","deferred","response","data","group","showComparison","from","dateFrom","to","dateTo","params","Api","reports","negotiations","then","bind","search","datasource","sort","setRangeDiff","diff","range","is","setDiff","resetFilters","isFunction","a","b","update","exclude","include","toggleCol","toggleColumns","doFilter","isActive","getKey","doFilterMultiple","length","indexOf","doFilterColumns","doOrder","getSortKey","getRowClass","onOpen","path","excel","columns","json","format","getFormat","getValue","getValueTotal","exportExcel","headers","blob","Blob","windowUrl","URL","webkitURL","downloadUrl","createObjectURL","anchor","createElement","href","fileNamePattern","download","exec","body","appendChild","click","revokeObjectURL","remove","error","scope","event","fromIndex","model","toIndex","splice","aid","directive","templateFunction","element","attributes","form","placeholder","split","join","formKey","formFocus","message","decoration","disabled","label","change","onChange","inputCols","colInput","colLabel","required","readonly","options","validate","precision","controlRow","undefined","match","validation","mouseover","mouseout","nameHi","formKeyHi","modelHi","validationHi","requiredHi","messageHi","decorationHi","himodel","min","optionLabel","number","canCreate","flatten","queryable","onSelected","restrict","compile","templateElement","templateAttributes","html","contents","control","link","require","onFocus","focus","$modelValue","$setViewValue","doBlur","$invalid","validateType","onBlur","addListeners","on","removeListeners","off","$formatters","$parsers","unshift","valid","String","Number","toString","$setValidity","max","onTap","e","toggleClass","toggle","setAttribute","hasClass","addCloseListeners","onTapOut","getClosest","target","removeClass","removeCloseListeners","querySelector","$document","Style","togglers","collapsable","_height","offsetHeight","style","height","addClass","setTimeout","$broadcast","hide","$target","clearTimeout","onOver","onLeave","toElement","onClick","getClosestElement","toggleLeave","transclude","$parent","$eval","onValidate","button","stateClass","sclass","busy","isBusy","successing","isSuccessing","success","isSuccess","errorring","isErroring","isError","stateDisabled","onSort","getSort","enabled","setSort","$watchCollection","$parse","ElementRect","Droppables","onStart","condition","down","getTouch","addDragListeners","onMove","move","difference","dragging","power","transform","x","y","elementRect","nativeElement","offset","rects","getIntersections","native","onEnd","droppableIndex","fromModel","ngModel","rect","droppable","$emit","removeDragListeners","selector","draggableItem","draggableIf","onGetData","droppableIf","droppableItem","add","onLink","linkTo","attr","open","preventDefault","events","tap","$templateRequest","$controller","getPageScroll","supportPageOffset","pageXOffset","isCSS1Compat","compatMode","documentElement","scrollLeft","pageYOffset","scrollTop","pop","copy","onClose","promise","find","eq","append","compileController","$watch","newValue","oldValue","getBoundingClientRect","point","top","Math","onClickOut","showValues","toggler","activate","addOutListeners","deactivate","removeOutListeners","Error","toTitleCase","str","txt","charAt","toUpperCase","substr","toLowerCase","splitted","firstName","shift","lastName","legacyFilter","cost","currency","ratio","formatting","unit","hours","floor","minutes","timezone","parseTime","parseHour","val","filterWatcher","_groupBy","collection","getter","dict","property","isObject","isUndefined","isMemoized","arguments","memoize","provider","isNull","isScope","obj","$evalAsync","$get","getHashKey","fName","args","replacerFactory","cache","JSON","stringify","removeCache","targetScope","$id","$$listeners","$$cache","cleanStateless","$$timeout","$$phase","addListener","hashKey","$$isMemoized","filterName","$$memoize","result","factory","types","QUARTER","extend","prototype","setQuarter","setSemester","setYear","now","setMonth","getMonth","year","quarter","SEMESTER","semester","YEAR","getName","setDates","Base","$$super","$super","$ctor","apply","call","constructor","methods","Object","create","Point","radius","degree","w","h","pow","sin","cos","draw","ctx","fillStyle","fillRect","Vector","make","size","sqrt","normalize","l","incidence","angle","atan2","distance","cross","abs","towards","friction","width","center","fromNative","left","offsetWidth","vector","intersect","props","scale","hoverScale","currentScale","prefix","webkit","div","every","prop","prefixed","styles","cssText","transformOrigin","round","Matrix","translate","z","rotate","skew","matrix","decompose","decompositionType","decompositionTypeEnum","QRLike","is3dSupported","get","getComputedStyle","WebKitCSSMatrix","MozCSSMatrix","MsCSSMatrix","OCSSMatrix","CSSMatrix","properties","webkitTransform","OTransform","msTransform","MozTransform","insertBefore","p","getPropertyValue","removeChild","LULike","computedStyle","trim","matrix3dRegexp","matrix3dMatch","matrix2dRegexp","matrix2dMatch","isNaN","c","m41","m42","m43","m11","asin","m22","PI","acos","m13","parseFloat","d","f","delta","r","atan","s","compose","t","service","tableColumnClass","colType","columnClass","tableHeaderClass","Cookie","TIMEOUT","_set","days","setTime","expires","toGMTString","cookie","cookieName","ca","i","substring","parse","delete","checkCookie","elapsed","timeout","reject","interval","defer","LocalStorage","isLocalStorageSupported","supported","localStorage","setItem","removeItem","isSupported","storageEvent","originalEvent","SessionStorage","isSessionStorageSupported","sessionStorage","Animate","callback","useTimeout","isPlaying","ticks","play","loop","time","_this","requestAnimationFrame","pause","cancelAnimationFrame","playpause","cycle","k","ff","gg","hh","ii","add32","cmn","q","md51","n","md5blk","tail","charCodeAt","md5blks","rhex","j","hex_chr","hex","Md5","encode","string","lsw","msw","previous","touch","touches","changedTouches","pageX","pageY","getRelativeTouch","el","matchesFn","parent","some","fn","parentElement","throttle","func","wait","context","later","leading","getNow","remaining","trailing","where","array","query","found","$new","controllerAs","children","reverseSortOn","prepend","expression","formatted","reducer","o","reducerSetter","slice","reducerAdder","lastTime","vendors","currTime","timeToCall","Array","reduce","defineProperty","TypeError","len","ua","navigator","userAgent","safari","msie","chrome","mobile","toMd5","getElementsByTagName","isReady","idle","errors","ready","errorMessage","submitClass","submitMessage","idleMessage","busyMessage","successMessage","getObjectParams","getParams","post","btoa","page","getMonths","monthDiff","months","nameShort","storage","PAGES_FIRST","PAGES_SIZE","pages","PAGES_MAX","count","maxPages","allrows","steps","POSITIVE_INFINITY","next","$d","step","unallowed","$$lastRequestedPath","status","parseHeader","responseHeader","responseView","ceil","pagination","getPages","getUri","concat","opened","prevPage","nextPage","gotoPage","firstPage","lastPage","hasMany","hasMorePagesBehind","startingIndex","hasMorePagesNext","endingIndex","isPage","hasPages","openClose","hasSort","setSearch","getSearch","setDateFrom","getDateFrom","setDateTo","getDateTo","Column","raw","getters","fields","field","setters","assign","getRaw","getSource","values","keys","total","hasKey","initValue","addTotal","addCount","v","addValue","filtered","getValueFormatted","isNumber","getFormatted","static","getTotal","getLink","getHeaderClass","cc","getColumnClass","getCellClass","getItemClass","baseClass","getTextClass","getTotalClass","searchToggle","textClass","list","getCount","getFirstCol","first","getChartKey","getGroupKey","radios","showDynamics","getCounters","getPercentages","getDynamics","getCompares","groups","headerClass","va","vb","activeInRange","flag","unique","addTotals","searchDisabled","setMode","mode","labels","series","bezierCurve","elements","line","tension","scaleLabel","tooltipTemplate","scales","yAxes","gridLines","display","callbacks","tooltips","tooltipItems","tooltipItem","datasets","datasetIndex","datasetLabel","points","evt","datasetOverride","natives","intersections"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global angular */\r\n\r\n\"use strict\";\r\n\r\nvar app = angular.module('app', ['ngSanitize', 'ngRoute', 'ngMessages']); //, 'ngSilent', 'ui.bootstrap', 'relativeDate', 'ngFileUpload', 'textAngular', 'uiSwitch', 'rzModule', 'ngJsonExplorer', 'chart.js']);\r\n\r\napp.config(['$routeProvider', '$locationProvider', function ($routeProvider, $locationProvider) {\r\n    \r\n    $routeProvider.when('/test', {\r\n        title: 'Test',\r\n        templateUrl: 'partials/test.html',\r\n        controller: 'TestCtrl',\r\n\r\n    }).when('/404', {\r\n        title: 'Error 404',\r\n        templateUrl: 'partials/404.html',\r\n    });\r\n\r\n    $routeProvider.otherwise('/test');\r\n\r\n    // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\r\n    $locationProvider.html5Mode(true);\r\n\r\n}]);\r\n\r\napp.config(['$httpProvider', function ($httpProvider) {\r\n    \r\n    // $httpProvider.defaults.withCredentials = true;\r\n\r\n}]);\r\n\r\napp.run(['$rootScope', '$route', '$routeParams', '$window', '$q', '$timeout', function ($rootScope, $route, $routeParams, $window, $q, $timeout) {\r\n\r\n    $rootScope.$on('$routeChangeSuccess', function () {\r\n        var title = $route.current.title;\r\n        angular.forEach($routeParams, function (value, key) {\r\n            title = title.replace(new RegExp(':' + key, 'g'), value);\r\n        });\r\n        document.title = title || '';        \r\n    });\r\n\r\n}]);\n/* global angular, app */\r\n\r\nwindow.console ? null : window.console = { log: function () { } };\r\nwindow.domain = '//' + location.hostname + (location.port ? ':' + location.port : ''); // location.protocol + \r\n\r\napp.constant('domain', domain);\r\n\r\napp.constant('formActions', {\r\n    CLI_PULL_NEW: 1,\r\n    CLI_PUSH_EXHISTING: 2,\r\n    COM_HANDLED: 3,\r\n    COM_SUPPORT: 4,\r\n    COM_UNAUTHORIZED: 5,\r\n    COM_EXTRA_BUDGET: 6,\r\n    COM_CLOSE: 7,\r\n    PLDSSPETC_AC_SHORT_YES: 8,\r\n    PLDSSPETC_AC_SHORT_NO: 9,\r\n    PLDSSPETC_SHORT_YES: 10,\r\n    PLDSSPETC_SHORT_NO: 11,\r\n    CAPOF_CLOSE: 12,\r\n    CAPOF_NO_BUDGET: 13,\r\n    CAPOF_CREATE: 14,\r\n    CAPOF_TASK: 15,\r\n    DIRCOM_ACCEPTED: 16,\r\n    DIRCOM_REFUSED: 17,\r\n    CAPOF_INFO: 18,\r\n    ASSIGNTO_CLOSE: 19,\r\n});\r\n\r\napp.constant('formTypes', {\r\n    CLI_PULL: 1,\r\n    COM_PULL_AC: 2,\r\n    COM_PULL: 3,\r\n    COM_PUSH: 4,\r\n    COM_LONG: 5,\r\n    COM_EXTRA: 6,\r\n    COM_EXTRA_CONFIRMED: 7,\r\n    PLDSSPETC_PUSH: 8,\r\n    PLDSSPETC_PULL: 9,\r\n    CAPOF_ASSIGNATION: 10,\r\n    DIRCOM_EXTRA: 11,\r\n    COMPLETE: 12,\r\n    COM_TASK: 13,\r\n});\r\n\r\napp.constant('formStatus', {\r\n    STATUS_WAITING:         1,\r\n    STATUS_TASK:            2,\r\n    STATUS_COM:             3,\r\n    STATUS_BUDGET:          4,\r\n    STATUS_COMPLETE:        5,\r\n});\r\n\r\napp.constant('taskStatus', {\r\n    STATUS_OPENED: 1,\r\n    STATUS_HANDLED: 2,\r\n    STATUS_WAITING: 3,\r\n    STATUS_COMPLETED: 4,\r\n    STATUS_ESTIMATION: 5,\r\n    STATUS_PLANNED: 6,\r\n});\r\n\r\napp.constant('teamStatus', {\r\n    STATUS_UNDONE: 0,\r\n    STATUS_DONE: 1,\r\n});\r\n\r\napp.constant('negotiationStatus', {\r\n    STATUS_OPENED: 1,\r\n    STATUS_CLOSED: 2,\r\n});\r\n\r\napp.constant('estimationStatus', {\r\n    STATUS_RAI: 255,\r\n    STATUS_COM: 270,\r\n    STATUS_NEGOTIATION: 254,\r\n    STATUS_ACCEPTED: 252,\r\n    STATUS_REFUSED: 253,\r\n    STATUS_COMPLETED: 271,\r\n});\r\n\r\napp.constant('projectTypes', {\r\n    NORMAL:                 1,\r\n    DOWNWARD:               2,\r\n});\r\n\r\napp.constant('projectStatus', {\r\n    STATUS_OPENED: 1,\r\n    STATUS_CLOSED: 2,\r\n});\r\n\r\napp.constant('userAreas', {\r\n    DIRCOM: 250,\r\n    COM: 210,\r\n    SEG: 200,\r\n    CAPOF: 80,\r\n    PLDSSPE: 170,\r\n    TEC: 140,\r\n    NONE: 0,\r\n});\r\n\r\napp.constant('userGroups', {\r\n    ADMIN: [10000],\r\n    DIRCOM: [10000, 250, 1],\r\n    COM: [10000, 210, 200],\r\n    SEG: [10000, 200],\r\n    PLDSSPETC: [10000, 220, 170, 160, 150, 140],\r\n    PLDSSPE: [10000, 220, 170, 160, 150],\r\n    RR: [10000, 220],\r\n    DS: [10000, 170],\r\n    PL: [10000, 160],\r\n    SPE: [10000, 150],\r\n    TEC: [10000, 140],\r\n    CAPOF: [10000, 80],\r\n    GESTIONALE: [10000, 1],\r\n    REPORTTRATT: [10000, 1, 190, 80, 250],\r\n});\r\n\r\napp.constant('colTypes', {\r\n    ID: 1,\r\n    IDS: 2,\r\n    TITLE: 3,\r\n    DATE: 4,\r\n    CUSTOMER: 5,\r\n    RESOURCE: 6,\r\n    STATUS: 7,\r\n    STATUSSM: 8,\r\n    FAMILY: 9,\r\n    NUMBER: 10,\r\n    HOURS: 11,\r\n    COSTS: 12,\r\n    PERCENT: 13,\r\n    INCREMENT: 14,\r\n    ICON: 15,\r\n    BUTTONS: 16,\r\n    DISABLED: 17,\r\n    LINK: 18,\r\n    BOOL: 19,\r\n    DOUBLE: 20,\r\n    WEEKS: 21,\r\n});\r\n\r\n/*\r\napp.value('relativeDateTranslations', {\r\n    just_now:               'adesso', // 'just now',\r\n    seconds_ago:            '{{time}} secondi fa', // '{{time}} seconds ago',\r\n    a_minute_ago:\t        'un minuto fa', // 'a minute ago',\r\n    minutes_ago:\t        '{{time}} minuti fa', // '{{time}} minutes ago',\r\n    an_hour_ago:            'un\\'ora fa', // 'an hour ago',\r\n    hours_ago:              '{{time}} ore fa', // '{{time}} hours ago',\r\n    a_day_ago:              'ieri', // 'yesterday',\r\n    days_ago:               '{{time}} giorni fa', // '{{time}} days ago',\r\n    a_week_ago:             'una settimana fa', // 'a week ago',\r\n    weeks_ago:              '{{time}} settimane fa', // '{{time}} weeks ago',\r\n    a_month_ago:            'un mese fa', // 'a month ago',\r\n    months_ago:             '{{time}} mesi fa', // '{{time}} months ago',\r\n    a_year_ago:             'un anno fa', // 'a year ago',\r\n    years_ago:              '{{time}} anni fa', // '{{time}} years ago',\r\n    over_a_year_ago:        'più di un anno fa', // 'over a year ago',\r\n    seconds_from_now:       'fra {{time}} secondi', // '{{time}} seconds from now',\r\n    a_minute_from_now:      'fra un minuto', // 'a minute from now',\r\n    minutes_from_now:       'tra {{time}} minuti', // '{{time}} minutes from now',\r\n    an_hour_from_now:       'tra un\\'ora', // 'an hour from now',\r\n    hours_from_now:         'tra {{time}} ore', // '{{time}} hours from now',\r\n    a_day_from_now:         'domani', // 'tomorrow',\r\n    days_from_now:          'fra {{time}} giorni', // '{{time}} days from now',\r\n    a_week_from_now:        'tra una settimana', // 'a week from now',\r\n    weeks_from_now:         'fra {{time}} settimane', // '{{time}} weeks from now',\r\n    a_month_from_now:       'tra un mese', // 'a month from now',\r\n    months_from_now:        'fra {{time}} mesi', // '{{time}} months from now',\r\n    a_year_from_now:        'tra un anno', // 'a year from now',\r\n    years_from_now:         'tra {{time}} anni', // '{{time}} years from now',\r\n    over_a_year_from_now:   'fra più di un anno', // 'over a year from now',\r\n});\r\n\r\napp.config(['ChartJsProvider', function (ChartJsProvider) {\r\n    console.log(Chart.defaults.global);\r\n    var colors = ['#1684FB', '#F21500', '#ffe200', '#FF6435', '#FF9700', '#4BAF4F', '#8BC24A', '#7A70E4', '#53E2DD', '#03A9F4'];\r\n    ChartJsProvider.setOptions({\r\n        chartColors: colors,\r\n        responsive: true,\r\n        maintainAspectRatio: true,\r\n    });\r\n    ChartJsProvider.setOptions('line', {\r\n        showLines: true,\r\n    });\r\n    ChartJsProvider.setOptions('tooltips', {\r\n        callbacks: {\r\n            title: function (tooltipItems, data) {\r\n                return ''; // title;\r\n            },\r\n            label: function (tooltipItem, data) {\r\n                var label = data.datasets[tooltipItem.datasetIndex].label; // data.labels[tooltipItem.index];\r\n                var datasetLabel = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];\r\n                return label + ': ' + datasetLabel;\r\n            }\r\n        }\r\n    });\r\n    ChartJsProvider.setOptions('legend', {\r\n        display: true,\r\n    });    \r\n}]);\r\n*/\n/* global angular, app */\r\n\r\napp.controller('RootCtrl', ['$scope', '$location', '$timeout', '$http', '$templateCache', '$compile', '$window', 'Appearance', function ($scope, $location, $timeout, $http, $templateCache, $compile, $window, Appearance) {\r\n\r\n    $scope.appearance = Appearance;\r\n\r\n    $scope.stop = function ($event) {\r\n        $event.stopImmediatePropagation();\r\n        return true;\r\n    };\r\n    $scope.goBack = function () {\r\n        $window.history.back();\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('TableCtrl', ['$scope', function ($scope) {\r\n\r\n    $scope.init = function (source) {\r\n        $scope.source = source;\r\n        $scope.state = $scope.source.state;\r\n        $scope.source.paging();\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('TestCtrl', ['$scope', '$route', '$filter', '$location', '$http', '$q', 'State', 'Utils', 'Appearance', 'DataFilter', 'DataSource', 'Columns', 'Range', 'ChartData', 'colTypes', function ($scope, $route, $filter, $location, $http, $q, State, Utils, Appearance, DataFilter, DataSource, Columns, Range, ChartData, colTypes) {\r\n    var state = $scope.state = new State();\r\n\r\n    var tabs = $scope.tabs = [{\r\n        id: 2,\r\n        name: 'Colonne',\r\n        template: 'partials/report/filters/columns',\r\n        icon: 'icon-time',\r\n    }, {\r\n        id: 3,\r\n        name: 'Valori',\r\n        template: 'partials/report/filters/values',\r\n        icon: 'icon-time',\r\n    }, {\r\n        id: 4,\r\n        name: 'Opzioni',\r\n        template: 'partials/report/filters/flags',\r\n        icon: 'icon-time',\r\n    },];\r\n    tabs.show = true;\r\n    tabs.description = 'partials/report/description';\r\n    tabs.id = 2;\r\n\r\n    function GroupColumns(rows, items, compares) {\r\n        // console.log(rows, items, compares);\r\n        cols.reset();\r\n        var compared = null;\r\n        angular.forEach(rows, function (row) {\r\n            var has = true;\r\n            angular.forEach(excludes, function (item) {\r\n                if (item.active) {\r\n                    has = has && item.filter(row);\r\n                }\r\n            });\r\n            angular.forEach(includes, function (item) {\r\n                if (item.active) {\r\n                    has = has && item.filter(row);\r\n                }\r\n            });\r\n            if (has) {\r\n                cols.iterate(row, items);\r\n            }\r\n        });\r\n        if (compares) {\r\n            compared = [];\r\n            angular.forEach(compares, function (row) {\r\n                var has = true;\r\n                angular.forEach(excludes, function (item) {\r\n                    if (item.active) {\r\n                        has = has && item.filter(row);\r\n                    }\r\n                });\r\n                angular.forEach(includes, function (item) {\r\n                    if (item.active) {\r\n                        has = has && item.filter(row);\r\n                    }\r\n                });\r\n                if (has) {\r\n                    compared.push(row);\r\n                    cols.compare(row, items);\r\n                }\r\n            });\r\n        }\r\n        cols.makeStatic(items);\r\n        // $scope.groupChart();\r\n    }\r\n    \r\n    var filters = $scope.filters = new DataFilter();\r\n    var ranges = $scope.ranges = [\r\n        new Range().currentQuarter().set(filters),\r\n        new Range().currentSemester(),\r\n        new Range().currentYear(),\r\n    ];\r\n\r\n    function CountryCols(){\r\n        return [{\r\n            name: 'region', value: 'region', key: 'region', type: colTypes.TEXT, active: true, hasSearch: true, groupBy: true,\r\n        }, {\r\n            name: 'name', value: 'name', key: 'name', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'country',\r\n        }, {\r\n            name: 'capital', value: 'capital', key: 'name', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'country',\r\n        }, {\r\n            name: 'language', value: 'languages[0].name', key: 'languages[0].name', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'country',\r\n        }, {\r\n            name: 'currency', value: 'currencies[0].name', key: 'currencies[0].name', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'country',\r\n        }, {\r\n            name: 'alpha2Code', value: 'alpha2Code', key: 'name', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'country',\r\n        }, {\r\n            name: 'lat', value: 'latlng[0]', key: 'name', type: colTypes.NUMBER, active: false, groupBy: true, color: 1,\r\n        }, {\r\n            name: 'lng', value: 'latlng[1]', key: 'name', type: colTypes.NUMBER, active: false, groupBy: true, color: 1,\r\n        }, {\r\n            name: 'area', value: 'area', key: 'name', type: colTypes.NUMBER, active: true, aggregate: true, color: 2,\r\n        }, {\r\n            name: 'population', value: 'population', key: 'name', type: colTypes.NUMBER, active: true, aggregate: true, color: 3,\r\n        }, ];\r\n        /*\r\n        alpha2Code: \"AF\"\r\n        alpha3Code: \"AFG\"\r\n        altSpellings: Array[2]\r\n        area: 652230\r\n        borders: Array[6]\r\n        callingCodes: Array[1]\r\n        capital: \"Kabul\"\r\n        currencies: Array[1]\r\n        demonym: \"Afghan\"\r\n        gini: 27.8\r\n        languages: Array[3]\r\n        latlng: Array[2]\r\n        name: \"Afghanistan\"\r\n        nativeName: \"افغانستان\"\r\n        numericCode: \"004\"\r\n        population: 27657145\r\n        region: \"Asia\"\r\n        timezones: Array[1]\r\n        topLevelDomain: Array[1]\r\n        translations: Object\r\n        */\r\n    }\r\n    function GitCols(){\r\n        return [{\r\n            name: 'owner', value: 'owner.login', key: 'owner.id', type: colTypes.TEXT, active: true, hasSearch: true, groupBy: true, radio: 'git',\r\n        }, {\r\n            name: 'name', value: 'name', key: 'id', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'git',\r\n        }, {\r\n            name: 'description', value: 'description', key: 'id', type: colTypes.TEXT, active: false, hasSearch: true, groupBy: true, radio: 'git',\r\n        }, {\r\n            name: 'count', value: 'count', key: 'id', type: colTypes.NUMBER, active: false, count: true, aggregate: true,\r\n        }, {\r\n            name: 'size', value: 'size', key: 'orderRecord.id', type: colTypes.NUMBER, active: true, aggregate: true, color: 1,\r\n        }, {\r\n            name: 'stargazers_count', value: 'stargazers_count', key: 'id', type: colTypes.NUMBER, active: true, aggregate: true, color: 2,\r\n        }, {\r\n            name: 'watchers_count', value: 'watchers_count', key: 'id', type: colTypes.NUMBER, active: true, aggregate: true, color: 3,\r\n        }, {\r\n            name: 'score', value: 'score', key: 'id', type: colTypes.NUMBER, active: true, aggregate: true, color: 4,\r\n        }, {\r\n            name: 'A = score * 2', value: 'score * 2', raw: 'A', key: 'id', type: colTypes.NUMBER, active: true, aggregate: true\r\n        }, {\r\n            name: 'B = A * 3', value: 'A * 3', raw: 'B', key: 'id', type: colTypes.NUMBER, active: true, aggregate: true\r\n        }, {\r\n            name: 'C = B / A', value: 'B / A', raw: 'C', key: 'id', type: colTypes.NUMBER, active: true, aggregate: true\r\n        }]\r\n    }\r\n\r\n    var cols = $scope.cols = new Columns(CountryCols());\r\n    cols = $scope.cols = cols.expand({ dynamic: true, compare: false });\r\n    cols.showReport = true;\r\n    var defaults = cols.map(function (col) { \r\n        return { \r\n            id: col.id, \r\n            active: col.active,\r\n        };\r\n    });\r\n    var colGroups = $scope.colGroups = [{\r\n        name: 'GroupBy',\r\n        cols: cols.getGroups()\r\n    }, ];\r\n    var valGroups = $scope.valGroups = [{\r\n        name: 'Aggregate',\r\n        cols: cols.getAggregates()\r\n    }];\r\n    var excludes = $scope.excludes = [/*{\r\n        name: 'Monte ore / tutti i reparti', filter: function (row) {\r\n            return !(row.supplier.id === 15143);\r\n        }, active: true,\r\n    }, */];\r\n    var includes = $scope.includes = [];\r\n\r\n    var compares;\r\n    var source = $scope.source = new DataSource({\r\n        unpaged: true,\r\n        uri: function () {\r\n            return 'api/restcountries.all.js';\r\n            return 'https://restcountries.eu/rest/v2/all';\r\n            return 'https://api.github.com/search/repositories?q=tetris+language:javascript&sort=stars&order=desc&per_page=100';\r\n        },\r\n        filters: filters,\r\n        resolveItems: function (items, rows, comparing) {\r\n            console.log(items);\r\n            // items = items.items;\r\n            angular.forEach(items, function (item, index) {\r\n                item.id = this.id;\r\n                var date = new Date(item.created_at);\r\n                if (comparing) {\r\n                    date = new Date(date.setFullYear(date.getFullYear() + 1));\r\n                }\r\n                item.dt = date;\r\n                item.dt.setDate(1);\r\n                item.dt.setHours(0, 0, 0, 0);\r\n                item.dt = item.dt.getTime();\r\n                item.month = $filter('date')(date, '(yyyy MM) MMMM');\r\n                item.monthShort = $filter('date')(date, 'MMM yy');\r\n                rows.push(item);\r\n                this.id++;\r\n            }, this);\r\n            return rows;\r\n        },\r\n        resolve: function (deferred) {\r\n            compares = null;\r\n            this.id = 1;\r\n            this.resolveItems(this.response.data, this.rows);\r\n            deferred.resolve();\r\n        },\r\n        group: function (deferred) {\r\n            if (cols.showComparison) {\r\n                if (compares) {\r\n                    GroupColumns(this.rows, this.items, compares);\r\n                    deferred.resolve();\r\n                } else {\r\n                    // loadAndParseCompares\r\n                    var from = new Date(filters.dateFrom.getTime());\r\n                    var to = new Date(filters.dateTo.getTime());\r\n                    var params = {\r\n                        dateFrom: new Date(from.setFullYear(from.getFullYear() - 1)),\r\n                        dateTo: new Date(to.setFullYear(to.getFullYear() - 1)),\r\n                    };\r\n                    Api.reports.negotiations(params).then(function success(response) {\r\n                        compares = this.resolveItems(response, [], true);\r\n                        GroupColumns(this.rows, this.items, compares);\r\n                        deferred.resolve();\r\n                    }.bind(this));\r\n                }\r\n            } else {\r\n                GroupColumns(this.rows, this.items);\r\n                deferred.resolve();\r\n            }\r\n        },\r\n        search: function (datasource) {\r\n            // console.log('search', datasource.items, datasource.filters);\r\n        },\r\n        sort: function (datasource) {\r\n            // console.log('sort', datasource.items, datasource.filters);\r\n        },\r\n    });\r\n\r\n    $scope.setRangeDiff = function (diff) {\r\n        angular.forEach(ranges, function (range) {\r\n            if (range.is(filters)) {\r\n                range.setDiff(diff);\r\n                range.set(filters, source);\r\n            }\r\n        });\r\n    };\r\n    $scope.resetFilters = function () {\r\n        angular.forEach(cols, function (col, key) {\r\n            angular.forEach(defaults, function (item) {\r\n                if (col.id === item.id) {\r\n                    angular.isFunction(col.active) ? null : col.active = item.active;\r\n                }\r\n            });\r\n            col.search = null;\r\n        });\r\n        cols = $scope.cols = cols.sort(function (a, b) {\r\n            return a.id - b.id;\r\n        });\r\n        // cols.radios.workloads = 'supplier.name';\r\n        source.update();\r\n    };\r\n    $scope.exclude = function (item) {\r\n        item.active = !item.active;\r\n        source.update();\r\n    };\r\n    $scope.include = function (item) {\r\n        item.active = !item.active;\r\n        source.update();\r\n    };\r\n    $scope.toggleCol = function (col) {\r\n        cols.toggleColumns(col);\r\n        source.update();\r\n    };\r\n    $scope.doFilter = function (cols) {\r\n        // source.update(); // doing regroup\r\n        return function (item) {\r\n            var has = true;\r\n            angular.forEach(cols, function (col) {\r\n                if (col.isActive() && col.search && col.search.id !== 0) {\r\n                    has = has && col.getKey(item) === col.search.id;\r\n                }\r\n            }.bind(this));\r\n            return has;\r\n        };\r\n    };\r\n    $scope.doFilterMultiple = function (cols) {\r\n        // source.update(); // doing regroup\r\n        return function (item) {\r\n            var has = true;\r\n            angular.forEach(cols, function (col) {\r\n                if (col.isActive() && col.search.length) {\r\n                    has = has && col.search.indexOf(col.getKey(item)) != -1;\r\n                }\r\n            }.bind(this));\r\n            return has;\r\n        };\r\n    };\r\n    $scope.doFilterColumns = function (cols) {\r\n        return function (col) {\r\n            return col.isActive(); // col.dynamic ? (cols.showDynamics && col.active()) : col.active;\r\n        };\r\n    };\r\n    $scope.doOrder = function (cols) {\r\n        return function (item) {\r\n            return cols.getSortKey(item);\r\n        };\r\n    };\r\n    $scope.getRowClass = function (item) {\r\n        return ''; // item.status ? 'status-' + Appearance.negotiationClass(item.status.id) : '';\r\n    };\r\n    $scope.onOpen = function (item) {\r\n        $location.path('/trattative/' + item.id);\r\n    };\r\n    $scope.excel = function (columns, rows) {\r\n        console.log('excel', columns, rows);\r\n        var json = {\r\n            name: 'Report carichi di lavoro',\r\n            description: 'Report carichi di lavoro', // + $filter('date')(filters.dateFrom, 'dd MMM yyyy') + ' al ' + $filter('date')(filters.dateTo, 'dd MMM yyyy'),\r\n            columns: [],\r\n            rows: [],\r\n        };\r\n        angular.forEach(columns, function (col, index) {\r\n            json.columns.push({\r\n                index: index,\r\n                name: col.name,\r\n                format: col.getFormat(),\r\n            });\r\n        });\r\n        angular.forEach(rows, function (row, index) {\r\n            var item = [];\r\n            angular.forEach(columns, function (col, index) {\r\n                item[index] = col.getValue(row);\r\n                switch (col.type) {\r\n                    case colTypes.PERCENT:\r\n                    case colTypes.INCREMENT:\r\n                        item[index] /= 100;\r\n                        break;\r\n                }\r\n            });\r\n            json.rows.push(item);\r\n        });\r\n        var item = [];\r\n        angular.forEach(columns, function (col, index) {\r\n            if (col.aggregate) {\r\n                item[index] = col.getValueTotal(rows);\r\n                switch (col.type) {\r\n                    case colTypes.PERCENT:\r\n                    case colTypes.INCREMENT:\r\n                        item[index] /= 100;\r\n                        break;\r\n                }\r\n            } else {\r\n                item[index] = null;\r\n            }\r\n        });\r\n        json.rows.push(item);\r\n        Api.app.exportExcel(json).then(function success(response) {\r\n            var headers = response.headers();\r\n            // console.log(response);\r\n            var blob = new Blob([response.data], { type: headers['content-type'] });\r\n            var windowUrl = (window.URL || window.webkitURL);\r\n            var downloadUrl = windowUrl.createObjectURL(blob);\r\n            var anchor = document.createElement(\"a\");\r\n            anchor.href = downloadUrl;\r\n            var fileNamePattern = /filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/;\r\n            anchor.download = fileNamePattern.exec(headers['content-disposition'])[1];\r\n            document.body.appendChild(anchor);\r\n            anchor.click();\r\n            windowUrl.revokeObjectURL(blob);\r\n            anchor.remove();\r\n            /*\r\n            //Dispatching click event.\r\n            if (document.createEvent) {\r\n                var e = document.createEvent('MouseEvents');\r\n                e.initEvent('click', true, true);\r\n                link.dispatchEvent(e);\r\n                return true;\r\n            }\r\n             */\r\n            return;\r\n\r\n        }, function error(response) {\r\n            state.error(response);\r\n        });\r\n    };\r\n    $scope.$on('onDropItem', function (scope, event) {\r\n        // console.log('NegotiationReportCtrl.onDropItem', 'from', event.from, 'to', event.to);\r\n        var fromIndex = cols.indexOf(event.from.model);\r\n        var toIndex = cols.indexOf(event.to.model);\r\n        var item = cols[fromIndex];\r\n        cols.splice(fromIndex, 1);\r\n        cols.splice(toIndex, 0, item);\r\n    });\r\n    $scope.$on('onDropOut', function (scope, event) {\r\n        // console.log('NegotiationReportCtrl.onDropOut', event.model, event.from, event.to, event.target);\r\n    });\r\n\r\n    function Init() {\r\n        state.ready();\r\n    }    \r\n\r\n    /*\r\n    $scope.output = \"A\";\r\n    $http.get('https://api.github.com/search/repositories?q=tetris+language:javascript&sort=stars&order=desc&per_page=100').then(function success(response) {\r\n        $scope.output = response;\r\n    });\r\n    */\r\n\r\n}]);\r\n\n/* global angular, app */\r\n\r\nvar aid = 0; // application unique id counter using for dev\r\n\r\napp.directive('controlRow', ['$http', '$templateCache', '$compile', 'Utils', function ($http, $templateCache, $compile, Utils) {\r\n    function templateFunction (element, attributes) {\r\n        var form = attributes.form || 'Form';\r\n        var title = attributes.title || 'Untitled';\r\n        var placeholder = attributes.placeholder || title;\r\n        var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++aid);\r\n        var formKey = form + '.' + name;\r\n        var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n        var message = '', decoration = '', disabled = '';\r\n        var label = (attributes.label ? attributes.label : 'name');\r\n        var key = (attributes.key ? attributes.key : 'id');\r\n        var model = attributes.model;\r\n        var change = (attributes.onChange ? ' ng-change=\"' + attributes.onChange + '\"' : '');\r\n        var inputCols = attributes.cols ? 6 : 9;\r\n        var colInput = 'col-lg-' + inputCols;\r\n        var colLabel = 'col-lg-' + (12 - inputCols);\r\n        var required = (attributes.required ? ' required=\"true\"' : '');\r\n        var readonly = (attributes.readonly ? ' readonly' : '');\r\n        var options = (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '');\r\n        var validate = (attributes.validate ? ' validate-type=\"' + attributes.validate + '\" ' : '');\r\n        var format = (attributes.format ? ' format=\"' + attributes.format + '\" ' : '');\r\n        var precision = (attributes.precision ? ' precision=\"' + attributes.precision + '\" ' : '');\r\n        if (attributes.disabled) {\r\n            disabled = ' disabled';\r\n        }\r\n        if (attributes.required) {\r\n            decoration = attributes.readonly || attributes.disabled ? '' : '<sup>✽</sup>';            \r\n        }\r\n        message = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$touched) && ') + formKey + '.$error\" role=\"alert\">';\r\n        message = message + '<span ng-message=\"required\" class=\"label-error animated flash\">obbligatorio ⤴</span>';\r\n        switch (attributes.controlRow) {\r\n            case 'password':\r\n                message = message + '<span ng-message=\"minlength\" class=\"label-error animated flash\">almeno 3 caratteri ⤴</span>';\r\n                break;\r\n            case 'email':\r\n                message = message + '<span ng-message=\"email\" class=\"label-error animated flash\">valore non corretto ⤴</span>';\r\n                break;\r\n            case 'number':\r\n            case 'range':\r\n                message = message + '<span ng-message=\"positive\" class=\"label-error animated flash\">solo valori positivi ⤴</span>';\r\n                message = message + '<span ng-message=\"number\" class=\"label-error animated flash\">solo valori numerici ⤴</span>';\r\n                break;\r\n        }\r\n        if (attributes.match !== undefined) {\r\n            message = message + '<span ng-message=\"match\" class=\"label-error animated flash\">non corrispondente ⤴</span>';\r\n        }\r\n        message = message + '</span>';\r\n        var validation = ' ng-class=\"{ \\'control-focus\\': ' + formKey + '.hasFocus, \\'control-success\\': ' + formKey + '.$valid, \\'control-error\\': ' + formKey + '.$invalid && (' + form + '.$submitted || ' + formKey + '.$touched), \\'control-empty\\': !' + formKey + '.$viewValue }\"';\r\n        var template = '<div class=\"row\" ' + validation + '><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + decoration + '</label><div class=\"' + colInput + ' col-' + attributes.controlRow + '\">';\r\n        switch (attributes.controlRow) {\r\n            case 'static':\r\n                var click = (attributes.click ? ' ng-click=\"' + attributes.click + '\"' : '');\r\n                var mouseover = (attributes.mouseover ? ' ng-mouseover=\"' + attributes.mouseover + '\"' : '');\r\n                var mouseout = (attributes.mouseout ? ' ng-mouseover=\"' + attributes.mouseout + '\"' : '');\r\n                var icon = (attributes.icon ? '<i class=\"pull-xs-right ' + attributes.icon + '\"></i>' : '');\r\n                template += '<p class=\"form-control\" ' + click + mouseover + mouseout + '><span ng-bind-html=\"' + model + ' || \\'&nbsp;\\'\"></span>' + icon + '</p>';\r\n                break;\r\n            case 'checkbox':\r\n                template = '<div class=\"' + colInput + '\"' + validation + '><div class=\"col-xs-12\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + '\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">' + title + '</span>';\r\n                template += '</label>';\r\n                // template += '<input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + required + ' class=\"toggle toggle-round-flat\">';\r\n                /*\r\n                template = '<div class=\"checkbox\">';\r\n                template += '<span class=\"checkbox-label\">' + title + required +'</span>';\r\n                template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + required + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                template += '</div>';\r\n                */\r\n                break;\r\n            case 'yesno':\r\n                template = '<div class=\"row\" ' + validation + '><label class=\"col-lg-6 custom-control custom-checkbox\">' + title + decoration + '</label>';\r\n                template += '<div class=\"' + colLabel + '\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + '\" ng-change=\"' + model + 'No=!' + model + '\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">Sì</span>';\r\n                template += '</label></div>';\r\n                template += '<div class=\"' + colLabel + '\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + 'No\" ng-change=\"' + model + '=!' + model + 'No\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">No</span>';\r\n                template += '</label>';\r\n                // template += '<input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + required + ' class=\"toggle toggle-round-flat\">';\r\n                /*\r\n                template = '<div class=\"checkbox\">';\r\n                template += '<span class=\"checkbox-label\">' + title + required +'</span>';\r\n                template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + required + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                template += '</div>';\r\n                */\r\n                break;\r\n            case 'switch':\r\n                template = '<div class=\"row control-switch\" ' + validation + '><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + decoration + '</label>';\r\n                template += '<div class=\"' + colInput + '\">';\r\n                template += '<switch name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + options + ' on=\"Sì\" off=\"No\" ' + required + disabled + readonly + formFocus + '></switch>';\r\n                break;\r\n            case 'range':\r\n                validate = ' validate-type=\"number\"';\r\n                var nameHi = name + 'Hi';\r\n                var formKeyHi = form + '.' + nameHi;\r\n                var modelHi = attributes.modelHi;\r\n                var validationHi = ' ng-class=\"{ \\'control-focus\\': ' + formKeyHi + '.hasFocus, \\'control-success\\': ' + formKeyHi + '.$valid, \\'control-error\\': ' + formKeyHi + '.$invalid && (' + form + '.$submitted || ' + formKeyHi + '.$touched), \\'control-empty\\': !' + formKeyHi + '.$viewValue }\"';\r\n                var requiredHi = required;\r\n                if (attributes.requiredHi == 'true') {\r\n                    requiredHi = ' required=\"true\"';\r\n                } else if (attributes.requiredHi == 'false') {\r\n                    requiredHi = '';\r\n                }\r\n                var messageHi = ' ', decorationHi = ' ';\r\n                if (attributes.required && attributes.requiredHi !== 'false') {\r\n                    decorationHi = attributes.readonly || attributes.disabled ? '' : '<sup>✽</sup>';                    \r\n                }\r\n                messageHi = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKeyHi + '.$touched) && ') + formKeyHi + '.$error\" role=\"alert\">';\r\n                messageHi = messageHi + '<span ng-message=\"required\" class=\"label-error animated flash\">obbligatorio ⤴</span>';\r\n                switch (attributes.controlRow) {\r\n                    case 'password':\r\n                        messageHi = messageHi + '<span ng-message=\"minlength\" class=\"label-error animated flash\">almeno 3 caratteri ⤴</span>';\r\n                        break;\r\n                    case 'email':\r\n                        messageHi = messageHi + '<span ng-message=\"email\" class=\"label-error animated flash\">valore non corretto ⤴</span>';\r\n                        break;\r\n                    case 'number':\r\n                    case 'range':\r\n                        messageHi = messageHi + '<span ng-message=\"positive\" class=\"label-error animated flash\">solo valori positivi ⤴</span>';\r\n                        messageHi = messageHi + '<span ng-message=\"number\" class=\"label-error animated flash\">solo valori numerici ⤴</span>';\r\n                        break;\r\n                }\r\n                if (attributes.match !== undefined) {\r\n                    messageHi = messageHi + '<span ng-message=\"match\" class=\"label-error animated flash\">non corrispondente ⤴</span>';\r\n                }\r\n                messageHi = messageHi + '</span>';\r\n                template = '<div class=\"row\"><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + '</label><div class=\"' + colInput + ' col-' + attributes.controlRow + '\">';\r\n                template += '<div class=\"form-control-range form-control-range-min\" ' + validation + '>' + decoration + '<input class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>' + message + '</div>';\r\n                template += '<div class=\"form-control-range form-control-range-max\" ' + validationHi + '>' + decorationHi + '<input class=\"form-control\" name=\"' + nameHi + '\" ng-model=\"' + modelHi + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + requiredHi + disabled + readonly + formFocus + validate + format + precision + '>' + messageHi + '</div>';\r\n                return template + '</div></div>';\r\n                break;\r\n            case 'range-slider':\r\n                var himodel = (attributes.himodel ? ' rz-slider-high=\"' + attributes.himodel + '\" ' : '');\r\n                options = (attributes.options ? ' rz-slider-options=\"' + attributes.options + '\" ' : '');\r\n                template += '<rzslider rz-slider-model=\"' + model + '\" ' + himodel + options + '\"></rzslider>';\r\n                break;\r\n            case 'select':\r\n                var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\r\n                var optionLabel = Utils.format(label, 'item.', true);\r\n                var options = attributes.number\r\n                    ? 'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter\r\n                    : optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\r\n                template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + ' ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + required + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n                break;\r\n            case 'autocomplete':\r\n                var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n                var flatten = (attributes.flatten ? attributes.flatten : false);\r\n                var queryable = (attributes.queryable ? attributes.queryable : false);\r\n                var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n                template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" type=\"hidden\" ' + (attributes.required ? 'required' : '') + '>';\r\n                template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n                break;\r\n            case 'textarea':\r\n                var rows = (attributes.rows ? attributes.rows : '1');\r\n                template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" ' + required + disabled + ' rows=\"' + rows + '\"' + formFocus + '></textarea>';\r\n                break;\r\n            case 'htmltext':\r\n                template += '<div text-angular name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" ' + required + disabled + readonly + formFocus + (attributes.required ? ' ta-min-text=\"1\"' : '') + '></div>';\r\n                break;\r\n            case 'password':\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"password\" ng-minlength=\"2\" ' + required + disabled + formFocus + '>';\r\n                break;\r\n            case 'email':\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + required + disabled + formFocus + '>';\r\n                break;\r\n            case 'number':\r\n                validate = ' validate-type=\"number\"';\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n            case 'date':\r\n                validate = ' validate-type=\"date\"';\r\n                format = ' format=\"dd-MM-yyyy\"';\r\n                if (attributes.disabled || attributes.readonly) {\r\n                    template += '<div class=\"input-group\"><input type=\"text\" class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" placeholder=\"' + placeholder + '\" ' + required + disabled + readonly + formFocus + validate + format + '><span class=\"input-group-addon\"><i class=\"icon-calendar\"></i></span></div>';\r\n                } else {\r\n                    template += '<input type=\"date\" name=\"' + name + '\" class=\"form-control form-control-hidden\" is-open=\"flags.' + name + '\" ng-model=\"' + model + '\" placeholder=\"dd-MM-yyyy\" ' + required + disabled + readonly + formFocus + ' uib-datepicker-popup datepicker-options=\"sources.datepickerOptions\" datepicker-template-url=\"uib/template/datepicker/datepicker.html\" show-button-bar=\"false\" current-text=\"Oggi\" clear-text=\"Rimuovi\" close-text=\"Chiudi\">';\r\n                    template += '<div ng-click=\"(flags.' + name + ' = true)\" class=\"input-group disabled\"><input type=\"text\" class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" placeholder=\"' + placeholder + '\" ' + required + disabled + readonly + formFocus + validate + format + '><span class=\"input-group-addon\"><i class=\"icon-calendar\"></i></span></div>';\r\n                }\r\n                break;\r\n                /*\r\n            case 'date':\r\n                placeholder = placeholder || 'dd-MM-yyyy';\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"date\"' + required + disabled + readonly + formFocus + '>';\r\n                break;\r\n                */\r\n            case 'datetime-local':\r\n                placeholder = placeholder || 'dd-MM-yyyyTHH:mm:ss';\r\n                // placeholder == title ? placeholder = 'dd/MM/yyyyTHH:mm:ss' : null;\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + required + disabled + readonly + formFocus + '>';\r\n                break;\r\n            case 'text':\r\n            default:\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n        }\r\n        return template + message + '</div></div>';\r\n    }\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        compile: function (templateElement, templateAttributes) {            \r\n            return function (scope, element, attributes) {\r\n                element.html(templateFunction(templateElement, templateAttributes));\r\n                $compile(element.contents())(scope);\r\n            }\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('control', [function () {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        template: function (element, attributes) {\r\n            var form = attributes.form || 'Form';\r\n            var title = attributes.title || 'Untitled';\r\n            var placeholder = attributes.placeholder || title;\r\n            var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++aid);\r\n            var formKey = name; // form + '.' + name;\r\n            var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n            var message = '', decoration = '', disabled = '';\r\n            var label = (attributes.label ? attributes.label : 'name');\r\n            var key = (attributes.key ? attributes.key : 'id');\r\n            var model = attributes.model;\r\n            var change = (attributes.onChange ? ' ng-change=\"' + attributes.onChange + '\"' : '');\r\n            var required = (attributes.required ? ' required=\"true\"' : '');\r\n            var readonly = (attributes.readonly ? ' readonly' : '');\r\n            var options = (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '');\r\n            var validate = (attributes.validate ? ' validate-type=\"' + attributes.validate + '\" ' : '');\r\n            if (attributes.required) {\r\n                decoration = attributes.readonly || attributes.disabled ? '' : '<sup>✽</sup>';\r\n                message = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$dirty) && ') + formKey + '.$error\" role=\"alert\"><span ng-message=\"required\" class=\"label-error animated flash\"> ⤴ required</span>';\r\n                switch (attributes.control) {\r\n                    case 'password':\r\n                        message = message + '<span ng-message=\"minlength\" class=\"label-error animated flash\"> ⤴ at least 3 chars</span>';\r\n                        break;\r\n                    case 'email':\r\n                        message = message + '<span ng-message=\"email\" class=\"label-error animated flash\"> ⤴ incorrect</span>';\r\n                        break;\r\n                    case 'number':\r\n                        message = message + '<span ng-message=\"number\" class=\"label-error animated flash\"> ⤴ enter a valid number</span>';\r\n                        message = message + '<span ng-message=\"number\" class=\"label-error animated flash\"> ⤴ enter a positive number</span>';\r\n                        break;\r\n                }\r\n                if (attributes.match !== undefined) {\r\n                    message = message + '<span ng-message=\"match\" class=\"label-error animated flash\"> ⤴ not matching</span>';\r\n                }\r\n                message = message + '</span>';\r\n            } else {\r\n                message = ' ';\r\n            }\r\n            if (attributes.disabled) {\r\n                disabled = ' disabled';\r\n            }\r\n            // var template = '<ng-form name=\"' + name + '\" ng-class=\"{ \\'control-focus\\': ' + formKey + '.hasFocus, \\'control-success\\': ' + formKey + '.$valid, \\'control-error\\': ' + formKey + '.$invalid && (' + form + '.$submitted || ' + formKey + '.$dirty), \\'control-empty\\': !' + formKey + '.$viewValue }\"><label for=\"' + name + '\" class=\"control-label\">' + title + message + '</label>';\r\n            var template = '<ng-form name=\"' + name + '\" ng-class=\"{ \\'control-focus\\': ' + formKey + '.hasFocus }\"><label for=\"' + name + '\" class=\"control-label\"><span class=\"control-title\">' + title + '</span>' + decoration + ' ' + message + '</label>';\r\n            // console.log('control' + formKey);\r\n            switch (attributes.control) {\r\n                case 'checkbox':\r\n                    template = '<ng-form name=\"' + name + '\" class=\"checkbox\">';\r\n                    template += '<span class=\"checkbox-label\"><span class=\"control-title\">' + title + '</span>' + decoration + ' ' + message + '</span>';\r\n                    template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + required + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                    template += '</div>';\r\n                    break;\r\n                case 'select':\r\n                    var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\r\n                    var options = attributes.number\r\n                        ? 'item.' + key + ' as item.' + label + ' for item in ' + attributes.source + filter\r\n                        : 'item.' + label + ' for item in ' + attributes.source + filter + ' track by item.' + key;\r\n                    template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + ' ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + required + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n                    break;\r\n                case 'autocomplete':\r\n                    var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n                    var flatten = (attributes.flatten ? attributes.flatten : false);\r\n                    var queryable = (attributes.queryable ? attributes.queryable : false);\r\n                    var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n                    template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + ' type=\"hidden\" ' + required +  disabled +'>';\r\n                    template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n                    break;\r\n                case 'textarea':\r\n                    var rows = (attributes.rows ? attributes.rows : '1');\r\n                    template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" ' + required + disabled +' rows=\"' + rows + '\"' + formFocus + '></textarea>';\r\n                    break;\r\n                case 'datetime-local':\r\n                    placeholder == title ? placeholder = 'yyyy-MM-ddTHH:mm:ss' : null;\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + required + readonly + formFocus + '>';\r\n                    break;\r\n                case 'password':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"password\" ng-minlength=\"2\" ' + required + disabled + formFocus + '>';\r\n                    break;\r\n                case 'email':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + required + disabled + formFocus + '>';\r\n                    break;\r\n                case 'number':\r\n                    validate = ' validate-type=\"number\"';\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + ' validate-type=\"number\">'; // ' validator=\"{ number: isNumber }\">';\r\n                    break;\r\n                case 'text':\r\n                default:\r\n                    // var log = ' ng-change=\"log(\\'' + formKey + '\\', \\'$valid\\', ' + formKey + '.$valid, \\'$dirty\\', ' + formKey + '.$dirty, \\'$pristine\\', ' + formKey + '.$pristine, \\'$error\\', ' + formKey + '.$error)\"';\r\n                    var log = '';\r\n                    template += '<input name=\"' + name + '\" ' + log + ' class=\"form-control\" ng-model=\"' + model + '\" ' + change + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + '>';\r\n                    break;\r\n            }\r\n            return template + '</ng-form>';\r\n        },\r\n        link: function (scope, element, attributes, model) {\r\n        },\r\n    };\r\n}]);\r\n\r\napp.directive('validateType', ['$filter', function ($filter) {\r\n    return {\r\n        require: 'ngModel',\r\n        link: function (scope, element, attributes, model) {\r\n            var validateType = attributes.validateType;\r\n            var format = attributes.format || '';\r\n            var precision = attributes.precision || 2;\r\n            var focus = false;\r\n            switch (validateType) {\r\n                case 'date':\r\n                case 'datetime':\r\n                case 'datetime-local':\r\n                    model.$formatters.push(function (value) {\r\n                        if (value) {\r\n                            return $filter('date')(value, format);\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    break;\r\n                case 'number':\r\n                    model.$parsers.unshift(function (value) {\r\n                        var valid = false, type = validateType;\r\n                        if (value !== undefined && value !== \"\") {\r\n                            valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \r\n                            value = Number(value);\r\n                            model.$setValidity('number', valid);\r\n                            if (valid) {\r\n                                model.$setValidity('positive', value >= 0.01);\r\n                                attributes.min !== undefined ? model.$setValidity('range', value >= Number(attributes.min)) : null;\r\n                                attributes.max !== undefined ? model.$setValidity('range', value <= Number(attributes.max)) : null;\r\n                            }\r\n                            /*                             \r\n                            if (valid) {\r\n                                if (value < 0.01) {\r\n                                    valid = false;\r\n                                    type = 'positive';\r\n                                }\r\n                                if (valid && attributes.min !== undefined) {\r\n                                    valid = valid && value >= Number(attributes.min);\r\n                                    if (!valid) {\r\n                                        type = 'range';\r\n                                    }\r\n                                }\r\n                                if (valid && attributes.max !== undefined) {\r\n                                    valid = valid && value <= Number(attributes.max);\r\n                                    if (!valid) {\r\n                                        type = 'range';\r\n                                    }\r\n                                }\r\n                            }\r\n                            */\r\n                            // console.log('validateType.number', type, valid, value);\r\n                        } else {\r\n                            valid = true;\r\n                            value = Number(value);\r\n                            model.$setValidity('number', true);\r\n                            model.$setValidity('positive', true);\r\n                            attributes.min !== undefined ? model.$setValidity('range', true) : null;\r\n                            attributes.max !== undefined ? model.$setValidity('range', true) : null;\r\n                        }\r\n                        return value;\r\n                    });\r\n                    model.$formatters.push(function (value) {\r\n                        if (value) {\r\n                            return $filter('number')(value, precision) + ' ' + format;\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    /*\r\n                    model.$render = function () {\r\n                        console.log('model.render', model.$modelValue);\r\n                        element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\r\n                    };\r\n                    */\r\n                    break;\r\n            }\r\n            function onFocus() {\r\n                focus = true;\r\n                if (format) {\r\n                    element[0].value = model.$modelValue || null;\r\n                    if (!model.$modelValue) {\r\n                        model.$setViewValue(null);\r\n                    }\r\n                }\r\n            }\r\n            function doBlur() {\r\n                if (format && !model.$invalid) {\r\n                    switch (validateType) {\r\n                        case 'date':\r\n                        case 'datetime':\r\n                        case 'datetime-local':\r\n                            element[0].value = model.$modelValue ? $filter('date')(model.$modelValue, format) : ' ';\r\n                            break;\r\n                        default:\r\n                            element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n            function onBlur() {\r\n                focus = false;\r\n                doBlur();\r\n            }\r\n            function addListeners() {\r\n                element.on('focus', onFocus);\r\n                element.on('blur', onBlur);\r\n            }\r\n            function removeListeners() {\r\n                element.off('focus', onFocus);\r\n                element.off('blur', onBlur);\r\n            }\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\r\n\r\napp.directive('dropdown', ['$window', 'Utils', function ($window, Utils) {\r\n    return {\r\n        restrict: 'C',\r\n        link: function (scope, element, attributes, model) {\r\n            var toggle = element[0].querySelector('.dropdown-toggle');\r\n            var opened = element.hasClass('open');\r\n            function onTap(e) {\r\n                element.toggleClass('open');\r\n                toggle.setAttribute('aria-expanded', element.hasClass('open').toString());\r\n                addCloseListeners();\r\n            };\r\n            function onTapOut(e) {\r\n                if (Utils.getClosest(e.target, '.dropdown')) {\r\n                    return true;\r\n                } else {\r\n                    element.removeClass('open');\r\n                    toggle.setAttribute('aria-expanded', element.hasClass('open').toString());\r\n                    removeCloseListeners();\r\n                }\r\n            };\r\n            function addCloseListeners() {\r\n                angular.element($window).on('touchend mouseup', onTapOut);\r\n            };\r\n            function removeCloseListeners() {\r\n                angular.element($window).off('touchend mouseup', onTapOut);\r\n            };\r\n            function addListeners() {\r\n                angular.element(toggle).on('touchstart mousedown', onTap);\r\n            };\r\n            function removeListeners() {\r\n                angular.element(toggle).off('touchstart mousedown', onTap);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n                removeCloseListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('dropup', ['$window', 'Utils', function ($window, Utils) {\r\n    return {\r\n        restrict: 'C',\r\n        link: function (scope, element, attributes, model) {\r\n            var toggle = element[0].querySelector('.dropdown-toggle');\r\n            var opened = element.hasClass('open');\r\n            function onTap(e) {\r\n                element.toggleClass('open');\r\n                toggle.setAttribute('aria-expanded', element.hasClass('open').toString());\r\n            };\r\n            function onTapOut(e) {\r\n                if (Utils.getClosest(e.target, '.dropdown')) {\r\n                    return true;\r\n                } else {\r\n                    element.removeClass('open');\r\n                    toggle.setAttribute('aria-expanded', element.hasClass('open').toString());\r\n                }\r\n            };\r\n            function addListeners() {\r\n                angular.element(toggle).on('touchstart mousedown', onTap);\r\n                angular.element($window).on('touchend mouseup', onTapOut);\r\n            };\r\n            function removeListeners() {\r\n                angular.element(toggle).off('touchstart mousedown', onTap);\r\n                angular.element($window).off('touchend mouseup', onTapOut);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('toggle', ['$window', '$document', '$timeout', 'Utils', 'Style', function ($window, $document, $timeout, Utils, Style) {\r\n    var togglers = [];\r\n    var reflow = function (element) {\r\n        new Function('bs', 'return bs')(element ? element.offsetHeight : 0);\r\n    };\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            if (!attributes.target) {\r\n                return;\r\n            }\r\n            var target;\r\n            var style = new Style();\r\n            function show() {\r\n                var collapsable = angular.element(target);\r\n                if (collapsable.hasClass('in')) {\r\n                    return;\r\n                }\r\n                collapsable.removeClass('collapse');\r\n                if (target) {\r\n                    var _height = target.offsetHeight;\r\n                    style.height = '0px';\r\n                    style.set(target);\r\n                    collapsable.removeClass('collapse').addClass('collapsing');\r\n                    target.setAttribute('aria-expanded', true);\r\n                    element.removeClass('collapsed');\r\n                    element[0].setAttribute('aria-expanded', true);\r\n                    setTimeout(function () {\r\n                        style.height = _height + 'px';\r\n                        style.set(target);\r\n                        setTimeout(function () {\r\n                            collapsable.removeClass('collapsing').addClass('collapse').addClass('in');\r\n                            target.style.height = 'auto';\r\n                        }, 500);\r\n                    }, 1);\r\n                    scope.$broadcast('onToggled', target);\r\n                }\r\n                addCloseListeners();\r\n            }\r\n            function hide() {\r\n                var collapsable = angular.element(target);\r\n                if (!collapsable.hasClass('in')) {\r\n                    return;\r\n                }\r\n                var _height = target ? target.offsetHeight : 0;\r\n                style.height = _height + 'px';\r\n                style.set(target);\r\n                collapsable.addClass('collapsing').removeClass('collapse').removeClass('in');\r\n                target.setAttribute('aria-expanded', false);\r\n                element.addClass('collapsed');\r\n                element[0].setAttribute('aria-expanded', false);                \r\n                setTimeout(function () {\r\n                    style.height = '0px';\r\n                    style.set(target);\r\n                    setTimeout(function () {\r\n                        collapsable.removeClass('collapsing').addClass('collapse');\r\n                        target.style.height = 'auto';\r\n                    }, 500);\r\n                }, 1);\r\n                removeCloseListeners();\r\n            }            \r\n            function onTap(e) {\r\n                // console.log('toggle.onTap');\r\n                /*\r\n                if (angular.element(target).hasClass('collapsing')) {\r\n                    return;\r\n                }\r\n                */\r\n                if (angular.element(target).hasClass('in')) {\r\n                    hide();\r\n                } else {\r\n                    show();\r\n                }\r\n            }\r\n            function onTapOut(e) {\r\n                // console.log('toggle.onTapOut', e);\r\n                if (Utils.getClosest(e.target, attributes.target)) {\r\n                    return true;\r\n                } else {\r\n                    hide();\r\n                }\r\n            };\r\n            function addCloseListeners() {\r\n                angular.element($window).on('touchend mouseup', onTapOut);\r\n            };\r\n            function removeCloseListeners() {\r\n                angular.element($window).off('touchend mouseup', onTapOut);\r\n            };\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onTap);\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onTap);\r\n            };\r\n            scope.$on('onToggled', function ($scope, $target) {\r\n                if (target !== $target) {\r\n                    // console.log('toggle.onToggled');\r\n                    hide();\r\n                }\r\n            });\r\n            scope.$on('$destroy', function () {\r\n                var index = togglers.indexOf(target);\r\n                if (index !== -1) {\r\n                    togglers.splice(index, 1);\r\n                }\r\n                removeListeners();\r\n                removeCloseListeners();\r\n            });\r\n            setTimeout(function () {\r\n                target = document.querySelector(attributes.target);\r\n                togglers.push(target);\r\n                // console.log('toggle', attributes.target, target);\r\n                addListeners();\r\n            });\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('toggleEnter', ['$window', '$document', '$timeout', 'Utils', 'Style', function ($window, $document, $timeout, Utils, Style) {\r\n    var togglers = [];\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            if (!attributes.target) {\r\n                return;\r\n            }\r\n            var target;\r\n            var style = new Style();\r\n            var to;\r\n            function show() {\r\n                var collapsable = angular.element(target);\r\n                if (collapsable.hasClass('in')) {\r\n                    return;\r\n                }\r\n                to ? clearTimeout(to) : null;\r\n                collapsable.removeClass('collapse');\r\n                if (target) {\r\n                    var _height = target.offsetHeight;\r\n                    style.height = '0px';\r\n                    style.set(target);\r\n                    collapsable.removeClass('collapse').addClass('collapsing');\r\n                    target.setAttribute('aria-expanded', true);\r\n                    element.removeClass('collapsed');\r\n                    element[0].setAttribute('aria-expanded', true);\r\n                    to = setTimeout(function () {\r\n                        style.height = _height + 'px';\r\n                        style.set(target);\r\n                        to = setTimeout(function () {\r\n                            collapsable.removeClass('collapsing').addClass('collapse').addClass('in');\r\n                            target.style.height = 'auto';\r\n                        }, 500);\r\n                    }, 1);\r\n                    scope.$broadcast('onToggleEntered', target);\r\n                }\r\n                addCloseListeners();\r\n            }\r\n            function hide() {\r\n                var collapsable = angular.element(target);\r\n                if (!collapsable.hasClass('in')) {\r\n                    return;\r\n                }\r\n                to ? clearTimeout(to) : null;\r\n                to = setTimeout(function () { \r\n                    var _height = target ? target.offsetHeight : 0;\r\n                    style.height = _height + 'px';\r\n                    style.set(target);\r\n                    collapsable.addClass('collapsing').removeClass('collapse').removeClass('in');\r\n                    target.setAttribute('aria-expanded', false);\r\n                    element.addClass('collapsed');\r\n                    element[0].setAttribute('aria-expanded', false);\r\n                    to = setTimeout(function () {\r\n                        style.height = '0px';\r\n                        style.set(target);\r\n                        to = setTimeout(function () {\r\n                            collapsable.removeClass('collapsing').addClass('collapse');\r\n                            target.style.height = 'auto';\r\n                        }, 125);\r\n                    }, 1);\r\n                    removeCloseListeners();\r\n                }, 500);\r\n            }\r\n            function onOver(e) {\r\n                if (angular.element(target).hasClass('collapsing')) {\r\n                    return;\r\n                }\r\n                show();\r\n            }\r\n            function onLeave(e) {\r\n                if (Utils.getClosest(e.toElement, attributes.target)) {\r\n                    return true;\r\n                } else {\r\n                    hide();\r\n                }\r\n            }\r\n            function onClick(e) {\r\n                if (Utils.getClosestElement(e.target, element[0])) {\r\n                    return true;\r\n                } else if (Utils.getClosest(e.target, attributes.target)) {\r\n                    return true;\r\n                } else {\r\n                    hide();\r\n                }\r\n            }\r\n            function addCloseListeners() {\r\n                if (attributes.toggleLeave) {\r\n                    element.on('mouseleave', onLeave);\r\n                    angular.element(target).on('mouseleave', onLeave);\r\n                } else {\r\n                    angular.element($window).on('click', onClick);\r\n                }\r\n            }\r\n            function removeCloseListeners() {\r\n                if (attributes.toggleLeave) {\r\n                    element.off('mouseleave', onLeave);\r\n                    angular.element(target).off('mouseleave', onLeave);\r\n                } else {\r\n                    angular.element($window).off('click', onClick);\r\n                }\r\n            }\r\n            function addListeners() {\r\n                element.on('mouseenter', onOver);\r\n            }\r\n            function removeListeners() {\r\n                element.off('mouseenter', onOver);\r\n            }\r\n            scope.$on('onToggleEntered', function ($scope, $target) {\r\n                if (target !== $target) {\r\n                    console.log('toggleEnter.onToggleEntered');\r\n                    hide();\r\n                }\r\n            });\r\n            scope.$on('$destroy', function () {\r\n                var index = togglers.indexOf(target);\r\n                if (index !== -1) {\r\n                    togglers.splice(index, 1);\r\n                }\r\n                removeListeners();\r\n                removeCloseListeners();\r\n            });\r\n            setTimeout(function () {\r\n                target = document.querySelector(attributes.target);\r\n                togglers.push(target);\r\n                addListeners();\r\n            });\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('state', ['$timeout', function ($timeout) {\r\n    return {\r\n        restrict: 'EA',\r\n        template: '<button type=\"button\" class=\"btn btn-sm btn-primary btn-block-md-down\" ng-class=\"stateClass()\" ng-disabled=\"stateDisabled()\"><span ng-transclude></span></button>',\r\n        transclude: true,\r\n        replace: true,\r\n        scope: {\r\n            state: '=',\r\n        },\r\n        link: function (scope, element, attributes, model) {\r\n            scope.stateClass = function () {\r\n                if (scope.state.button === element) {\r\n                    var sclass = {\r\n                        busy: scope.state.isBusy,\r\n                        successing: scope.state.isSuccessing,\r\n                        success: scope.state.isSuccess,\r\n                        errorring: scope.state.isErroring,\r\n                        error: scope.state.isError,\r\n                    };\r\n                    // console.log('stateClass', sclass);\r\n                    return sclass;\r\n                } else {\r\n                    return null;\r\n                }\r\n            };\r\n            scope.stateDisabled = function () {\r\n                var disabled = (scope.state.button && scope.state.button !== element); // || scope.$parent.$eval(attributes.onValidate);\r\n                // console.log('stateDisabled', disabled);\r\n                return disabled;\r\n            };\r\n            function onClick() {\r\n                $timeout(function () {\r\n                    if (!scope.$parent.$eval(attributes.onValidate)) {\r\n                        console.log('state.onClick', attributes.onValidate, attributes.onClick);\r\n                        scope.state.button = element;\r\n                        return scope.$parent.$eval(attributes.onClick);\r\n                    } else {\r\n                        scope.$parent.$eval('form.$setSubmitted()');\r\n                    }\r\n                });\r\n            };\r\n            function addListeners() {\r\n                element.on('touchstart click', onClick);\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart click', onClick);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('sortable', ['$timeout', function ($timeout) {    \r\n    return {\r\n        restrict: 'A',\r\n        scope: {\r\n            source: '=sortable',\r\n            key: '@sortableKey',\r\n            sort: '=?',\r\n        },\r\n        template: '<th ng-class=\"{ \\'sorted-up\\': sort == 1, \\'sorted-down\\': sort == -1 }\" ng-transclude></th>',\r\n        transclude: true,\r\n        replace: true,\r\n        link: function (scope, element, attributes, model) {\r\n            scope.sort = scope.sort || 0;\r\n            function onSort() {\r\n                scope.sort = scope.source.getSort(scope.key);\r\n                // console.log('sortable.onSort', scope.key, scope.source.filters.sort);\r\n            }\r\n            scope.$watchCollection('source.filters.sort', onSort);\r\n            onSort();\r\n            function onTap() {\r\n                if (scope.source.state.enabled()) {\r\n                    var sort = scope.sort ? (scope.sort * -1) : 1;\r\n                    scope.source.setSort(scope.key, sort).then(function (response) {\r\n                        scope.sort = sort;\r\n                    });\r\n                }\r\n            }\r\n            function addListeners() {\r\n                element.on('touchstart click', onTap);\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart click', onTap);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('draggableItem', ['$parse', '$timeout', 'Utils', 'Style', 'ElementRect', 'Droppables', function ($parse, $timeout, Utils, Style, ElementRect, Droppables) {\r\n\r\n    return {\r\n        require: 'ngModel',\r\n        link: function (scope, element, attributes, model) {\r\n            var nativeElement = element[0];\r\n            var selector = attributes.draggableItem || '.item';\r\n            var condition = attributes.draggableIf !== undefined ? $parse(attributes.draggableIf) : function () { return true; };\r\n            var target = nativeElement.querySelector(selector);\r\n            var style = new Style();\r\n            var elementRect = new ElementRect();\r\n            var down, move, diff, dragging, rects;\r\n            function onStart(e) {\r\n                if (condition(scope)) {\r\n                    down = Utils.getTouch(e);\r\n                    addDragListeners();\r\n                }\r\n                return false;\r\n            }\r\n            function onMove(e) {\r\n                move = Utils.getTouch(e);\r\n                diff = down.difference(move);\r\n                if (!dragging && diff.power() > 25) {\r\n                    dragging = true;\r\n                    element.addClass('dragging');\r\n                }\r\n                if (dragging) {\r\n                    style.transform = 'translateX(' + diff.x + 'px) translateY(' + diff.y + 'px)';\r\n                    style.set(target);\r\n                    elementRect.set(nativeElement).offset(diff);\r\n                    rects = Droppables.getIntersections(elementRect);\r\n                    if (rects.length) {\r\n                        angular.element(rects[0].native).addClass('dropping');\r\n                    }\r\n                }\r\n                // console.log(diff);\r\n                return false;\r\n            }\r\n            function onEnd(e) {\r\n                if (dragging) {\r\n                    dragging = false;\r\n                    element.removeClass('dragging');\r\n                    style.transform = 'none';\r\n                    style.set(target);\r\n                    var fromIndex = $parse(attributes.droppableIndex)(scope);\r\n                    var fromModel = $parse(attributes.ngModel)(scope);\r\n                    if (rects.length) {\r\n                        var event = null;\r\n                        angular.forEach(rects, function (rect, index) {\r\n                            angular.element(rect.native).removeClass('dropping over');\r\n                            if (rect.data.droppable(scope) && !event) {\r\n                                event = {\r\n                                    from: {\r\n                                        index: fromIndex,\r\n                                        model: fromModel,\r\n                                        target: target,\r\n                                    },\r\n                                    to: {\r\n                                        index: rect.data.index,\r\n                                        model: rect.data.model,\r\n                                        target: rect.native\r\n                                    },\r\n                                };\r\n                                $timeout(function () {\r\n                                    scope.$emit('onDropItem', event);\r\n                                });\r\n                            }\r\n                        });\r\n                    } else {\r\n                        var event = {\r\n                            from: {\r\n                                index: fromIndex,\r\n                                model: fromModel,\r\n                                target: target,\r\n                            },\r\n                            to: null,\r\n                        };\r\n                        $timeout(function () {\r\n                            scope.$emit('onDropOut', event);\r\n                        });\r\n                    }\r\n                }\r\n                removeDragListeners();\r\n                return false;\r\n            }\r\n            function addDragListeners() {\r\n                angular.element(window).on('touchmove mousemove', onMove);\r\n                angular.element(window).on('touchend mouseup', onEnd);\r\n            };\r\n            function removeDragListeners() {\r\n                angular.element(window).off('touchmove mousemove', onMove);\r\n                angular.element(window).off('touchend mouseup', onEnd);\r\n            };\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onStart);\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onStart);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\r\n\r\napp.directive('droppableItem', ['$parse', 'Utils', 'Style', 'Droppables', function ($parse, Utils, Style, Droppables) {\r\n    var droppables = {};\r\n    return {\r\n        require: 'ngModel',\r\n        link: function (scope, element, attributes, model) {\r\n            var nativeElement = element[0];\r\n            var selector = attributes.droppableItem || '.item';\r\n            function onGetData() {\r\n                var index = $parse(attributes.droppableIndex)(scope);\r\n                var model = $parse(attributes.ngModel)(scope);\r\n                var droppable = attributes.droppableIf !== undefined ? $parse(attributes.droppableIf) : function () { return true };\r\n                return {\r\n                    index: index,\r\n                    model: model,\r\n                    droppable: droppable,\r\n                };\r\n            }\r\n            Droppables.add(nativeElement, onGetData);\r\n            scope.$on('$destroy', function () {\r\n                Droppables.remove(nativeElement);\r\n            });\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('linkTo', ['$parse', '$timeout', '$location', function ($parse, $timeout, $location) {\r\n    return {\r\n        link: function (scope, element, attributes, model) {\r\n            if (!attributes.linkTo) {\r\n                return;\r\n            }\r\n            function onLink() {\r\n                var link = $parse(attributes.linkTo)(scope);\r\n                if (!link) {\r\n                    return;\r\n                }\r\n                element.attr('href', link.href);\r\n                element.attr('target', link.target);\r\n            }\r\n            function onTap(event) {\r\n                var link = $parse(attributes.linkTo)(scope);\r\n                if (!link) {\r\n                    return;\r\n                }\r\n                element.attr('href', link.href);\r\n                element.attr('target', link.target);\r\n                if (link.target === '_blank') {\r\n                    window.open(link.href, '_blank');\r\n                } else {\r\n                    $timeout(function () {\r\n                        var href = link.href.split(window.domain).join('');\r\n                        $location.path(href);                        \r\n                    });\r\n                }\r\n                event.stopImmediatePropagation();\r\n                event.preventDefault();\r\n                return false;\r\n            }\r\n            var events = {\r\n                tap: 'click', // 'touchstart mousedown', // 'click',\r\n            };\r\n            function addListeners() {\r\n                element.on(events.tap, onTap);\r\n            };\r\n            function removeListeners() {\r\n                element.off(events.tap, onTap);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n            $timeout(onLink);\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('pop', ['$parse', '$templateRequest', '$compile', '$controller', '$window', '$document', '$timeout', 'Utils', 'Style', function ($parse, $templateRequest, $compile, $controller, $window, $document, $timeout, Utils, Style) {\r\n    /*\r\n    function compilePop(scope, element, html, data) {\r\n        element.html(html);\r\n        var link = $compile(element.contents());\r\n        console.log(data.controller, scope, element, html, data);\r\n        if (data.controller) {\r\n            var $scope = scope.$new(true);\r\n            $scope = angular.extend($scope, data);\r\n            var controller = $controller(data.controller, $scope); // , modal);\r\n            if (data.controllerAs) {\r\n                scope[data.controllerAs] = controller;\r\n            }\r\n            element.data('$ngControllerController', controller);\r\n            element.children().data('$ngControllerController', controller);\r\n        }\r\n        link(scope);\r\n    }\r\n    */\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            var native = element[0], promise;\r\n            var pop = {\r\n                target: null,\r\n                element: null,\r\n                native: null,\r\n            };\r\n            function onOver(e) {\r\n                promise = $timeout(function () {\r\n                    onTargetOver();\r\n                }, 1000);\r\n            }\r\n            function onOut(e) {\r\n                promise ? $timeout.cancel(promise) : null;\r\n            };\r\n            function getPageScroll() {\r\n                var supportPageOffset = window.pageXOffset !== undefined;\r\n                var isCSS1Compat = ((document.compatMode || \"\") === \"CSS1Compat\");\r\n                var x = supportPageOffset ? window.pageXOffset : isCSS1Compat ? document.documentElement.scrollLeft : document.body.scrollLeft;\r\n                var y = supportPageOffset ? window.pageYOffset : isCSS1Compat ? document.documentElement.scrollTop : document.body.scrollTop;\r\n                return { x: x, y: y };\r\n            }\r\n            function onTap() {\r\n                if (!pop.native) {\r\n                    var data = angular.copy($parse(attributes.pop)(scope));\r\n                    // console.log('pop.onTargetOver', attributes.pop, data);\r\n                    if (data && data != undefined) {\r\n                        data.onClose = function () {\r\n                            removeCloseListeners();\r\n                            pop.element.remove();\r\n                            pop.native = pop.element = promise = null;\r\n                        };\r\n                        pop.native = document.createElement('div');\r\n                        pop.element = angular.element(pop.native);\r\n                        pop.element.addClass('pop');\r\n                        /*\r\n                        var rect = native.getBoundingClientRect();\r\n                        var point = getPageScroll();\r\n                        pop.element.attr('style', 'top:' + (point.y) + 'px');\r\n                        */\r\n                        var body = $document.find('body').eq(0);\r\n                        body.append(pop.element);\r\n                        if (data.template) {\r\n                            $templateRequest(data.template).then(function (html) {\r\n                                Utils.compileController(scope, pop.element, html, data);\r\n                            });\r\n                        } else {\r\n                            Utils.compileController(scope, pop.element, '<div>pop</div>', data);\r\n                        }\r\n                        // console.log('element', pop.element);\r\n                        scope.$emit('onPopUp', pop.native);\r\n                        $timeout(function () {\r\n                            addCloseListeners();\r\n                        }, 1000);\r\n                    }\r\n                }\r\n                /*\r\n                if (angular.element(pop.native).hasClass('collapsing')) {\r\n                    return;\r\n                }\r\n                if (angular.element(pop.native).hasClass('in')) {\r\n                    hide();\r\n                } else {\r\n                    show();\r\n                }\r\n                */\r\n            }\r\n            function onTapOut(e) {\r\n                if (Utils.getClosest(e.target, '.pop')) {\r\n                    return true;\r\n                } else {\r\n                    if (pop.native) {\r\n                        removeCloseListeners();\r\n                        pop.element.remove();\r\n                        pop.native = pop.element = promise = null;\r\n                    }\r\n                }\r\n            };\r\n            scope.$watch(function () {\r\n                return pop.element ? pop.element[0].offsetHeight : 0;\r\n            }, function (newValue, oldValue) {\r\n                if (newValue !== oldValue && pop.element) {\r\n                    var rect = native.getBoundingClientRect();\r\n                    var point = getPageScroll();\r\n                    var top = Math.max(80, (rect.top + point.y - newValue));\r\n                    pop.element.attr('style', 'top:' + top + 'px');\r\n                }\r\n            });\r\n            function addCloseListeners() {\r\n                /*\r\n                element.on('mouseout', onTargetOut);\r\n                pop.element.on('mouseout', onTargetOut);\r\n                */\r\n                angular.element($window).on('click', onTapOut);\r\n            };\r\n            function removeCloseListeners() {\r\n                /*\r\n                element.off('mouseout', onTargetOut);\r\n                pop.element.off('mouseout', onTargetOut);\r\n                */\r\n                angular.element($window).off('click', onTapOut);\r\n            };\r\n            function addListeners() {\r\n                /*\r\n                element.on('mouseover', onOver);\r\n                element.on('mouseout', onOut);\r\n                */\r\n                element.on('click', onTap);\r\n            };\r\n            function removeListeners() {\r\n                /*\r\n                element.off('mouseover', onOver);\r\n                element.off('mouseout', onOut);\r\n                */\r\n                element.off('click', onTap);\r\n            };\r\n            scope.$on('onPopUp', function ($scope, $target) {\r\n                if (pop.native !== $target) {\r\n                    onTapOut();\r\n                }\r\n            });\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('onClickOut', ['$document', '$parse', '$timeout', 'Utils', function ($document, $parse, $timeout, Utils) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            function onClick(e) {\r\n                if (Utils.getClosestElement(e.target, element[0]) === null) {\r\n                    $timeout(function () {                    \r\n                        console.log('onClickOut', attributes.onClickOut, scope.cols.showValues);\r\n                        var onClickOut = $parse(attributes.onClickOut);\r\n                        onClickOut(scope);\r\n                    });\r\n                }\r\n            }\r\n            function addListeners() {\r\n                angular.element($document).on('click', onClick);\r\n            };\r\n            function removeListeners() {\r\n                angular.element($document).off('click', onClick);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\r\n\r\napp.directive('toggler', ['$document', '$parse', '$timeout', 'Utils', function ($document, $parse, $timeout, Utils) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            if (attributes.value === undefined) {\r\n                throw new Error('[toggler] attribute value required');\r\n            }\r\n            if (attributes.target === undefined) {\r\n                throw new Error('[toggler] attribute target required');\r\n            }\r\n            function isActive() {\r\n                return $parse(attributes.toggler + '==' + attributes.value)(scope);\r\n            }\r\n            function activate() {\r\n                addOutListeners();\r\n                $timeout(function () {\r\n                    $parse(attributes.toggler + '=' + attributes.value)(scope);\r\n                });\r\n            }\r\n            function deactivate() {\r\n                removeOutListeners();\r\n                $timeout(function () {\r\n                    $parse(attributes.toggler + '=null')(scope);\r\n                });\r\n            }\r\n            function onClick(e) {\r\n                setTimeout(function () {\r\n                    if (isActive()) {\r\n                        deactivate();\r\n                    } else {\r\n                        activate();\r\n                    }\r\n                }, 100);\r\n            }\r\n            function onClickOut(e) {\r\n                if (isActive()\r\n                    && Utils.getClosestElement(e.target, element[0]) === null\r\n                    && Utils.getClosest(e.target, attributes.target) === null) {\r\n                    deactivate();\r\n                }\r\n            }\r\n            function addOutListeners() {\r\n                angular.element($document).on('click', onClickOut);\r\n            };\r\n            function removeOutListeners() {\r\n                angular.element($document).off('click', onClickOut);\r\n            };\r\n            function addListeners() {\r\n                element.on('click', onClick);\r\n            };\r\n            function removeListeners() {\r\n                element.off('click', onClick);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n                removeOutListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\r\n\n/* global angular, app, Autolinker */\r\n\r\napp.filter('shortName', ['$filter', function ($filter) {\r\n    function toTitleCase(str) {\r\n        return str.replace(/\\w\\S*/g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });\r\n    }\r\n    return function (value) {\r\n        if (!value) {\r\n            return '';\r\n        }\r\n        if (value.indexOf(' .') === value.length - 2) {\r\n            value = value.split(' .').join('');\r\n        }\r\n        /*\r\n        var splitted;\r\n        if (value.indexOf('.') !== -1) {\r\n            splitted = value.split('.');\r\n        } else {\r\n            splitted = value.split(' ');\r\n        }\r\n        */\r\n        var splitted = value.split(' ');\r\n        var firstName = splitted.shift();\r\n        if (splitted.length) {\r\n            var lastName = splitted.join(' ');\r\n            return firstName.substr(0, 1).toUpperCase() + '.' + toTitleCase(lastName);\r\n        } else {\r\n            return firstName;\r\n        }\r\n    }\r\n}]);\r\n\r\napp.filter('customCurrency', ['$filter', function ($filter) {\r\n    var legacyFilter = $filter('currency');\r\n    return function (cost, currency) {\r\n        return legacyFilter(cost * currency.ratio, currency.formatting);\r\n    }\r\n}]);\r\n\r\napp.filter('customNumber', ['$filter', function ($filter) {\r\n    var filter = $filter('number');\r\n    return function (value, precision, unit) {\r\n        unit = unit || '';\r\n        return (value ? filter(value, precision) + unit : '-');\r\n    }\r\n}]);\r\n\r\napp.filter('customHours', [function () {\r\n    return function (value) {\r\n        if (value) {\r\n            var hours = Math.floor(value);\r\n            var minutes = Math.floor((value - hours) * 60);\r\n            var label = hours ? hours + ' H' : '';\r\n            label += minutes ? ' ' + minutes + ' m' : '';\r\n            return label;\r\n        } else {\r\n            return '-';\r\n        }\r\n    }\r\n}]);\r\n\r\napp.filter('customDate', ['$filter', function ($filter) {\r\n    var filter = $filter('date');\r\n    return function (value, format, timezone) {\r\n        return value ? filter(value, format, timezone) : '-';\r\n    }\r\n}]);\r\n\r\napp.filter('customTime', ['$filter', function ($filter) {\r\n    return function (value, placeholder) {\r\n        if (value) {\r\n            return Utils.parseTime(value);\r\n        } else {\r\n            return (placeholder ? placeholder : '-');\r\n        }\r\n    }\r\n}]);\r\n\r\napp.filter('customDigital', ['$filter', function ($filter) {\r\n    return function (value, placeholder) {\r\n        if (value) {\r\n            return Utils.parseHour(value);\r\n        } else {\r\n            return (placeholder ? placeholder : '-');\r\n        }\r\n    }\r\n}]);\r\n\r\napp.filter('customString', ['$filter', function ($filter) {\r\n    return function (value, placeholder) {\r\n        return value ? value : (placeholder ? placeholder : '-');\r\n    }\r\n}]);\r\n\r\napp.filter('customEnum', function () {\r\n    return function (val) {\r\n        val = val + 1;\r\n        return val < 10 ? '0' + val : val;\r\n    };\r\n});\r\n\r\napp.filter('groupBy', ['$parse', 'filterWatcher', function ($parse, filterWatcher) {\r\n    function _groupBy(collection, getter) {\r\n        var dict = {};\r\n        var key;\r\n        angular.forEach(collection, function (item) {\r\n            key = getter(item);\r\n            if (!dict[key]) {\r\n                dict[key] = [];\r\n            }\r\n            dict[key].push(item);\r\n        });\r\n        return dict;\r\n    }\r\n    return function (collection, property) {\r\n        if (!angular.isObject(collection) || angular.isUndefined(property)) {\r\n            return collection;\r\n        }\r\n        return filterWatcher.isMemoized('groupBy', arguments) || filterWatcher.memoize('groupBy', arguments, this, _groupBy(collection, $parse(property)));        \r\n    }\r\n}]);\r\n\r\napp.provider('filterWatcher', function () {\r\n    function isNull(value) {\r\n        return value === null;\r\n    }\r\n    function isScope(obj) {\r\n        return obj && obj.$evalAsync && obj.$watch;\r\n    }\r\n    this.$get = ['$window', '$rootScope', function ($window, $rootScope) {\r\n        var $$cache = {};\r\n        var $$listeners = {};\r\n        var $$timeout = $window.setTimeout;\r\n        function getHashKey(fName, args) {\r\n            function replacerFactory() {\r\n                var cache = [];\r\n                return function (key, val) {\r\n                    if (angular.isObject(val) && !isNull(val)) {\r\n                        if (~cache.indexOf(val)) {\r\n                            return '[Circular]';\r\n                        }\r\n                        cache.push(val);\r\n                    }\r\n                    if ($window == val) return '$WINDOW';\r\n                    if ($window.document == val) return '$DOCUMENT';\r\n                    if (isScope(val)) return '$SCOPE';\r\n                    return val;\r\n                }\r\n            }\r\n            return [fName, JSON.stringify(args, replacerFactory())]\r\n              .join('#')\r\n              .replace(/\"/g, '');\r\n        }\r\n        function removeCache(event) {\r\n            var id = event.targetScope.$id;\r\n            angular.forEach($$listeners[id], function (key) {\r\n                delete $$cache[key];\r\n            });\r\n            delete $$listeners[id];\r\n        }\r\n        function cleanStateless() {\r\n            $$timeout(function () {\r\n                if (!$rootScope.$$phase) {\r\n                    $$cache = {};\r\n                }\r\n            }, 2000);\r\n        }\r\n        function addListener(scope, hashKey) {\r\n            var id = scope.$id;\r\n            if (angular.isUndefined($$listeners[id])) {\r\n                scope.$on('$destroy', removeCache);\r\n                $$listeners[id] = [];\r\n            }\r\n            return $$listeners[id].push(hashKey);\r\n        }\r\n        function $$isMemoized(filterName, args) {\r\n            var hashKey = getHashKey(filterName, args);\r\n            return $$cache[hashKey];\r\n        }\r\n        function $$memoize(filterName, args, scope, result) {\r\n            var hashKey = getHashKey(filterName, args);\r\n            //store result in `$$cache` container\r\n            $$cache[hashKey] = result;\r\n            // for angular versions that less than 1.3\r\n            // add to `$destroy` listener, a cleaner callback\r\n            if (isScope(scope)) {\r\n                addListener(scope, hashKey);\r\n            } else {\r\n                cleanStateless();\r\n            }\r\n            return result;\r\n        }\r\n        return {\r\n            isMemoized: $$isMemoized,\r\n            memoize: $$memoize\r\n        }\r\n    }];\r\n});\r\n\n/* global angular, app */\r\n\r\napp.factory('Range', ['$filter', function ($filter) {\r\n    function Range(data) {\r\n        this.type = Range.types.QUARTER;\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    Range.prototype = {\r\n        currentQuarter: function () {\r\n            this.diff = 0;\r\n            return this.setQuarter();\r\n        },\r\n        currentSemester: function () {\r\n            this.diff = 0;\r\n            return this.setSemester();\r\n        },\r\n        currentYear: function () {\r\n            this.diff = 0;\r\n            return this.setYear();\r\n        },\r\n        setQuarter: function () {\r\n            this.type = Range.types.QUARTER;\r\n            var now = new Date();\r\n            now.setMonth(now.getMonth() + 3 * this.diff);\r\n            var year = now.getFullYear();\r\n            var quarter = Math.floor(now.getMonth() / 3);\r\n            this.from = new Date(year, quarter * 3, 1);\r\n            this.to = new Date(year, quarter * 3 + 3, 0);\r\n            return this;\r\n        },\r\n        setSemester: function () {\r\n            this.type = Range.types.SEMESTER;\r\n            var now = new Date();\r\n            now.setMonth(now.getMonth() + 6 * this.diff);\r\n            var year = now.getFullYear();\r\n            var semester = Math.floor(now.getMonth() / 6);\r\n            this.from = new Date(year, semester * 6, 1);\r\n            this.to = new Date(year, semester * 6 + 6, 0);\r\n            return this;\r\n        },\r\n        setYear: function () {\r\n            this.type = Range.types.YEAR;\r\n            var now = new Date();\r\n            now.setMonth(now.getMonth() + 12 * this.diff);\r\n            var year = now.getFullYear();\r\n            this.from = new Date(year, 0, 1);\r\n            this.to = new Date(year, 12, 0);\r\n            return this;\r\n        },\r\n        getName: function () {\r\n            switch (this.type) {\r\n                case Range.types.QUARTER:\r\n                    return 'Trimestre ' + $filter('date')(this.from, 'MMM') + '-' + $filter('date')(this.to, 'MMM') + ' ' + $filter('date')(this.from, 'yyyy');\r\n                    break;\r\n                case Range.types.SEMESTER:\r\n                    return 'Semestre ' + $filter('date')(this.from, 'MMM') + '-' + $filter('date')(this.to, 'MMM') + ' ' + $filter('date')(this.from, 'yyyy');\r\n                    break;\r\n                case Range.types.YEAR:\r\n                    return 'Anno ' + $filter('date')(this.from, 'yyyy');\r\n                    break;\r\n            }\r\n        },\r\n        setDiff: function(diff) {\r\n            this.diff += diff;\r\n            switch (this.type) {\r\n                case Range.types.QUARTER:\r\n                    return this.setQuarter();\r\n                    break;\r\n                case Range.types.SEMESTER:\r\n                    return this.setSemester();\r\n                    break;\r\n                case Range.types.YEAR:\r\n                    return this.setYear();\r\n                    break;\r\n            }\r\n        },\r\n        set: function (filters, source) {\r\n            filters.dateFrom = this.from;\r\n            filters.dateTo = this.to;\r\n            source ? source.setDates(filters.dateFrom, filters.dateTo) : null;\r\n            return this;\r\n        },\r\n        is: function (filters) {\r\n            return  filters.dateFrom.getTime() == this.from.getTime() &&\r\n                    filters.dateTo.getTime() == this.to.getTime();\r\n        },\r\n    };\r\n    Range.types = {\r\n        QUARTER: 1,\r\n        SEMESTER: 2,\r\n        YEAR: 3,\r\n    }\r\n    return Range;\r\n}]);\r\n\r\napp.factory('Base', [function () {\r\n    function Base() {\r\n    }\r\n    Base.prototype = {\r\n        $$super: null,\r\n        $super: {},\r\n        $ctor: function () {\r\n            this.$$super.apply(this, [].splice.call(arguments, 0));\r\n        },\r\n    };\r\n    Base.extend = function (data) {\r\n        if (!data || !data.constructor) {\r\n            throw ('Base.extend.error: please pass an object with constructor eg. { constructor: function myFunc() {...} }');\r\n        }\r\n        var constructor = data.constructor;\r\n        var methods = data.methods || {};\r\n        // statics\r\n        angular.extend(constructor, this);\r\n        // prototypes\r\n        constructor.prototype = angular.extend(Object.create(this.prototype), methods);\r\n        constructor.prototype.constructor = constructor;\r\n        constructor.prototype.$$super = this;\r\n        constructor.prototype.$super = {};\r\n        angular.forEach(this.prototype, function (value, key) {\r\n            constructor.prototype.$super[key] = function (scope) {\r\n                value.apply(scope, [].splice.call(arguments, 1));\r\n            };\r\n        });\r\n        return constructor;\r\n    };\r\n    Base.prototype.constructor = Base;\r\n    return Base;\r\n}]);\r\n\r\napp.factory('Point', ['Base', function (Base) {\r\n    var Point = Base.extend({\r\n        constructor: function Point(x, y, radius) {\r\n            this.x = x || 0;\r\n            this.y = y || 0;\r\n            this.radius = radius || 100;\r\n        },\r\n        methods: {\r\n            move: function (degree, w, h, pow) {\r\n                var radius = this.radius * (1 + pow);\r\n                this.x = w / 2 + radius * Math.sin(degree);\r\n                this.y = h / 2 + radius * Math.cos(degree);\r\n            },\r\n            draw: function (ctx) {\r\n                ctx.fillStyle = \"white\";\r\n                ctx.fillRect(this.x, this.y, 4, 4);\r\n            },\r\n        }\r\n    });\r\n    return Point;\r\n}]);\r\n\r\napp.factory('Vector', function () {\r\n    function Vector(x, y) {\r\n        this.x = x || 0;\r\n        this.y = y || 0;\r\n    }\r\n    Vector.make = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.size = function (a) {\r\n        return Math.sqrt(a.x * a.x + a.y * a.y);\r\n    };\r\n    Vector.normalize = function (a) {\r\n        var l = Vector.size(a);\r\n        a.x /= l;\r\n        a.y /= l;\r\n        return a;\r\n    };\r\n    Vector.incidence = function (a, b) {\r\n        var angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\r\n        // if (angle < 0) angle += 2 * Math.PI;\r\n        // angle = Math.min(angle, (Math.PI * 2 - angle));\r\n        return angle;\r\n    };\r\n    Vector.distance = function (a, b) {\r\n        return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\r\n    };\r\n    Vector.cross = function (a, b) {\r\n        return (a.x * b.y) - (a.y * b.x);\r\n    };\r\n    Vector.difference = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.power = function (a, b) {\r\n        var x = Math.abs(b.x - a.x);\r\n        var y = Math.abs(b.y - a.y);\r\n        return (x + y) / 2;\r\n    };\r\n    Vector.prototype = {\r\n        size: function () {\r\n            return Vector.size(this);\r\n        },\r\n        normalize: function () {\r\n            return Vector.normalize(this);\r\n        },\r\n        incidence: function (b) {\r\n            return Vector.incidence(this, b);\r\n        },\r\n        cross: function (b) {\r\n            return Vector.cross(this, b);\r\n        },\r\n        distance: function (b) {\r\n            return Vector.distance(this, b);\r\n        },\r\n        difference: function (b) {\r\n            return Vector.difference(this, b);\r\n        },\r\n        power: function () {\r\n            return (Math.abs(this.x) + Math.abs(this.y)) / 2;\r\n        },\r\n        towards: function (b, friction) {\r\n            friction = friction || 0.125;\r\n            this.x += (b.x - this.x) * friction;\r\n            this.y += (b.y - this.y) * friction;\r\n            return this;\r\n        },\r\n        add: function (b) {\r\n            this.x += b.x;\r\n            this.y += b.y;\r\n            return this;\r\n        },\r\n        friction: function (b) {\r\n            this.x *= b;\r\n            this.y *= b;\r\n            return this;\r\n        },\r\n        copy: function (b) {\r\n            return new Vector(this.x, this.y);\r\n        },\r\n        toString: function () {\r\n            return '{' + this.x + ',' + this.y + '}';\r\n        },\r\n    };\r\n    return Vector;\r\n});\r\n\r\napp.factory('ElementRect', ['Vector', function (Vector) {\r\n    function ElementRect() {\r\n        this.x = 0;\r\n        this.y = 0;\r\n        this.width = 0;\r\n        this.height = 0;\r\n        this.center = new Vector();\r\n    }\r\n    ElementRect.fromNative = function (nativeElement) {\r\n        return new ElementRect().set(nativeElement);\r\n    }\r\n    ElementRect.prototype = {\r\n        set: function (nativeElement) {\r\n            var rect = nativeElement.getBoundingClientRect();\r\n            this.x = rect.left;\r\n            this.y = rect.top;\r\n            this.width = nativeElement.offsetWidth;\r\n            this.height = nativeElement.offsetHeight;\r\n            this.center.x = this.x + this.width / 2;\r\n            this.center.y = this.y + this.height / 2;\r\n            this.native = nativeElement;\r\n            return this;\r\n        },\r\n        offset: function (vector) {\r\n            this.x += vector.x;\r\n            this.y += vector.y;\r\n            this.center.x = this.x + this.width / 2;\r\n            this.center.y = this.y + this.height / 2;\r\n            return this;\r\n        },\r\n        intersect: function (element) {\r\n            // console.log('intersect.this', this, 'element', element);\r\n            return !(element.x > this.x + this.width ||\r\n                        element.x + element.width < this.x ||\r\n                        element.y > this.y + this.height ||\r\n                        element.y + element.height < this.y);\r\n        },\r\n        toString: function () {\r\n            return '{' + this.x + ',' + this.y + ',' + this.width + ',' + this.height + '}';\r\n        },\r\n    };\r\n    return ElementRect;\r\n}]);\r\n\r\napp.factory('Style', function () {\r\n    var prefix = function detectTransformProperty() {\r\n        var transform = 'transform',\r\n            webkit = 'webkitTransform';\r\n        var div = document.createElement(\"DIV\");\r\n        if (typeof div.style[transform] !== 'undefined') {\r\n            ['webkit', 'moz', 'o', 'ms'].every(function (prop) {\r\n                var prefixed = '-' + prop + '-transform';\r\n                if (typeof div.style[prefixed] !== 'undefined') {\r\n                    prefix = prefixed;\r\n                    return false;\r\n                }\r\n                return true;\r\n            });\r\n        } else if (typeof div.style[webkit] !== 'undefined') {\r\n            prefix = '-webkit-transform';\r\n        } else {\r\n            prefix = undefined;\r\n        }\r\n        return prefix;\r\n    }();\r\n    function Style() {\r\n        this.props = {\r\n            scale: 1,\r\n            hoverScale: 1,\r\n            currentScale: 1,\r\n        }\r\n    }\r\n    Style.prototype = {\r\n        set: function (element) {\r\n            var styles = [];\r\n            angular.forEach(this, function (value, key) {\r\n                if (key !== 'props')\r\n                    styles.push(key + ':' + value);\r\n            });\r\n            element.style.cssText = styles.join(';') + ';';\r\n        },\r\n        transform: function (transform) {\r\n            this[prefix] = transform;\r\n        },\r\n        transformOrigin: function (x, y) {\r\n            this[prefix + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\r\n            this[prefix + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\r\n        },\r\n    };\r\n    Style.prefix = prefix;\r\n    return Style;\r\n});\r\n\r\napp.factory('Matrix', [function () {\r\n    var transform = { name: 'transform', key: 'transform', matrix: null };\r\n    var is3dSupported = function isSupported3d() {\r\n        if (!window.getComputedStyle) {\r\n            return false;\r\n        }\r\n        transform.matrix = window.WebKitCSSMatrix || window.MozCSSMatrix || window.MsCSSMatrix || window.OCSSMatrix || window.CSSMatrix;\r\n        if (!transform.matrix) {\r\n            return false;\r\n        }\r\n        var element = document.createElement('div'),\r\n            has = false,\r\n            properties = {\r\n                webkitTransform: '-webkit-transform',\r\n                OTransform: '-o-transform',\r\n                msTransform: '-ms-transform',\r\n                MozTransform: '-moz-transform',\r\n                transform: 'transform'\r\n            };\r\n\r\n        document.body.insertBefore(element, null);\r\n        for (var p in properties) {\r\n            if (element.style[p] !== undefined) {\r\n                element.style[p] = \"translate3d(1px,1px,1px)\";\r\n                has = window.getComputedStyle(element).getPropertyValue(properties[p]);\r\n                transform.name = p;\r\n                transform.key = properties[p];\r\n                break;\r\n            }\r\n        }\r\n        document.body.removeChild(element);\r\n        return (has !== undefined && has.length > 0 && has !== \"none\");\r\n    }(transform);\r\n    var decompositionTypeEnum = {\r\n        QRLike: 1,\r\n        LULike: 2,\r\n    };\r\n\r\n    function Matrix(element) {\r\n        this.element = element || document.createElement('div');\r\n        this.translate = { x: 0, y: 0, z: 0 };\r\n        this.rotate = { x: 0, y: 0, z: 0 };\r\n        this.scale = { x: 1, y: 1, z: 1 };\r\n        this.skew = { x: 0, y: 0 };\r\n        this.matrix = this.decompose();\r\n        this.decompositionType = decompositionTypeEnum.QRLike;\r\n        console.log('Matrix', is3dSupported, transform);\r\n        this.get();\r\n    }\r\n    Matrix.prototype.decompose = function () {\r\n        var computedStyle = window.getComputedStyle(this.element);\r\n        var style = computedStyle[transform.name]; //.transform || computedStyle.WebkitTransform || computedStyle.MozTransform || computedStyle.msTransform || computedStyle.OTransform;\r\n        if (!style) {\r\n            this.matrix = new transform.matrix();\r\n        } else {\r\n            style = style.trim();\r\n            this.matrix = new transform.matrix(style);\r\n            if (style === 'none') {\r\n                this.translate.x = this.translate.y = this.translate.z = 0;\r\n                this.rotate.x = this.rotate.y = this.rotate.z = 0;\r\n                this.scale.x = this.scale.y = this.scale.z = 1;\r\n                this.skew.x = this.skew.y = 0;\r\n\r\n            } else {\r\n                var matrix3dRegexp = /matrix3d\\((.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*),(.*)\\)/;\r\n                var matrix3dMatch = matrix3dRegexp.exec(style);\r\n\r\n                var matrix2dRegexp = /matrix\\((.*),(.*),(.*),(.*),(.*),(.*)\\)/;\r\n                var matrix2dMatch = matrix2dRegexp.exec(style);\r\n\r\n                if (matrix3dMatch !== null) {\r\n                    /*****************/\r\n                    /*** 3D MATRIX ***/\r\n                    /*****************/\r\n                    var matrix = new transform.matrix(style);\r\n                    if (!matrix || isNaN(matrix.a) || isNaN(matrix.b) || isNaN(matrix.c) || isNaN(matrix.m41) || isNaN(matrix.m42) || isNaN(matrix.m43) || isNaN(matrix.m11)) {\r\n                        throw \"Could not catch CSSMatrix constructor for current browser, OR the constructor has returned a non-standard matrix object (need .a, .b, .c and mXX numerical properties to work)\";\r\n                    }\r\n                    this.rotate.x = Math.asin(matrix.m22) * 180 / Math.PI; // deg;\r\n                    this.rotate.y = Math.acos(matrix.m11) * 180 / Math.PI * (matrix.m13 > 0 ? -1 : 1); // deg\r\n                    this.rotate.z = 0; // \"TODO: Sorry, math people. I really need help here! Please implement this case for me. This will help you: http://9elements.com/html5demos/matrix3d/\";\r\n                    this.translate.x = matrix.m41; // px;\r\n                    this.translate.y = matrix.m42; // px;\r\n                    this.translate.z = matrix.m43; // px;\r\n                    this.scale.x = matrix.m11; // if (matrix.m11 === matrix.m22 && matrix.m22 === matrix.m33)\r\n                    this.scale.y = matrix.m11; // if (matrix.m11 === matrix.m22 && matrix.m22 === matrix.m33)\r\n                    this.scale.z = matrix.m11; // if (matrix.m11 === matrix.m22 && matrix.m22 === matrix.m33)\r\n                    this.skew.x = 0;\r\n                    this.skew.y = 0;\r\n\r\n                } else if (matrix2dMatch !== null) {\r\n                    /*****************/\r\n                    /*** 2D MATRIX ***/\r\n                    /*****************/\r\n                    var a = parseFloat(matrix2dMatch[1]);\r\n                    var b = parseFloat(matrix2dMatch[2]);\r\n                    var c = parseFloat(matrix2dMatch[3]);\r\n                    var d = parseFloat(matrix2dMatch[4]);\r\n                    var e = parseFloat(matrix2dMatch[5]);\r\n                    var f = parseFloat(matrix2dMatch[6]);\r\n\r\n                    var delta = a * d - b * c;\r\n\r\n                    this.rotate.x = 0; // deg;\r\n                    this.rotate.y = 0; // deg;\r\n                    this.rotate.z = 0; // deg;\r\n\r\n                    this.translate.x = e; // px;\r\n                    this.translate.y = f; // px;\r\n                    this.translate.z = 0; // px;\r\n\r\n                    this.scale.x = 1;\r\n                    this.scale.y = 1;\r\n                    this.scale.z = 1;\r\n\r\n                    this.skew.x = 0;\r\n                    this.skew.y = 0;\r\n\r\n                    if (this.decompositionType === decompositionTypeEnum.QRLike) {\r\n                        // Apply the QR-like decomposition.\r\n                        if (a != 0 || b != 0) {\r\n                            var r = Math.sqrt(a * a + b * b);\r\n                            this.rotate.z = (b > 0 ? Math.acos(a / r) : -Math.acos(a / r));\r\n                            this.scale.x = r;\r\n                            this.scale.y = delta / r;\r\n                            this.skew.x = Math.atan((a * c + b * d) / (r * r));\r\n                            this.skew.y = 0;\r\n                        } else if (c != 0 || d != 0) {\r\n                            var s = Math.sqrt(c * c + d * d);\r\n                            this.rotate.z = Math.PI / 2 - (d > 0 ? Math.acos(-c / s) : -Math.acos(c / s));\r\n                            this.scale.x = delta / s;\r\n                            this.scale.y = s;\r\n                            this.skew.x = 0;\r\n                            this.skew.y = Math.atan((a * c + b * d) / (s * s));\r\n                        } else { // a = b = c = d = 0\r\n                            this.rotate.z = 0;\r\n                            this.scale.x = 0;\r\n                            this.scale.y = 0;\r\n                            this.skew.x = 0;\r\n                            this.skew.y = 0;\r\n                        }\r\n                    } else {\r\n                        // Apply the LU-like decomposition.\r\n                        if (a != 0) {\r\n                            this.rotate.z = 0;\r\n                            this.scale.x = a;\r\n                            this.scale.y = delta / a;\r\n                            this.skew.x = Math.atan(c / a);\r\n                            this.skew.y = Math.atan(b / a);\r\n                        } else if (b != 0) {\r\n                            this.rotate.z = Math.PI / 2;\r\n                            this.scale.x = b;\r\n                            this.scale.y = delta / b;\r\n                            this.skew.x = Math.atan(d / b);\r\n                            this.skew.y = 0;\r\n                        } else { // a = b = 0\r\n                            this.rotate.z = 0;\r\n                            this.scale.x = c;\r\n                            this.scale.y = d;\r\n                            this.skew.x = Math.PI / 4;\r\n                            this.skew.y = 0;\r\n                            this.scale.x = 0;\r\n                            this.scale.y = 1;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return this.matrix;\r\n    };\r\n    Matrix.prototype.compose = function () {\r\n        var matrix = new transform.matrix();\r\n        if (is3dSupported) {\r\n            matrix = matrix.translate(this.translate.x, this.translate.y, this.translate.z);\r\n            matrix = matrix.scale(this.scale.x, this.scale.y, this.scale.z);\r\n            matrix = matrix.rotate(this.rotate.x, this.rotate.y, this.rotate.z);\r\n        } else {\r\n            matrix = matrix.translate(this.translate.x, this.translate.y);\r\n            matrix = matrix.scale(this.scale.x, this.scale.y);\r\n            matrix = matrix.rotate(this.rotate.z);\r\n        }\r\n        return matrix;\r\n    };\r\n    Matrix.prototype.get = function () {\r\n        this.decompose();\r\n        console.log(this.toString());\r\n    };\r\n    Matrix.prototype.set = function () {\r\n        var matrix = this.compose().toString();\r\n        this.element.style[transform.name] = matrix;\r\n        // console.log('Matrix.set', matrix);\r\n        // console.log(this.toString());\r\n    };\r\n    Matrix.prototype.toString = function () {\r\n        var t = this.translate;\r\n        var r = this.rotate;\r\n        var s = this.scale;\r\n        return 'Matrix translate(' + t.x + ',' + t.y + ',' + t.z + ') rotate(' + r.x + ',' + r.y + ',' + r.z + ') scale(' + s.x + ',' + s.y + ',' + s.z + ')';\r\n    };\r\n    return Matrix;\r\n\r\n}]);\r\n\n/* global angular, app */\r\n\r\napp.service('Appearance', ['colTypes', function (colTypes) {\r\n\r\n    this.tableColumnClass = function (colType) {\r\n        var columnClass = '';\r\n        switch (colType) {\r\n            case colTypes.ID:\r\n                columnClass = 'tag tag-link';\r\n                break;\r\n            case colTypes.TEXT:\r\n            case colTypes.CUSTOMER:\r\n            case colTypes.FAMILY:\r\n                columnClass = 'text-uppercase';\r\n                break;\r\n            case colTypes.TITLE:\r\n                columnClass = 'col-text text-uppercase';\r\n                break;\r\n            case colTypes.DATE:\r\n                columnClass = 'tag tag-date';\r\n                break;\r\n            case colTypes.RESOURCE:\r\n            case colTypes.STATUS:\r\n            case colTypes.STATUSSM:\r\n                columnClass = 'tag tag-pill';\r\n                break;\r\n            case colTypes.DISABLED:\r\n                columnClass = 'tag tag-pill disabled';\r\n                break;\r\n            case colTypes.IDS:\r\n            case colTypes.NUMBER:\r\n            case colTypes.DOUBLE:\r\n            case colTypes.WEEKS:\r\n            case colTypes.HOURS:\r\n            case colTypes.COSTS:\r\n            case colTypes.ICON:\r\n            case colTypes.BUTTONS:\r\n                break;\r\n        }\r\n        return columnClass;\r\n    };\r\n\r\n    this.tableHeaderClass = function (colType) {\r\n        var columnClass = '';\r\n        switch (colType) {\r\n            case colTypes.ID:\r\n                columnClass = 'th-id';\r\n                break;\r\n            case colTypes.IDS:\r\n                columnClass = 'th-ids';\r\n                break;\r\n            case colTypes.TEXT:\r\n                columnClass = 'th-text';\r\n                break;\r\n            case colTypes.TITLE:\r\n                columnClass = 'th-title';\r\n                break;\r\n            case colTypes.DATE:\r\n                columnClass = 'th-date';\r\n                break;\r\n            case colTypes.CUSTOMER:\r\n                columnClass = 'th-customer';\r\n                break;\r\n            case colTypes.RESOURCE:\r\n            case colTypes.DISABLED:\r\n                columnClass = 'th-resource';\r\n                break;\r\n            case colTypes.STATUS:\r\n                columnClass = 'th-status';\r\n                break;\r\n            case colTypes.STATUSSM:\r\n                columnClass = 'th-status-sm';\r\n                break;\r\n            case colTypes.FAMILY:\r\n                columnClass = 'th-family';\r\n                break;\r\n            case colTypes.NUMBER:\r\n            case colTypes.DOUBLE:\r\n            case colTypes.WEEKS:\r\n                columnClass = 'th-number';\r\n                break;\r\n            case colTypes.HOURS:\r\n                columnClass = 'th-hours';\r\n                break;\r\n            case colTypes.COSTS:\r\n                columnClass = 'th-costs';\r\n                break;\r\n            case colTypes.ICON:\r\n                columnClass = 'th-icon';\r\n                break;\r\n            case colTypes.BUTTONS:\r\n                columnClass = 'th-buttons';\r\n                break;\r\n        }\r\n        return columnClass;\r\n    }\r\n    \r\n}]);\r\n\r\napp.factory('Cookie', ['$q', '$window', function ($q, $window) {\r\n    function Cookie() {\r\n    }\r\n    Cookie.TIMEOUT = 5 * 60 * 1000; // five minutes\r\n    Cookie._set = function (name, value, days) {\r\n        if (days) {\r\n            var date = new Date();\r\n            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\r\n            var expires = \"; expires=\" + date.toGMTString();\r\n        } else {\r\n            var expires = \"\";\r\n        }\r\n        $window.document.cookie = name + \"=\" + value + expires + \"; path=/\";\r\n    }\r\n    Cookie.set = function (name, value, days) {\r\n        try {\r\n            var cache = [];\r\n            var json = JSON.stringify(value, function (key, value) {\r\n                if (key === 'pool') {\r\n                    return;\r\n                }\r\n                if (typeof value === 'object' && value !== null) {\r\n                    if (cache.indexOf(value) !== -1) {\r\n                        // Circular reference found, discard key\r\n                        return;\r\n                    }\r\n                    cache.push(value);\r\n                }\r\n                return value;\r\n            });\r\n            cache = null;\r\n            Cookie._set(name, json, days);\r\n        } catch (e) {\r\n            console.log('Cookie.set.error serializing', name, value, e);\r\n        }\r\n    };\r\n    Cookie.get = function (name) {\r\n        var cookieName = name + \"=\";\r\n        var ca = $window.document.cookie.split(';');\r\n        for (var i = 0; i < ca.length; i++) {\r\n            var c = ca[i];\r\n            while (c.charAt(0) == ' ') {\r\n                c = c.substring(1, c.length);\r\n            }\r\n            if (c.indexOf(cookieName) == 0) {\r\n                var value = c.substring(cookieName.length, c.length);\r\n                var model = null;\r\n                try {\r\n                    model = JSON.parse(value);\r\n                } catch (e) {\r\n                    console.log('Cookie.get.error parsing', key, e);\r\n                };\r\n                return model;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    Cookie.delete = function (name) {\r\n        Cookie._set(name, \"\", -1);\r\n    };\r\n    Cookie.on = function (name) {\r\n        var deferred = $q.defer();\r\n        var i, interval = 1000, elapsed = 0, timeout = Cookie.TIMEOUT;\r\n        function checkCookie() {\r\n            if (elapsed > timeout) {\r\n                deferred.reject('timeout');\r\n            } else {\r\n                var c = Cookie.get(name);\r\n                if (c) {\r\n                    deferred.resolve(c);\r\n                } else {\r\n                    elapsed += interval;\r\n                    i = setTimeout(checkCookie, interval);\r\n                }\r\n            }\r\n        }\r\n        checkCookie();\r\n        return deferred.promise;\r\n    };\r\n    return Cookie;\r\n}]);\r\n\r\napp.factory('LocalStorage', ['$q', '$window', 'Cookie', function ($q, $window, Cookie) {\r\n    function LocalStorage() {\r\n    }\r\n    function isLocalStorageSupported() {\r\n        var supported = false;\r\n        try {\r\n            supported = 'localStorage' in $window && $window['localStorage'] !== null;\r\n            if (supported) {\r\n                $window.localStorage.setItem('test', '1');\r\n                $window.localStorage.removeItem('test');\r\n            } else {\r\n                supported = false;\r\n            }\r\n        } catch (e) {\r\n            supported = false;\r\n        }\r\n        return supported;\r\n    }\r\n    LocalStorage.isSupported = isLocalStorageSupported();\r\n    if (LocalStorage.isSupported) {\r\n        LocalStorage.set = function (name, value) {\r\n            try {\r\n                var cache = [];\r\n                var json = JSON.stringify(value, function (key, value) {\r\n                    if (key === 'pool') {\r\n                        return;\r\n                    }\r\n                    if (typeof value === 'object' && value !== null) {\r\n                        if (cache.indexOf(value) !== -1) {\r\n                            // Circular reference found, discard key\r\n                            return;\r\n                        }\r\n                        cache.push(value);\r\n                    }\r\n                    return value;\r\n                });\r\n                cache = null;\r\n                $window.localStorage.setItem(name, json);\r\n            } catch (e) {\r\n                console.log('LocalStorage.set.error serializing', name, value, e);\r\n            }\r\n        };\r\n        LocalStorage.get = function (name) {\r\n            var value = null;\r\n            if ($window.localStorage[name] !== undefined) {\r\n                try {\r\n                    value = JSON.parse($window.localStorage[name]);\r\n                } catch (e) {\r\n                    console.log('LocalStorage.get.error parsing', name, e);\r\n                }\r\n            }\r\n            return value;\r\n        };\r\n        LocalStorage.delete = function (name) {\r\n            $window.localStorage.removeItem(name);\r\n        };\r\n        LocalStorage.on = function (name) {\r\n            var deferred = $q.defer();\r\n            var i, timeout = Cookie.TIMEOUT;\r\n            function storageEvent(e) {\r\n                // console.log('LocalStorage.on', name, e);\r\n                clearTimeout(i);\r\n                if (e.originalEvent.key == name) {\r\n                    try {\r\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\r\n                        deferred.resolve(value);\r\n                    } catch (e) {\r\n                        console.log('LocalStorage.on.error parsing', name, e);\r\n                        deferred.reject('error parsing ' + name);\r\n                    }\r\n                }\r\n            }\r\n            angular.element($window).on('storage', storageEvent);\r\n            i = setTimeout(function () {\r\n                deferred.reject('timeout');\r\n            }, timeout);\r\n            return deferred.promise;\r\n        };\r\n    } else {\r\n        console.log('LocalStorage.unsupported switching to cookies');\r\n        LocalStorage.set = Cookie.set;\r\n        LocalStorage.get = Cookie.get;\r\n        LocalStorage.delete = Cookie.delete;\r\n        LocalStorage.on = Cookie.on;\r\n    }\r\n    return LocalStorage;\r\n}]);\r\n\r\napp.factory('SessionStorage', ['$q', '$window', 'Cookie', function ($q, $window, Cookie) {\r\n    function SessionStorage() {\r\n    }\r\n    function isSessionStorageSupported() {\r\n        var supported = false;\r\n        try {\r\n            supported = 'sessionStorage' in $window && $window.sessionStorage !== undefined;\r\n            if (supported) {\r\n                $window.sessionStorage.setItem('test', '1');\r\n                $window.sessionStorage.removeItem('test');\r\n            } else {\r\n                supported = false;\r\n            }\r\n        } catch (e) {\r\n            supported = false;\r\n        }\r\n        return supported;\r\n    }\r\n    SessionStorage.isSupported = isSessionStorageSupported();\r\n    if (SessionStorage.isSupported) {\r\n        SessionStorage.set = function (name, value) {\r\n            try {\r\n                var cache = [];\r\n                var json = JSON.stringify(value, function (key, value) {\r\n                    if (key === 'pool') {\r\n                        return;\r\n                    }\r\n                    if (typeof value === 'object' && value !== null) {\r\n                        if (cache.indexOf(value) !== -1) {\r\n                            // Circular reference found, discard key\r\n                            return;\r\n                        }\r\n                        cache.push(value);\r\n                    }\r\n                    return value;\r\n                });\r\n                cache = null;\r\n                $window.sessionStorage.setItem(name, json);\r\n            } catch (e) {\r\n                console.log('SessionStorage.set.error serializing', name, value, e);\r\n            }\r\n        };\r\n        SessionStorage.get = function (name) {\r\n            var value = null;\r\n            if ($window.sessionStorage[name] !== undefined) {\r\n                try {\r\n                    value = JSON.parse($window.sessionStorage[name]);\r\n                } catch (e) {\r\n                    console.log('SessionStorage.get.error parsing', name, e);\r\n                }\r\n            }\r\n            return value;\r\n        };\r\n        SessionStorage.delete = function (name) {\r\n            $window.sessionStorage.removeItem(name);\r\n        };\r\n        SessionStorage.on = function (name) {\r\n            var deferred = $q.defer();\r\n            var i, timeout = Cookie.TIMEOUT;\r\n            function storageEvent(e) {\r\n                // console.log('SessionStorage.on', name, e);\r\n                clearTimeout(i);\r\n                if (e.originalEvent.key === name) {\r\n                    try {\r\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\r\n                        deferred.resolve(value);\r\n                    } catch (e) {\r\n                        console.log('SessionStorage.on.error parsing', name, e);\r\n                        deferred.reject('error parsing ' + name);\r\n                    }\r\n                }\r\n            }\r\n            angular.element($window).on('storage', storageEvent);\r\n            i = setTimeout(function () {\r\n                deferred.reject('timeout');\r\n            }, timeout);\r\n            return deferred.promise;\r\n        };\r\n    } else {\r\n        console.log('SessionStorage.unsupported switching to cookies');\r\n        SessionStorage.set = Cookie.set;\r\n        SessionStorage.get = Cookie.get;\r\n        SessionStorage.delete = Cookie.delete;\r\n        SessionStorage.on = Cookie.on;\r\n    }\r\n    return SessionStorage;\r\n}]);\r\n\r\napp.factory('Animate', [function () {\r\n    function Animate(callback, useTimeout) {\r\n        this.callback = callback;\r\n        this.isPlaying = false;\r\n        this.key = null;\r\n        this.ticks = 0;\r\n        this.useTimeout = useTimeout === true ? true : false;\r\n    }\r\n    Animate.prototype = {\r\n        play: function () {\r\n            var _this = this;\r\n            function loop(time) {\r\n                _this.ticks++;\r\n                _this.callback(time, _this.ticks);\r\n                if (this.useTimeout) {\r\n                    _this.key = window.setTimeout(loop, 1000 / 60);\r\n                } else {\r\n                    _this.key = window.requestAnimationFrame(loop);\r\n                }\r\n            }\r\n            if (!this.key) {\r\n                this.isPlaying = true;\r\n                loop();\r\n            }\r\n        },\r\n        pause: function () {\r\n            if (this.key) {\r\n                if (this.useTimeout) {\r\n                    window.clearTimeout(this.key);\r\n                } else {\r\n                    window.cancelAnimationFrame(this.key);\r\n                }\r\n                this.key = null;\r\n                this.isPlaying = false;\r\n            }\r\n        },\r\n        playpause: function () {\r\n            if (this.key) {\r\n                this.pause();\r\n            } else {\r\n                this.play();\r\n            }\r\n        }\r\n    }\r\n    return Animate;\r\n}]);\r\n\r\napp.factory('Md5', [function () {\r\n\r\n    var hex_chr = '0123456789abcdef'.split('');\r\n\r\n    function cycle(x, k) {\r\n        var a = x[0], b = x[1], c = x[2], d = x[3];\r\n\r\n        a = ff(a, b, c, d, k[0], 7, -680876936);\r\n        d = ff(d, a, b, c, k[1], 12, -389564586);\r\n        c = ff(c, d, a, b, k[2], 17, 606105819);\r\n        b = ff(b, c, d, a, k[3], 22, -1044525330);\r\n        a = ff(a, b, c, d, k[4], 7, -176418897);\r\n        d = ff(d, a, b, c, k[5], 12, 1200080426);\r\n        c = ff(c, d, a, b, k[6], 17, -1473231341);\r\n        b = ff(b, c, d, a, k[7], 22, -45705983);\r\n        a = ff(a, b, c, d, k[8], 7, 1770035416);\r\n        d = ff(d, a, b, c, k[9], 12, -1958414417);\r\n        c = ff(c, d, a, b, k[10], 17, -42063);\r\n        b = ff(b, c, d, a, k[11], 22, -1990404162);\r\n        a = ff(a, b, c, d, k[12], 7, 1804603682);\r\n        d = ff(d, a, b, c, k[13], 12, -40341101);\r\n        c = ff(c, d, a, b, k[14], 17, -1502002290);\r\n        b = ff(b, c, d, a, k[15], 22, 1236535329);\r\n\r\n        a = gg(a, b, c, d, k[1], 5, -165796510);\r\n        d = gg(d, a, b, c, k[6], 9, -1069501632);\r\n        c = gg(c, d, a, b, k[11], 14, 643717713);\r\n        b = gg(b, c, d, a, k[0], 20, -373897302);\r\n        a = gg(a, b, c, d, k[5], 5, -701558691);\r\n        d = gg(d, a, b, c, k[10], 9, 38016083);\r\n        c = gg(c, d, a, b, k[15], 14, -660478335);\r\n        b = gg(b, c, d, a, k[4], 20, -405537848);\r\n        a = gg(a, b, c, d, k[9], 5, 568446438);\r\n        d = gg(d, a, b, c, k[14], 9, -1019803690);\r\n        c = gg(c, d, a, b, k[3], 14, -187363961);\r\n        b = gg(b, c, d, a, k[8], 20, 1163531501);\r\n        a = gg(a, b, c, d, k[13], 5, -1444681467);\r\n        d = gg(d, a, b, c, k[2], 9, -51403784);\r\n        c = gg(c, d, a, b, k[7], 14, 1735328473);\r\n        b = gg(b, c, d, a, k[12], 20, -1926607734);\r\n\r\n        a = hh(a, b, c, d, k[5], 4, -378558);\r\n        d = hh(d, a, b, c, k[8], 11, -2022574463);\r\n        c = hh(c, d, a, b, k[11], 16, 1839030562);\r\n        b = hh(b, c, d, a, k[14], 23, -35309556);\r\n        a = hh(a, b, c, d, k[1], 4, -1530992060);\r\n        d = hh(d, a, b, c, k[4], 11, 1272893353);\r\n        c = hh(c, d, a, b, k[7], 16, -155497632);\r\n        b = hh(b, c, d, a, k[10], 23, -1094730640);\r\n        a = hh(a, b, c, d, k[13], 4, 681279174);\r\n        d = hh(d, a, b, c, k[0], 11, -358537222);\r\n        c = hh(c, d, a, b, k[3], 16, -722521979);\r\n        b = hh(b, c, d, a, k[6], 23, 76029189);\r\n        a = hh(a, b, c, d, k[9], 4, -640364487);\r\n        d = hh(d, a, b, c, k[12], 11, -421815835);\r\n        c = hh(c, d, a, b, k[15], 16, 530742520);\r\n        b = hh(b, c, d, a, k[2], 23, -995338651);\r\n\r\n        a = ii(a, b, c, d, k[0], 6, -198630844);\r\n        d = ii(d, a, b, c, k[7], 10, 1126891415);\r\n        c = ii(c, d, a, b, k[14], 15, -1416354905);\r\n        b = ii(b, c, d, a, k[5], 21, -57434055);\r\n        a = ii(a, b, c, d, k[12], 6, 1700485571);\r\n        d = ii(d, a, b, c, k[3], 10, -1894986606);\r\n        c = ii(c, d, a, b, k[10], 15, -1051523);\r\n        b = ii(b, c, d, a, k[1], 21, -2054922799);\r\n        a = ii(a, b, c, d, k[8], 6, 1873313359);\r\n        d = ii(d, a, b, c, k[15], 10, -30611744);\r\n        c = ii(c, d, a, b, k[6], 15, -1560198380);\r\n        b = ii(b, c, d, a, k[13], 21, 1309151649);\r\n        a = ii(a, b, c, d, k[4], 6, -145523070);\r\n        d = ii(d, a, b, c, k[11], 10, -1120210379);\r\n        c = ii(c, d, a, b, k[2], 15, 718787259);\r\n        b = ii(b, c, d, a, k[9], 21, -343485551);\r\n\r\n        x[0] = add32(a, x[0]);\r\n        x[1] = add32(b, x[1]);\r\n        x[2] = add32(c, x[2]);\r\n        x[3] = add32(d, x[3]);\r\n\r\n    }\r\n\r\n    function cmn(q, a, b, x, s, t) {\r\n        a = add32(add32(a, q), add32(x, t));\r\n        return add32((a << s) | (a >>> (32 - s)), b);\r\n    }\r\n\r\n    function ff(a, b, c, d, x, s, t) {\r\n        return cmn((b & c) | ((~b) & d), a, b, x, s, t);\r\n    }\r\n\r\n    function gg(a, b, c, d, x, s, t) {\r\n        return cmn((b & d) | (c & (~d)), a, b, x, s, t);\r\n    }\r\n\r\n    function hh(a, b, c, d, x, s, t) {\r\n        return cmn(b ^ c ^ d, a, b, x, s, t);\r\n    }\r\n\r\n    function ii(a, b, c, d, x, s, t) {\r\n        return cmn(c ^ (b | (~d)), a, b, x, s, t);\r\n    }\r\n\r\n    function md51(s) {\r\n        var txt = '';\r\n        var n = s.length,\r\n        state = [1732584193, -271733879, -1732584194, 271733878], i;\r\n        for (i = 64; i <= s.length; i += 64) {\r\n            cycle(state, md5blk(s.substring(i - 64, i)));\r\n        }\r\n        s = s.substring(i - 64);\r\n        var tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n        for (i = 0; i < s.length; i++)\r\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\r\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\r\n        if (i > 55) {\r\n            cycle(state, tail);\r\n            for (i = 0; i < 16; i++) tail[i] = 0;\r\n        }\r\n        tail[14] = n * 8;\r\n        cycle(state, tail);\r\n        return state;\r\n    }\r\n\r\n    /* there needs to be support for Unicode here,\r\n        * unless we pretend that we can redefine the MD-5\r\n        * algorithm for multi-byte characters (perhaps\r\n        * by adding every four 16-bit characters and\r\n        * shortening the sum to 32 bits). Otherwise\r\n        * I suggest performing MD-5 as if every character\r\n        * was two bytes--e.g., 0040 0025 = @%--but then\r\n        * how will an ordinary MD-5 sum be matched?\r\n        * There is no way to standardize text to something\r\n        * like UTF-8 before transformation; speed cost is\r\n        * utterly prohibitive. The JavaScript standard\r\n        * itself needs to look at this: it should start\r\n        * providing access to strings as preformed UTF-8\r\n        * 8-bit unsigned value arrays.\r\n        */\r\n    function md5blk(s) { /* I figured global was faster.   */\r\n        var md5blks = [], i; /* Andy King said do it this way. */\r\n        for (i = 0; i < 64; i += 4) {\r\n            md5blks[i >> 2] = s.charCodeAt(i)\r\n            + (s.charCodeAt(i + 1) << 8)\r\n            + (s.charCodeAt(i + 2) << 16)\r\n            + (s.charCodeAt(i + 3) << 24);\r\n        }\r\n        return md5blks;\r\n    }\r\n\r\n    function rhex(n) {\r\n        var s = '', j = 0;\r\n        for (; j < 4; j++)\r\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F]\r\n            + hex_chr[(n >> (j * 8)) & 0x0F];\r\n        return s;\r\n    }\r\n\r\n    function hex(x) {\r\n        for (var i = 0; i < x.length; i++)\r\n            x[i] = rhex(x[i]);\r\n        return x.join('');\r\n    }\r\n\r\n    /* this function is much faster,\r\n    so if possible we use it. Some IEs\r\n    are the only ones I know of that\r\n    need the idiotic second function,\r\n    generated by an if clause.  */\r\n    function add32(a, b) {\r\n        return (a + b) & 0xFFFFFFFF;\r\n    }\r\n\r\n    function Md5() { }\r\n    Md5.encode = function (string) {\r\n        return hex(md51(string));\r\n    }\r\n    if (Md5.encode('hello') !== '5d41402abc4b2a76b9719d911017c592') {\r\n        add32 = function (x, y) {\r\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\r\n            msw = (x >> 16) + (y >> 16) + (lsw >> 16);\r\n            return (msw << 16) | (lsw & 0xFFFF);\r\n        }\r\n    }\r\n    return Md5;\r\n}]);\r\n\r\napp.factory('Utils', ['$compile', '$controller', 'Vector', 'Md5', function ($compile, $controller, Vector, Md5) {\r\n    (function () {\r\n        // POLYFILL window.requestAnimationFrame\r\n        var lastTime = 0;\r\n        var vendors = ['ms', 'moz', 'webkit', 'o'];\r\n        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\r\n            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame']\r\n                                       || window[vendors[x] + 'CancelRequestAnimationFrame'];\r\n        }\r\n        if (!window.requestAnimationFrame) {\r\n            window.requestAnimationFrame = function (callback, element) {\r\n                var currTime = new Date().getTime();\r\n                var timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n                var id = window.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\r\n                lastTime = currTime + timeToCall;\r\n                return id;\r\n            };\r\n        }\r\n        if (!window.cancelAnimationFrame) {\r\n            window.cancelAnimationFrame = function (id) {\r\n                clearTimeout(id);\r\n            };\r\n        }\r\n    }());\r\n    (function () {\r\n        // POLYFILL Array.prototype.reduce\r\n        // Production steps of ECMA-262, Edition 5, 15.4.4.21\r\n        // Reference: http://es5.github.io/#x15.4.4.21\r\n        // https://tc39.github.io/ecma262/#sec-array.prototype.reduce\r\n        if (!Array.prototype.reduce) {\r\n            Object.defineProperty(Array.prototype, 'reduce', {\r\n                value: function (callback) {// , initialvalue\r\n                    if (this === null) {\r\n                        throw new TypeError('Array.prototype.reduce called on null or undefined');\r\n                    }\r\n                    if (typeof callback !== 'function') {\r\n                        throw new TypeError(callback + ' is not a function');\r\n                    }\r\n                    var o = Object(this);\r\n                    var len = o.length >>> 0;\r\n                    var k = 0;\r\n                    var value;\r\n                    if (arguments.length == 2) {\r\n                        value = arguments[1];\r\n                    } else {\r\n                        while (k < len && !(k in o)) {\r\n                            k++;\r\n                        }\r\n                        if (k >= len) {\r\n                            throw new TypeError('Reduce of empty array with no initial value');\r\n                        }\r\n                        value = o[k++];\r\n                    }\r\n                    while (k < len) {\r\n                        if (k in o) {\r\n                            value = callback(value, o[k], k, o);\r\n                        }\r\n                        k++;\r\n                    }\r\n                    return value;\r\n                }\r\n            });\r\n        }\r\n    }());\r\n    var _isTouch;\r\n    function isTouch() {\r\n        if (!_isTouch) {\r\n            _isTouch = {\r\n                value: ('ontouchstart' in window || 'onmsgesturechange' in window)\r\n            }\r\n        }\r\n        // console.log(_isTouch);\r\n        return _isTouch.value;\r\n    }\r\n    function getTouch(e, previous) {\r\n        var t = new Vector();\r\n        if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {\r\n            var touch = null;\r\n            var event = e.originalEvent ? e.originalEvent : e;\r\n            var touches = event.touches.length ? event.touches : event.changedTouches;\r\n            if (touches && touches.length) {\r\n                touch = touches[0];\r\n            }\r\n            if (touch) {\r\n                t.x = touch.pageX;\r\n                t.y = touch.pageY;\r\n            }\r\n        } else if (e.type == 'click' || e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {\r\n            t.x = e.pageX;\r\n            t.y = e.pageY;\r\n        }\r\n        if (previous) {\r\n            t.s = Vector.difference(previous, t);\r\n        }\r\n        t.type = e.type;\r\n        return t;\r\n    }\r\n    function getRelativeTouch(element, point) {\r\n        var rect = element[0].getBoundingClientRect();\r\n        var e = new Vector(rect.left, rect.top);\r\n        return Vector.difference(e, point);\r\n    }\r\n    function getClosest(el, selector) {\r\n        var matchesFn, parent;\r\n        ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function (fn) {\r\n            if (typeof document.body[fn] == 'function') {\r\n                matchesFn = fn;\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        if (el[matchesFn](selector)) {\r\n            return el;\r\n        }\r\n        while (el !== null) {\r\n            parent = el.parentElement;\r\n            if (parent !== null && parent[matchesFn](selector)) {\r\n                return parent;\r\n            }\r\n            el = parent;\r\n        }\r\n        return null;\r\n    }\r\n    function getClosestElement(el, target) {\r\n        var matchesFn, parent;\r\n        if (el === target) {\r\n            return el;\r\n        }\r\n        while (el !== null) {\r\n            parent = el.parentElement;\r\n            if (parent !== null && parent === target) {\r\n                return parent;\r\n            }\r\n            el = parent;\r\n        }\r\n        return null;\r\n    }\r\n    var getNow = Date.now || function () {\r\n        return new Date().getTime();\r\n    };\r\n    function throttle(func, wait, options) {\r\n        // Returns a function, that, when invoked, will only be triggered at most once\r\n        // during a given window of time. Normally, the throttled function will run\r\n        // as much as it can, without ever going more than once per `wait` duration;\r\n        // but if you'd like to disable the execution on the leading edge, pass\r\n        // `{leading: false}`. To disable execution on the trailing edge, ditto.\r\n        var context, args, result;\r\n        var timeout = null;\r\n        var previous = 0;\r\n        if (!options) options = {};\r\n        var later = function () {\r\n            previous = options.leading === false ? 0 : getNow();\r\n            timeout = null;\r\n            result = func.apply(context, args);\r\n            if (!timeout) context = args = null;\r\n        };\r\n        return function () {\r\n            var now = getNow();\r\n            if (!previous && options.leading === false) previous = now;\r\n            var remaining = wait - (now - previous);\r\n            context = this;\r\n            args = arguments;\r\n            if (remaining <= 0 || remaining > wait) {\r\n                if (timeout) {\r\n                    clearTimeout(timeout);\r\n                    timeout = null;\r\n                }\r\n                previous = now;\r\n                result = func.apply(context, args);\r\n                if (!timeout) context = args = null;\r\n            } else if (!timeout && options.trailing !== false) {\r\n                timeout = setTimeout(later, remaining);\r\n            }\r\n            return result;\r\n        };\r\n    }\r\n    function where(array, query) {\r\n        var found = null;\r\n        if (array) {\r\n            angular.forEach(array, function (item) {\r\n                var has = true;\r\n                angular.forEach(query, function (value, key) {\r\n                    has = has && item[key] === value;\r\n                });\r\n                if (has) {\r\n                    found = item;\r\n                }\r\n            });\r\n        }\r\n        return found;\r\n    }\r\n    function compileController(scope, element, html, data) {\r\n        // console.log('Utils.compileController', element);\r\n        element.html(html);\r\n        var link = $compile(element.contents());\r\n        if (data.controller) {\r\n            var $scope = scope.$new();\r\n            angular.extend($scope, data);\r\n            var controller = $controller(data.controller, { $scope: $scope });\r\n            if (data.controllerAs) {\r\n                scope[data.controllerAs] = controller;\r\n            }\r\n            element.data('$ngControllerController', controller);\r\n            element.children().data('$ngControllerController', controller);\r\n            scope = $scope;\r\n        }\r\n        link(scope);\r\n    }\r\n    var ua = window.navigator.userAgent.toLowerCase();\r\n    var safari = ua.indexOf('safari') !== -1 && ua.indexOf('chrome') === -1;\r\n    var msie = ua.indexOf('trident') !== -1 || ua.indexOf('edge') !== -1 || ua.indexOf('msie') !== -1;\r\n    var chrome = !safari && !msie && ua.indexOf('chrome') !== -1;\r\n    var mobile = ua.indexOf('mobile') !== -1;\r\n    function Utils() {\r\n    }\r\n    function reverseSortOn(key) {\r\n        return function (a, b) {\r\n            if (a[key] < b[key]) {\r\n                return 1;\r\n            }\r\n            if (a[key] > b[key]) {\r\n                return -1;\r\n            }\r\n            // a must be equal to b\r\n            return 0;\r\n        }\r\n    }\r\n    function format(string, prepend, expression) {\r\n        string = string || '';\r\n        prepend = prepend || '';\r\n        var splitted = string.split(',');\r\n        if (splitted.length > 1) {\r\n            var formatted = splitted.shift();\r\n            angular.forEach(splitted, function (value, index) {\r\n                if (expression) {\r\n                    formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\r\n                } else {\r\n                    formatted = formatted.split('{' + index + '}').join(prepend + value);\r\n                }\r\n            });\r\n            if (expression) {\r\n                return '\\'' + formatted + '\\'';\r\n            } else {\r\n                return formatted;\r\n            }\r\n        } else {\r\n            return prepend + string;\r\n        }\r\n    }\r\n    function reducer(o, key) {\r\n        return o[key];\r\n    }\r\n    function reducerSetter(o, key, value) {\r\n        if (typeof key == 'string') {\r\n            return reducerSetter(o, key.split('.'), value);\r\n        } else if (key.length == 1 && value !== undefined) {\r\n            return o[key[0]] = value;\r\n        } else if (key.length == 0) {\r\n            return o;\r\n        } else {\r\n            return reducerSetter(o[key[0]], key.slice(1), value);\r\n        }\r\n    }\r\n    function reducerAdder(o, key, value) {\r\n        if (typeof key == 'string') {\r\n            return reducerAdder(o, key.split('.'), value);\r\n        } else if (key.length == 1 && value !== undefined) {\r\n            return (o[key[0]] += value);\r\n        } else if (key.length == 0) {\r\n            return o;\r\n        } else {\r\n            return reducerAdder(o[key[0]], key.slice(1), value);\r\n        }\r\n    }\r\n    Utils.reverseSortOn = reverseSortOn;\r\n    Utils.getTouch = getTouch;\r\n    Utils.getRelativeTouch = getRelativeTouch;\r\n    Utils.getClosest = getClosest;\r\n    Utils.getClosestElement = getClosestElement;\r\n    Utils.throttle = throttle;\r\n    Utils.where = where;\r\n    Utils.format = format;\r\n    Utils.compileController = compileController;\r\n    Utils.reducer = reducer;\r\n    Utils.reducerSetter = reducerSetter;\r\n    Utils.reducerAdder = reducerAdder;\r\n    Utils.toMd5 = function (string) {\r\n        return Md5.encode(string);\r\n    };\r\n    Utils.ua = {\r\n        safari: safari,\r\n        msie: msie,\r\n        chrome: chrome,\r\n        mobile: mobile,\r\n    };\r\n    angular.forEach(Utils.ua, function (value, key) {\r\n        if (value) {\r\n            angular.element(document.getElementsByTagName('body')).addClass(key);\r\n        }\r\n    });\r\n    return Utils;\r\n}]);\r\n\r\napp.factory('State', ['$timeout', function ($timeout) {\r\n    function State() {\r\n        this.isReady = false;\r\n        this.idle();\r\n    }\r\n    State.prototype = {\r\n        idle: function () {\r\n            this.isBusy = false;\r\n            this.isError = false;\r\n            this.isErroring = false;\r\n            this.isSuccess = false;\r\n            this.isSuccessing = false;\r\n            this.button = null;\r\n            this.errors = [];\r\n        },\r\n        enabled: function () {\r\n            return !this.isBusy && !this.isErroring && !this.isSuccessing;\r\n        },\r\n        busy: function () {\r\n            if (!this.isBusy) {\r\n                this.isBusy = true;\r\n                this.isError = false;\r\n                this.isErroring = false;\r\n                this.isSuccess = false;\r\n                this.isSuccessing = false;\r\n                this.errors = [];\r\n                // console.log('State.busy', this);\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n        success: function () {\r\n            this.isBusy = false;\r\n            this.isError = false;\r\n            this.isErroring = false;\r\n            this.isSuccess = true;\r\n            this.isSuccessing = true;\r\n            this.errors = [];\r\n            $timeout(function () {\r\n                this.isSuccessing = false;\r\n                this.button = null;\r\n            }.bind(this), 1000);\r\n        },\r\n        error: function (error) {\r\n            this.isBusy = false;\r\n            this.isError = true;\r\n            this.isErroring = true;\r\n            this.isSuccess = false;\r\n            this.isSuccessing = false;\r\n            this.errors.push(error);\r\n            $timeout(function () {\r\n                this.isErroring = false;\r\n                this.button = null;\r\n            }.bind(this), 1000);\r\n        },\r\n        ready: function () {\r\n            this.isReady = true;\r\n            this.success();\r\n        },\r\n        errorMessage: function () {\r\n            return this.isError ? this.errors[this.errors.length - 1] : null;\r\n        },\r\n        submitClass: function () {\r\n            return {\r\n                busy: this.isBusy,\r\n                ready: this.isReady,\r\n                successing: this.isSuccessing,\r\n                success: this.isSuccess,\r\n                errorring: this.isErroring,\r\n                error: this.isError,\r\n            };\r\n        },\r\n        submitMessage: function (idleMessage, busyMessage, successMessage, errorMessage) {\r\n            idleMessage = idleMessage || 'Submit';\r\n            if (this.isBusy) {\r\n                return busyMessage || idleMessage;\r\n            } else if (this.isSuccess) {\r\n                return successMessage || idleMessage;\r\n            } else if (this.isError) {\r\n                return errorMessage || idleMessage;\r\n            } else {\r\n                return idleMessage;\r\n            }\r\n        },\r\n    };\r\n    return State;\r\n}]);\r\n\r\napp.factory('DataFilter', ['$filter', function ($filter) {\r\n    function DataFilter(data) {\r\n        /*\r\n        this.dateFrom = null;\r\n        this.dateTo = null;\r\n        this.search = null;\r\n        this.status = null;\r\n        this.sort = null;\r\n        */\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    DataFilter.prototype = {\r\n        getObjectParams: function (obj) {\r\n            var a = [];\r\n            if (obj) {\r\n                for (var p in obj) {\r\n                    a.push({ name: p, value: obj[p] });\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        getParams: function (source) {\r\n            var post = {}, value;\r\n            for (var p in this) {\r\n                switch (p) {\r\n                    case 'dateFrom':\r\n                    case 'dateTo':\r\n                    case 'status':\r\n                        value = this[p];\r\n                        if (value !== undefined) {\r\n                            post[p] = value;\r\n                        }\r\n                        break;\r\n                    case 'search':\r\n                    case 'sort':\r\n                        var json = JSON.stringify(this.getObjectParams(this[p]), null, '');\r\n                        post[p] = window.btoa(json);\r\n                        break;\r\n                }\r\n            }\r\n            if (!source.unpaged) {\r\n                post.page = source.page;\r\n                post.size = source.size;\r\n            }\r\n            // console.log('DataFilter.getParams', post);\r\n            return post;\r\n        },\r\n        getMonths: function () {\r\n            var months = [];\r\n            if (this.dateFrom && this.dateTo) {\r\n                var range = [this.dateFrom, this.dateTo];\r\n                range = range.sort(function (a, b) {\r\n                    return a.getTime() - b.getTime();\r\n                });\r\n                function monthDiff(a, b) {\r\n                    var months;\r\n                    months = (b.getFullYear() - a.getFullYear()) * 12;\r\n                    months -= a.getMonth() + 1;\r\n                    months += b.getMonth() + 1; // we should add + 1 to get correct month number\r\n                    months ++;\r\n                    // console.log(months);\r\n                    return months <= 0 ? 0 : months;\r\n                }\r\n                var diff = Math.max(1, monthDiff(range[0], range[1]));\r\n                // console.log('getMonths', range[0], range[1], diff);\r\n                var i = 0;\r\n                while (i < diff) {\r\n                    var date = new Date(range[0].getFullYear(), range[0].getMonth() + i, 1);\r\n                    months.push({\r\n                        id: date.getTime(),\r\n                        name: $filter('date')(date, '(yyyy MM) MMMM'),\r\n                        nameShort: $filter('date')(date, 'MMM yy'),\r\n                    });\r\n                    i++;\r\n                };\r\n            }\r\n            return months;\r\n        },\r\n    };\r\n    return DataFilter;\r\n}]);\r\n\r\napp.factory('DataSource', ['$q', '$http', '$rootScope', '$location', 'LocalStorage', 'State', 'DataFilter', function ($q, $http, $rootScope, $location, storage, State, DataFilter) {\r\n    var PAGES_FIRST = 1;\r\n    var PAGES_SIZE = 7;\r\n    var PAGES_MAX = Number.POSITIVE_INFINITY;\r\n    function DataSource(data) {\r\n        this.state = new State();\r\n        this.page = PAGES_FIRST;\r\n        this.size = PAGES_SIZE;\r\n        this.pages = PAGES_MAX;\r\n        this.count = 0;\r\n        this.maxPages = 10;\r\n        this.items = [];\r\n        this.rows = [];\r\n        this.allrows = [];\r\n        this.steps = [];\r\n        this.filters = new DataFilter({});\r\n        this.uri = '/api/items/paging';\r\n        this.unpaged = false; // if true skip pagination\r\n        data ? angular.extend(this, data) : null;        \r\n    }\r\n    DataSource.prototype = {\r\n        resolve: function (deferred) {\r\n            angular.forEach(this.response.data, function (item) {\r\n                this.push(item);\r\n            }, this.rows);\r\n            deferred.resolve();\r\n        },\r\n        group: function (deferred) {\r\n            deferred.resolve();\r\n        },\r\n        next: function ($d) {\r\n            if (this.steps.length) {\r\n                var deferred = $q.defer();\r\n                deferred.promise.then(function (response) {\r\n                    this.next($d);\r\n                }.bind(this), function (response) {\r\n                    this.error(response);\r\n                }.bind(this));\r\n                var step = this.steps.shift();\r\n                step.call(this, deferred);\r\n            } else {\r\n                $d.resolve();\r\n            }\r\n        },\r\n        when: function () {\r\n            var deferred = $q.defer();\r\n            angular.forEach(Array.prototype.slice.call(arguments), function(step) {\r\n                this.push(step);\r\n            }, this.steps);\r\n            this.next(deferred);\r\n            return deferred.promise;\r\n        },\r\n        unallowed: function (error) {\r\n            this.deferred.reject(error);\r\n            this.deferred = null;\r\n            this.state.error(error);\r\n            $location.$$lastRequestedPath = $location.path(); // $route.current.$$route.originalPath;\r\n            $location.path('/signin');\r\n        },\r\n        error: function (response) {\r\n            // typeof (err) === \"string\" ? err = { status: status } : (err == null ? err = { status: status } : err.status = status);\r\n            var error = response ? { message: response.data ? response.data.message : \"error\", status: response.status } : null;\r\n            if (error.message === 'ERROR_NOT_ALLOWED') {\r\n                var q = storage.get('q');\r\n                console.log('onError', error, 'q', q);\r\n                this.unallowed(error);\r\n            } else {\r\n                this.deferred.reject(error);\r\n                this.deferred = null;\r\n                this.state.error(error);\r\n            }\r\n        },\r\n        parseHeader: function () {\r\n            var responseHeader = this.response.headers('X-Pagination');\r\n            var responseView = responseHeader ? JSON.parse(responseHeader) : null;\r\n            if (responseView) {\r\n                this.page = responseView.page;\r\n                this.size = responseView.size;\r\n                this.count = responseView.count;\r\n                this.pages = responseView.pages;\r\n            } else {\r\n                this.page = PAGES_FIRST;\r\n                this.size = this.size || PAGES_SIZE;\r\n                this.count = this.response.data.length;\r\n                this.pages = Math.ceil(this.count / this.size);\r\n            }\r\n            this.pagination = this.getPages();\r\n        },\r\n        getUri: function () {\r\n            return angular.isFunction(this.uri) ? this.uri() : this.uri;\r\n        },\r\n        getParams: function () {\r\n            return { params: this.filters.getParams(this) };\r\n        },\r\n        get: function () {\r\n            $http.get(this.getUri(), this.getParams()).then(function (response) {\r\n                this.rows.length = 0;\r\n                this.items.length = 0;\r\n                this.response = response;\r\n                this.parseHeader();\r\n                this.when(this.resolve, this.group).then(function () {\r\n                    this.allrows = this.allrows.concat(this.rows);\r\n                    $rootScope.$broadcast('onDataSourceUpdate', this);\r\n                    this.state.success();\r\n                    this.deferred.resolve(this.rows);\r\n                    this.deferred = null;\r\n                }.bind(this));\r\n            }.bind(this), function (response) {\r\n                this.error(response);\r\n            }.bind(this));\r\n        },\r\n        update: function ($d) {\r\n            this.items = [];\r\n            if (this.state.busy()) {\r\n                this.when(this.group).then(function () {\r\n                    this.state.success();\r\n                }.bind(this));\r\n            }\r\n        },\r\n        paging: function ($d) {\r\n            var deferred = this.deferred = ($d || $q.defer());\r\n            if ((this.page <= this.pages || $d !== undefined) && this.state.busy()) {\r\n                this.opened = null;\r\n                this.get();\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        filter: function () {\r\n            var deferred = $q.defer();\r\n            this.allrows = [];\r\n            this.paging(deferred);\r\n            return deferred.promise;\r\n        },\r\n        add: function (item) {\r\n            this.rows.push(item);\r\n            this.allrows.push(item);\r\n            this.update();\r\n            this.count++;\r\n            this.pages = Math.ceil(this.count / this.size);\r\n        },\r\n        remove: function (item) {\r\n            var i = this.rows.indexOf(item);\r\n            if (i !== -1) {\r\n                this.rows.splice(i, 1);\r\n            }\r\n            i = this.allrows.indexOf(item);\r\n            if (i !== -1) {\r\n                this.allrows.splice(i, 1);\r\n            }\r\n            this.update();\r\n            this.count--;\r\n            this.pages = Math.ceil(this.count / this.size);\r\n        },\r\n        prevPage: function () {\r\n            var page = this.page - 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        nextPage: function () {\r\n            var page = this.page + 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        gotoPage: function (page) {\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        firstPage: function () {\r\n            if (this.page !== 1) {\r\n                this.page = 1;\r\n                this.paging();\r\n            }\r\n        },\r\n        lastPage: function () {\r\n            if (this.page !== this.pages) {\r\n                this.page = this.pages;\r\n                this.paging();\r\n            }\r\n        },\r\n        hasMany: function () {\r\n            return this.pages > this.maxPages;\r\n        },\r\n        hasMorePagesBehind: function () {\r\n            var startingIndex = Math.max(0, this.page - this.maxPages);\r\n            return startingIndex > 0;\r\n        },\r\n        hasMorePagesNext: function () {\r\n            var endingIndex = Math.max(0, this.page - this.maxPages) + this.maxPages;\r\n            return endingIndex < this.pages;\r\n        },\r\n        isPage: function (number) {\r\n            return this.page === number;\r\n        },\r\n        hasPages: function () {\r\n            return this.pages > 0 && this.pages < PAGES_MAX;\r\n        },\r\n        getPages: function () {\r\n            var a = [], i;\r\n            if (this.hasPages()) {\r\n                var startingIndex = Math.max(0, this.page - this.maxPages);\r\n                var endingIndex = Math.min(this.pages, startingIndex + this.maxPages);\r\n                i = startingIndex;\r\n                while (i < endingIndex) {\r\n                    a.push({ number: (i + 1) });\r\n                    i++;\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        openClose: function (index) {\r\n            if (this.opened === index) {\r\n                this.opened = null;\r\n            } else {\r\n                this.opened = index;\r\n            }\r\n        },\r\n        setSort: function (key, sort) {\r\n            var deferred = $q.defer();\r\n            if (!this.state.isBusy) {\r\n                this.filters.sort = {};\r\n                this.filters.sort[key] = sort;\r\n                if (angular.isFunction(this.sort)) {\r\n                    this.sort(this);\r\n                    deferred.resolve(this.rows);\r\n                } else {\r\n                    this.allrows = [];\r\n                    this.paging(deferred);\r\n                }\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        getSort: function (key) {\r\n            if (this.filters.sort) {\r\n                return this.filters.sort[key] || 0;\r\n            } else {\r\n                return 0;\r\n            }\r\n        },\r\n        hasSort: function () {\r\n            if (this.filters.sort) {\r\n                var has = false;\r\n                angular.forEach(this.filters.sort, function (value) {\r\n                    has = has || value;\r\n                });\r\n                return has;\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n        setSearch: function (key, search) {\r\n            var deferred = $q.defer();\r\n            if (!this.state.isBusy) {\r\n                this.filters.search = {};\r\n                if (search && search !== '') {\r\n                    this.filters.search[key] = search;\r\n                }\r\n                if (angular.isFunction(this.search)) {\r\n                    this.search(this);\r\n                    deferred.resolve(this.rows);\r\n                } else {\r\n                    this.allrows = [];\r\n                    this.paging(deferred);\r\n                }\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        getSearch: function (key) {\r\n            if (this.filters.search) {\r\n                return this.filters.search[key] || 0;\r\n            } else {\r\n                return 0;\r\n            }\r\n        },\r\n        hasSearch: function () {\r\n            if (this.filters.search) {\r\n                var has = false;\r\n                angular.forEach(this.filters.search, function (value) {\r\n                    has = has || (value && value !== '');\r\n                });\r\n                return has;\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n        setDateFrom: function (date) {\r\n            var deferred = $q.defer();\r\n            if (!this.state.isBusy) {\r\n                this.filters.dateFrom = date || '';\r\n                if (angular.isFunction(this.dateFrom)) {\r\n                    this.dateFrom(this);\r\n                    deferred.resolve(this.rows);\r\n                } else {\r\n                    this.allrows = [];\r\n                    this.paging(deferred);\r\n                }\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        getDateFrom: function () {\r\n            return this.filters.dateFrom || null;\r\n        },\r\n        setDateTo: function (date) {\r\n            var deferred = $q.defer();\r\n            if (!this.state.isBusy) {\r\n                this.filters.dateTo = date || '';\r\n                if (angular.isFunction(this.dateTo)) {\r\n                    this.dateTo(this);\r\n                    deferred.resolve(this.rows);\r\n                } else {\r\n                    this.allrows = [];\r\n                    this.paging(deferred);\r\n                }\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        getDateTo: function () {\r\n            return this.filters.dateTo || null;\r\n        },\r\n        setDates: function (from, to) {\r\n            var deferred = $q.defer();\r\n            if (!this.state.isBusy) {\r\n                this.filters.dateFrom = from || '';\r\n                this.filters.dateTo = to || '';\r\n                this.allrows = [];\r\n                this.paging(deferred);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n    };\r\n    return DataSource;\r\n}]);\r\n\r\napp.factory('Column', ['$parse', '$filter', 'Utils', 'colTypes', function ($parse, $filter, Utils, colTypes) {        \r\n    function Column(data) {\r\n        data ? angular.extend(this, data) : null;\r\n        // PREPARE GETTER SETTERS\r\n        if (angular.isFunction(this.value)) {\r\n            this.value = this.value.bind(this);\r\n        }\r\n        this.raw = this.raw || this.value;\r\n        this.source = this.source || this.value;\r\n        this.getters = {};\r\n        var fields = ['key', 'value', 'raw', 'source', 'post'];\r\n        angular.forEach(fields, function (field) {\r\n            if (this[field]) {\r\n                this.getters[field] = angular.isFunction(this[field]) ? this[field] : $parse(this[field]);\r\n            }\r\n        }, this);\r\n        this.setters = {};\r\n        angular.forEach(this.getters, function (getter, key) {\r\n            if (!angular.isFunction(this[key])) {\r\n                this.setters[key] = getter.assign;\r\n            }\r\n        }, this);\r\n        // PREPARE GETTER SETTERS\r\n        this.reset();\r\n    }\r\n    Column.prototype = {\r\n        getKey: function (item) {\r\n            return this.getters.key(item);\r\n        },\r\n        getValue: function (item) {\r\n            return this.getters.value(item);\r\n        },\r\n        getRaw: function (item) {\r\n            return this.getters.raw(item);\r\n        },\r\n        getSource: function (item) {\r\n            return this.getters.source(item);\r\n        },\r\n        reset: function () {\r\n            this.values = [];\r\n            this.keys = {};\r\n            this.search = [];\r\n            this.total = 0;\r\n        },\r\n        hasKey: function (item) {\r\n            var has = true;\r\n            var key = this.getKey(item);\r\n            if (key && this.keys[key] != true) {\r\n                this.keys[key] = true;\r\n                has = false;\r\n            }\r\n            return has;\r\n        },\r\n        initValue: function (item) {\r\n            this.setters.raw(item, (this.getters.value(item) || 0));\r\n            return this;\r\n        },\r\n        addTotal: function (item, row) {\r\n            this.setters.raw(item, (this.getters.raw(item) || 0) + (this.getters.value(row) || 0));\r\n            return this;\r\n        },\r\n        addCount: function (item, row) {\r\n            if (!this.hasKey(row) && this.setters.raw) {\r\n                var v = null;\r\n                if (item != row) {\r\n                    v = (this.getters.raw(item) || 0) + 1;\r\n                } else {\r\n                    v = 1;                    \r\n                }\r\n                this.setters.raw(item, v);\r\n            }\r\n            return this;\r\n        },\r\n        addValue: function (item) {\r\n            this.values = this.values || [];\r\n            var key = this.getKey(item);\r\n            var has = false;\r\n            angular.forEach(this.values, function (v) {\r\n                if (v.id == key) {\r\n                    has = true;\r\n                }\r\n            })\r\n            if (!has) {\r\n                var value = this.getRaw(item);\r\n                this.values.push({\r\n                    id: key,\r\n                    name: value || '-',\r\n                });\r\n            }\r\n        },\r\n        getValueTotal: function (filtered) {\r\n            var value = 0;\r\n            if (this.compare && this.type === colTypes.INCREMENT) {\r\n                var current = 0; // (col.getters.raw(item) || 0);\r\n                var previous = 0; // (this.getters.raw(item) || 0);                \r\n                angular.forEach(filtered, function (item) {\r\n                    current += (this.col.getters.raw(item) || 0);\r\n                    previous += (this.getters.raw(item) || 0);\r\n                }.bind(this));\r\n                if (previous) {\r\n                    value = (current - previous) / previous * 100;\r\n                }\r\n            } else {\r\n                angular.forEach(filtered, function (item) {\r\n                    value += this.getRaw(item) || 0;\r\n                }.bind(this));\r\n            }\r\n            this.total = value;\r\n            return value;\r\n        },\r\n        getValueFormatted: function (item) {\r\n            var value = this.getRaw(item);\r\n            switch (this.type) {\r\n                case colTypes.RESOURCE:\r\n                case colTypes.DISABLED:\r\n                    value = $filter('shortName')(value);\r\n                    break;\r\n                case colTypes.ID:\r\n                case colTypes.NUMBER:\r\n                    value = $filter('customNumber')(value, 0);\r\n                    break;\r\n                case colTypes.DOUBLE:\r\n                    value = $filter('customNumber')(value, 2);\r\n                    break;\r\n                case colTypes.WEEKS:\r\n                    value = $filter('customNumber')(value, 2, ' W');\r\n                    break;\r\n                case colTypes.DATE:\r\n                    value = $filter('date')(value, 'yyyy-MM-dd');\r\n                    break;\r\n                case colTypes.HOURS:\r\n                    value = $filter('customNumber')(value, 0, ' H');\r\n                    break;\r\n                case colTypes.COSTS:\r\n                    value = $filter('customNumber')(value, 0, ' €');\r\n                    break;\r\n                case colTypes.PERCENT:\r\n                    value = $filter('customNumber')(value, 2, ' %');\r\n                    break;\r\n                case colTypes.INCREMENT:\r\n                    value = angular.isNumber(value) ? (value > 0 ? '+' : '') + $filter('customNumber')(value, 2, ' %') : (value || '-');\r\n                    break;\r\n            }\r\n            return value;\r\n        },\r\n        getFormatted: function (item) {\r\n            if (this.dynamic) {\r\n                return this.getValueFormatted(item);\r\n            } else {\r\n                return item.static[this.id].value;\r\n            }\r\n        },\r\n        getTotal: function (filtered) {\r\n            var value = this.getValueTotal(filtered);\r\n            switch (this.type) {\r\n                case colTypes.NUMBER:\r\n                    value = $filter('customNumber')(value, 0);\r\n                    break;\r\n                case colTypes.DOUBLE:\r\n                    value = $filter('customNumber')(value, 2);\r\n                    break;\r\n                case colTypes.WEEKS:\r\n                    value = $filter('customNumber')(value, 2, ' W');\r\n                    break;\r\n                case colTypes.HOURS:\r\n                    value = $filter('customNumber')(value, 0, ' H');\r\n                    break;\r\n                case colTypes.COSTS:\r\n                    value = $filter('customNumber')(value, 0, ' €');\r\n                    break;\r\n                case colTypes.PERCENT:\r\n                    value = $filter('customNumber')(value, 2, ' %');\r\n                    break;\r\n                case colTypes.INCREMENT:\r\n                    value = angular.isNumber(value) ? (value > 0 ? '+' : '') + $filter('customNumber')(value, 2, ' %') : (value || '-');\r\n                    break;\r\n            }\r\n            return value;\r\n        },\r\n        getFormat: function () {\r\n            var format = '';\r\n            switch (this.type) {\r\n                case colTypes.ID:\r\n                case colTypes.NUMBER:\r\n                    format = '#';\r\n                    break;\r\n                case colTypes.DOUBLE:\r\n                    format = '#';\r\n                    break;\r\n                case colTypes.DATE:\r\n                    format = 'yyyy-mm-dd';\r\n                    break;\r\n                case colTypes.WEEKS:\r\n                    format = '#,###0 [$W]';\r\n                    break;\r\n                case colTypes.HOURS:\r\n                    format = '#,###0 [$H]';\r\n                    break;\r\n                case colTypes.COSTS:\r\n                    format = '#,###.00 €';\r\n                    break;\r\n                case colTypes.PERCENT:                \r\n                    format = '0.00%';\r\n                    break;\r\n                case colTypes.INCREMENT:\r\n                    format = '[Color 10]+0.00%;[Red]-0.00%;-';\r\n                    break;\r\n            }\r\n            return format;\r\n        },\r\n        getLink: function (item) {\r\n            return angular.isFunction(this.link) ? this.link(item) : null;\r\n        },\r\n        getHeaderClass: function () {\r\n            var cc = [];\r\n            angular.forEach(this, function (value, key) {\r\n                if (value === true) {\r\n                    cc.push(key);\r\n                }\r\n            });\r\n            switch (this.type) {\r\n                case colTypes.NUMBER:\r\n                case colTypes.DOUBLE:\r\n                case colTypes.WEEKS:\r\n                case colTypes.HOURS:\r\n                case colTypes.COSTS:\r\n                case colTypes.PERCENT:\r\n                case colTypes.INCREMENT:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n            }\r\n            var columnClass = this.getColumnClass();\r\n            if (columnClass != '') {\r\n                cc.push(columnClass);\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getCellClass: function (item) {\r\n            var cc = [];            \r\n            angular.forEach(this, function (value, key) {\r\n                if (value === true) {\r\n                    cc.push(key);\r\n                }\r\n            });\r\n            switch (this.type) {\r\n                case colTypes.LINK:\r\n                    cc.push('text-underline');\r\n                    break;\r\n                case colTypes.NUMBER:\r\n                case colTypes.DOUBLE:\r\n                case colTypes.WEEKS:\r\n                case colTypes.HOURS:\r\n                case colTypes.COSTS:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n                case colTypes.PERCENT:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n                case colTypes.INCREMENT:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getColumnClass: function () {\r\n            return this.color ? 'shade-light-blue-' + this.color : '';\r\n        },\r\n        getItemClass: function (item) {\r\n            var cc = [];\r\n            cc.push(item.static[this.id].baseClass);\r\n            var columnClass = this.getColumnClass();\r\n            if (columnClass != '') {\r\n                cc.push(columnClass);\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getTextClass: function (item) {\r\n            var cc = [];\r\n            switch (this.type) {\r\n                case colTypes.INCREMENT:\r\n                    var value = this.getRaw(item);\r\n                    if (angular.isNumber(value) && value < 0) {\r\n                        cc.push('text-danger');\r\n                    } else {\r\n                        cc.push('text-success');\r\n                    }\r\n                    break;\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        getTotalClass: function (filtered) {\r\n            var cc = [];\r\n            switch (this.type) {\r\n                case colTypes.NUMBER:\r\n                case colTypes.DOUBLE:\r\n                case colTypes.WEEKS:\r\n                case colTypes.HOURS:\r\n                case colTypes.COSTS:\r\n                case colTypes.PERCENT:\r\n                case colTypes.INCREMENT:\r\n                    cc.push('text-xs-right');\r\n                    break;\r\n            }\r\n            return cc.join(' ');\r\n        },\r\n        searchToggle: function (item) {\r\n            var index = this.search.indexOf(item.id);\r\n            if (index === -1) {\r\n                item.active = true;\r\n                this.search.push(item.id);\r\n            } else {\r\n                item.active = false;\r\n                this.search.splice(index, 1);\r\n            }\r\n        },\r\n        isActive: function () {\r\n            if (angular.isFunction(this.active) && this.active) {\r\n                return this.active();\r\n            } else {\r\n                return this.active;\r\n            }\r\n        },\r\n        toggle: function () {\r\n            angular.isFunction(this.active) ? null : this.active = !this.active;\r\n        },\r\n        activate: function () {\r\n            angular.isFunction(this.active) ? null : this.active = true;\r\n        },\r\n        deactivate: function () {\r\n            angular.isFunction(this.active) ? null : this.active = false;\r\n        },\r\n        makeStatic: function (item) {\r\n            if (this.post) {\r\n                this.setters.raw(item, (this.getters.post(item) || 0));\r\n            }\r\n            var col = this;\r\n            item.static[col.id] = {\r\n                baseClass: col.getCellClass(item),\r\n                textClass: col.getTextClass(item),\r\n                value: col.getValueFormatted(item),\r\n                link: col.link ? col.link(item) : null,\r\n                pop: col.pop ? col.pop(item) : null,\r\n            };\r\n        },\r\n    };\r\n    Column.types = colTypes;\r\n    return Column;\r\n}]);\r\n\r\napp.factory('Columns', ['$parse', 'Utils', 'Column', 'colTypes', function ($parse, Utils, Column, colTypes) {\r\n    function Columns(columns) {\r\n        var list = [];\r\n        if (columns) {\r\n            angular.forEach(columns, function (col, index) {\r\n                col.id = index + 1;\r\n                list.push(new Column(col));\r\n            });\r\n        }        \r\n        angular.extend(list, Columns.prototype);\r\n        return list;\r\n    }\r\n    Columns.prototype = {\r\n        getCount: function () {\r\n            var i = 0;\r\n            angular.forEach(this, function (col) {\r\n                i += col.isActive() ? 1 : 0;\r\n            }.bind(this));\r\n            return i;\r\n        },\r\n        getFirstCol: function () {\r\n            var first = null;\r\n            angular.forEach(this, function (col) {\r\n                if (first === null && col.isActive() && col.groupBy && col.value !== 'month' && col.value !== 'monthShort') {\r\n                    first = col;\r\n                }\r\n            });\r\n            return first;\r\n        },\r\n        getChartKey: function (item, time) {\r\n            var keys = [];\r\n            angular.forEach(this, function (col) {\r\n                if (col.isActive() && col.groupBy && col.value !== 'month' && col.value !== 'monthShort' && keys.length === 0) {\r\n                    keys.push(col.getKey(item));\r\n                }\r\n            });\r\n            keys.push(time);\r\n            return keys.join('-');\r\n        },\r\n        getGroupKey: function (item) {\r\n            var keys = [];\r\n            angular.forEach(this, function (col) {\r\n                if (col.isActive() && col.groupBy) {\r\n                    keys.push(col.getKey(item));\r\n                }\r\n            });\r\n            return keys.join('-');\r\n        },\r\n        getSortKey: function (item) {\r\n            var values = [];\r\n            angular.forEach(this, function (col) {\r\n                if (col.isActive() && col.groupBy) {\r\n                    values.push(col.sort ? $parse(col.sort)(item) : col.getValueFormatted(item));\r\n                }\r\n            });\r\n            return values.join('');\r\n        },\r\n        expand: function (data) {\r\n            var options = {\r\n                dynamic: true,\r\n                compare: true,\r\n            }\r\n            data ? angular.extend(options, data) : null;\r\n            // add percentuals and compares\r\n            var array = [], cols = this;\r\n            array.radios = {};\r\n            angular.forEach(this, function (col, index) {\r\n                col.id = array.length + 1;\r\n                array.push(col);\r\n                if (col.aggregate) {\r\n                    if (options.dynamic) {\r\n                        array.push(new Column({\r\n                            id: array.length + 1,\r\n                            name: '%',\r\n                            value: function (item) {\r\n                                return col.getters.raw(item) / col.total * 100;\r\n                            },\r\n                            key: col.key,\r\n                            type: colTypes.PERCENT,\r\n                            dynamic: true,\r\n                            active: function () {\r\n                                return array.showDynamics && col.active;\r\n                            },\r\n                            col: col,\r\n                        }));\r\n                    }\r\n                    if (options.compare) {\r\n                        array.push(new Column({\r\n                            id: array.length + 1,\r\n                            name: 'anno precedente',\r\n                            value: function (item) {\r\n                                return this.getters.raw(item);\r\n                            },\r\n                            raw: col.value + 'Last',\r\n                            source: col.value,\r\n                            key: col.key,\r\n                            type: col.type, // \r\n                            count: col.count,\r\n                            compare: true,\r\n                            dynamic: true,\r\n                            active: function () {\r\n                                return array.showComparison && col.active;\r\n                            },\r\n                            col: col,\r\n                        }));\r\n                        array.push(new Column({\r\n                            id: array.length + 1,\r\n                            name: '%',\r\n                            value: function (item) {\r\n                                var current = (col.getters.raw(item) || 0);\r\n                                var previous = (this.getters.raw(item) || 0);\r\n                                if (previous) {\r\n                                    return (current - previous) / previous * 100;\r\n                                } else {\r\n                                    return null; // '+∞ %';\r\n                                }\r\n                            },\r\n                            raw: col.value + 'Gain',\r\n                            source: col.value,\r\n                            key: col.key,\r\n                            type: colTypes.INCREMENT, // col.type, // \r\n                            count: col.count,\r\n                            compare: true,\r\n                            dynamic: true,\r\n                            active: function () {\r\n                                return array.showComparison && col.active;\r\n                            },\r\n                            col: col,\r\n                        }));\r\n                    }\r\n                }\r\n                if (col.radio && col.active) {\r\n                    array.radios[col.radio] = col.value;\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getGroups: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.groupBy) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getCounters: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.count) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getAggregates: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.aggregate && !col.count) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getPercentages: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.type === colTypes.PERCENT) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getDynamics: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.dynamic) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        getCompares: function () {\r\n            var array = [];\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.compare) {\r\n                    array.push(col);\r\n                }\r\n            });\r\n            angular.extend(array, Columns.prototype);\r\n            return array;\r\n        },\r\n        reset: function () {\r\n            this.groups = {};\r\n            angular.forEach(this, function (col) {\r\n                col.reset();\r\n            });\r\n            return this;\r\n        },\r\n        makeStatic: function (items) {\r\n            //console.log('Columns.makeStatic', 'items', items.length);\r\n            angular.forEach(this, function (col, index) {\r\n                col.values = [];\r\n                col.static = {\r\n                    active: col.isActive(),\r\n                    headerClass: col.getHeaderClass(),\r\n                };\r\n            });\r\n            angular.forEach(this, function (col, index) {\r\n                if (col.static.active || col.dynamic) {\r\n                    angular.forEach(items, function (item) {\r\n                        col.makeStatic(item);\r\n                        col.groupBy ? col.addValue(item) : null;\r\n                    });\r\n                    if (col.groupBy) {\r\n                        col.values = col.values.sort(function (va, vb) {\r\n                            var a, b;\r\n                            a = va.name ? String(va.name).toLowerCase() : ''; // ignore upper and lowercase\r\n                            b = vb.name ? String(vb.name).toLowerCase() : ''; // ignore upper and lowercase\r\n                            if (a < b) {\r\n                                return -1;\r\n                            }\r\n                            if (a > b) {\r\n                                return 1;\r\n                            }\r\n                            return 0;\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        activeInRange: function (range) {\r\n            var flag = false;\r\n            var i = 0;\r\n            while (!flag && i < this.length) {\r\n                var col = this[i];\r\n                if (col.static.active) {\r\n                    flag = (range.indexOf(col.value) !== -1);\r\n                }\r\n                i++;\r\n            }\r\n            return flag;\r\n        },\r\n        unique: function (row, items) {\r\n            var key = this.getGroupKey(row);\r\n            var item = this.groups[key];\r\n            if (!item) {\r\n                item = this.groups[key] = row; // angular.copy(row);\r\n                item.static = [];\r\n                items.push(item);\r\n            }\r\n            return item;\r\n        },\r\n        iterate: function (row, items) {\r\n            row = angular.copy(row);\r\n            var item = this.unique(row, items);\r\n            this.addTotals(item, row);\r\n        },        \r\n        compare: function (row, items) {\r\n            row = angular.copy(row);\r\n            angular.forEach(this, function (col) {\r\n                if (col.compare) {\r\n                    var value = col.getters.source(row);\r\n                    col.setters.raw(row, value);\r\n                }\r\n            });\r\n            angular.forEach(this, function (col) {\r\n                if (col.compare) {\r\n                    col.setters.source(row, 0);\r\n                }\r\n            });\r\n            var item = this.unique(row, items);\r\n            this.addTotals(item, row, true);\r\n        },\r\n        addTotals: function (item, row, comparing) {\r\n            angular.forEach(this, function (col) {\r\n                if (col.isActive() && (comparing ? col.compare : !col.compare)) {\r\n                    if (col.count) {\r\n                        col.addCount(item, row);\r\n                    } else if (comparing || col.aggregate) {\r\n                        if (!col.hasKey(row)) {\r\n                            if (item === row) {\r\n                                col.initValue(item);\r\n                            } else {\r\n                                col.addTotal(item, row);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            return this;\r\n        },\r\n        toggleColumns: function (c) {\r\n            if (c.radio) {\r\n                angular.forEach(this, function (col) {\r\n                    if (c.radio === col.radio && c !== col) {\r\n                        col.deactivate();\r\n                    }\r\n                });\r\n                c.activate();\r\n                this.radios[c.radio] = c.value;\r\n            } else {\r\n                c.toggle();\r\n            }\r\n        },\r\n        searchDisabled: function (item, col, filtered) {\r\n            var id = item.id, t = this;\r\n            var has = false, index = 0;\r\n            while(index < filtered.length) {\r\n                has = has || col.getKey(filtered[index]) === id;\r\n                if (has) {\r\n                    index = filtered.length;\r\n                } else {\r\n                    index ++;\r\n                }\r\n            }\r\n            return !has;    \r\n        },\r\n        setMode: function (mode) {\r\n            this[mode] = !this[mode];\r\n            switch (mode) {\r\n                case 'showDynamics':\r\n                    this.showComparison = false;\r\n                    break;\r\n                case 'showComparison':\r\n                    this.showDynamics = false;\r\n                    break;\r\n            }\r\n            return this[mode];\r\n        },\r\n    };\r\n    Columns.types = colTypes;\r\n    return Columns;\r\n}]);\r\n\r\napp.factory('ChartData', ['$filter', function ($filter) {\r\n    function ChartData(data) {\r\n        var defaults = {\r\n            type: 'chart-line',\r\n            labels: [],\r\n            series: [],\r\n            data: [],\r\n            options: {\r\n                bezierCurve: false,\r\n                elements: {\r\n                    line: {\r\n                        tension: 0,\r\n                    }\r\n                },\r\n                scaleLabel: function (label) {\r\n                    return $filter('currency')(label.value);\r\n                },\r\n                tooltipTemplate: function (data) {\r\n                    return $filter('currency')(data.value);\r\n                },\r\n                scales: {\r\n                    yAxes: [{\r\n                        gridLines: {\r\n                            display: false\r\n                        },\r\n                        ticks: {\r\n                            min: 0,\r\n                            // max: 3,\r\n                            // stepSize: 1,\r\n                            callback: function (value, index, values) {\r\n                                return $filter('customNumber')(value, 2, ' W');\r\n                            }\r\n                        }\r\n                    }],\r\n                    callbacks: {\r\n                        label: function (label) {\r\n                            console.log('b');\r\n                            return $filter('customNumber')(label.value, 2, ' W');\r\n                        }\r\n                    }\r\n                },\r\n                tooltips: {\r\n                    callbacks: {\r\n                        title: function (tooltipItems, data) {\r\n                            return '';\r\n                        },\r\n                        label: function (tooltipItem, data) {\r\n                            var label = data.datasets[tooltipItem.datasetIndex].label;\r\n                            var datasetLabel = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];\r\n                            return label + ': ' + $filter('customNumber')(datasetLabel, 2, ' W');\r\n                        },\r\n                    }\r\n                },\r\n            },\r\n            onClick: function (points, evt) {\r\n                console.log('chart', points, evt);\r\n            },\r\n            datasetOverride: [],\r\n        };\r\n        angular.extend(this, defaults);\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    ChartData.prototype = {\r\n        getObjectParams: function (obj) {\r\n            var a = [];\r\n            if (obj) {\r\n                for (var p in obj) {\r\n                    a.push({ name: p, value: obj[p] });\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        getParams: function (source) {\r\n            var post = {}, value;\r\n            for (var p in this) {\r\n                switch (p) {\r\n                    case 'dateFrom':\r\n                    case 'dateTo':\r\n                    case 'status':\r\n                        value = this[p];\r\n                        if (value !== undefined) {\r\n                            post[p] = value;\r\n                        }\r\n                        break;\r\n                    case 'search':\r\n                    case 'sort':\r\n                        var json = JSON.stringify(this.getObjectParams(this[p]), null, '');\r\n                        post[p] = window.btoa(json);\r\n                        break;\r\n                }\r\n            }\r\n            if (!source.unpaged) {\r\n                post.page = source.page;\r\n                post.size = source.size;\r\n            }\r\n            // console.log('ChartData.getParams', post);\r\n            return post;\r\n        },\r\n        getMonths: function () {\r\n            var months = [];\r\n            if (this.dateFrom && this.dateTo) {\r\n                var range = [this.dateFrom, this.dateTo];\r\n                range = range.sort(function (a, b) {\r\n                    return a.getTime() - b.getTime();\r\n                });\r\n                function monthDiff(a, b) {\r\n                    var months;\r\n                    months = (b.getFullYear() - a.getFullYear()) * 12;\r\n                    months -= a.getMonth() + 1;\r\n                    months += b.getMonth() + 1; // we should add + 1 to get correct month number\r\n                    months++;\r\n                    // console.log(months);\r\n                    return months <= 0 ? 0 : months;\r\n                }\r\n                var diff = Math.max(1, monthDiff(range[0], range[1]));\r\n                // console.log('getMonths', range[0], range[1], diff);\r\n                var i = 0;\r\n                while (i < diff) {\r\n                    var date = new Date(range[0].getFullYear(), range[0].getMonth() + i, 1);\r\n                    months.push({\r\n                        id: date.getTime(),\r\n                        name: $filter('date')(date, '(yyyy MM) MMMM'),\r\n                        nameShort: $filter('date')(date, 'MMM yy'),\r\n                    });\r\n                    i++;\r\n                };\r\n            }\r\n            return months;\r\n        },\r\n    };\r\n    return ChartData;\r\n}]);\r\n\r\napp.service('Droppables', ['ElementRect', function (ElementRect) {\r\n    this.natives = [];\r\n    this.callbacks = [];\r\n    this.rects = [];\r\n    this.add = function (nativeElement, callback) {\r\n        this.natives.push(nativeElement);\r\n        this.callbacks.push(callback || function () { });\r\n        this.rects.push(ElementRect.fromNative(nativeElement));\r\n    };\r\n    this.remove = function (nativeElement) {\r\n        var index = this.natives.indexOf(nativeElement);\r\n        if (index !== -1) {\r\n            this.natives.splice(index, 1);\r\n            this.callbacks.splice(index, 1);\r\n            this.rects.splice(index, 1);\r\n        }\r\n    };\r\n    this.getIntersections = function (item) {\r\n        var intersections = [], element;\r\n        angular.forEach(this.rects, function (rect, index) {\r\n            rect.set(rect.native);\r\n            element = angular.element(rect.native);\r\n            element.removeClass('dropping');\r\n            if (rect.intersect(item)) {\r\n                rect.distance = rect.center.distance(item.center);\r\n                rect.data = this.callbacks[index]();\r\n                intersections.push(rect);\r\n                element.addClass('over');\r\n            } else {\r\n                element.removeClass('over');\r\n            }\r\n        }.bind(this));\r\n        intersections.sort(function (a, b) {\r\n            if (a.distance < b.distance) {\r\n                return -1;\r\n            }\r\n            if (a.distance > b.distance) {\r\n                return 1;\r\n            }\r\n            return 0;\r\n        });\r\n        return intersections;\r\n    };\r\n}]);\r\n"]}